// morphee-coffee-minified.js - https://github.com/davidedc/livecodelab
'use strict';var BlinkerMorph,BouncerMorph,BoxMorph,CircleBoxMorph,Color,ColorPaletteMorph,ColorPickerMorph,CursorMorph,FrameMorph,GrayPaletteMorph,HandMorph,HandleMorph,InspectorMorph,ListMorph,MenuItemMorph,MenuMorph,Morph,MorphicNode,MorphsListMorph,MouseSensorMorph,PenMorph,Point,Point2,Rectangle,ScrollFrameMorph,ShadowMorph,SliderButtonMorph,SliderMorph,SpeechBubbleMorph,StringFieldMorph,StringMorph,TextMorph,TriggerMorph,WorldMorph,clone,contains,copy,degrees,detect,fontHeight,getBlurredShadowSupport,
getDocumentPositionOf,getMinimumFontHeight,isFunction,isNil,isObject,isString,localize,modules,morphicVersion,newCanvas,noOperation,nop,radians,sizeOf,standardSettings,touchScreenSettings,useBlurredShadows,__hasProp={}.hasOwnProperty,__extends=function(c,a){function b(){this.constructor=c}for(var h in a)__hasProp.call(a,h)&&(c[h]=a[h]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c},__indexOf=[].indexOf||function(c){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===
c)return a;return-1};nop=function(){return function(){return null}};noOperation=function(){return null};isFunction=function(c){return"function"===typeof c};localize=function(c){return c};isNil=function(c){return void 0===c||null===c};contains=function(c,a){return c.some(function(b){return b===a})};detect=function(c,a){var b,h,d;h=0;for(d=c.length;h<d;h++)if(b=c[h],a.call(null,b))return b;return null};sizeOf=function(c){var a,b;b=0;a=void 0;for(a in c)c.hasOwnProperty(a)&&(b+=1);return b};
isString=function(c){return"string"===typeof c||c instanceof String};isObject=function(c){return null!=c&&("object"===typeof c||c instanceof Object)};radians=function(c){return c*Math.PI/180};degrees=function(c){return 180*c/Math.PI};fontHeight=function(c){return 1.2*Math.max(c,WorldMorph.MorphicPreferences.minimumFontHeight)};newCanvas=function(c){var a;a=c||{x:0};({y:0});c=document.createElement("canvas");c.width=a.x;c.height=a.y;return c};
getMinimumFontHeight=function(){var c,a,b,h,d,g;c=document.createElement("canvas");c.width=50;c.height=50;c=c.getContext("2d");c.font="1px serif";b=c.measureText("I").width;c.fillStyle="black";c.textBaseline="bottom";c.fillText("I",0,50);for(h=d=0;50>d;h=++d)for(a=g=0;0<=b?g<b:g>b;a=0<=b?++g:--g)if(a=c.getImageData(a,h,1,1),0!==a.data[3])return 50-h+1;return 0};
getBlurredShadowSupport=function(){var c,a;a=document.createElement("canvas");a.width=10;a.height=10;c=a.getContext("2d");c.fillStyle="rgb(255, 0, 0)";c.beginPath();c.arc(5,5,5,0,2*Math.PI,!0);c.closePath();c.fill();c=document.createElement("canvas");c.width=10;c.height=10;c=c.getContext("2d");c.shadowBlur=10;c.shadowColor="rgba(0, 0, 255, 1)";c.drawImage(a,0,0);return c.getImageData(0,0,1,1).data[3]?!0:!1};
getDocumentPositionOf=function(c){var a;if(null===c)return{x:0,y:0};a={x:c.offsetLeft,y:c.offsetTop};for(c=c.offsetParent;null!==c;)a.x+=c.offsetLeft,a.y+=c.offsetTop,c!==document.body&&c!==document.documentElement&&(a.x-=c.scrollLeft,a.y-=c.scrollTop),c=c.offsetParent;return a};clone=function(c){var a;return"object"===typeof c?(a=function(){},a.prototype=c,new a):c};
copy=function(c){var a,b;if("object"!==typeof c)return c;a=c.valueOf();if(c!==a)return new c.constructor(a);if(c instanceof c.constructor&&c.constructor!==Object)for(b in a=clone(c.constructor.prototype),c)c.hasOwnProperty(b)&&(a[b]=c[b]);else for(b in a={},c)a[b]||(a[b]=c[b]);return a};
getMinimumFontHeight=function(){var c,a,b,h,d,g;c=document.createElement("canvas");c.width=50;c.height=50;c=c.getContext("2d");c.font="1px serif";b=c.measureText("I").width;c.fillStyle="black";c.textBaseline="bottom";c.fillText("I",0,50);for(h=d=0;50>d;h=++d)for(a=g=0;0<=b?g<b:g>b;a=0<=b?++g:--g)if(a=c.getImageData(a,h,1,1),0!==a.data[3])return 50-h+1;return 0};
getBlurredShadowSupport=function(){var c,a;a=document.createElement("canvas");a.width=10;a.height=10;c=a.getContext("2d");c.fillStyle="rgb(255, 0, 0)";c.beginPath();c.arc(5,5,5,0,2*Math.PI,!0);c.closePath();c.fill();c=document.createElement("canvas");c.width=10;c.height=10;c=c.getContext("2d");c.shadowBlur=10;c.shadowColor="rgba(0, 0, 255, 1)";c.drawImage(a,0,0);return c.getImageData(0,0,1,1).data[3]?!0:!1};
getDocumentPositionOf=function(c){var a;if(null===c)return{x:0,y:0};a={x:c.offsetLeft,y:c.offsetTop};for(c=c.offsetParent;null!==c;)a.x+=c.offsetLeft,a.y+=c.offsetTop,c!==document.body&&c!==document.documentElement&&(a.x-=c.scrollLeft,a.y-=c.scrollTop),c=c.offsetParent;return a};clone=function(c){var a;return"object"===typeof c?(a=function(){},a.prototype=c,new a):c};
copy=function(c){var a,b;if("object"!==typeof c)return c;a=c.valueOf();if(c!==a)return new c.constructor(a);if(c instanceof c.constructor&&c.constructor!==Object)for(b in a=clone(c.constructor.prototype),c)c.hasOwnProperty(b)&&(a[b]=c[b]);else for(b in a={},c)a[b]||(a[b]=c[b]);return a};
MorphicNode=function(){function c(a,b){this.parent=null!=a?a:null;this.children=null!=b?b:[]}c.prototype.parent=null;c.prototype.children=null;c.prototype.toString=function(){return"a MorphicNode["+this.children.length.toString()+"]"};c.prototype.addChild=function(a){this.children.push(a);return a.parent=this};c.prototype.addChildFirst=function(a){this.children.splice(0,null,a);return a.parent=this};c.prototype.removeChild=function(a){a=this.children.indexOf(a);if(-1!==a)return this.children.splice(a,
1)};c.prototype.root=function(){return null!=this.parent?this.parent.root():this};c.prototype.depth=function(){return!this.parent?0:this.parent.depth()+1};c.prototype.allChildren=function(){var a;a=[this];this.children.forEach(function(b){return a=a.concat(b.allChildren())});return a};c.prototype.forAllChildren=function(a){this.children.length&&this.children.forEach(function(b){return b.forAllChildren(a)});return a.call(null,this)};c.prototype.allLeafs=function(){var a;a=[];this.allChildren().forEach(function(b){if(!b.children.length)return a.push(b)});
return a};c.prototype.allParents=function(){var a;a=[this];null!=this.parent&&(a=a.concat(this.parent.allParents()));return a};c.prototype.siblings=function(){var a=this;return!this.parent?[]:this.parent.children.filter(function(b){return b!==a})};c.prototype.parentThatIsA=function(a){return this instanceof a?this:!this.parent?null:this.parent.parentThatIsA(a)};c.prototype.parentThatIsAnyOf=function(a){var b=this;a.forEach(function(a){if(b.constructor===a)return b});return!this.parent?null:this.parent.parentThatIsAnyOf(a)};
return c}();
Morph=function(c){function a(){a.__super__.constructor.call(this);this.bounds=new Rectangle(0,0,50,40);this.color=new Color(80,80,80);this.drawNew();this.lastTime=Date.now()}__extends(a,c);a.prototype.propertyUpTheChain=[1,2,3];a.prototype.morphMethod=function(){return 3.14};a.morphStaticMethod=function(){return 3.14};a.prototype.isMorph=!0;a.prototype.bounds=null;a.prototype.color=null;a.prototype.texture=null;a.prototype.cachedTexture=null;a.prototype.lastTime=null;a.prototype.alpha=1;a.prototype.isVisible=
!0;a.prototype.isDraggable=!1;a.prototype.isTemplate=!1;a.prototype.acceptsDrops=!1;a.prototype.noticesTransparentClick=!1;a.prototype.fps=0;a.prototype.customContextMenu=null;a.prototype.trackChanges=!0;a.prototype.shadowBlur=4;a.prototype.image=null;a.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+" "+this.children.length.toString()+" "+this.bounds};a.prototype.destroy=function(){if(null!==this.parent)return this.fullChanged(),
this.parent.removeChild(this)};a.prototype.runChildrensStepFunction=function(){var b;if(!this.step)return null;b=WorldMorph.currentTime-this.lastTime;if(1>(0<this.fps?1E3/this.fps-b:0))return this.lastTime=WorldMorph.currentTime,this.step(),this.children.forEach(function(b){return b.runChildrensStepFunction()})};a.prototype.step=noOperation;a.prototype.left=function(){return this.bounds.left()};a.prototype.right=function(){return this.bounds.right()};a.prototype.top=function(){return this.bounds.top()};
a.prototype.bottom=function(){return this.bounds.bottom()};a.prototype.center=function(){return this.bounds.center()};a.prototype.bottomCenter=function(){return this.bounds.bottomCenter()};a.prototype.bottomLeft=function(){return this.bounds.bottomLeft()};a.prototype.bottomRight=function(){return this.bounds.bottomRight()};a.prototype.boundingBox=function(){return this.bounds};a.prototype.corners=function(){return this.bounds.corners()};a.prototype.leftCenter=function(){return this.bounds.leftCenter()};
a.prototype.rightCenter=function(){return this.bounds.rightCenter()};a.prototype.topCenter=function(){return this.bounds.topCenter()};a.prototype.topLeft=function(){return this.bounds.topLeft()};a.prototype.topRight=function(){return this.bounds.topRight()};a.prototype.position=function(){return this.bounds.origin};a.prototype.extent=function(){return this.bounds.extent()};a.prototype.width=function(){return this.bounds.width()};a.prototype.height=function(){return this.bounds.height()};a.prototype.boundsIncludingChildren=
function(){var b;b=this.bounds;this.children.forEach(function(a){if(a.isVisible)return b=b.merge(a.boundsIncludingChildren())});return b};a.prototype.boundsIncludingChildrenNoShadow=function(){var b;b=this.bounds;this.children.forEach(function(a){if(!(a instanceof ShadowMorph)&&a.isVisible)return b=b.merge(a.boundsIncludingChildren())});return b};a.prototype.visibleBounds=function(){var b;b=this.bounds;this.allParents().filter(function(b){return b instanceof FrameMorph}).forEach(function(a){return b=
b.intersect(a.bounds)});return b};a.prototype.moveBy=function(b){this.changed();this.bounds=this.bounds.translateBy(b);this.children.forEach(function(a){return a.moveBy(b)});return this.changed()};a.prototype.silentMoveBy=function(b){this.bounds=this.bounds.translateBy(b);return this.children.forEach(function(a){return a.silentMoveBy(b)})};a.prototype.setPosition=function(b){b=b.subtract(this.topLeft());if(0!==b.x||0!==b.y)return this.moveBy(b)};a.prototype.silentSetPosition=function(b){b=b.subtract(this.topLeft());
if(0!==b.x||0!==b.y)return this.silentMoveBy(b)};a.prototype.setLeft=function(b){return this.setPosition(new Point(b,this.top()))};a.prototype.setRight=function(b){return this.setPosition(new Point(b-this.width(),this.top()))};a.prototype.setTop=function(b){return this.setPosition(new Point(this.left(),b))};a.prototype.setBottom=function(b){return this.setPosition(new Point(this.left(),b-this.height()))};a.prototype.setCenter=function(b){return this.setPosition(b.subtract(this.extent().floorDivideBy(2)))};
a.prototype.setFullCenter=function(b){return this.setPosition(b.subtract(this.boundsIncludingChildren().extent().floorDivideBy(2)))};a.prototype.keepWithin=function(b){var a;a=this.boundsIncludingChildren().left()-b.left();0>a&&this.moveBy(new Point(-a,0));a=this.boundsIncludingChildren().right()-b.right();0<a&&this.moveBy(new Point(-a,0));a=this.boundsIncludingChildren().top()-b.top();0>a&&this.moveBy(new Point(0,-a));b=this.boundsIncludingChildren().bottom()-b.bottom();if(0<b)return this.moveBy(new Point(0,
-b))};a.prototype.setExtent=function(b){if(!b.eq(this.extent()))return this.changed(),this.silentSetExtent(b),this.changed(),this.drawNew()};a.prototype.silentSetExtent=function(b){var a;a=b.round();b=Math.max(a.x,0);a=Math.max(a.y,0);return this.bounds.corner=new Point(this.bounds.origin.x+b,this.bounds.origin.y+a)};a.prototype.setWidth=function(b){return this.setExtent(new Point(b||0,this.height()))};a.prototype.silentSetWidth=function(b){b=Math.max(Math.round(b||0),0);return this.bounds.corner=
new Point(this.bounds.origin.x+b,this.bounds.corner.y)};a.prototype.setHeight=function(b){return this.setExtent(new Point(this.width(),b||0))};a.prototype.silentSetHeight=function(b){b=Math.max(Math.round(b||0),0);return this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+b)};a.prototype.setColor=function(b){if(b&&!this.color.eq(b))return this.color=b,this.changed(),this.drawNew()};a.prototype.drawNew=function(){var b;this.image=newCanvas(this.extent());b=this.image.getContext("2d");
b.fillStyle=this.color.toString();b.fillRect(0,0,this.width(),this.height());if(this.cachedTexture)return this.drawCachedTexture();if(this.texture)return this.drawTexture(this.texture)};a.prototype.drawTexture=function(b){var a=this;this.cachedTexture=new Image;this.cachedTexture.onload=function(){return a.drawCachedTexture()};return this.cachedTexture.src=this.texture=b};a.prototype.drawCachedTexture=function(){var b,a,d,g,c,e,i,j;b=this.cachedTexture;a=Math.floor(this.image.width/b.width);g=Math.floor(this.image.height/
b.height);d=this.image.getContext("2d");for(e=i=0;0<=g?i<=g:i>=g;e=0<=g?++i:--i)for(c=j=0;0<=a?j<=a:j>=a;c=0<=a?++j:--j)d.drawImage(b,Math.round(c*b.width),Math.round(e*b.height));return this.changed()};a.prototype.drawOn=function(b,a){var d,g,c,e,i,j,k,l;if(!this.isVisible)return null;g=(a||this.bounds()).intersect(this.bounds).round();if(g.isNotEmpty()){d=this.position().neg();e=g.copy().translateBy(d).round();c=b.getContext("2d");c.globalAlpha=this.alpha;i=e.left();j=e.top();d=g.left();g=g.top();
l=Math.min(e.width(),this.image.width-i);e=Math.min(e.height(),this.image.height-j);if(1>l||1>e)return null;c.drawImage(this.image,Math.round(i),Math.round(j),Math.round(l),Math.round(e),Math.round(d),Math.round(g),Math.round(l),Math.round(e));if(WorldMorph.showRedraws)return k=Math.round(255*Math.random()),j=Math.round(255*Math.random()),i=Math.round(255*Math.random()),c.globalAlpha=0.5,c.fillStyle="rgb("+k+","+j+","+i+")",c.fillRect(Math.round(d),Math.round(g),Math.round(l),Math.round(e))}};a.prototype.fullDrawOn=
function(b,a){var d;if(!this.isVisible)return null;d=a||this.boundsIncludingChildren();this.drawOn(b,d);return this.children.forEach(function(a){return a.fullDrawOn(b,d)})};a.prototype.hide=function(){this.isVisible=!1;this.changed();return this.children.forEach(function(b){return b.hide()})};a.prototype.show=function(){this.isVisible=!0;this.changed();return this.children.forEach(function(b){return b.show()})};a.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible;this.changed();
return this.children.forEach(function(b){return b.toggleVisibility()})};a.prototype.fullImageClassic=function(){var b,a;b=this.boundsIncludingChildren();a=newCanvas(b.extent());this.fullDrawOn(a,b);a.globalAlpha=this.alpha;return a};a.prototype.fullImage=function(){var b,a;b=this.boundsIncludingChildren();a=newCanvas(b.extent());a.getContext("2d").translate(-this.bounds.origin.x,-this.bounds.origin.y);this.fullDrawOn(a,b);return a};a.prototype.shadowImage=function(b,a){var d,g,c,e,i,j;i=b||new Point(7,
7);d=a||new Color(0,0,0);c=this.boundsIncludingChildren().extent();e=this.fullImage();j=newCanvas(c);g=j.getContext("2d");g.drawImage(e,0,0);g.globalCompositeOperation="destination-out";g.drawImage(e,Math.round(-i.x),Math.round(-i.y));e=newCanvas(c);g=e.getContext("2d");g.drawImage(j,0,0);g.globalCompositeOperation="source-atop";g.fillStyle=d.toString();g.fillRect(0,0,c.x,c.y);return e};a.prototype.shadowImageBlurred=function(b,a){var d,g,c,e,i,j;i=b||new Point(7,7);d=this.shadowBlur;g=a||new Color(0,
0,0);c=this.boundsIncludingChildren().extent().add(2*d);e=this.fullImage();j=newCanvas(c);c=j.getContext("2d");c.shadowOffsetX=i.x;c.shadowOffsetY=i.y;c.shadowBlur=d;c.shadowColor=g.toString();c.drawImage(e,Math.round(d-i.x),Math.round(d-i.y));c.shadowOffsetX=0;c.shadowOffsetY=0;c.shadowBlur=0;c.globalCompositeOperation="destination-out";c.drawImage(e,Math.round(d-i.x),Math.round(d-i.y));return j};a.prototype.shadow=function(b,a,d){var g,c;c=new ShadowMorph;b=b||new Point(7,7);a=a||(0===a?0:0.2);
g=this.boundsIncludingChildren();c.setExtent(g.extent().add(2*this.shadowBlur));useBlurredShadows?(c.image=this.shadowImageBlurred(b,d),c.alpha=a,c.setPosition(g.origin.add(b).subtract(this.shadowBlur))):(c.image=this.shadowImage(b,d),c.alpha=a,c.setPosition(g.origin.add(b)));return c};a.prototype.addShadow=function(b,a,d){b=this.shadow(b||new Point(7,7),a||(0===a?0:0.2),d);this.addBack(b);this.fullChanged();return b};a.prototype.getShadow=function(){var b;b=this.children.slice(0).reverse().filter(function(b){return b instanceof
ShadowMorph});return b.length?b[0]:null};a.prototype.removeShadow=function(){var b;b=this.getShadow();if(null!==b)return this.fullChanged(),this.removeChild(b)};a.prototype.penTrails=function(){return this.image};a.prototype.changed=function(){var b;this.trackChanges&&(b=this.root(),b instanceof WorldMorph&&b.broken.push(this.visibleBounds().spread()));if(this.parent)return this.parent.childChanged(this)};a.prototype.fullChanged=function(){var b;if(this.trackChanges&&(b=this.root(),b instanceof WorldMorph))return b.broken.push(this.boundsIncludingChildren().spread())};
a.prototype.childChanged=function(){if(this.parent)return this.parent.childChanged(this)};a.prototype.world=function(){var b;b=this.root();return b instanceof WorldMorph?b:b instanceof HandMorph?b.world:null};a.prototype.add=function(b){var a;a=b.parent;null!=a&&a.removeChild(b);return this.addChild(b)};a.prototype.addBack=function(b){var a;a=b.parent;null!=a&&a.removeChild(b);return this.addChildFirst(b)};a.prototype.topMorphSuchThat=function(b){var a;return b.call(null,this)?(a=detect(this.children.slice(0).reverse(),
b))?a.topMorphSuchThat(b):this:null};a.prototype.morphAt=function(b){var a,d;a=this.allChildren().slice(0).reverse();d=null;a.forEach(function(a){if(a.boundsIncludingChildren().containsPoint(b)&&null===d)return d=a});return d};a.prototype.overlappedMorphs=function(){var b,a,d,g,c=this;g=this.world();d=this.boundsIncludingChildren();a=this.allParents();b=this.allChildren();return g.allChildren().filter(function(e){return e.isVisible&&e!==c&&e!==g&&!contains(a,e)&&!contains(b,e)&&e.boundsIncludingChildren().intersects(d)})};
a.prototype.getPixelColor=function(b){b=b.subtract(this.bounds.origin);b=this.image.getContext("2d").getImageData(b.x,b.y,1,1);return new Color(b.data[0],b.data[1],b.data[2],b.data[3])};a.prototype.isTransparentAt=function(b){var a;if(this.bounds.containsPoint(b)){if(this.texture)return!1;a=b.subtract(this.bounds.origin);b=this.image.getContext("2d");b=b.getImageData(Math.floor(a.x),Math.floor(a.y),1,1);return 0===b.data[3]}return!1};a.prototype.copy=function(){var b;b=copy(this);b.parent=null;b.children=
[];b.bounds=this.bounds.copy();return b};a.prototype.fullCopy=function(){var b,a;a={};b=this.copyRecordingReferences(a);b.forAllChildren(function(b){return b.updateReferences(a)});return b};a.prototype.copyRecordingReferences=function(b){var a;a=this.copy();b[this]=a;this.children.forEach(function(d){return a.add(d.copyRecordingReferences(b))});return a};a.prototype.updateReferences=function(b){var a,d;d=[];for(a in this)a.isMorph&&b[a]?d.push(this[a]=b[a]):d.push(void 0);return d};a.prototype.rootForGrab=
function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||!0===this.isDraggable?this:this.parent.rootForGrab()};a.prototype.wantsDropOf=function(b){return b instanceof HandleMorph||b instanceof MenuMorph||b instanceof InspectorMorph?!1:this.acceptsDrops};a.prototype.pickUp=function(b){b=b||this.world();this.setPosition(b.hand.position().subtract(this.extent().floorDivideBy(2)));
return b.hand.grab(this)};a.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)};a.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null};a.prototype.slideBackTo=function(b,a){var d,g,c,e,i,j,k,l=this;i=a||5;c=b.origin.position().add(b.position);j=-(this.left()-c.x)/i;k=-(this.top()-c.y)/i;e=0;g=this.step;d=this.fps;this.fps=0;return this.step=function(){l.fullChanged();l.silentMoveBy(new Point(j,
k));l.fullChanged();e+=1;if(e===i)return b.origin.add(l),b.origin.reactToDropOf&&b.origin.reactToDropOf(l),l.step=g,l.fps=d}};a.prototype.resize=function(){return this.world().activeHandle=new HandleMorph(this)};a.prototype.move=function(){return this.world().activeHandle=new HandleMorph(this,null,null,null,null,"move")};a.prototype.hint=function(b){var a;(a=b)?b.toString&&(a=b.toString()):a="NULL";b=new MenuMorph(this,a);b.isDraggable=!0;return b.popUpCenteredAtHand(this.world())};a.prototype.inform=
function(b){var a;(a=b)?b.toString&&(a=b.toString()):a="NULL";b=new MenuMorph(this,a);b.addItem("Ok");b.isDraggable=!0;return b.popUpCenteredAtHand(this.world())};a.prototype.prompt=function(b,a,d,c,f,e,i,j){var k,l;i&&(l=!0);b=new MenuMorph(a||null,b||"",d||null);k=new StringFieldMorph(c||"",f||100,WorldMorph.MorphicPreferences.prompterFontSize,WorldMorph.MorphicPreferences.prompterFontName,!1,!1,l);b.items.push(k);if(i||WorldMorph.MorphicPreferences.useSliderForInput)c=new SliderMorph(e||0,i,parseFloat(c),
Math.floor((i-e)/4),"horizontal"),c.alpha=1,c.color=new Color(225,225,225),c.button.color=b.borderColor,c.button.highlightColor=c.button.color.copy(),c.button.highlightColor.b+=100,c.button.pressColor=c.button.color.copy(),c.button.pressColor.b+=150,c.setHeight(WorldMorph.MorphicPreferences.prompterSliderSize),c.action=j?function(b){k.changed();k.text.text=Math.round(b).toString();k.text.drawNew();k.text.changed();return k.text.edit()}:function(b){k.changed();k.text.text=b.toString();k.text.drawNew();
return k.text.changed()},b.items.push(c);b.addLine(2);b.addItem("Ok",function(){return k.string()});b.addItem("Cancel",function(){return null});b.isDraggable=!0;b.popUpAtHand(this.world());return k.text.edit()};a.prototype.pickColor=function(b,a,d,c){var f,b=new MenuMorph(a||null,b||"",d||null);f=new ColorPickerMorph(c);b.items.push(f);b.addLine(2);b.addItem("Ok",function(){return f.getChoice()});b.addItem("Cancel",function(){return null});b.isDraggable=!0;return b.popUpAtHand(this.world())};a.prototype.inspect=
function(b){var a,d;d=this.world instanceof Function?this.world():this.root()||this.world;a=this;b&&(a=b);b=new InspectorMorph(a);b.setPosition(d.hand.position());b.keepWithin(d);d.add(b);return b.changed()};a.prototype.contextMenu=function(){var b;return this.customContextMenu?this.customContextMenu:(b=this.world instanceof Function?this.world():this.root()||this.world)&&b.isDevMode?this.parent===b?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu()};a.prototype.hierarchyMenu=
function(){var b,a,d;a=this.allParents();d=this.world instanceof Function?this.world():this.root()||this.world;b=new MenuMorph(this,null);a.forEach(function(a){if(a.developersMenu&&a!==d)return b.addItem(a.toString().slice(0,50),function(){return a.developersMenu().popUpAtHand(d)})});return b};a.prototype.developersMenu=function(){var b,a,d;d=this.world instanceof Function?this.world():this.root()||this.world;a=this.userMenu()||this.parent&&this.parent.userMenu();b=new MenuMorph(this,this.constructor.name||
this.constructor.toString().split(" ")[1].split("(")[0]);a&&(b.addItem("user features...",function(){return a.popUpAtHand(d)}),b.addLine());b.addItem("color...",function(){return this.pickColor(b.title+"\ncolor:",this.setColor,this,this.color)},"choose another color \nfor this morph");b.addItem("transparency...",function(){return this.prompt(b.title+"\nalpha\nvalue:",this.setAlphaScaled,this,(this.alpha*100).toString(),null,1,100,true)},"set this morph's\nalpha value");b.addItem("resize...","resize",
"show a handle\nwhich can be dragged\nto change this morph's extent");b.addLine();b.addItem("duplicate",function(){return this.fullCopy().pickUp(this.world())},"make a copy\nand pick it up");b.addItem("pick up","pickUp","disattach and put \ninto the hand");b.addItem("attach...","attach","stick this morph\nto another one");b.addItem("move...","move","show a handle\nwhich can be dragged\nto move this morph");b.addItem("inspect...","inspect","open a window\non all properties");b.addItem("pic...",function(){return window.open(this.fullImage().toDataURL())},
"open a new window\nwith a picture of this morph");b.addLine();this.isDraggable?b.addItem("lock","toggleIsDraggable","make this morph\nunmovable"):b.addItem("unlock","toggleIsDraggable","make this morph\nmovable");b.addItem("hide","hide");b.addItem("delete","destroy");this instanceof WorldMorph||(b.addLine(),b.addItem("World...",function(){return d.contextMenu().popUpAtHand(d)},"show the\nWorld's menu"));return b};a.prototype.userMenu=function(){return null};a.prototype.setAlphaScaled=function(b){"number"===
typeof b?this.alpha=Math.min(Math.max(b/100,0.1),1):(b=parseFloat(b),isNaN(b)||(this.alpha=Math.min(Math.max(b/100,0.1),1)));return this.changed()};a.prototype.attach=function(){var b,a,d=this;b=this.overlappedMorphs();a=new MenuMorph(this,"choose new parent:");b.forEach(function(b){return a.addItem(b.toString().slice(0,50),function(){b.add(d);return d.isDraggable=!1})});if(b.length)return a.popUpAtHand(this.world())};a.prototype.toggleIsDraggable=function(){return this.isDraggable=!this.isDraggable};
a.prototype.colorSetters=function(){return["color"]};a.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled"]};a.prototype.allEntryFields=function(){return this.allChildren().filter(function(b){return b.isEditable&&(b instanceof StringMorph||b instanceof TextMorph)})};a.prototype.nextEntryField=function(b){var a;a=this.allEntryFields();b=a.indexOf(b);return-1!==b&&a.length>b+1?a[b+1]:a[0]};a.prototype.previousEntryField=function(b){var a;a=this.allEntryFields();
b=a.indexOf(b);return-1!==b?0<b?a[b-1]:a[a.length-1]:a[0]};a.prototype.tab=function(b){if(this.nextTab)return this.nextTab(b);if(this.parent)return this.parent.tab(b)};a.prototype.backTab=function(b){if(this.previousTab)return this.previousTab(b);if(this.parent)return this.parent.backTab(b)};a.prototype.escalateEvent=function(b,a){var d;for(d=this.parent;!d[b]&&null!=d.parent;)d=d.parent;if(d[b])return d[b](a)};a.prototype.evaluateString=function(b){var a;try{a=eval(b),this.drawNew(),this.changed()}catch(d){this.inform(d)}return a};
a.prototype.isTouching=function(b){b=this.overlappingImage(b);b=b.getContext("2d").getImageData(1,1,b.width,b.height).data;return null!==detect(b,function(b){return 0!==b})};a.prototype.overlappingImage=function(b){var a,d,c,f,e;d=this.boundsIncludingChildren();e=b.boundsIncludingChildren();f=d.intersect(e);c=newCanvas(f.extent());a=c.getContext("2d");if(1>f.width()||1>f.height())return newCanvas(new Point(1,1));a.drawImage(this.fullImage(),Math.round(f.origin.x-d.origin.x),Math.round(f.origin.y-
d.origin.y));a.globalCompositeOperation="source-in";a.drawImage(b.fullImage(),Math.round(e.origin.x-f.origin.x),Math.round(e.origin.y-f.origin.y));return c};return a}(MorphicNode);
BoxMorph=function(c){function a(b,h,d){this.edge=null!=b?b:4;this.border=h||(0===h?0:2);this.borderColor=d||new Color;a.__super__.constructor.call(this)}__extends(a,c);a.prototype.edge=null;a.prototype.border=null;a.prototype.borderColor=null;a.prototype.drawNew=function(){var b;this.image=newCanvas(this.extent());b=this.image.getContext("2d");if(0===this.edge&&0===this.border)return a.__super__.drawNew.call(this),null;b.fillStyle=this.color.toString();b.beginPath();this.outlinePath(b,Math.max(this.edge-
this.border,0),this.border);b.closePath();b.fill();if(0<this.border)return b.lineWidth=this.border,b.strokeStyle=this.borderColor.toString(),b.beginPath(),this.outlinePath(b,this.edge,this.border/2),b.closePath(),b.stroke()};a.prototype.outlinePath=function(b,a,d){var c,f;c=a+d;f=this.width();d=this.height();b.arc(c,c,a,radians(-180),radians(-90),!1);b.arc(f-c,c,a,radians(-90),radians(-0.0),!1);b.arc(f-c,d-c,a,radians(0),radians(90),!1);return b.arc(c,d-c,a,radians(90),radians(180),!1)};a.prototype.developersMenu=
function(){var b;b=a.__super__.developersMenu.call(this);b.addLine();b.addItem("border width...",function(){return this.prompt(b.title+"\nborder\nwidth:",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)},"set the border's\nline size");b.addItem("border color...",function(){return this.pickColor(b.title+"\nborder color:",this.setBorderColor,this,this.borderColor)},"set the border's\nline color");b.addItem("corner size...",function(){return this.prompt(b.title+"\ncorner\nsize:",this.setCornerSize,
this,this.edge.toString(),null,0,100,!0)},"set the corner's\nradius");return b};a.prototype.setBorderWidth=function(b){"number"===typeof b?this.border=Math.max(b,0):(b=parseFloat(b),isNaN(b)||(this.border=Math.max(b,0)));this.drawNew();return this.changed()};a.prototype.setBorderColor=function(b){if(b)return this.borderColor=b,this.drawNew(),this.changed()};a.prototype.setCornerSize=function(b){"number"===typeof b?this.edge=Math.max(b,0):(b=parseFloat(b),isNaN(b)||(this.edge=Math.max(b,0)));this.drawNew();
return this.changed()};a.prototype.colorSetters=function(){return["color","borderColor"]};a.prototype.numericalSetters=function(){var b;b=a.__super__.numericalSetters.call(this);b.push("setBorderWidth","setCornerSize");return b};return a}(Morph);
MouseSensorMorph=function(c){function a(b,h,d){a.__super__.constructor.apply(this,arguments);this.edge=b||4;this.border=h||2;this.color=new Color(255,255,255);this.borderColor=d||new Color;this.isTouched=!1;this.upStep=0.05;this.downStep=0.02;this.noticesTransparentClick=!1;this.drawNew()}__extends(a,c);a.prototype.touch=function(){var b=this;if(!this.isTouched)return this.isTouched=!0,this.alpha=0.6,this.step=function(){b.isTouched?1>b.alpha&&(b.alpha+=b.upStep):b.alpha>b.downStep?b.alpha-=b.downStep:
(b.alpha=0,b.step=null);return b.changed()}};a.prototype.unTouch=function(){return this.isTouched=!1};a.prototype.mouseEnter=function(){return this.touch()};a.prototype.mouseLeave=function(){return this.unTouch()};a.prototype.mouseDownLeft=function(){return this.touch()};a.prototype.mouseClickLeft=function(){return this.unTouch()};return a}(BoxMorph);
Point=function(){function c(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}c.prototype.x=null;c.prototype.y=null;c.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())};c.prototype.copy=function(){return new c(this.x,this.y)};c.prototype.eq=function(a){return this.x===a.x&&this.y===a.y};c.prototype.lt=function(a){return this.x<a.x&&this.y<a.y};c.prototype.gt=function(a){return this.x>a.x&&this.y>a.y};c.prototype.ge=function(a){return this.x>=a.x&&this.y>=
a.y};c.prototype.le=function(a){return this.x<=a.x&&this.y<=a.y};c.prototype.max=function(a){return new c(Math.max(this.x,a.x),Math.max(this.y,a.y))};c.prototype.min=function(a){return new c(Math.min(this.x,a.x),Math.min(this.y,a.y))};c.prototype.round=function(){return new c(Math.round(this.x),Math.round(this.y))};c.prototype.abs=function(){return new c(Math.abs(this.x),Math.abs(this.y))};c.prototype.neg=function(){return new c(-this.x,-this.y)};c.prototype.mirror=function(){return new c(this.y,
this.x)};c.prototype.floor=function(){return new c(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))};c.prototype.ceil=function(){return new c(Math.ceil(this.x),Math.ceil(this.y))};c.prototype.add=function(a){return a instanceof c?new c(this.x+a.x,this.y+a.y):new c(this.x+a,this.y+a)};c.prototype.subtract=function(a){return a instanceof c?new c(this.x-a.x,this.y-a.y):new c(this.x-a,this.y-a)};c.prototype.multiplyBy=function(a){return a instanceof c?new c(this.x*a.x,this.y*a.y):new c(this.x*
a,this.y*a)};c.prototype.divideBy=function(a){return a instanceof c?new c(this.x/a.x,this.y/a.y):new c(this.x/a,this.y/a)};c.prototype.floorDivideBy=function(a){return a instanceof c?new c(Math.floor(this.x/a.x),Math.floor(this.y/a.y)):new c(Math.floor(this.x/a),Math.floor(this.y/a))};c.prototype.r=function(){var a;a=this.multiplyBy(this);return Math.sqrt(a.x+a.y)};c.prototype.degrees=function(){var a;if(0===this.x)return 0<=this.y?90:270;a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?degrees(a):
360+degrees(a):180+degrees(a)};c.prototype.theta=function(){var a;if(0===this.x)return 0<=this.y?radians(90):radians(270);a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?a:radians(360)+a:radians(180)+a};c.prototype.crossProduct=function(a){return this.multiplyBy(a.mirror())};c.prototype.distanceTo=function(a){return a.subtract(this).r()};c.prototype.rotate=function(a,b){var h;h=this.subtract(b);return"right"===a?(new c(-h.y,h.y)).add(b):"left"===a?(new c(h.y,-h.y)).add(b):b.subtract(h)};c.prototype.flip=
function(a,b){return"vertical"===a?new c(this.x,2*b.y-this.y):new c(2*b.x-this.x,this.y)};c.prototype.distanceAngle=function(a,b){var h,d;h=b;270<h?h-=360:-270>h&&(h+=360);if(-90<=h&&90>=h)return h=Math.sin(radians(h))*a,d=Math.sqrt(a*a-h*h),new c(h+this.x,this.y-d);h=Math.sin(radians(180-h))*a;d=Math.sqrt(a*a-h*h);return new c(h+this.x,this.y+d)};c.prototype.scaleBy=function(a){return this.multiplyBy(a)};c.prototype.translateBy=function(a){return this.add(a)};c.prototype.rotateBy=function(a,b){var h,
d,g;h=b||new c(0,0);d=this.subtract(h);g=d.r();d=a-d.theta();return new c(h.x+g*Math.cos(d),h.y-g*Math.sin(d))};c.prototype.asArray=function(){return[this.x,this.y]};c.prototype.corner=function(a){return new Rectangle(this.x,this.y,a.x,a.y)};c.prototype.rectangle=function(a){var b;b=this.min(a);a=this.max(a);return new Rectangle(b.x,b.y,a.x,a.y)};c.prototype.extent=function(a){a=this.add(a);return new Rectangle(this.x,this.y,a.x,a.y)};return c}();
FrameMorph=function(c){function a(b){this.scrollFrame=null!=b?b:null;a.__super__.constructor.call(this);this.color=new Color(255,250,245);this.drawNew();this.acceptsDrops=!0;this.scrollFrame&&(this.noticesTransparentClick=this.isDraggable=!1,this.alpha=0)}__extends(a,c);a.scrollFrame=null;a.prototype.boundsIncludingChildren=function(){var b;b=this.getShadow();return null!==b?this.bounds.merge(b.bounds):this.bounds};a.prototype.fullImage=function(){return this.image};a.prototype.fullDrawOn=function(b,
a){var d,c;if(!this.isVisible)return null;d=a||this.boundsIncludingChildren();c=this.bounds.intersect(d);if(c.isEmpty())return null;this.drawOn(b,c);return this.children.forEach(function(a){return a instanceof ShadowMorph?a.fullDrawOn(b,d):a.fullDrawOn(b,c)})};a.prototype.moveBy=function(b){this.changed();this.bounds=this.bounds.translateBy(b);this.children.forEach(function(a){return a.silentMoveBy(b)});return this.changed()};a.prototype.submorphBounds=function(){var b;b=null;this.children.length&&
(b=this.children[0].bounds,this.children.forEach(function(a){return b=b.merge(a.boundsIncludingChildren())}));return b};a.prototype.keepInScrollFrame=function(){if(null===this.scrollFrame)return null;this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0));this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0));this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top()));if(this.bottom()<
this.scrollFrame.bottom())return this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))};a.prototype.adjustBounds=function(){var b,a=this;if(null===this.scrollFrame)return null;b=(b=this.submorphBounds())&&!this.scrollFrame.isTextLineWrapping?b.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy();this.bounds.eq(b)||(this.bounds=b,this.drawNew(),this.keepInScrollFrame());this.scrollFrame.isTextLineWrapping&&this.children.forEach(function(b){if(b instanceof
TextMorph){b.setWidth(a.width());return a.setHeight(Math.max(b.height(),a.scrollFrame.height()))}});return this.scrollFrame.adjustScrollBars()};a.prototype.reactToDropOf=function(){return this.adjustBounds()};a.prototype.reactToGrabOf=function(){return this.adjustBounds()};a.prototype.copyRecordingReferences=function(b){var h;h=a.__super__.copyRecordingReferences.call(this,b);h.frame&&b[this.scrollFrame]&&(h.frame=b[this.scrollFrame]);return h};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);
this.children.length&&(b.addLine(),b.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"));return b};a.prototype.keepAllSubmorphsWithin=function(){var b=this;return this.children.forEach(function(a){return a.keepWithin(b)})};return a}(Morph);
ScrollFrameMorph=function(c){function a(b,h,d){var c=this;a.__super__.constructor.call(this);this.scrollBarSize=h||WorldMorph.MorphicPreferences.scrollBarSize;this.contents=b||new FrameMorph(this);this.add(this.contents);this.hBar=new SliderMorph(null,null,null,null,"horizontal",d);this.hBar.setHeight(this.scrollBarSize);this.hBar.action=function(b){return c.contents.setPosition(new Point(c.left()-b,c.contents.position().y))};this.hBar.isDraggable=!1;this.add(this.hBar);this.vBar=new SliderMorph(null,
null,null,null,"vertical",d);this.vBar.setWidth(this.scrollBarSize);this.vBar.action=function(b){return c.contents.setPosition(new Point(c.contents.position().x,c.top()-b))};this.vBar.isDraggable=!1;this.add(this.vBar)}__extends(a,c);a.prototype.autoScrollTrigger=null;a.prototype.hasVelocity=!0;a.prototype.padding=0;a.prototype.growth=0;a.prototype.isTextLineWrapping=!1;a.prototype.isScrollingByDragging=!0;a.prototype.scrollBarSize=null;a.prototype.contents=null;a.prototype.vBar=null;a.prototype.hBar=
null;a.prototype.adjustScrollBars=function(){var b,a;b=this.width()-this.scrollBarSize;a=this.height()-this.scrollBarSize;this.changed();this.contents.width()>this.width()+WorldMorph.MorphicPreferences.scrollBarSize?(this.hBar.show(),this.hBar.width()!==b&&this.hBar.setWidth(b),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width(),this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=
this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide();return this.contents.height()>this.height()+this.scrollBarSize?(this.vBar.show(),this.vBar.height()!==a&&this.vBar.setHeight(a),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height(),this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide()};a.prototype.addContents=
function(b){this.contents.add(b);return this.contents.adjustBounds()};a.prototype.setContents=function(b){this.contents.children.forEach(function(b){return b.destroy()});this.contents.children=[];b.setPosition(this.position().add(this.padding+2));return this.addContents(b)};a.prototype.setExtent=function(b){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy());a.__super__.setExtent.call(this,b);return this.contents.adjustBounds()};a.prototype.scrollX=function(b){var a,d,c,f;a=
this.contents.left();c=this.left();d=this.contents.width();f=this.right();b=a+b;b>c&&(b=c);b+d<f&&(b=f-d);if(b!==a)return this.contents.setLeft(b)};a.prototype.scrollY=function(b){var a,d,c,f;c=this.contents.top();f=this.top();d=this.contents.height();a=this.bottom();b=c+b;b>f&&(b=f);b+d<a&&(b=a-d);if(b!==c)return this.contents.setTop(b)};a.prototype.mouseDownLeft=function(b){var a,d,c,f,e=this;if(!this.isScrollingByDragging)return null;f=this.root();c=b;d=a=0;return this.step=function(){var b;f.hand.mouseButton&&
!f.hand.children.length&&e.bounds.containsPoint(f.hand.position())?(b=f.hand.bounds.origin,a=b.x-c.x,0!==a&&e.scrollX(a),d=b.y-c.y,0!==d&&e.scrollY(d),c=b):e.hasVelocity?0.5>Math.abs(a)&&0.5>Math.abs(d)?e.step=noOperation:(a*=0.8,e.scrollX(Math.round(a)),d*=0.8,e.scrollY(Math.round(d))):e.step=noOperation;return e.adjustScrollBars()}};a.prototype.startAutoScrolling=function(){var b,a,d,c=this;a=3*WorldMorph.MorphicPreferences.scrollBarSize;d=this.world();if(!d)return null;b=d.hand;this.autoScrollTrigger||
(this.autoScrollTrigger=Date.now());return this.step=function(){var d,e;e=b.bounds.origin;d=c.bounds.insetBy(a);if(c.bounds.containsPoint(e)&&!d.containsPoint(e)&&b.children.length)return c.autoScroll(e);c.step=noOperation;return c.autoScrollTrigger=null}};a.prototype.autoScroll=function(b){var a,d;if(500>Date.now()-this.autoScrollTrigger)return null;d=3*WorldMorph.MorphicPreferences.scrollBarSize;a=this.topLeft().extent(new Point(this.width(),d));a.containsPoint(b)&&this.scrollY(d-(b.y-this.top()));
a=this.topLeft().extent(new Point(d,this.height()));a.containsPoint(b)&&this.scrollX(d-(b.x-this.left()));a=(new Point(this.right()-d,this.top())).extent(new Point(d,this.height()));a.containsPoint(b)&&this.scrollX(-(d-(this.right()-b.x)));a=(new Point(this.left(),this.bottom()-d)).extent(new Point(this.width(),d));a.containsPoint(b)&&this.scrollY(-(d-(this.bottom()-b.y)));return this.adjustScrollBars()};a.prototype.scrollCursorIntoView=function(b){var a,d,c,f;f=b.target;c=f.position().subtract(this.contents.position());
d=this.top()+this.padding;a=this.bottom()-this.padding;this.contents.setExtent(f.extent().add(c).add(this.padding));b.top()<d?(this.contents.setTop(this.contents.top()+d-b.top()),b.setTop(d)):b.bottom()>a&&(this.contents.setBottom(this.contents.bottom()+a-b.bottom()),b.setBottom(a));return this.adjustScrollBars()};a.prototype.mouseScroll=function(b,a){b&&this.scrollY(b*WorldMorph.MorphicPreferences.mouseScrollAmount);a&&this.scrollX(a*WorldMorph.MorphicPreferences.mouseScrollAmount);return this.adjustScrollBars()};
a.prototype.copyRecordingReferences=function(b){var h;h=a.__super__.copyRecordingReferences.call(this,b);h.contents&&b[this.contents]&&(h.contents=b[this.contents]);h.hBar&&b[this.hBar]&&(h.hBar=b[this.hBar],h.hBar.action=function(b){return h.contents.setPosition(new Point(h.left()-b,h.contents.position().y))});h.vBar&&b[this.vBar]&&(h.vBar=b[this.vBar],h.vBar.action=function(b){return h.contents.setPosition(new Point(h.contents.position().x,h.top()-b))});return h};a.prototype.developersMenu=function(){var b;
b=a.__super__.developersMenu.call(this);this.isTextLineWrapping?b.addItem("auto line wrap off...","toggleTextLineWrapping","turn automatic\nline wrapping\noff"):b.addItem("auto line wrap on...","toggleTextLineWrapping","enable automatic\nline wrapping");return b};a.prototype.toggleTextLineWrapping=function(){return this.isTextLineWrapping=!this.isTextLineWrapping};return a}(FrameMorph);
Color=function(){function c(a,b,h,d){this.r=null!=a?a:0;this.g=null!=b?b:0;this.b=null!=h?h:0;this.a=d||(0===d?0:1)}c.prototype.a=null;c.prototype.r=null;c.prototype.g=null;c.prototype.b=null;c.prototype.toString=function(){return"rgba("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+","+this.a+")"};c.prototype.copy=function(){return new c(this.r,this.g,this.b,this.a)};c.prototype.eq=function(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b};c.prototype.hsv=function(){var a,
b,h,d,c,f,e;e=this.r/255;h=this.g/255;a=this.b/255;c=Math.max(e,h,a);f=Math.min(e,h,a);d=c;b=c-f;if(c===f)d=0;else{switch(c){case e:d=(h-a)/b+(h<a?6:0);break;case h:d=(a-e)/b+2;break;case a:d=(e-h)/b+4}d/=6}return[d,0===c?0:b/c,c]};c.prototype.set_hsv=function(a,b,h){var d,c,f;c=Math.floor(6*a);d=6*a-c;a=h*(1-b);f=h*(1-d*b);b=h*(1-(1-d)*b);switch(c%6){case 0:this.r=h;this.g=b;this.b=a;break;case 1:this.r=f;this.g=h;this.b=a;break;case 2:this.r=a;this.g=h;this.b=b;break;case 3:this.r=a;this.g=f;this.b=
h;break;case 4:this.r=b;this.g=a;this.b=h;break;case 5:this.r=h,this.g=a,this.b=f}this.r*=255;this.g*=255;return this.b*=255};c.prototype.mixed=function(a,b){var h,d;h=Math.min(Math.max(a,0),1);d=1-h;return new c(this.r*h+b.r*d,this.g*h+b.g*d,this.b*h+b.b*d)};c.prototype.darker=function(a){var b;b=0.8333;a&&(b=(100-a)/100);return this.mixed(b,new c(0,0,0))};c.prototype.lighter=function(a){var b;b=0.8333;a&&(b=(100-a)/100);return this.mixed(b,new c(255,255,255))};c.prototype.dansDarker=function(){var a,
b,h;a=this.hsv();b=new c;h=Math.max(a[2]-0.16,0);b.set_hsv(a[0],a[1],h);return b};return c}();modules={};useBlurredShadows=getBlurredShadowSupport();standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:"sans-serif",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0};
touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:"sans-serif",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0};
InspectorMorph=function(c){function a(b){this.target=b;a.__super__.constructor.call(this);this.silentSetExtent(new Point(20*WorldMorph.MorphicPreferences.handleSize,40*WorldMorph.MorphicPreferences.handleSize/3));this.isDraggable=!0;this.border=1;this.edge=5;this.color=new Color(60,60,60);this.borderColor=new Color(95,95,95);this.drawNew();this.target&&this.buildPanes()}__extends(a,c);a.prototype.target=null;a.prototype.currentProperty=null;a.prototype.showing="attributes";a.prototype.markOwnershipOfProperties=
!1;a.prototype.label=null;a.prototype.list=null;a.prototype.detail=null;a.prototype.work=null;a.prototype.buttonInspect=null;a.prototype.buttonClose=null;a.prototype.buttonSubset=null;a.prototype.buttonEdit=null;a.prototype.resizer=null;a.prototype.setTarget=function(b){this.target=b;this.currentProperty=null;return this.buildPanes()};a.prototype.buildPanes=function(){var b,h,d,c,f,e=this;b=[];this.children.forEach(function(b){if(b!==this.work)return b.destroy()});this.children=[];this.label=new TextMorph(this.target.toString());
this.label.fontSize=WorldMorph.MorphicPreferences.menuFontSize;this.label.isBold=!0;this.label.color=new Color(255,255,255);this.label.drawNew();this.add(this.label);for(h in this.target)h&&b.push(h);"attributes"===this.showing?b=b.filter(function(b){return!isFunction(e.target[b])}):"methods"===this.showing&&(b=b.filter(function(b){return isFunction(e.target[b])}));c=Object.getOwnPropertyNames(this.target.constructor);c=c.filter(function(b){return"name"!==b&&"length"!==b&&"prototype"!==b&&"caller"!==
b&&"__super__"!==b&&"arguments"!==b});"attributes"===this.showing?(d=[],h=c.filter(function(b){return!isFunction(e.target.constructor[b])})):"methods"===this.showing?(d=c.filter(function(b){return isFunction(e.target.constructor[b])}),h=[]):(d=c.filter(function(b){return isFunction(e.target.constructor[b])}),h=c.filter(function(b){return 0>__indexOf.call(d,b)}));b=b.concat(d).concat(h);this.markOwnershipOfProperties&&(f=Object.getOwnPropertyNames(this.target.constructor.prototype));this.list=new ListMorph(this.target instanceof
Array?b:b.sort(),null,this.markOwnershipOfProperties?[[new Color(0,0,180),function(){return true}],[new Color(255,165,0),function(b){return __indexOf.call(c,b)>=0}],[new Color(0,180,0),function(b){return e.target.hasOwnProperty(b)}],[new Color(180,0,0),function(b){return __indexOf.call(f,b)>=0}]]:null);this.list.action=function(b){var a;a=e.target[b];a===void 0&&(a=e.target.constructor[b]);e.currentProperty=a;b=a===null?"NULL":isString(a)?a:a.toString();b=new TextMorph(b);b.isEditable=true;b.enableSelecting();
b.setReceiver(e.target);return e.detail.setContents(b)};this.list.hBar.alpha=0.6;this.list.vBar.alpha=0.6;this.list.listContents.step=null;this.add(this.list);this.detail=new ScrollFrameMorph;this.detail.acceptsDrops=!1;this.detail.contents.acceptsDrops=!1;this.detail.isTextLineWrapping=!0;this.detail.color=new Color(255,255,255);this.detail.hBar.alpha=0.6;this.detail.vBar.alpha=0.6;b=new TextMorph("");b.isEditable=!0;b.enableSelecting();b.setReceiver(this.target);this.detail.setContents(b);this.add(this.detail);
null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=0.6,this.work.vBar.alpha=0.6,b=new TextMorph(""),b.isEditable=!0,b.enableSelecting(),b.setReceiver(this.target),this.work.setContents(b));this.add(this.work);this.buttonSubset=new TriggerMorph;this.buttonSubset.labelString="show...";this.buttonSubset.action=function(){var b;b=new MenuMorph;b.addItem("attributes",
function(){e.showing="attributes";return e.buildPanes()});b.addItem("methods",function(){e.showing="methods";return e.buildPanes()});b.addItem("all",function(){e.showing="all";return e.buildPanes()});b.addLine();b.addItem(e.markOwnershipOfProperties?"un-mark ownership":"mark ownership",function(){e.markOwnershipOfProperties=!e.markOwnershipOfProperties;return e.buildPanes()},"highlight\nownership of properties");return b.popUpAtHand(e.world())};this.add(this.buttonSubset);this.buttonInspect=new TriggerMorph;
this.buttonInspect.labelString="inspect...";this.buttonInspect.action=function(){var b;if(isObject(e.currentProperty)){b=new MenuMorph;b.addItem("in new inspector...",function(){var b,h;h=e.world();b=new a(e.currentProperty);b.setPosition(h.hand.position());b.keepWithin(h);h.add(b);return b.changed()});b.addItem("here...",function(){return e.setTarget(e.currentProperty)});return b.popUpAtHand(e.world())}return e.inform((e.currentProperty===null?"null":typeof e.currentProperty)+"\nis not inspectable")};
this.add(this.buttonInspect);this.buttonEdit=new TriggerMorph;this.buttonEdit.labelString="edit...";this.buttonEdit.action=function(){var b;b=new MenuMorph(e);b.addItem("save","save","accept changes");b.addLine();b.addItem("add property...","addProperty");b.addItem("rename...","renameProperty");b.addItem("remove...","removeProperty");return b.popUpAtHand(e.world())};this.add(this.buttonEdit);this.buttonClose=new TriggerMorph;this.buttonClose.labelString="close";this.buttonClose.action=function(){return e.destroy()};
this.add(this.buttonClose);this.resizer=new HandleMorph(this,150,100,this.edge,this.edge);return this.fixLayout()};a.prototype.fixLayout=function(){var b,a,d,c;Morph.prototype.trackChanges=!1;d=this.left()+this.edge;c=this.top()+this.edge;a=this.right()-this.edge;a-=d;this.label.setPosition(new Point(d,c));this.label.setWidth(a);this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew());c=this.label.bottom()+2;a=Math.min(Math.floor(this.width()/
3),this.list.listContents.width());a-=this.edge;b=this.bottom()-2*this.edge-WorldMorph.MorphicPreferences.handleSize-c;this.list.setPosition(new Point(d,c));this.list.setExtent(new Point(a,b));d=this.list.right()+this.edge;a=this.right()-this.edge;a-=d;this.detail.setPosition(new Point(d,c));this.detail.setExtent(new Point(a,2*b/3-this.edge));c=this.detail.bottom()+this.edge;this.work.setPosition(new Point(d,c));this.work.setExtent(new Point(a,b/3));d=this.list.left();c=this.list.bottom()+this.edge;
a=this.list.width();b=WorldMorph.MorphicPreferences.handleSize;this.buttonSubset.setPosition(new Point(d,c));this.buttonSubset.setExtent(new Point(a,b));d=this.detail.left();a=this.detail.width()-this.edge-WorldMorph.MorphicPreferences.handleSize;a=a/3-this.edge/3;this.buttonInspect.setPosition(new Point(d,c));this.buttonInspect.setExtent(new Point(a,b));d=this.buttonInspect.right()+this.edge;this.buttonEdit.setPosition(new Point(d,c));this.buttonEdit.setExtent(new Point(a,b));d=this.buttonEdit.right()+
this.edge;a=this.detail.right()-this.edge-WorldMorph.MorphicPreferences.handleSize;a-=d;this.buttonClose.setPosition(new Point(d,c));this.buttonClose.setExtent(new Point(a,b));Morph.prototype.trackChanges=!0;return this.changed()};a.prototype.setExtent=function(b){a.__super__.setExtent.call(this,b);return this.fixLayout()};a.prototype.save=function(){var b,a;a=this.detail.contents.children[0].text.toString();b=this.list.selected;try{if(this.target.evaluateString("this."+b+" = "+a),this.target.drawNew)return this.target.changed(),
this.target.drawNew(),this.target.changed()}catch(d){return this.inform(d)}};a.prototype.addProperty=function(){var b=this;return this.prompt("new property name:",function(a){if(a&&(b.target[a]=null,b.buildPanes(),b.target.drawNew))return b.target.changed(),b.target.drawNew(),b.target.changed()},this,"property")};a.prototype.renameProperty=function(){var b,a=this;b=this.list.selected;return this.prompt("property name:",function(d){try{delete a.target[b],a.target[d]=a.currentProperty}catch(c){a.inform(c)}a.buildPanes();
if(a.target.drawNew)return a.target.changed(),a.target.drawNew(),a.target.changed()},this,b)};a.prototype.removeProperty=function(){var b;b=this.list.selected;try{if(delete this.target[b],this.currentProperty=null,this.buildPanes(),this.target.drawNew)return this.target.changed(),this.target.drawNew(),this.target.changed()}catch(a){return this.inform(a)}};return a}(BoxMorph);
TriggerMorph=function(c){function a(b,h,d,c,f,e,i,j){this.target=null!=b?b:null;this.action=null!=h?h:null;this.labelString=null!=d?d:null;this.environment=null!=e?e:null;this.hint=null!=i?i:null;this.fontSize=c||WorldMorph.MorphicPreferences.menuFontSize;this.fontStyle=f||"sans-serif";this.labelColor=j||new Color(0,0,0);a.__super__.constructor.call(this);this.color=new Color(255,255,255);this.drawNew()}__extends(a,c);a.prototype.target=null;a.prototype.action=null;a.prototype.environment=null;a.prototype.labelString=
null;a.prototype.label=null;a.prototype.hint=null;a.prototype.fontSize=null;a.prototype.fontStyle=null;a.prototype.highlightColor=new Color(192,192,192);a.prototype.pressColor=new Color(128,128,128);a.prototype.labelColor=null;a.prototype.drawNew=function(){this.createBackgrounds();if(null!==this.labelString)return this.createLabel()};a.prototype.createBackgrounds=function(){var b,a;a=this.extent();this.normalImage=newCanvas(a);b=this.normalImage.getContext("2d");b.fillStyle=this.color.toString();
b.fillRect(0,0,a.x,a.y);this.highlightImage=newCanvas(a);b=this.highlightImage.getContext("2d");b.fillStyle=this.highlightColor.toString();b.fillRect(0,0,a.x,a.y);this.pressImage=newCanvas(a);b=this.pressImage.getContext("2d");b.fillStyle=this.pressColor.toString();b.fillRect(0,0,a.x,a.y);return this.image=this.normalImage};a.prototype.createLabel=function(){null!==this.label&&this.label.destroy();this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,!1,!1,!1,null,null,this.labelColor);
this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2)));return this.add(this.label)};a.prototype.copyRecordingReferences=function(b){var h;h=a.__super__.copyRecordingReferences.call(this,b);h.label&&b[this.label]&&(h.label=b[this.label]);return h};a.prototype.trigger=function(){return"function"===typeof this.target?"function"===typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"===typeof this.action?
this.action.call(this.target):this.target[this.action]()};a.prototype.mouseEnter=function(){this.image=this.highlightImage;this.changed();if(this.hint)return this.bubbleHelp(this.hint)};a.prototype.mouseLeave=function(){this.image=this.normalImage;this.changed();if(this.hint)return this.world().hand.destroyTemporaries()};a.prototype.mouseDownLeft=function(){this.image=this.pressImage;return this.changed()};a.prototype.mouseClickLeft=function(){this.image=this.highlightImage;this.changed();return this.trigger()};
a.prototype.bubbleHelp=function(b){var a=this;this.fps=2;return this.step=function(){a.bounds.containsPoint(a.world().hand.position())&&a.popUpbubbleHelp(b);a.fps=0;return delete a.step}};a.prototype.popUpbubbleHelp=function(b){return(new SpeechBubbleMorph(localize(b),null,null,1)).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))};return a}(Morph);
MenuMorph=function(c){function a(b,h,d,c){this.target=b;this.title=null!=h?h:null;this.environment=null!=d?d:null;this.fontSize=null!=c?c:null;this.items=[];a.__super__.constructor.call(this);this.border=null}__extends(a,c);a.prototype.target=null;a.prototype.title=null;a.prototype.environment=null;a.prototype.fontSize=null;a.prototype.items=null;a.prototype.label=null;a.prototype.world=null;a.prototype.isListContents=!1;a.prototype.addItem=function(b,a,d,c){return this.items.push([localize(b||"close"),
a||nop,d,c])};a.prototype.addLine=function(b){return this.items.push([0,b||1])};a.prototype.createLabel=function(){var b;null!==this.label&&this.label.destroy();b=new TextMorph(localize(this.title),this.fontSize||WorldMorph.MorphicPreferences.menuFontSize,WorldMorph.MorphicPreferences.menuFontName,!0,!1,"center");b.alignment="center";b.color=new Color(255,255,255);b.backgroundColor=this.borderColor;b.drawNew();this.label=new BoxMorph(3,0);this.label.color=this.borderColor;this.label.borderColor=this.borderColor;
this.label.setExtent(b.extent().add(4));this.label.drawNew();this.label.add(b);return this.label.text=b};a.prototype.drawNew=function(){var b,h,d,c=this;b=!1;this.children.forEach(function(b){return b.destroy()});this.children=[];this.isListContents||(this.edge=5,this.border=2);this.color=new Color(255,255,255);this.borderColor=new Color(60,60,60);this.silentSetExtent(new Point(0,0));d=2;h=this.left()+4;this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),
this.add(this.label),d=this.label.bottom()):d=this.top()+4);d+=1;this.items.forEach(function(a){var e;b=false;if(a instanceof StringFieldMorph||a instanceof ColorPickerMorph||a instanceof SliderMorph)e=a;else if(a[0]===0){b=true;e=new Morph;e.color=c.borderColor;e.setHeight(a[1])}else e=new MenuItemMorph(c.target,a[1],a[0],c.fontSize||WorldMorph.MorphicPreferences.menuFontSize,WorldMorph.MorphicPreferences.menuFontName,c.environment,a[2],a[3]);b&&(d=d+1);e.setPosition(new Point(h,d));c.add(e);d=d+
e.height();if(b)return d=d+1});this.silentSetExtent(this.boundsIncludingChildren().extent().add(4));this.adjustWidths();return a.__super__.drawNew.call(this)};a.prototype.maxWidth=function(){var b;b=0;this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(b=this.parent.scrollFrame.width());this.children.forEach(function(a){if(a instanceof MenuItemMorph)return b=Math.max(b,a.children[0].width()+8);if(a instanceof StringFieldMorph||a instanceof ColorPickerMorph||a instanceof
SliderMorph)return b=Math.max(b,a.width())});this.label&&(b=Math.max(b,this.label.width()));return b};a.prototype.adjustWidths=function(){var b,a=this;b=this.maxWidth();return this.children.forEach(function(d){var c;d.silentSetWidth(b);if(d instanceof MenuItemMorph){if(c=d.image===d.pressImage,d.createBackgrounds(),c)return d.image=d.pressImage}else if(d.drawNew(),d===a.label)return d.text.setPosition(d.center().subtract(d.text.extent().floorDivideBy(2)))})};a.prototype.unselectAllItems=function(){this.children.forEach(function(b){if(b instanceof
MenuItemMorph)return b.image=b.normalImage});return this.changed()};a.prototype.popup=function(b,a){this.drawNew();this.setPosition(a);this.addShadow(new Point(2,2),80);this.keepWithin(b);b.activeMenu&&b.activeMenu.destroy();b.add(this);b.activeMenu=this;return this.fullChanged()};a.prototype.popUpAtHand=function(b){b=b||this.world;return this.popup(b,b.hand.position())};a.prototype.popUpCenteredAtHand=function(b){b=b||this.world;this.drawNew();return this.popup(b,b.hand.position().subtract(this.extent().floorDivideBy(2)))};
a.prototype.popUpCenteredInWorld=function(b){b=b||this.world;this.drawNew();return this.popup(b,b.center().subtract(this.extent().floorDivideBy(2)))};return a}(BoxMorph);
PenMorph=function(c){function a(){this.penSize=4*WorldMorph.MorphicPreferences.handleSize;a.__super__.constructor.call(this);this.setExtent(new Point(this.penSize,this.penSize));this.penSize=1}__extends(a,c);a.prototype.heading=0;a.prototype.penSize=null;a.prototype.isWarped=!1;a.prototype.wantsRedraw=!1;a.prototype.isDown=!0;a.staticVariable=1;a.staticFunction=function(){return 3.14};a.prototype.changed=function(){var b;if(!1===this.isWarped&&(b=this.root(),b instanceof WorldMorph&&b.broken.push(this.visibleBounds().spread()),
this.parent))return this.parent.childChanged(this)};a.prototype.drawNew=function(b){var a,d,c,f,e;d=b||this.heading;if(this.isWarped)return this.wantsRedraw=!0,null;this.image=newCanvas(this.extent());b=this.image.getContext("2d");f=this.width()/2;e=this.center().subtract(this.bounds.origin);a=e.distanceAngle(0.75*f,d-180);c=e.distanceAngle(f,d+195);d=e.distanceAngle(f,d-195);b.fillStyle=this.color.toString();b.beginPath();b.moveTo(e.x,e.y);b.lineTo(c.x,c.y);b.lineTo(a.x,a.y);b.lineTo(d.x,d.y);b.closePath();
b.strokeStyle="white";b.lineWidth=3;b.stroke();b.strokeStyle="black";b.lineWidth=1;b.stroke();b.fill();return this.wantsRedraw=!1};a.prototype.setHeading=function(b){this.heading=parseFloat(b)%360;if(!1===this.isWarped)return this.drawNew(),this.changed()};a.prototype.drawLine=function(b,a){var d,c,f;d=this.parent.penTrails().getContext("2d");c=b.subtract(this.parent.bounds.origin);f=a.subtract(this.parent.bounds.origin);if(this.isDown&&(d.lineWidth=this.penSize,d.strokeStyle=this.color.toString(),
d.lineCap="round",d.lineJoin="round",d.beginPath(),d.moveTo(c.x,c.y),d.lineTo(f.x,f.y),d.stroke(),!1===this.isWarped))return this.world().broken.push(b.rectangle(a).expandBy(Math.max(this.penSize/2,1)).intersect(this.parent.visibleBounds()).spread())};a.prototype.turn=function(b){return this.setHeading(this.heading+parseFloat(b))};a.prototype.forward=function(b){var a;a=this.center();b=parseFloat(b);this.setPosition(0<=b?this.position().distanceAngle(b,this.heading):this.position().distanceAngle(Math.abs(b),
this.heading-180));return this.drawLine(a,this.center())};a.prototype.down=function(){return this.isDown=!0};a.prototype.up=function(){return this.isDown=!1};a.prototype.clear=function(){this.parent.drawNew();return this.parent.changed()};a.prototype.startWarp=function(){return this.isWarped=!0};a.prototype.endWarp=function(){this.wantsRedraw&&this.drawNew();this.changed();this.parent.changed();return this.isWarped=!1};a.prototype.warp=function(b){this.startWarp();b.call(this);return this.endWarp()};
a.prototype.warpOp=function(b,a){this.startWarp();this[b].apply(this,a);return this.endWarp()};a.prototype.warpSierpinski=function(b,a){return this.warpOp("sierpinski",[b,a])};a.prototype.sierpinski=function(b,a){var d,c;if(b>a){c=[];for(d=0;3>d;++d)this.sierpinski(0.5*b,a),this.turn(120),c.push(this.forward(b));return c}};a.prototype.warpTree=function(b,a,d){return this.warpOp("tree",[b,a,d])};a.prototype.tree=function(b,a,d){if(0<b)return this.penSize=b,this.forward(a),this.turn(d),this.tree(b-
1,0.75*a,d),this.turn(-2*d),this.tree(b-1,0.75*a,d),this.turn(d),this.forward(-a)};return a}(Morph);
SpeechBubbleMorph=function(c){function a(b,h,d,c,f,e,i){this.contents=null!=b?b:"";this.padding=null!=e?e:0;this.isThought=null!=i?i:!1;a.__super__.constructor.call(this,d||6,c||(0===c?0:1),f||new Color(140,140,140));this.color=h||new Color(230,230,230);this.drawNew()}__extends(a,c);a.prototype.isPointingRight=!0;a.prototype.contents=null;a.prototype.padding=null;a.prototype.isThought=null;a.prototype.isClickable=!1;a.prototype.popUp=function(b,a,d){this.drawNew();this.setPosition(a.subtract(new Point(0,
this.height())));this.addShadow(new Point(2,2),80);this.keepWithin(b);b.add(this);this.changed();b.hand.destroyTemporaries();b.hand.temporaries.push(this);return d?this.mouseEnter=function(){return this.destroy()}:this.isClickable=!1};a.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy();this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,WorldMorph.MorphicPreferences.bubbleHelpFontSize,null,
!1,!0,"center"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contentsMorph=new TextMorph(this.contents.toString(),WorldMorph.MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center");this.add(this.contentsMorph);this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge));this.silentSetHeight(this.contentsMorph.height()+
this.edge+2*this.border+2*this.padding+2);a.__super__.drawNew.call(this);return this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))};a.prototype.outlinePath=function(b,a,d){var c,f,e,i;c=function(a,h,d){b.moveTo(a+d,h);return b.arc(a,h,d,radians(0),radians(360))};e=a+d;i=this.width();f=this.height();b.arc(e,e,a,radians(-180),radians(-90),!1);b.arc(i-e,e,a,radians(-90),radians(-0.0),!1);b.arc(i-e,f-e-a,a,radians(0),radians(90),!1);this.isThought||
(this.isPointingRight?(b.lineTo(e+a,f-e),b.lineTo(a/2+d,f-d)):(b.lineTo(i-(a/2+d),f-d),b.lineTo(i-(e+a),f-e)));b.arc(e,f-e-a,a,radians(90),radians(180),!1);if(this.isThought){b.lineTo(d,e);if(this.isPointingRight)return e=a/4,c(e+d,f-e-d,e),e=a/3.2,c(2*e+d,f-e-2*d,e),e=a/2.8,c(3*e+2*d,f-e-4*d,e);e=a/4;c(i-(e+d),f-e-d,e);e=a/3.2;c(i-(2*e+d),f-e-2*d,e);e=a/2.8;return c(i-(3*e+2*d),f-e-4*d,e)}};a.prototype.shadowImage=function(b,a){var d,c,f,e,i,j;i=b||new Point(7,7);d=a||new Color(0,0,0);f=this.extent();
e=this.image;j=newCanvas(f);c=j.getContext("2d");c.drawImage(e,0,0);c.globalCompositeOperation="destination-out";c.drawImage(e,-i.x,-i.y);e=newCanvas(f);c=e.getContext("2d");c.drawImage(j,0,0);c.globalCompositeOperation="source-atop";c.fillStyle=d.toString();c.fillRect(0,0,f.x,f.y);return e};a.prototype.shadowImageBlurred=function(b,a){var c,g,f,e,i,j;i=b||new Point(7,7);c=this.shadowBlur;g=a||new Color(0,0,0);f=this.extent().add(2*c);e=this.image;j=newCanvas(f);f=j.getContext("2d");f.shadowOffsetX=
i.x;f.shadowOffsetY=i.y;f.shadowBlur=c;f.shadowColor=g.toString();f.drawImage(e,c-i.x,c-i.y);f.shadowOffsetX=0;f.shadowOffsetY=0;f.shadowBlur=0;f.globalCompositeOperation="destination-out";f.drawImage(e,c-i.x,c-i.y);return j};a.prototype.fixLayout=function(){this.removeShadow();this.drawNew();return this.addShadow(new Point(2,2),80)};return a}(BoxMorph);
ColorPickerMorph=function(c){function a(b){this.choice=b||new Color(255,255,255);a.__super__.constructor.call(this);this.color=new Color(255,255,255);this.silentSetExtent(new Point(80,80));this.drawNew()}__extends(a,c);a.prototype.choice=null;a.prototype.drawNew=function(){a.__super__.drawNew.call(this);return this.buildSubmorphs()};a.prototype.buildSubmorphs=function(){var b,a;this.children.forEach(function(b){return b.destroy()});this.children=[];this.feedback=new Morph;this.feedback.color=this.choice;
this.feedback.setExtent(new Point(20,20));b=new ColorPaletteMorph(this.feedback,new Point(this.width(),50));a=new GrayPaletteMorph(this.feedback,new Point(this.width(),5));b.setPosition(this.bounds.origin);this.add(b);a.setPosition(b.bottomLeft());this.add(a);b=a.left()+Math.floor((a.width()-this.feedback.width())/2);a=a.bottom()+Math.floor((this.bottom()-a.bottom()-this.feedback.height())/2);this.feedback.setPosition(new Point(b,a));return this.add(this.feedback)};a.prototype.getChoice=function(){return this.feedback.color};
a.prototype.rootForGrab=function(){return this};return a}(Morph);
HandMorph=function(c){function a(b){this.world=b;this.mouseOverList=[];this.temporaries=[];a.__super__.constructor.call(this);this.bounds=new Rectangle}__extends(a,c);a.prototype.world=null;a.prototype.mouseButton=null;a.prototype.mouseDownMorph=null;a.prototype.morphToGrab=null;a.prototype.grabOrigin=null;a.prototype.mouseOverList=null;a.prototype.temporaries=null;a.prototype.touchHoldTimeout=null;a.prototype.changed=function(){var b;if(null!==this.world&&(b=this.boundsIncludingChildren(),!b.extent().eq(new Point)))return this.world.broken.push(this.boundsIncludingChildren().spread())};
a.prototype.morphAtPointer=function(){var b,a,c=this;b=this.world.allChildren().slice(0).reverse();a=null;b.forEach(function(b){if(b.visibleBounds().containsPoint(c.bounds.origin)&&null===a&&b.isVisible&&(b.noticesTransparentClick||!b.isTransparentAt(c.bounds.origin))&&!(b instanceof ShadowMorph))return a=b});return null!==a?a:this.world};a.prototype.allMorphsAtPointer=function(){var b=this;return this.world.allChildren().filter(function(a){return a.isVisible&&a.visibleBounds().containsPoint(b.bounds.origin)})};
a.prototype.dropTargetFor=function(b){var a;for(a=this.morphAtPointer();!a.wantsDropOf(b);)a=a.parent;return a};a.prototype.grab=function(b){var a;a=b.parent;if(b instanceof WorldMorph)return null;if(!this.children.length&&(this.world.stopEditing(),this.grabOrigin=b.situation(),b.addShadow(),b.prepareToBeGrabbed&&b.prepareToBeGrabbed(this),this.add(b),this.changed(),a&&a.reactToGrabOf))return a.reactToGrabOf(b)};a.prototype.drop=function(){var b,a;if(this.children.length)return b=this.children[0],
a=this.dropTargetFor(b),this.changed(),a.add(b),b.changed(),b.removeShadow(),this.children=[],this.setExtent(new Point),b.justDropped&&b.justDropped(this),a.reactToDropOf&&a.reactToDropOf(b,this),this.dragOrigin=null};a.prototype.processMouseDown=function(b){var a,c;this.destroyTemporaries();this.morphToGrab=null;if(this.children.length)return this.drop(),this.mouseButton=null;c=this.morphAtPointer();this.world.activeMenu&&(contains(c.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):
this.world.activeMenu.destroy());this.world.activeHandle&&c!==this.world.activeHandle&&this.world.activeHandle.destroy();this.world.cursor&&c!==this.world.cursor.target&&this.world.stopEditing();c.mouseMove||(this.morphToGrab=c.rootForGrab());2===b.button||b.ctrlKey?(this.mouseButton="right",b="mouseDownRight",a="mouseClickRight"):(this.mouseButton="left",b="mouseDownLeft",a="mouseClickLeft");for(this.mouseDownMorph=c;!this.mouseDownMorph[a];)this.mouseDownMorph=this.mouseDownMorph.parent;for(;!c[b];)c=
c.parent;return c[b](this.bounds.origin)};a.prototype.processTouchStart=function(b){var a=this;clearInterval(this.touchHoldTimeout);if(1===b.touches.length)return this.touchHoldTimeout=setInterval(function(){a.processMouseDown({button:2});a.processMouseUp({button:2});b.preventDefault();return clearInterval(a.touchHoldTimeout)},400),this.processMouseMove(b.touches[0]),this.processMouseDown({button:0}),b.preventDefault()};a.prototype.processTouchMove=function(b){if(1===b.touches.length)return b=b.touches[0],
this.processMouseMove(b),clearInterval(this.touchHoldTimeout)};a.prototype.processTouchEnd=function(){clearInterval(this.touchHoldTimeout);return this.processMouseUp({button:0})};a.prototype.processMouseUp=function(){var b,a,c,g;g=this.morphAtPointer();this.destroyTemporaries();if(this.children.length)this.drop();else{if("left"===this.mouseButton)c="mouseClickLeft";else if(c="mouseClickRight",this.mouseButton){b=g;for(a=b.contextMenu();!a&&b.parent;)b=b.parent,a=b.contextMenu();a&&a.popUpAtHand(this.world)}for(;!g[c];)g=
g.parent;g[c](this.bounds.origin)}return this.mouseButton=null};a.prototype.processMouseScroll=function(b){var a;for(a=this.morphAtPointer();a&&!a.mouseScroll;)a=a.parent;if(a)return a.mouseScroll(b.detail/-3||(b.hasOwnProperty("wheelDeltaY")?b.wheelDeltaY/120:b.wheelDelta/120),b.wheelDeltaX/120||0)};a.prototype.processDrop=function(b){var a,c,g,f,e,i,j,k,l,m;c=b instanceof FileList?b:b.target.files||b.dataTransfer.files;k=b.dataTransfer?b.dataTransfer.getData("Text/HTML"):null;j=this.morphAtPointer();
g=new Image;e=function(b){var a,c;c=new Image;for(a=new FileReader;!j.droppedImage;)j=j.parent;c.onload=function(){var a;a=newCanvas(new Point(c.width,c.height));a.getContext("2d").drawImage(c,0,0);return j.droppedImage(a,b.name)};a=new FileReader;a.onloadend=function(b){return c.src=b.target.result};return a.readAsDataURL(b)};b=function(b){var a,c;c=new Audio;for(a=new FileReader;!j.droppedAudio;)j=j.parent;a.onloadend=function(a){c.src=a.target.result;return j.droppedAudio(c,b.name)};return a.readAsDataURL(b)};
i=function(b){var a;for(a=new FileReader;!j.droppedText;)j=j.parent;a.onloadend=function(a){return j.droppedText(a.target.result,b.name)};return a.readAsText(b)};f=function(b){var a;for(a=new FileReader;!j.droppedBinary;)j=j.parent;a.onloadend=function(a){return j.droppedBinary(a.target.result,b.name)};return a.readAsArrayBuffer(b)};a=function(b){var a,c,h,d,g;h="";c=b.indexOf('<img src="');if(-1===c)return null;a=d=c+=10;for(g=b.length;c<=g?d<g:d>g;a=c<=g?++d:--d){a=b[a];if('"'===a)return h;h=h.concat(a)}return null};
if(c.length){m=[];k=0;for(l=c.length;k<l;k++)a=c[k],0===a.type.indexOf("image")?m.push(e(a)):0===a.type.indexOf("audio")?m.push(b(a)):0===a.type.indexOf("text")?m.push(i(a)):m.push(f(a));return m}if(k){for(;!j.droppedImage;)j=j.parent;g=new Image;g.onload=function(){var b;b=newCanvas(new Point(g.width,g.height));b.getContext("2d").drawImage(g,0,0);return j.droppedImage(b)};if(c=a(k))return g.src=c}};a.prototype.destroyTemporaries=function(){var b=this;return this.temporaries.forEach(function(a){if(!a.isClickable||
!a.bounds.containsPoint(b.position()))return a.destroy(),b.temporaries.splice(b.temporaries.indexOf(a),1)})};a.prototype.moveBy=function(b){Morph.prototype.trackChanges=!1;a.__super__.moveBy.call(this,b);Morph.prototype.trackChanges=!0;return this.fullChanged()};a.prototype.processMouseMove=function(b){var a,c,g,f=this;g=getDocumentPositionOf(this.world.worldCanvas);g=new Point(b.pageX-g.x,b.pageY-g.y);this.setPosition(g);c=this.morphAtPointer().allParents();if(!this.children.length&&"left"===this.mouseButton&&
(a=this.morphAtPointer(),b=a.rootForGrab(),a.mouseMove&&a.mouseMove(g),this.morphToGrab&&(this.morphToGrab.isDraggable?(b=this.morphToGrab,this.grab(b)):this.morphToGrab.isTemplate&&(b=this.morphToGrab.fullCopy(),b.isTemplate=!1,b.isDraggable=!0,this.grab(b),this.grabOrigin=this.morphToGrab.situation()),a=b.boundsIncludingChildren(),!a.containsPoint(g))))this.bounds.origin=a.center(),this.grab(b),this.setPosition(g);this.mouseOverList.forEach(function(b){if(!contains(c,b)&&(b.mouseLeave&&b.mouseLeave(),
b.mouseLeaveDragging&&this.mouseButton))return b.mouseLeaveDragging()});c.forEach(function(b){contains(f.mouseOverList,b)||(b.mouseEnter&&b.mouseEnter(),b.mouseEnterDragging&&f.mouseButton&&b.mouseEnterDragging());if(f.children.length&&b instanceof ScrollFrameMorph&&!b.bounds.insetBy(3*WorldMorph.MorphicPreferences.scrollBarSize).containsPoint(f.bounds.origin))return b.startAutoScrolling()});return this.mouseOverList=c};return a}(Morph);morphicVersion="2012-October-22";
ListMorph=function(c){function a(b,c,d){this.elements=null!=b?b:[];this.format=null!=d?d:[];a.__super__.constructor.call(this);this.contents.acceptsDrops=!1;this.color=new Color(255,255,255);this.hBar.alpha=0.6;this.vBar.alpha=0.6;this.labelGetter=c||function(b){return isString(b)?b:b.toSource?b.toSource():b.toString()};this.buildListContents()}__extends(a,c);a.prototype.elements=null;a.prototype.labelGetter=null;a.prototype.format=null;a.prototype.listContents=null;a.prototype.selected=null;a.prototype.action=
null;a.prototype.buildListContents=function(){var b=this;this.listContents&&this.listContents.destroy();this.listContents=new MenuMorph(this.select,null,this);this.elements.length||(this.elements=["(empty)"]);this.elements.forEach(function(a){var c;c=null;b.format.forEach(function(b){if(b[1].call(null,a))return c=b[0]});return b.listContents.addItem(b.labelGetter(a),a,null,c)});this.listContents.setPosition(this.contents.position());this.listContents.isListContents=!0;this.listContents.drawNew();
return this.addContents(this.listContents)};a.prototype.select=function(b){this.selected=b;if(this.action)return this.action.call(null,b)};a.prototype.setExtent=function(b){var c,d;c=this.listContents.bounds;d=this.bounds.origin.copy().corner(this.bounds.origin.add(b));d.right()>c.right()&&d.width()<=c.width()&&this.listContents.setRight(d.right());d.bottom()>c.bottom()&&d.height()<=c.height()&&this.listContents.setBottom(d.bottom());return a.__super__.setExtent.call(this,b)};return a}(ScrollFrameMorph);
CircleBoxMorph=function(c){function a(b){this.orientation=null!=b?b:"vertical";a.__super__.constructor.call(this);this.setExtent(new Point(20,100))}__extends(a,c);a.prototype.orientation=null;a.prototype.autoOrient=!0;a.prototype.autoOrientation=function(){return this.height()>this.width()?this.orientation="vertical":this.orientation="horizontal"};a.prototype.drawNew=function(){var b,a,c,g,f,e=this;this.autoOrient&&this.autoOrientation();this.image=newCanvas(this.extent());c=this.image.getContext("2d");
"vertical"===this.orientation?(g=this.width()/2,f=this.center().x,b=new Point(f,this.top()+g),a=new Point(f,this.bottom()-g),f=this.bounds.origin.add(new Point(0,g)).corner(this.bounds.corner.subtract(new Point(0,g)))):(g=this.height()/2,f=this.center().y,b=new Point(this.left()+g,f),a=new Point(this.right()-g,f),f=this.bounds.origin.add(new Point(g,0)).corner(this.bounds.corner.subtract(new Point(g,0))));[b.subtract(this.bounds.origin),a.subtract(this.bounds.origin)].forEach(function(b){c.fillStyle=
e.color.toString();c.beginPath();c.arc(b.x,b.y,g,0,2*Math.PI,false);c.closePath();return c.fill()});f=f.translateBy(this.bounds.origin.neg());b=f.extent();if(0<b.x&&0<b.y)return c.fillRect(f.origin.x,f.origin.y,f.width(),f.height())};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);b.addLine();"vertical"===this.orientation?b.addItem("horizontal...","toggleOrientation","toggle the\norientation"):b.addItem("vertical...","toggleOrientation","toggle the\norientation");
return b};a.prototype.toggleOrientation=function(){var b;b=this.center();this.changed();this.orientation="vertical"===this.orientation?"horizontal":"vertical";this.silentSetExtent(new Point(this.height(),this.width()));this.setCenter(b);this.drawNew();return this.changed()};return a}(Morph);
SliderButtonMorph=function(c){function a(b){this.color=new Color(80,80,80);a.__super__.constructor.call(this,b)}__extends(a,c);a.prototype.highlightColor=new Color(90,90,140);a.prototype.pressColor=new Color(80,80,160);a.prototype.is3D=!0;a.prototype.hasMiddleDip=!0;a.prototype.autoOrientation=function(){return noOperation};a.prototype.drawNew=function(){var b;b=this.color.copy();a.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.normalImage=this.image;this.color=this.highlightColor.copy();
a.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.highlightImage=this.image;this.color=this.pressColor.copy();a.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.pressImage=this.image;this.color=b;return this.image=this.normalImage};a.prototype.drawEdges=function(){var b,a,c,g,f;b=this.image.getContext("2d");f=this.width();c=this.height();b.lineJoin="round";b.lineCap="round";if("vertical"===this.orientation){if(b.lineWidth=f/3,a=b.createLinearGradient(0,0,b.lineWidth,0),
a.addColorStop(0,"white"),a.addColorStop(1,this.color.toString()),b.strokeStyle=a,b.beginPath(),b.moveTo(0.5*b.lineWidth,f/2),b.lineTo(0.5*b.lineWidth,c-f/2),b.stroke(),a=b.createLinearGradient(f-b.lineWidth,0,f,0),a.addColorStop(0,this.color.toString()),a.addColorStop(1,"black"),b.strokeStyle=a,b.beginPath(),b.moveTo(f-0.5*b.lineWidth,f/2),b.lineTo(f-0.5*b.lineWidth,c-f/2),b.stroke(),this.hasMiddleDip)return a=b.createLinearGradient(b.lineWidth,0,f-b.lineWidth,0),g=f/4,a.addColorStop(0,"black"),
a.addColorStop(0.35,this.color.toString()),a.addColorStop(0.65,this.color.toString()),a.addColorStop(1,"white"),b.fillStyle=a,b.beginPath(),b.arc(f/2,c/2,g,radians(0),radians(360),!1),b.closePath(),b.fill()}else if("horizontal"===this.orientation&&(b.lineWidth=c/3,a=b.createLinearGradient(0,0,0,b.lineWidth),a.addColorStop(0,"white"),a.addColorStop(1,this.color.toString()),b.strokeStyle=a,b.beginPath(),b.moveTo(c/2,0.5*b.lineWidth),b.lineTo(f-c/2,0.5*b.lineWidth),b.stroke(),a=b.createLinearGradient(0,
c-b.lineWidth,0,c),a.addColorStop(0,this.color.toString()),a.addColorStop(1,"black"),b.strokeStyle=a,b.beginPath(),b.moveTo(c/2,c-0.5*b.lineWidth),b.lineTo(f-c/2,c-0.5*b.lineWidth),b.stroke(),this.hasMiddleDip))return a=b.createLinearGradient(0,b.lineWidth,0,c-b.lineWidth),g=c/4,a.addColorStop(0,"black"),a.addColorStop(0.35,this.color.toString()),a.addColorStop(0.65,this.color.toString()),a.addColorStop(1,"white"),b.fillStyle=a,b.beginPath(),b.arc(this.width()/2,this.height()/2,g,radians(0),radians(360),
!1),b.closePath(),b.fill()};a.prototype.mouseEnter=function(){this.image=this.highlightImage;return this.changed()};a.prototype.mouseLeave=function(){this.image=this.normalImage;return this.changed()};a.prototype.mouseDownLeft=function(b){this.image=this.pressImage;this.changed();return this.escalateEvent("mouseDownLeft",b)};a.prototype.mouseClickLeft=function(){this.image=this.highlightImage;return this.changed()};a.prototype.mouseMove=function(){return noOperation};return a}(CircleBoxMorph);
StringMorph=function(c){function a(b,c,d,g,f,e,i,j,k,l){this.fontSize=null!=c?c:12;this.fontStyle=null!=d?d:"sans-serif";this.isBold=null!=g?g:!1;this.isItalic=null!=f?f:!1;this.isNumeric=null!=e?e:!1;this.shadowColor=j;this.text=b||(""===b?"":"StringMorph");this.fontName=l||WorldMorph.MorphicPreferences.globalFontFamily;this.shadowOffset=i||new Point(0,0);a.__super__.constructor.call(this);this.color=k||new Color(0,0,0);this.noticesTransparentClick=!0;this.drawNew()}__extends(a,c);a.prototype.text=
null;a.prototype.fontSize=null;a.prototype.fontName=null;a.prototype.fontStyle=null;a.prototype.isBold=null;a.prototype.isItalic=null;a.prototype.isEditable=!1;a.prototype.isNumeric=null;a.prototype.isPassword=!1;a.prototype.shadowOffset=null;a.prototype.shadowColor=null;a.prototype.isShowingBlanks=!1;a.prototype.blanksColor=new Color(180,140,140);a.prototype.isScrollable=!0;a.prototype.currentlySelecting=!1;a.prototype.startMark=0;a.prototype.endMark=0;a.prototype.markedTextColor=new Color(255,255,
255);a.prototype.markedBackgoundColor=new Color(60,60,120);a.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+'("'+this.text.slice(0,30)+'...")'};a.prototype.password=function(b,a){var c,g;c="";for(g=0;0<=a?g<a:g>a;0<=a?++g:--g)c+=b;return c};a.prototype.font=function(){var b;b="";this.isBold&&(b+="bold ");this.isItalic&&(b+="italic ");return b+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle};a.prototype.drawNew=
function(){var b,a,c,g,f,e,i,j,k;e=this.isPassword?this.password("*",this.text.length):this.text;this.image=newCanvas();a=this.image.getContext("2d");a.font=this.font();c=Math.max(a.measureText(e).width+Math.abs(this.shadowOffset.x),1);this.bounds.corner=this.bounds.origin.add(new Point(c,fontHeight(this.fontSize)+Math.abs(this.shadowOffset.y)));this.image.width=c;this.image.height=this.height();a.font=this.font();a.textAlign="left";a.textBaseline="bottom";this.shadowColor&&(i=Math.max(this.shadowOffset.x,
0),j=Math.max(this.shadowOffset.y,0),a.fillStyle=this.shadowColor.toString(),a.fillText(e,i,fontHeight(this.fontSize)+j));i=Math.abs(Math.min(this.shadowOffset.x,0));j=Math.abs(Math.min(this.shadowOffset.y,0));a.fillStyle=this.color.toString();this.isShowingBlanks?this.renderWithBlanks(a,i,fontHeight(this.fontSize)+j):a.fillText(e,i,fontHeight(this.fontSize)+j);g=Math.min(this.startMark,this.endMark);f=Math.max(this.startMark,this.endMark);for(b=k=g;g<=f?k<f:k>f;b=g<=f?++k:--k)c=this.slotPosition(b).subtract(this.position()),
b=e.charAt(b),a.fillStyle=this.markedBackgoundColor.toString(),a.fillRect(c.x,c.y,a.measureText(b).width+1+i,fontHeight(this.fontSize)+j),a.fillStyle=this.markedTextColor.toString(),a.fillText(b,c.x+i,fontHeight(this.fontSize)+j);if(this.parent&&this.parent.fixLayout)return this.parent.fixLayout()};a.prototype.renderWithBlanks=function(b,a,c){var g,f,e,i,j,k,l;e=function(){b.drawImage(g,Math.round(l),0);return l+=j};j=b.measureText(" ").width;g=newCanvas(new Point(j,this.height()));f=g.getContext("2d");
k=this.text.split(" ");l=a||0;i=!0;f.fillStyle=this.blanksColor.toString();f.arc(j/2,g.height/2,j/2,radians(0),radians(360));f.fill();return k.forEach(function(a){i||e();i=!1;if(""!==a)return b.fillText(a,l,c),l+=b.measureText(a).width})};a.prototype.slotPosition=function(b){var a,c,g,f,e;g=this.isPassword?this.password("*",this.text.length):this.text;a=Math.min(Math.max(b,0),g.length);b=this.image.getContext("2d");for(c=e=f=0;0<=a?e<a:e>a;c=0<=a?++e:--e)f+=b.measureText(g[c]).width;this.pos=a;g=
this.left()+f;b=this.top();return new Point(g,b)};a.prototype.slotAt=function(b){var a,c,g,f;f=this.isPassword?this.password("*",this.text.length):this.text;a=g=0;for(c=this.image.getContext("2d");b.x-this.left()>a;)if(a+=c.measureText(f[g]).width,g+=1,g===f.length&&c.measureText(f).width-c.measureText(f[g-1]).width/2<b.x-this.left())return g;return g-1};a.prototype.upFrom=function(b){return b};a.prototype.downFrom=function(b){return b};a.prototype.startOfLine=function(){return 0};a.prototype.endOfLine=
function(){return this.text.length};a.prototype.rawHeight=function(){return this.height()/1.2};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);b.addLine();b.addItem("edit","edit");b.addItem("font size...",function(){return this.prompt(b.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)},"set this String's\nfont point size");"serif"!==this.fontStyle&&b.addItem("serif","setSerif");"sans-serif"!==this.fontStyle&&b.addItem("sans-serif",
"setSansSerif");this.isBold?b.addItem("normal weight","toggleWeight"):b.addItem("bold","toggleWeight");this.isItalic?b.addItem("normal style","toggleItalic"):b.addItem("italic","toggleItalic");this.isShowingBlanks?b.addItem("hide blanks","toggleShowBlanks"):b.addItem("show blanks","toggleShowBlanks");this.isPassword?b.addItem("show characters","toggleIsPassword"):b.addItem("hide characters","toggleIsPassword");return b};a.prototype.toggleIsDraggable=function(){return(this.isDraggable=!this.isDraggable)?
this.disableSelecting():this.enableSelecting()};a.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks;this.changed();this.drawNew();return this.changed()};a.prototype.toggleWeight=function(){this.isBold=!this.isBold;this.changed();this.drawNew();return this.changed()};a.prototype.toggleItalic=function(){this.isItalic=!this.isItalic;this.changed();this.drawNew();return this.changed()};a.prototype.toggleIsPassword=function(){this.isPassword=!this.isPassword;this.changed();
this.drawNew();return this.changed()};a.prototype.setSerif=function(){this.fontStyle="serif";this.changed();this.drawNew();return this.changed()};a.prototype.setSansSerif=function(){this.fontStyle="sans-serif";this.changed();this.drawNew();return this.changed()};a.prototype.setFontSize=function(b){"number"===typeof b?this.fontSize=Math.round(Math.min(Math.max(b,4),500)):(b=parseFloat(b),isNaN(b)||(this.fontSize=Math.round(Math.min(Math.max(b,4),500))));this.changed();this.drawNew();return this.changed()};
a.prototype.setText=function(b){this.text=Math.round(b).toString();this.changed();this.drawNew();return this.changed()};a.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]};a.prototype.edit=function(){return this.root().edit(this)};a.prototype.selection=function(){var b,a;b=Math.min(this.startMark,this.endMark);a=Math.max(this.startMark,this.endMark);return this.text.slice(b,a)};a.prototype.selectionStartSlot=function(){return Math.min(this.startMark,
this.endMark)};a.prototype.clearSelection=function(){this.currentlySelecting=!1;this.endMark=this.startMark=0;this.drawNew();return this.changed()};a.prototype.deleteSelection=function(){var b,a,c;c=this.text;b=Math.min(this.startMark,this.endMark);a=Math.max(this.startMark,this.endMark);this.text=c.slice(0,b)+c.slice(a);this.changed();return this.clearSelection()};a.prototype.selectAll=function(){this.startMark=0;this.endMark=this.text.length;this.drawNew();return this.changed()};a.prototype.mouseDownLeft=
function(b){return this.isEditable?this.clearSelection():this.escalateEvent("mouseDownLeft",b)};a.prototype.mouseClickLeft=function(b){var a;a=this.root().cursor;return this.isEditable?(this.currentlySelecting||this.edit(),a&&a.gotoPos(b),this.root().cursor.gotoPos(b),this.currentlySelecting=!0):this.escalateEvent("mouseClickLeft",b)};a.prototype.enableSelecting=function(){this.mouseDownLeft=function(b){this.clearSelection();if(this.isEditable&&!this.isDraggable)return this.edit(),this.root().cursor.gotoPos(b),
this.endMark=this.startMark=this.slotAt(b),this.currentlySelecting=!0};return this.mouseMove=function(b){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable&&(b=this.slotAt(b),b!==this.endMark))return this.endMark=b,this.drawNew(),this.changed()}};a.prototype.disableSelecting=function(){this.mouseDownLeft=a.prototype.mouseDownLeft;return delete this.mouseMove};return a}(Morph);
TextMorph=function(c){function a(b,c,d,g,f,e,i,j,k,l){this.fontSize=null!=c?c:12;this.fontStyle=null!=d?d:"sans-serif";this.isBold=null!=g?g:!1;this.isItalic=null!=f?f:!1;this.alignment=null!=e?e:"left";this.maxWidth=null!=i?i:0;this.shadowColor=null!=l?l:null;a.__super__.constructor.call(this);this.markedTextColor=new Color(255,255,255);this.markedBackgoundColor=new Color(60,60,120);this.text=b||(""===b?b:"TextMorph");this.fontName=j||WorldMorph.MorphicPreferences.globalFontFamily;this.shadowOffset=
k||new Point(0,0);this.color=new Color(0,0,0);this.noticesTransparentClick=!0;this.drawNew()}__extends(a,c);a.prototype.words=[];a.prototype.lines=[];a.prototype.lineSlots=[];a.prototype.alignment=null;a.prototype.maxWidth=null;a.prototype.maxLineWidth=0;a.prototype.backgroundColor=null;a.prototype.receiver=null;a.prototype.toString=function(){return'a TextMorph("'+this.text.slice(0,30)+'...")'};a.prototype.parse=function(){var b,a,c,g,f=this;c=this.text.split("\n");b=newCanvas().getContext("2d");
a="";g=0;b.font=this.font();this.maxLineWidth=0;this.lines=[];this.lineSlots=[0];this.words=[];c.forEach(function(b){f.words=f.words.concat(b.split(" "));return f.words.push("\n")});return this.words.forEach(function(c){var d,j;if("\n"===c)return f.lines.push(a),f.lineSlots.push(g),f.maxLineWidth=Math.max(f.maxLineWidth,b.measureText(a).width),a="";0<f.maxWidth?(d=a+c+" ",j=b.measureText(d).width,j>f.maxWidth?(f.lines.push(a),f.lineSlots.push(g),f.maxLineWidth=Math.max(f.maxLineWidth,b.measureText(a).width),
a=c+" "):a=d):a=a+c+" ";return g+=c.length+1})};a.prototype.drawNew=function(){var b,a,c,g,f,e,i,j,k,l,m,n;this.image=newCanvas();a=this.image.getContext("2d");a.font=this.font();this.parse();i=Math.abs(this.shadowOffset.x);e=Math.abs(this.shadowOffset.y);a=this.lines.length*(fontHeight(this.fontSize)+e);this.bounds=0===this.maxWidth?this.bounds.origin.extent(new Point(this.maxLineWidth+i,a)):this.bounds.origin.extent(new Point(this.maxWidth+i,a));this.image.width=this.width();this.image.height=this.height();
a=this.image.getContext("2d");a.font=this.font();a.textAlign="left";a.textBaseline="bottom";this.backgroundColor&&(a.fillStyle=this.backgroundColor.toString(),a.fillRect(0,0,this.width(),this.height()));if(this.shadowColor){g=Math.max(this.shadowOffset.x,0);f=Math.max(this.shadowOffset.y,0);a.fillStyle=this.shadowColor.toString();b=0;n=this.lines;l=0;for(m=n.length;l<m;l++)c=n[l],j=a.measureText(c).width+i,j="right"===this.alignment?this.width()-j:"center"===this.alignment?(this.width()-j)/2:0,k=
(b+1)*(fontHeight(this.fontSize)+e)-e,b++,a.fillText(c,j+g,k+f)}g=Math.abs(Math.min(this.shadowOffset.x,0));f=Math.abs(Math.min(this.shadowOffset.y,0));a.fillStyle=this.color.toString();b=0;n=this.lines;l=0;for(m=n.length;l<m;l++)c=n[l],j=a.measureText(c).width+i,j="right"===this.alignment?this.width()-j:"center"===this.alignment?(this.width()-j)/2:0,k=(b+1)*(fontHeight(this.fontSize)+e)-e,b++,a.fillText(c,j+g,k+f);i=Math.min(this.startMark,this.endMark);c=Math.max(this.startMark,this.endMark);for(b=
g=i;i<=c?g<c:g>c;b=i<=c?++g:--g)e=this.slotPosition(b).subtract(this.position()),b=this.text.charAt(b),a.fillStyle=this.markedBackgoundColor.toString(),a.fillRect(e.x,e.y,a.measureText(b).width+1,fontHeight(this.fontSize)),a.fillStyle=this.markedTextColor.toString(),a.fillText(b,e.x,e.y+fontHeight(this.fontSize));if(this.parent&&this.parent.layoutChanged)return this.parent.layoutChanged()};a.prototype.setExtent=function(b){this.maxWidth=Math.max(b.x,0);this.changed();return this.drawNew()};a.prototype.columnRow=
function(b){var a,c,g,f,e,i,j;g=f=0;for(i=this.lines.length;0<=i?f<i:f>i;g=0<=i?++f:--f){c=this.lineSlots[g];a=e=0;for(j=this.lines[g].length;0<=j?e<j:e>j;a=0<=j?++e:--e){if(c===b)return new Point(a,g);c+=1}}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)};a.prototype.slotPosition=function(b){var a,c,g,f,e,i,b=this.columnRow(b);a=this.image.getContext("2d");g=Math.abs(this.shadowOffset.y);f=0;g=b.y*(fontHeight(this.fontSize)+g);c=e=0;for(i=b.x;0<=i?e<i:e>i;c=0<=i?++e:
--e)f+=a.measureText(this.lines[b.y][c]).width;b=this.left()+f;a=this.top()+g;return new Point(b,a)};a.prototype.slotAt=function(b){var a,c,g,f,e;c=f=a=0;e=Math.abs(this.shadowOffset.y);for(g=this.image.getContext("2d");b.y-this.top()>(fontHeight(this.fontSize)+e)*f;)f+=1;for(f=Math.max(f,1);b.x-this.left()>a;)a+=g.measureText(this.lines[f-1][c]).width,c+=1;return this.lineSlots[Math.max(f-1,0)]+c-1};a.prototype.upFrom=function(b){var a;a=this.columnRow(b);if(1>a.y)return b;b=this.lines[a.y-1];return b.length<
a.x-1?this.lineSlots[a.y-1]+b.length:this.lineSlots[a.y-1]+a.x};a.prototype.downFrom=function(b){var a;a=this.columnRow(b);if(a.y>this.lines.length-2)return b;b=this.lines[a.y+1];return b.length<a.x-1?this.lineSlots[a.y+1]+b.length:this.lineSlots[a.y+1]+a.x};a.prototype.startOfLine=function(b){return this.lineSlots[this.columnRow(b).y]};a.prototype.endOfLine=function(b){return this.startOfLine(b)+this.lines[this.columnRow(b).y].length-1};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);
b.addLine();b.addItem("edit","edit");b.addItem("font size...",function(){return this.prompt(b.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)},"set this Text's\nfont point size");"left"!==this.alignment&&b.addItem("align left","setAlignmentToLeft");"right"!==this.alignment&&b.addItem("align right","setAlignmentToRight");"center"!==this.alignment&&b.addItem("align center","setAlignmentToCenter");b.addLine();"serif"!==this.fontStyle&&b.addItem("serif","setSerif");
"sans-serif"!==this.fontStyle&&b.addItem("sans-serif","setSansSerif");this.isBold?b.addItem("normal weight","toggleWeight"):b.addItem("bold","toggleWeight");this.isItalic?b.addItem("normal style","toggleItalic"):b.addItem("italic","toggleItalic");return b};a.prototype.setAlignmentToLeft=function(){this.alignment="left";this.drawNew();return this.changed()};a.prototype.setAlignmentToRight=function(){this.alignment="right";this.drawNew();return this.changed()};a.prototype.setAlignmentToCenter=function(){this.alignment=
"center";this.drawNew();return this.changed()};a.prototype.evaluationMenu=function(){var b;b=new MenuMorph(this,null);b.addItem("do it","doIt","evaluate the\nselected expression");b.addItem("show it","showIt","evaluate the\nselected expression\nand show the result");b.addItem("inspect it","inspectIt","evaluate the\nselected expression\nand inspect the result");b.addLine();b.addItem("select all","selectAllAndEdit");return b};a.prototype.selectAllAndEdit=function(){this.edit();return this.selectAll()};
a.prototype.setReceiver=function(b){this.receiver=b;return this.customContextMenu=this.evaluationMenu()};a.prototype.doIt=function(){this.receiver.evaluateString(this.selection());return this.edit()};a.prototype.showIt=function(){var b;b=this.receiver.evaluateString(this.selection());if(null!=b)return this.inform(b)};a.prototype.inspectIt=function(){var b,a;b=this.receiver.evaluateString(this.selection());a=this.world();if(null!=b)return b=new InspectorMorph(b),b.setPosition(a.hand.position()),b.keepWithin(a),
a.add(b),b.changed()};return a}(StringMorph);
BouncerMorph=function(c){function a(b,c){this.type=null!=b?b:"vertical";this.speed=null!=c?c:1;a.__super__.constructor.call(this);this.fps=50;this.direction="vertical"===this.type?"down":"right"}__extends(a,c);a.prototype.isStopped=!1;a.prototype.type=null;a.prototype.direction=null;a.prototype.speed=null;a.prototype.moveUp=function(){return this.moveBy(new Point(0,-this.speed))};a.prototype.moveDown=function(){return this.moveBy(new Point(0,this.speed))};a.prototype.moveRight=function(){return this.moveBy(new Point(this.speed,
0))};a.prototype.moveLeft=function(){return this.moveBy(new Point(-this.speed,0))};a.prototype.step=function(){if(!this.isStopped)if("vertical"===this.type){if("down"===this.direction?this.moveDown():this.moveUp(),this.boundsIncludingChildren().top()<this.parent.top()&&"up"===this.direction&&(this.direction="down"),this.boundsIncludingChildren().bottom()>this.parent.bottom()&&"down"===this.direction)return this.direction="up"}else if("horizontal"===this.type&&("right"===this.direction?this.moveRight():
this.moveLeft(),this.boundsIncludingChildren().left()<this.parent.left()&&"left"===this.direction&&(this.direction="right"),this.boundsIncludingChildren().right()>this.parent.right()&&"right"===this.direction))return this.direction="left"};return a}(Morph);
ColorPaletteMorph=function(c){function a(b,c){this.target=null!=b?b:null;a.__super__.constructor.call(this);this.silentSetExtent(c||new Point(80,50));this.drawNew()}__extends(a,c);a.prototype.target=null;a.prototype.targetSetter="color";a.prototype.choice=null;a.prototype.drawNew=function(){var b,a,c,g,f,e,i,j,k;a=this.extent();this.image=newCanvas(this.extent());b=this.image.getContext("2d");this.choice=new Color;k=[];f=i=0;for(j=a.x;0<=j?i<=j:i>=j;f=0<=j?++i:--i)c=360*f/a.x,e=0,k.push(function(){var i,
j,k;k=[];e=i=0;for(j=a.y;0<=j?i<=j:i>=j;e=0<=j?++i:--i)g=100-100*(e/a.y),b.fillStyle="hsl("+c+",100%,"+g+"%)",k.push(b.fillRect(f,e,1,1));return k}());return k};a.prototype.mouseMove=function(b){this.choice=this.getPixelColor(b);return this.updateTarget()};a.prototype.mouseDownLeft=function(b){this.choice=this.getPixelColor(b);return this.updateTarget()};a.prototype.updateTarget=function(){if(this.target instanceof Morph&&null!==this.choice){if(this.target[this.targetSetter]instanceof Function)return this.target[this.targetSetter](this.choice);
this.target[this.targetSetter]=this.choice;this.target.drawNew();return this.target.changed()}};a.prototype.copyRecordingReferences=function(b){var c;c=a.__super__.copyRecordingReferences.call(this,b);c.target&&b[this.target]&&(c.target=b[this.target]);return c};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);b.addLine();b.addItem("set target","setTarget","choose another morph\nwhose color property\n will be controlled by this one");return b};a.prototype.setTarget=
function(){var b,a,c=this;b=this.overlappedMorphs();a=new MenuMorph(this,"choose target:");b.push(this.world());b.forEach(function(b){return a.addItem(b.toString().slice(0,50),function(){c.target=b;return c.setTargetSetter()})});if(1===b.length)return this.target=b[0],this.setTargetSetter();if(b.length)return a.popUpAtHand(this.world())};a.prototype.setTargetSetter=function(){var b,a,c=this;b=this.target.colorSetters();a=new MenuMorph(this,"choose target property:");b.forEach(function(b){return a.addItem(b,
function(){return c.targetSetter=b})});if(1===b.length)return this.targetSetter=b[0];if(b.length)return a.popUpAtHand(this.world())};return a}(Morph);
SliderMorph=function(c){function a(b,c,d,g,f,e){this.start=null!=b?b:1;this.stop=null!=c?c:100;this.value=null!=d?d:50;this.size=null!=g?g:10;this.button=new SliderButtonMorph;this.button.isDraggable=!1;this.button.color=new Color(200,200,200);this.button.highlightColor=new Color(210,210,255);this.button.pressColor=new Color(180,180,255);a.__super__.constructor.call(this,f);this.add(this.button);this.alpha=0.3;this.color=e||new Color(0,0,0);this.setExtent(new Point(20,100))}__extends(a,c);a.prototype.target=
null;a.prototype.action=null;a.prototype.start=null;a.prototype.stop=null;a.prototype.value=null;a.prototype.size=null;a.prototype.offset=null;a.prototype.button=null;a.prototype.step=null;a.prototype.autoOrientation=function(){return noOperation};a.prototype.rangeSize=function(){return this.stop-this.start};a.prototype.ratio=function(){return this.size/this.rangeSize()};a.prototype.unitSize=function(){return"vertical"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-
this.button.width())/this.rangeSize()};a.prototype.drawNew=function(){var b,c;a.__super__.drawNew.call(this);this.button.orientation=this.orientation;"vertical"===this.orientation?(c=this.width()-2,b=Math.max(c,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(c,b)),b=1,c=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(b=this.height()-2,c=Math.max(b,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(c,
b)),c=1,b=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width()));this.button.setPosition((new Point(b,c)).add(this.bounds.origin));this.button.drawNew();return this.button.changed()};a.prototype.updateValue=function(){var b;b="vertical"===this.orientation?this.button.top()-this.top():this.button.left()-this.left();this.value=Math.round(b/this.unitSize()+this.start);return this.updateTarget()};a.prototype.updateTarget=function(){if(this.action)return"function"===
typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value)};a.prototype.copyRecordingReferences=function(b){var c;c=a.__super__.copyRecordingReferences.call(this,b);c.target&&b[this.target]&&(c.target=b[this.target]);c.button&&b[this.button]&&(c.button=b[this.button]);return c};a.prototype.developersMenu=function(){var b;b=a.__super__.developersMenu.call(this);b.addItem("show value...","showValue","display a dialog box\nshowing the selected number");b.addItem("floor...",
function(){return this.prompt(b.title+"\nfloor:",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)},"set the minimum value\nwhich can be selected");b.addItem("ceiling...",function(){return this.prompt(b.title+"\nceiling:",this.setStop,this,this.stop.toString(),null,this.start+this.size,100*this.size,!0)},"set the maximum value\nwhich can be selected");b.addItem("button size...",function(){return this.prompt(b.title+"\nbutton size:",this.setSize,this,this.size.toString(),null,
1,this.stop-this.start,!0)},"set the range\ncovered by\nthe slider button");b.addLine();b.addItem("set target","setTarget","select another morph\nwhose numerical property\nwill be controlled by this one");return b};a.prototype.showValue=function(){return this.inform(this.value)};a.prototype.userSetStart=function(b){return this.start=Math.max(b,this.stop)};a.prototype.setStart=function(b){"number"===typeof b?this.start=Math.min(Math.max(b,0),this.stop-this.size):(b=parseFloat(b),isNaN(b)||(this.start=
Math.min(Math.max(b,0),this.stop-this.size)));this.value=Math.max(this.value,this.start);this.updateTarget();this.drawNew();return this.changed()};a.prototype.setStop=function(b){"number"===typeof b?this.stop=Math.max(b,this.start+this.size):(b=parseFloat(b),isNaN(b)||(this.stop=Math.max(b,this.start+this.size)));this.value=Math.min(this.value,this.stop);this.updateTarget();this.drawNew();return this.changed()};a.prototype.setSize=function(b){"number"===typeof b?this.size=Math.min(Math.max(b,1),this.stop-
this.start):(b=parseFloat(b),isNaN(b)||(this.size=Math.min(Math.max(b,1),this.stop-this.start)));this.value=Math.min(this.value,this.stop-this.size);this.updateTarget();this.drawNew();return this.changed()};a.prototype.setTarget=function(){var b,a,c=this;b=this.overlappedMorphs();a=new MenuMorph(this,"choose target:");b.push(this.world());b.forEach(function(b){return a.addItem(b.toString().slice(0,50),function(){c.target=b;return c.setTargetSetter()})});if(1===b.length)return this.target=b[0],this.setTargetSetter();
if(b.length)return a.popUpAtHand(this.world())};a.prototype.setTargetSetter=function(){var b,a,c=this;b=this.target.numericalSetters();a=new MenuMorph(this,"choose target property:");b.forEach(function(b){return a.addItem(b,function(){return c.action=b})});if(1===b.length)return this.action=b[0];if(b.length)return a.popUpAtHand(this.world())};a.prototype.numericalSetters=function(){var b;b=a.__super__.numericalSetters.call(this);b.push("setStart","setStop","setSize");return b};a.prototype.mouseDownLeft=
function(b){var a,c=this;this.offset=this.button.bounds.containsPoint(b)?b.subtract(this.button.bounds.origin):new Point;a=this.root();return this.step=function(){var b,f,e;return a.hand.mouseButton?(b=a.hand.bounds.origin,"vertical"===c.orientation?(f=c.button.bounds.origin.x,e=Math.max(Math.min(b.y-c.offset.y,c.bottom()-c.button.height()),c.top())):(e=c.button.bounds.origin.y,f=Math.max(Math.min(b.x-c.offset.x,c.right()-c.button.width()),c.left())),c.button.setPosition(new Point(f,e)),c.updateValue()):
c.step=null}};return a}(CircleBoxMorph);
StringFieldMorph=function(c){function a(b,c,d,g,f,e,i){this.defaultContents=null!=b?b:"";this.minWidth=null!=c?c:100;this.fontSize=null!=d?d:12;this.fontStyle=null!=g?g:"sans-serif";this.isBold=null!=f?f:!1;this.isItalic=null!=e?e:!1;this.isNumeric=null!=i?i:!1;a.__super__.constructor.call(this);this.color=new Color(255,255,255);this.drawNew()}__extends(a,c);a.prototype.defaultContents=null;a.prototype.minWidth=null;a.prototype.fontSize=null;a.prototype.fontStyle=null;a.prototype.isBold=null;a.prototype.isItalic=
null;a.prototype.isNumeric=null;a.prototype.text=null;a.prototype.isEditable=!0;a.prototype.drawNew=function(){var b;b=this.text?this.string():this.defaultContents;this.text=null;this.children.forEach(function(b){return b.destroy()});this.children=[];this.text=new StringMorph(b,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric);this.text.isNumeric=this.isNumeric;this.text.setPosition(this.bounds.origin.copy());this.text.isEditable=this.isEditable;this.text.isDraggable=!1;this.text.enableSelecting();
this.silentSetExtent(new Point(Math.max(this.width(),this.minWidth),this.text.height()));a.__super__.drawNew.call(this);return this.add(this.text)};a.prototype.string=function(){return this.text.text};a.prototype.mouseClickLeft=function(){if(this.isEditable)return this.text.edit()};a.prototype.copyRecordingReferences=function(b){var c;c=a.__super__.copyRecordingReferences.call(this,b);c.text&&b[this.text]&&(c.text=b[this.text]);return c};return a}(FrameMorph);
BlinkerMorph=function(c){function a(b){this.fps=null!=b?b:2;a.__super__.constructor.call(this);this.color=new Color(0,0,0);this.drawNew()}__extends(a,c);a.prototype.step=function(){return this.toggleVisibility()};return a}(Morph);
GrayPaletteMorph=function(c){function a(b,c){this.target=null!=b?b:null;a.__super__.constructor.call(this,this.target,c||new Point(80,10))}__extends(a,c);a.prototype.drawNew=function(){var b,a,c;a=this.extent();this.image=newCanvas(this.extent());b=this.image.getContext("2d");this.choice=new Color;c=b.createLinearGradient(0,0,a.x,a.y);c.addColorStop(0,"black");c.addColorStop(1,"white");b.fillStyle=c;return b.fillRect(0,0,a.x,a.y)};return a}(ColorPaletteMorph);
HandleMorph=function(c){function a(b,c,d,g,f,e){this.target=null!=b?b:null;null==c&&(c=0);null==d&&(d=0);this.type=null!=e?e:"resize";this.minExtent=new Point(c,d);this.inset=new Point(g||0,f||g||0);a.__super__.constructor.call(this);this.color=new Color(255,255,255);this.noticesTransparentClick=!0;b=WorldMorph.MorphicPreferences.handleSize;this.setExtent(new Point(b,b))}__extends(a,c);a.prototype.target=null;a.prototype.minExtent=null;a.prototype.inset=null;a.prototype.type=null;a.prototype.drawNew=
function(){this.normalImage=newCanvas(this.extent());this.highlightImage=newCanvas(this.extent());this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100));this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255));this.image=this.normalImage;if(this.target)return this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed()};a.prototype.drawOnCanvas=function(b,a,c){var g,f,e,i,b=b.getContext("2d");
b.lineWidth=1;b.lineCap="round";b.strokeStyle=a.toString();if("move"===this.type){g=this.bottomLeft().subtract(this.position());f=g.copy();e=this.topRight().subtract(this.position());i=e.copy();for(a=0;a<=this.height();)f.y=g.y-a,i.y=e.y-a,b.beginPath(),b.moveTo(f.x,f.y),b.lineTo(i.x,i.y),b.closePath(),b.stroke(),a+=6}g=this.bottomLeft().subtract(this.position());f=g.copy();e=this.topRight().subtract(this.position());i=e.copy();for(a=0;a<=this.width();)f.x=g.x+a,i.x=e.x+a,b.beginPath(),b.moveTo(f.x,
f.y),b.lineTo(i.x,i.y),b.closePath(),b.stroke(),a+=6;b.strokeStyle=c.toString();if("move"===this.type){g=this.bottomLeft().subtract(this.position());f=g.copy();e=this.topRight().subtract(this.position());i=e.copy();for(a=-2;a<=this.height();)f.y=g.y-a,i.y=e.y-a,b.beginPath(),b.moveTo(f.x,f.y),b.lineTo(i.x,i.y),b.closePath(),b.stroke(),a+=6}g=this.bottomLeft().subtract(this.position());f=g.copy();e=this.topRight().subtract(this.position());i=e.copy();a=2;for(c=[];a<=this.width();)f.x=g.x+a,i.x=e.x+
a,b.beginPath(),b.moveTo(f.x,f.y),b.lineTo(i.x,i.y),b.closePath(),b.stroke(),c.push(a+=6);return c};a.prototype.mouseDownLeft=function(b){var a,c,g=this;c=this.root();a=b.subtract(this.bounds.origin);if(!this.target)return null;this.step=function(){var b;return c.hand.mouseButton?(b=c.hand.bounds.origin.copy().subtract(a),"resize"===g.type?(b=b.add(g.extent().add(g.inset)).subtract(g.target.bounds.origin),b=b.max(g.minExtent),g.target.setExtent(b),g.setPosition(g.target.bottomRight().subtract(g.extent().add(g.inset)))):
g.target.setPosition(b.subtract(g.target.extent()).add(g.extent()))):g.step=null};if(!this.target.step)return this.target.step=noOperation};a.prototype.rootForGrab=function(){return this};a.prototype.mouseEnter=function(){this.image=this.highlightImage;return this.changed()};a.prototype.mouseLeave=function(){this.image=this.normalImage;return this.changed()};a.prototype.copyRecordingReferences=function(b){var c;c=a.__super__.copyRecordingReferences.call(this,b);c.target&&b[this.target]&&(c.target=
b[this.target]);return c};a.prototype.attach=function(){var b,a;b=this.overlappedMorphs();a=new MenuMorph(this,"choose target:");b.forEach(function(b){return a.addItem(b.toString().slice(0,50),function(){this.isDraggable=!1;this.target=b;this.drawNew();return this.noticesTransparentClick=!0})});if(b.length)return a.popUpAtHand(this.world())};return a}(Morph);
MorphsListMorph=function(c){function a(){a.__super__.constructor.call(this);this.silentSetExtent(new Point(10*WorldMorph.MorphicPreferences.handleSize,40*WorldMorph.MorphicPreferences.handleSize/3));this.isDraggable=!0;this.border=1;this.edge=5;this.color=new Color(60,60,60);this.borderColor=new Color(95,95,95);this.drawNew();this.buildPanes()}__extends(a,c);a.prototype.morphsList=null;a.prototype.buttonClose=null;a.prototype.resizer=null;a.prototype.setTarget=function(b){this.target=b;this.currentProperty=
null;return this.buildPanes()};a.prototype.buildPanes=function(){var b,a,c=this;this.children.forEach(function(b){if(b!==this.work)return b.destroy()});this.children=[];this.label=new TextMorph("Morphs List");this.label.fontSize=WorldMorph.MorphicPreferences.menuFontSize;this.label.isBold=!0;this.label.color=new Color(255,255,255);this.label.drawNew();this.add(this.label);b=[];for(a in window)-1!==a.indexOf("Morph",a.length-5)&&b.push(a);this.morphsList=new ListMorph(b,null);this.morphsList.hBar.alpha=
0.6;this.morphsList.vBar.alpha=0.6;this.add(this.morphsList);this.buttonClose=new TriggerMorph;this.buttonClose.labelString="close";this.buttonClose.action=function(){return c.destroy()};this.add(this.buttonClose);this.resizer=new HandleMorph(this,150,100,this.edge,this.edge);return this.fixLayout()};a.prototype.fixLayout=function(){var b,a,c,g;Morph.prototype.trackChanges=!1;c=this.left()+this.edge;g=this.top()+this.edge;a=this.right()-this.edge-c;this.label.setPosition(new Point(c,g));this.label.setWidth(a);
this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew());g=this.label.bottom()+2;a=this.width()-this.edge;a-=this.edge;b=this.bottom()-2*this.edge-WorldMorph.MorphicPreferences.handleSize-g;this.morphsList.setPosition(new Point(c,g));this.morphsList.setExtent(new Point(a,b));c=this.morphsList.left();g=this.morphsList.bottom()+this.edge;b=WorldMorph.MorphicPreferences.handleSize;a=this.morphsList.width()-b-this.edge;this.buttonClose.setPosition(new Point(c,
g));this.buttonClose.setExtent(new Point(a,b));Morph.prototype.trackChanges=!0;return this.changed()};a.prototype.setExtent=function(b){a.__super__.setExtent.call(this,b);return this.fixLayout()};return a}(BoxMorph);
MenuItemMorph=function(c){function a(b,c,d,g,f,e,i,j){a.__super__.constructor.call(this,b,c,d,g,f,e,i,j)}__extends(a,c);a.prototype.createLabel=function(){var b,a;null!==this.label&&this.label.destroy();isString(this.labelString)?this.label=this.createLabelString(this.labelString):this.labelString instanceof Array?(this.label=new Morph,this.label.alpha=0,this.label.add(b=this.createIcon(this.labelString[0])),this.label.add(a=this.createLabelString(this.labelString[1])),a.setCenter(b.center()),a.setLeft(b.right()+
4),this.label.bounds=b.bounds.merge(a.bounds),this.label.drawNew()):this.label=this.createIcon(this.labelString);this.silentSetExtent(this.label.extent().add(new Point(8,0)));this.label.bounds=this.position().add(new Point(4,0)).extent(this.label.extent());return this.add(this.label)};a.prototype.createIcon=function(b){var a,c;a=new Morph;a.image=b instanceof Morph?b.fullImage():b;b instanceof Morph&&b.getShadow()&&(c=a.image,a.image=newCanvas(b.fullBounds().extent().subtract(this.shadowBlur*(useBlurredShadows?
1:2))),a.image.getContext("2d").drawImage(c,0,0));a.silentSetWidth(a.image.width);a.silentSetHeight(a.image.height);return a};a.prototype.createLabelString=function(a){a=new TextMorph(a,this.fontSize,this.fontStyle);a.setColor(this.labelColor);return a};a.prototype.mouseEnter=function(){this.isListItem()||(this.image=this.highlightImage,this.changed());if(this.hint)return this.bubbleHelp(this.hint)};a.prototype.mouseLeave=function(){this.isListItem()||(this.image=this.normalImage,this.changed());
if(this.hint)return this.world().hand.destroyTemporaries()};a.prototype.mouseDownLeft=function(a){this.isListItem()&&(this.parent.unselectAllItems(),this.escalateEvent("mouseDownLeft",a));this.image=this.pressImage;return this.changed()};a.prototype.mouseMove=function(){if(this.isListItem())return this.escalateEvent("mouseMove")};a.prototype.mouseClickLeft=function(){this.isListItem()||(this.parent.destroy(),this.root().activeMenu=null);return this.trigger()};a.prototype.isListItem=function(){return this.parent?
this.parent.isListContents:!1};a.prototype.isSelectedListItem=function(){return this.isListItem()?this.image===this.pressImage:!1};return a}(TriggerMorph);ShadowMorph=function(c){function a(){a.__super__.constructor.call(this)}__extends(a,c);return a}(Morph);
CursorMorph=function(c){function a(b){this.target=b;this.originalContents=this.target.text;this.originalAlignment=this.target.alignment;this.slot=this.target.text.length;a.__super__.constructor.call(this);b=fontHeight(this.target.fontSize);this.setExtent(new Point(Math.max(Math.floor(b/20),1),b));this.drawNew();this.image.getContext("2d").font=this.target.font();this.target instanceof TextMorph&&"left"!==this.target.alignment&&this.target.setAlignmentToLeft();this.gotoSlot(this.slot)}__extends(a,
c);a.prototype.keyDownEventUsed=!1;a.prototype.target=null;a.prototype.originalContents=null;a.prototype.slot=null;a.prototype.viewPadding=1;a.prototype.processKeyPress=function(a){if(this.keyDownEventUsed)return this.keyDownEventUsed=!1,null;if(40===a.keyCode||40===a.charCode)return this.insert("("),null;if(37===a.keyCode||37===a.charCode)return this.insert("%"),null;a.keyCode?a.ctrlKey?this.ctrl(a.keyCode):a.metaKey?this.cmd(a.keyCode):this.insert(String.fromCharCode(a.keyCode),a.shiftKey):a.charCode&&
(a.ctrlKey?this.ctrl(a.charCode):a.metaKey?this.cmd(a.keyCode):this.insert(String.fromCharCode(a.charCode),a.shiftKey));return this.target.escalateEvent("reactToKeystroke",a)};a.prototype.processKeyDown=function(a){var c;c=a.shiftKey;this.keyDownEventUsed=!1;if(a.ctrlKey)this.ctrl(a.keyCode),this.target.escalateEvent("reactToKeystroke",a);else if(a.metaKey)this.cmd(a.keyCode),this.target.escalateEvent("reactToKeystroke",a);else{switch(a.keyCode){case 37:this.goLeft(c);this.keyDownEventUsed=!0;break;
case 39:this.goRight(c);this.keyDownEventUsed=!0;break;case 38:this.goUp(c);this.keyDownEventUsed=!0;break;case 40:this.goDown(c);this.keyDownEventUsed=!0;break;case 36:this.goHome(c);this.keyDownEventUsed=!0;break;case 35:this.goEnd(c);this.keyDownEventUsed=!0;break;case 46:this.deleteRight();this.keyDownEventUsed=!0;break;case 8:this.deleteLeft();this.keyDownEventUsed=!0;break;case 13:"StringMorph"===this.target.constructor.name?this.accept():this.insert("\n");this.keyDownEventUsed=!0;break;case 27:this.cancel(),
this.keyDownEventUsed=!0}return this.target.escalateEvent("reactToKeystroke",a)}};a.prototype.gotoSlot=function(a){var c,d;c=this.target.text.length;d=this.target.slotPosition(a);this.slot=0>a?0:a>c?c:a;if(this.parent&&this.target.isScrollable&&(c=this.parent.right()-this.viewPadding,a=this.parent.left()+this.viewPadding,d.x>c&&(this.target.setLeft(this.target.left()+c-d.x),d.x=c),d.x<a&&(a=Math.min(this.parent.left(),a),this.target.setLeft(this.target.left()+a-d.x),d.x=a),this.target.right()<c&&
c-this.target.width()<a))d.x+=c-this.target.right(),this.target.setRight(c);this.show();this.setPosition(d);if(this.parent&&this.parent.parent instanceof ScrollFrameMorph&&this.target.isScrollable)return this.parent.parent.scrollCursorIntoView(this)};a.prototype.goLeft=function(a){this.updateSelection(a);this.gotoSlot(this.slot-1);return this.updateSelection(a)};a.prototype.goRight=function(a){this.updateSelection(a);this.gotoSlot(this.slot+1);return this.updateSelection(a)};a.prototype.goUp=function(a){this.updateSelection(a);
this.gotoSlot(this.target.upFrom(this.slot));return this.updateSelection(a)};a.prototype.goDown=function(a){this.updateSelection(a);this.gotoSlot(this.target.downFrom(this.slot));return this.updateSelection(a)};a.prototype.goHome=function(a){this.updateSelection(a);this.gotoSlot(this.target.startOfLine(this.slot));return this.updateSelection(a)};a.prototype.goEnd=function(a){this.updateSelection(a);this.gotoSlot(this.target.endOfLine(this.slot));return this.updateSelection(a)};a.prototype.gotoPos=
function(a){this.gotoSlot(this.target.slotAt(a));return this.show()};a.prototype.updateSelection=function(a){if(a){if(!this.target.endMark&&!this.target.startMark)return this.target.startMark=this.slot,this.target.endMark=this.slot;if(this.target.endMark!==this.slot)return this.target.endMark=this.slot,this.target.drawNew(),this.target.changed()}else return this.target.clearSelection()};a.prototype.accept=function(){var a;(a=this.root())&&a.stopEditing();return this.escalateEvent("accept",null)};
a.prototype.cancel=function(){var a;a=this.root();this.undo();a&&a.stopEditing();return this.escalateEvent("cancel",null)};a.prototype.undo=function(){this.target.text=this.originalContents;this.target.changed();this.target.drawNew();this.target.changed();return this.gotoSlot(0)};a.prototype.insert=function(a,c){var d;if("\t"===a)return this.target.escalateEvent("reactToEdit",this.target),c?this.target.backTab(this.target):this.target.tab(this.target);if(!this.target.isNumeric||!isNaN(parseFloat(a))||
contains(["-","."],a))return""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),d=this.target.text,d=d.slice(0,this.slot)+a+d.slice(this.slot),this.target.text=d,this.target.drawNew(),this.target.changed(),this.goRight()};a.prototype.ctrl=function(a){if(97===a||65===a)return this.target.selectAll();if(90===a)return this.undo();if(123===a)return this.insert("{");if(125===a)return this.insert("}");if(91===a)return this.insert("[");if(93===a)return this.insert("]")};
a.prototype.cmd=function(a){if(65===a)return this.target.selectAll();if(90===a)return this.undo()};a.prototype.deleteRight=function(){var a;if(""!==this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection();a=this.target.text;this.target.changed();a=a.slice(0,this.slot)+a.slice(this.slot+1);this.target.text=a;return this.target.drawNew()};a.prototype.deleteLeft=function(){var a;if(this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),
this.target.deleteSelection();a=this.target.text;this.target.changed();this.target.text=a.substring(0,this.slot-1)+a.substr(this.slot);this.target.drawNew();return this.goLeft()};a.prototype.destroy=function(){this.target.alignment!==this.originalAlignment&&(this.target.alignment=this.originalAlignment,this.target.drawNew(),this.target.changed());return a.__super__.destroy.apply(this,arguments)};a.prototype.inspectKeyEvent=function(a){return this.inform("Key pressed: "+String.fromCharCode(a.charCode)+
"\n------------------------\ncharCode: "+a.charCode.toString()+"\nkeyCode: "+a.keyCode.toString()+"\naltKey: "+a.altKey.toString()+"\nctrlKey: "+a.ctrlKey.toString()+"\ncmdKey: "+a.metaKey.toString())};return a}(BlinkerMorph);
Point2=function(){function c(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}c.prototype.x=null;c.prototype.y=null;c.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())};c.prototype.copy=function(){return new c(this.x,this.y)};c.prototype.eq=function(a){return this.x===a.x&&this.y===a.y};c.prototype.lt=function(a){return this.x<a.x&&this.y<a.y};c.prototype.gt=function(a){return this.x>a.x&&this.y>a.y};c.prototype.ge=function(a){return this.x>=a.x&&this.y>=
a.y};c.prototype.le=function(a){return this.x<=a.x&&this.y<=a.y};c.prototype.max=function(a){this.x=Math.max(this.x,a.x);return this.y=Math.max(this.y,a.y)};c.prototype.min=function(a){this.x=Math.min(this.x,a.x);return this.y=Math.min(this.y,a.y)};c.prototype.round=function(){this.x=Math.round(this.x);return this.y=Math.round(this.y)};c.prototype.abs=function(){this.x=Math.abs(this.x);return this.y=Math.abs(this.y)};c.prototype.neg=function(){this.x=-this.x;return this.y=-this.y};c.prototype.mirror=
function(){var a;a=this.x;this.x=this.y;return this.y=a};c.prototype.floor=function(){this.x=Math.max(Math.floor(this.x),0);return this.y=Math.max(Math.floor(this.y),0)};c.prototype.ceil=function(){this.x=Math.ceil(this.x);return this.y=Math.ceil(this.y)};c.prototype.add=function(a){if(a instanceof c)this.x+=a.x,this.y+=a.y;else return this.x+=a,this.y+=a};c.prototype.subtract=function(a){if(a instanceof c)this.x-=a.x,this.y-=a.y;else return this.x-=a,this.y-=a};c.prototype.multiplyBy=function(a){if(a instanceof
c)this.x*=a.x,this.y*=a.y;else return this.x*=a,this.y*=a};c.prototype.divideBy=function(a){if(a instanceof c)this.x/=a.x,this.y/=a.y;else return this.x/=a,this.y/=a};c.prototype.floorDivideBy=function(a){if(a instanceof c)this.x=Math.floor(this.x/a.x),this.y=Math.floor(this.y/a.y);else return this.x=Math.floor(this.x/a),this.y=Math.floor(this.y/a)};c.prototype.r=function(){var a;a=this.copy();a.multiplyBy(a);return Math.sqrt(a.x+a.y)};c.prototype.degrees=function(){var a;if(0===this.x)return 0<=
this.y?90:270;a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?degrees(a):360+degrees(a):180+degrees(a)};c.prototype.theta=function(){var a;if(0===this.x)return 0<=this.y?radians(90):radians(270);a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?a:radians(360)+a:radians(180)+a};c.prototype.crossProduct=function(a){return this.multiplyBy(a.copy().mirror())};c.prototype.distanceTo=function(a){return a.copy().subtract(this).r()};c.prototype.rotate=function(a,b){var c;c=this.copy().subtract(b);
if("right"===a)this.x=-c.y+b.x,this.y=c.y+b.y;else if("left"===a)this.x=c.y+b.x,this.y=-c.y+b.y;else return c=b.copy().subtract(c),this.x=c.x,this.y=c.y};c.prototype.flip=function(a,b){if("vertical"===a)this.y=2*b.y-this.y;else return this.x=2*b.x-this.x};c.prototype.distanceAngle=function(a,b){var c,d;c=b;270<c?c-=360:-270>c&&(c+=360);if(-90<=c&&90>=c)c=Math.sin(radians(c))*a,d=Math.sqrt(a*a-c*c),this.x=c+this.x,this.y-=d;else return c=Math.sin(radians(180-c))*a,d=Math.sqrt(a*a-c*c),this.x=c+this.x,
this.y+=d};c.prototype.scaleBy=function(a){return this.multiplyBy(a)};c.prototype.translateBy=function(a){return this.add(a)};c.prototype.rotateBy=function(a,b){var h,d,g;h=b||new c(0,0);d=this.copy().subtract(h);g=d.r();d=a-d.theta();this.x=h.x+g*Math.cos(d);return this.y=h.y-g*Math.sin(d)};c.prototype.asArray=function(){return[this.x,this.y]};c.prototype.corner=function(a){return new Rectangle(this.x,this.y,a.x,a.y)};c.prototype.rectangle=function(a){var b;b=this.copy().min(a);a=this.copy().max(a);
return new Rectangle(b.x,b.y,a.x,a.y)};c.prototype.extent=function(a){a=this.copy().add(a);return new Rectangle(this.x,this.y,a.x,a.y)};return c}();
WorldMorph=function(c){function a(b,c){a.__super__.constructor.call(this);this.color=new Color(205,205,205);this.alpha=1;this.bounds=new Rectangle(0,0,b.width,b.height);this.drawNew();this.isVisible=!0;this.isDraggable=!1;this.currentKey=null;this.worldCanvas=b;this.useFillPage=c;void 0===this.useFillPage&&(this.useFillPage=!0);this.isDevMode=!1;this.broken=[];this.hand=new HandMorph(this);this.virtualKeyboard=this.activeHandle=this.activeMenu=this.cursor=this.lastEditedText=this.keyboardReceiver=
null;this.initEventListeners()}__extends(a,c);a.MorphicPreferences=standardSettings;a.currentTime=null;a.showRedraws=!1;a.prototype.brokenFor=function(a){var c;c=a.boundsIncludingChildren();return this.broken.filter(function(a){return a.intersects(c)})};a.prototype.fullDrawOn=function(b,c){a.__super__.fullDrawOn.call(this,b,c);return this.hand.fullDrawOn(b,c)};a.prototype.updateBroken=function(){var a=this;this.broken.forEach(function(c){if(c.isNotEmpty())return a.fullDrawOn(a.worldCanvas,c)});return this.broken=
[]};a.prototype.doOneCycle=function(){a.currentTime=Date.now();this.runChildrensStepFunction();return this.updateBroken()};a.prototype.fillPage=function(){var a,c,d,g=this;d=getDocumentPositionOf(this.worldCanvas);a=window.innerHeight;c=window.innerWidth;0<d.x&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.left="0px",d.x=0);0<d.y&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.top="0px",d.y=0);document.body.scrollTop&&(a=document.documentElement.clientHeight);
document.body.scrollLeft&&(c=document.documentElement.clientWidth);this.worldCanvas.width!==c&&(this.worldCanvas.width=c,this.setWidth(c));this.worldCanvas.height!==a&&(this.worldCanvas.height=a,this.setHeight(a));return this.children.forEach(function(a){if(a.reactToWorldResize)return a.reactToWorldResize(g.bounds.copy())})};a.prototype.getGlobalPixelColor=function(a){a=this.worldCanvas.getContext("2d").getImageData(a.x,a.y,1,1).data;return new Color(a[0],a[1],a[2])};a.prototype.initVirtualKeyboard=
function(){var b=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null);if(a.MorphicPreferences.useVirtualKeyboard)return this.virtualKeyboard=document.createElement("input"),this.virtualKeyboard.type="text",this.virtualKeyboard.style.color="transparent",this.virtualKeyboard.style.backgroundColor="transparent",this.virtualKeyboard.style.border="none",this.virtualKeyboard.style.outline="none",this.virtualKeyboard.style.position="absolute",this.virtualKeyboard.style.top=
"0px",this.virtualKeyboard.style.left="0px",this.virtualKeyboard.style.width="0px",this.virtualKeyboard.style.height="0px",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener("keydown",function(a){b.currentKey=a.keyCode;b.keyboardReceiver&&b.keyboardReceiver.processKeyDown(a);(a.keyIdentifier==="U+0008"||a.keyIdentifier==="Backspace")&&a.preventDefault();if(a.keyIdentifier==="U+0009"||a.keyIdentifier==="Tab"){b.keyboardReceiver&&b.keyboardReceiver.processKeyPress(a);
return a.preventDefault()}},!1),this.virtualKeyboard.addEventListener("keyup",function(a){b.currentKey=null;b.keyboardReceiver&&b.keyboardReceiver.processKeyUp&&b.keyboardReceiver.processKeyUp(a);return a.preventDefault()},!1),this.virtualKeyboard.addEventListener("keypress",function(a){b.keyboardReceiver&&b.keyboardReceiver.processKeyPress(a);return a.preventDefault()},!1)};a.prototype.initEventListeners=function(){var a,c=this;a=this.worldCanvas;this.useFillPage?this.fillPage():this.changed();a.addEventListener("mousedown",
function(a){return c.hand.processMouseDown(a)},!1);a.addEventListener("touchstart",function(a){return c.hand.processTouchStart(a)},!1);a.addEventListener("mouseup",function(a){a.preventDefault();return c.hand.processMouseUp(a)},!1);a.addEventListener("touchend",function(a){return c.hand.processTouchEnd(a)},!1);a.addEventListener("mousemove",function(a){return c.hand.processMouseMove(a)},!1);a.addEventListener("touchmove",function(a){return c.hand.processTouchMove(a)},!1);a.addEventListener("contextmenu",
function(a){return a.preventDefault()},!1);a.addEventListener("keydown",function(a){c.currentKey=a.keyCode;c.keyboardReceiver&&c.keyboardReceiver.processKeyDown(a);("U+0008"===a.keyIdentifier||"Backspace"===a.keyIdentifier)&&a.preventDefault();if("U+0009"===a.keyIdentifier||"Tab"===a.keyIdentifier)return c.keyboardReceiver&&c.keyboardReceiver.processKeyPress(a),a.preventDefault()},!1);a.addEventListener("keyup",function(a){c.currentKey=null;c.keyboardReceiver&&c.keyboardReceiver.processKeyUp&&c.keyboardReceiver.processKeyUp(a);
return a.preventDefault()},!1);a.addEventListener("keypress",function(a){c.keyboardReceiver&&c.keyboardReceiver.processKeyPress(a);return a.preventDefault()},!1);a.addEventListener("mousewheel",function(a){c.hand.processMouseScroll(a);return a.preventDefault()},!1);a.addEventListener("DOMMouseScroll",function(a){c.hand.processMouseScroll(a);return a.preventDefault()},!1);window.addEventListener("dragover",function(a){return a.preventDefault()},!1);window.addEventListener("drop",function(a){c.hand.processDrop(a);
return a.preventDefault()},!1);window.addEventListener("resize",function(){if(c.useFillPage)return c.fillPage()},!1);return window.onbeforeunload=function(a){if(a=a||window.event)a.returnValue="Are you sure you want to leave?";return"Are you sure you want to leave?"}};a.prototype.mouseDownLeft=function(){return noOperation};a.prototype.mouseClickLeft=function(){return noOperation};a.prototype.mouseDownRight=function(){return noOperation};a.prototype.mouseClickRight=function(){return noOperation};
a.prototype.wantsDropOf=function(){return this.acceptsDrops};a.prototype.droppedImage=function(){return null};a.prototype.nextTab=function(a){var c;if(c=this.nextEntryField(a))return a.clearSelection(),c.selectAll(),c.edit()};a.prototype.previousTab=function(a){var c;if(c=this.previousEntryField(a))return a.clearSelection(),c.selectAll(),c.edit()};a.prototype.contextMenu=function(){var b;b=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]):
new MenuMorph(this,"Morphic");this.isDevMode&&(b.addItem("demo...","userCreateMorph","sample morphs"),b.addLine(),b.addItem("hide all...","hideAll"),b.addItem("show all...","showAllHiddens"),b.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"),b.addItem("inspect...","inspect","open a window on\nall properties"),b.addLine(),b.addItem("restore display","changed","redraw the\nscreen once"),b.addItem("fill page...","fillPage","let the World automatically\nadjust to browser resizings"),
useBlurredShadows?b.addItem("sharp shadows...","toggleBlurredShadows","sharp drop shadows\nuse for old browsers"):b.addItem("blurred shadows...","toggleBlurredShadows","blurry shades,\n use for new browsers"),b.addItem("color...",function(){return this.pickColor(b.title+"\ncolor:",this.setColor,this,this.color)},"choose the World's\nbackground color"),a.MorphicPreferences===standardSettings?b.addItem("touch screen settings","togglePreferences","bigger menu fonts\nand sliders"):b.addItem("standard settings",
"togglePreferences","smaller menu fonts\nand sliders"),b.addLine());this.isDevMode?b.addItem("user mode...","toggleDevMode","disable developers'\ncontext menus"):b.addItem("development mode...","toggleDevMode");b.addItem("about morphic.js...","about");return b};a.prototype.userCreateMorph=function(){var a,c,d=this;a=function(a){a.isDraggable=!0;return a.pickUp(d)};c=new MenuMorph(this,"make a morph");c.addItem("rectangle",function(){return a(new Morph)});c.addItem("box",function(){return a(new BoxMorph)});
c.addItem("circle box",function(){return a(new CircleBoxMorph)});c.addLine();c.addItem("slider",function(){return a(new SliderMorph)});c.addItem("frame",function(){var c;c=new FrameMorph;c.setExtent(new Point(350,250));return a(c)});c.addItem("scroll frame",function(){var c;c=new ScrollFrameMorph;c.contents.acceptsDrops=!0;c.contents.adjustBounds();c.setExtent(new Point(350,250));return a(c)});c.addItem("handle",function(){return a(new HandleMorph)});c.addLine();c.addItem("string",function(){var c;
c=new StringMorph("Hello, World!");c.isEditable=!0;return a(c)});c.addItem("text",function(){var c;c=new TextMorph("Ich wei\u00df nicht, was soll es bedeuten, dass ich so traurig bin, ein M\u00e4rchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist k\u00fchl und es dunkelt, und ruhig flie\u00dft der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die sch\u00f6nste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie k\u00e4mmt ihr goldenes Haar, sie k\u00e4mmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die H\u00f6h'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan.");
c.isEditable=!0;c.maxWidth=300;c.drawNew();return a(c)});c.addItem("speech bubble",function(){var c;c=new SpeechBubbleMorph("Hello, World!");return a(c)});c.addLine();c.addItem("gray scale palette",function(){return a(new GrayPaletteMorph)});c.addItem("color palette",function(){return a(new ColorPaletteMorph)});c.addItem("color picker",function(){return a(new ColorPickerMorph)});c.addLine();c.addItem("sensor demo",function(){var c;c=new MouseSensorMorph;c.setColor(new Color(230,200,100));c.edge=35;
c.border=15;c.borderColor=new Color(200,100,50);c.alpha=0.2;c.setExtent(new Point(100,100));return a(c)});c.addItem("animation demo",function(){var c,d,e,h,j;e=new BouncerMorph;e.setPosition(new Point(50,20));e.setExtent(new Point(300,200));e.alpha=0.9;e.speed=3;c=new BouncerMorph;c.setColor(new Color(50,50,50));c.setPosition(new Point(80,80));c.setExtent(new Point(80,250));c.type="horizontal";c.direction="right";c.alpha=0.9;c.speed=5;d=new BouncerMorph;d.setColor(new Color(20,20,20));d.setPosition(new Point(90,
140));d.setExtent(new Point(40,30));d.type="horizontal";d.direction="right";d.speed=3;j=new BouncerMorph;j.setColor(new Color(200,20,20));j.setPosition(new Point(90,140));j.setExtent(new Point(20,20));j.type="vertical";j.direction="up";j.speed=8;h=new BouncerMorph;h.setColor(new Color(20,200,20));h.setPosition(new Point(120,140));h.setExtent(new Point(20,20));h.type="vertical";h.direction="down";h.speed=4;c.add(j);c.add(d);e.add(h);e.add(c);return a(e)});c.addItem("pen",function(){return a(new PenMorph)});
c.addLine();c.addItem("view all...",function(){var c;c=new MorphsListMorph;return a(c)});this.customMorphs&&(c.addLine(),this.customMorphs().forEach(function(d){return c.addItem(d.toString(),function(){return a(d)})}));return c.popUpAtHand(this)};a.prototype.toggleDevMode=function(){return this.isDevMode=!this.isDevMode};a.prototype.hideAll=function(){return this.children.forEach(function(a){return a.hide()})};a.prototype.showAllHiddens=function(){return this.forAllChildren(function(a){if(!a.isVisible)return a.show()})};
a.prototype.about=function(){var a,c;c="";for(a in modules)modules.hasOwnProperty(a)&&(c+="\n"+a+" ("+modules[a]+")");""!==c&&(c="\n\nmodules:\n\nmorphic ("+morphicVersion+")"+c);return this.inform("morphic.js\n\na lively Web GUI\ninspired by Squeak\n"+morphicVersion+"\noriginal from Jens M\u00f6nig's (jens@moenig.org) morphic.js\n\n\nported and extended by Davide Della Casa\n"+c)};a.prototype.edit=function(b){var c;c=getDocumentPositionOf(this.worldCanvas);if(!b.isEditable)return null;this.cursor&&
this.cursor.destroy();this.lastEditedText&&this.lastEditedText.clearSelection();this.cursor=new CursorMorph(b);b.parent.add(this.cursor);this.keyboardReceiver=this.cursor;this.initVirtualKeyboard();a.MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+c.y+"px",this.virtualKeyboard.style.left=this.cursor.left()+c.x+"px",this.virtualKeyboard.focus());if(a.MorphicPreferences.useSliderForInput&&!b.parentThatIsA(MenuMorph))return this.slide(b)};a.prototype.slide=function(b){var c,
d;d=parseFloat(b.text);isNaN(d)&&(d=0);c=new MenuMorph;d=new SliderMorph(d-25,d+25,d,10,"horizontal");d.alpha=1;d.color=new Color(225,225,225);d.button.color=c.borderColor;d.button.highlightColor=d.button.color.copy();d.button.highlightColor.b+=100;d.button.pressColor=d.button.color.copy();d.button.pressColor.b+=150;d.silentSetHeight(a.MorphicPreferences.scrollBarSize);d.silentSetWidth(10*a.MorphicPreferences.menuFontSize);d.drawNew();d.action=function(a){b.changed();b.text=Math.round(a).toString();
b.drawNew();b.changed();return b.escalateEvent("reactToSliderEdit",b)};c.items.push(d);return c.popup(this,b.bottomLeft().add(new Point(0,5)))};a.prototype.stopEditing=function(){this.cursor&&(this.lastEditedText=this.cursor.target,this.cursor.destroy(),this.cursor=null,this.lastEditedText.escalateEvent("reactToEdit",this.lastEditedText));this.keyboardReceiver=null;this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null);return this.worldCanvas.focus()};
a.prototype.toggleBlurredShadows=function(){return useBlurredShadows=!useBlurredShadows};a.prototype.togglePreferences=function(){return a.MorphicPreferences===standardSettings?a.MorphicPreferences=touchScreenSettings:a.MorphicPreferences=standardSettings};return a}(FrameMorph);
Rectangle=function(){function c(a,b,c,d){this.origin=new Point(a||0,b||0);this.corner=new Point(c||0,d||0)}c.prototype.origin=null;c.prototype.corner=null;c.prototype.toString=function(){return"["+this.origin.toString()+" | "+this.extent().toString()+"]"};c.prototype.copy=function(){return new c(this.left(),this.top(),this.right(),this.bottom())};c.prototype.setTo=function(a,b,c,d){this.origin=new Point(a||(0===a?0:this.left()),b||(0===b?0:this.top()));return this.corner=new Point(c||(0===c?0:this.right()),
d||(0===d?0:this.bottom()))};c.prototype.area=function(){var a;a=this.width();return 0>a?0:Math.max(a*this.height(),0)};c.prototype.bottom=function(){return this.corner.y};c.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())};c.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)};c.prototype.bottomRight=function(){return this.corner.copy()};c.prototype.boundingBox=function(){return this};c.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))};
c.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]};c.prototype.extent=function(){return this.corner.subtract(this.origin)};c.prototype.isEmpty=function(){var a;a=this.corner.subtract(this.origin);return a.x=a.y=0};c.prototype.isNotEmpty=function(){var a;a=this.corner.subtract(this.origin);return 0<a.x&&0<a.y};c.prototype.height=function(){return this.corner.y-this.origin.y};c.prototype.left=function(){return this.origin.x};c.prototype.leftCenter=function(){return new Point(this.left(),
this.center().y)};c.prototype.right=function(){return this.corner.x};c.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)};c.prototype.top=function(){return this.origin.y};c.prototype.topCenter=function(){return new Point(this.center().x,this.top())};c.prototype.topLeft=function(){return this.origin};c.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)};c.prototype.width=function(){return this.corner.x-this.origin.x};c.prototype.position=function(){return this.origin};
c.prototype.eq=function(a){return this.origin.eq(a.origin)&&this.corner.eq(a.corner)};c.prototype.abs=function(){var a,b;b=this.origin.abs();a=this.corner.max(b);return b.corner(a)};c.prototype.insetBy=function(a){var b;b=new c;b.origin=this.origin.add(a);b.corner=this.corner.subtract(a);return b};c.prototype.expandBy=function(a){var b;b=new c;b.origin=this.origin.subtract(a);b.corner=this.corner.add(a);return b};c.prototype.growBy=function(a){var b;b=new c;b.origin=this.origin.copy();b.corner=this.corner.add(a);
return b};c.prototype.intersect=function(a){var b;b=new c;b.origin=this.origin.max(a.origin);b.corner=this.corner.min(a.corner);return b};c.prototype.merge=function(a){var b;b=new c;b.origin=this.origin.min(a.origin);b.corner=this.corner.max(a.corner);return b};c.prototype.round=function(){return this.origin.round().corner(this.corner.round())};c.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil())};c.prototype.amountToTranslateWithin=function(a){var b,c;this.right()>
a.right()&&(b=a.right()-this.right());this.bottom()>a.bottom()&&(c=a.bottom()-this.bottom());this.left()+b<a.left()&&(b=a.left()-this.right());this.top()+c<a.top()&&(c=a.top()-this.top());return new Point(b,c)};c.prototype.containsPoint=function(a){return this.origin.le(a)&&a.lt(this.corner)};c.prototype.containsRectangle=function(a){return a.origin.gt(this.origin)&&a.corner.lt(this.corner)};c.prototype.intersects=function(a){var b;b=a.origin;a=a.corner;return a.x>=this.origin.x&&a.y>=this.origin.y&&
b.x<=this.corner.x&&b.y<=this.corner.y};c.prototype.scaleBy=function(a){var b;b=this.origin.multiplyBy(a);a=this.corner.multiplyBy(a);return new c(b.x,b.y,a.x,a.y)};c.prototype.translateBy=function(a){var b;b=this.origin.add(a);a=this.corner.add(a);return new c(b.x,b.y,a.x,a.y)};c.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]};c.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]};return c}();
