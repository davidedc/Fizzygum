// morphee-coffee-minified.js - https://github.com/davidedc/livecodelab
'use strict';var BlinkerMorph,BouncerMorph,BoxMorph,CircleBoxMorph,Color,ColorPaletteMorph,ColorPickerMorph,CursorMorph,FrameMorph,GrayPaletteMorph,HandMorph,HandleMorph,InspectorMorph,ListMorph,MenuItemMorph,MenuMorph,Morph,MorphicNode,MorphicPreferences,MouseSensorMorph,PenMorph,Point,Rectangle,ScrollFrameMorph,ShadowMorph,SliderButtonMorph,SliderMorph,SpeechBubbleMorph,StringFieldMorph,StringMorph,TextMorph,TriggerMorph,WorldMorph,clone,contains,copy,degrees,detect,fontHeight,getBlurredShadowSupport,
getDocumentPositionOf,getMinimumFontHeight,isNil,isObject,isString,localize,modules,morphicVersion,newCanvas,nop,radians,standardSettings,touchScreenSettings,useBlurredShadows,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};morphicVersion="2012-October-16";nop=function(){return null};localize=function(a){return a};
isNil=function(a){return void 0===a||null===a};contains=function(a,b){return a.some(function(a){return a===b})};detect=function(a,b){var c,d;d=a.length;for(c=0;c<d;){if(b.call(null,a[c]))return a[c];c+=1}return null};isString=function(a){return"string"===typeof a||a instanceof String};isObject=function(a){return null!==a&&("object"===typeof a||a instanceof Object)};radians=function(a){return a*Math.PI/180};degrees=function(a){return 180*a/Math.PI};fontHeight=function(a){return Math.max(a,MorphicPreferences.minimumFontHeight)};
newCanvas=function(a){var b;b=a||{x:0};({y:0});a=document.createElement("canvas");a.width=b.x;a.height=b.y;return a};getMinimumFontHeight=function(){var a,b,c,d,e;a=document.createElement("canvas");a.width=50;a.height=50;a=a.getContext("2d");a.font="1px serif";c=a.measureText("I").width;a.fillStyle="black";a.textBaseline="bottom";a.fillText("I",0,50);for(e=0;50>e;){for(d=0;d<c;){b=a.getImageData(d,e,1,1);if(0!==b.data[3])return 50-e+1;d+=1}e+=1}return 0};
getBlurredShadowSupport=function(){var a,b;b=document.createElement("canvas");b.width=10;b.height=10;a=b.getContext("2d");a.fillStyle="rgb(255, 0, 0)";a.beginPath();a.arc(5,5,5,0,2*Math.PI,!0);a.closePath();a.fill();a=document.createElement("canvas");a.width=10;a.height=10;a=a.getContext("2d");a.shadowBlur=10;a.shadowColor="rgba(0, 0, 255, 1)";a.drawImage(b,0,0);return a.getImageData(0,0,1,1).data[3]?!0:!1};
getDocumentPositionOf=function(a){var b;if(null===a)return{x:0,y:0};b={x:a.offsetLeft,y:a.offsetTop};for(a=a.offsetParent;null!==a;)b.x+=a.offsetLeft,b.y+=a.offsetTop,a!==document.body&&a!==document.documentElement&&(b.x-=a.scrollLeft,b.y-=a.scrollTop),a=a.offsetParent;return b};clone=function(a){var b;return"object"===typeof a?(b=function(){},b.prototype=a,new b):a};
copy=function(a){var b,c;c=void 0;if("object"!==typeof a)return a;b=a.valueOf();if(a!==b)return new a.constructor(b);if(a instanceof a.constructor&&a.constructor!==Object)for(c in b=clone(a.constructor.prototype),a)a.hasOwnProperty(c)&&(b[c]=a[c]);else for(c in b={},a)b[c]||(b[c]=a[c]);return b};
getMinimumFontHeight=function(){var a,b,c,d,e;a=document.createElement("canvas");a.width=50;a.height=50;a=a.getContext("2d");a.font="1px serif";c=a.measureText("I").width;a.fillStyle="black";a.textBaseline="bottom";a.fillText("I",0,50);for(e=0;50>e;){for(d=0;d<c;){b=a.getImageData(d,e,1,1);if(0!==b.data[3])return 50-e+1;d+=1}e+=1}return 0};
getBlurredShadowSupport=function(){var a,b;b=document.createElement("canvas");b.width=10;b.height=10;a=b.getContext("2d");a.fillStyle="rgb(255, 0, 0)";a.beginPath();a.arc(5,5,5,0,2*Math.PI,!0);a.closePath();a.fill();a=document.createElement("canvas");a.width=10;a.height=10;a=a.getContext("2d");a.shadowBlur=10;a.shadowColor="rgba(0, 0, 255, 1)";a.drawImage(b,0,0);return a.getImageData(0,0,1,1).data[3]?!0:!1};
getDocumentPositionOf=function(a){var b;if(null===a)return{x:0,y:0};b={x:a.offsetLeft,y:a.offsetTop};for(a=a.offsetParent;null!==a;)b.x+=a.offsetLeft,b.y+=a.offsetTop,a!==document.body&&a!==document.documentElement&&(b.x-=a.scrollLeft,b.y-=a.scrollTop),a=a.offsetParent;return b};clone=function(a){var b;return"object"===typeof a?(b=function(){},b.prototype=a,new b):a};
copy=function(a){var b,c;c=void 0;if("object"!==typeof a)return a;b=a.valueOf();if(a!==b)return new a.constructor(b);if(a instanceof a.constructor&&a.constructor!==Object)for(c in b=clone(a.constructor.prototype),a)a.hasOwnProperty(c)&&(b[c]=a[c]);else for(c in b={},a)b[c]||(b[c]=a[c]);return b};modules={};useBlurredShadows=getBlurredShadowSupport();
standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:"sans-serif",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0};
touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:"sans-serif",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0};MorphicPreferences=standardSettings;Color=function(a,b,c,d){this.r=a||0;this.g=b||0;this.b=c||0;return this.a=d||(0===d?0:1)};
Color.prototype.toString=function(){return"rgba("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+","+this.a+")"};Color.prototype.copy=function(){return new Color(this.r,this.g,this.b,this.a)};Color.prototype.eq=function(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b};
Color.prototype.hsv=function(){var a,b,c,d,e,f,g;g=this.r/255;c=this.g/255;a=this.b/255;e=Math.max(g,c,a);f=Math.min(g,c,a);d=e;b=e-f;if(e===f)d=0;else{switch(e){case g:d=(c-a)/b+(c<a?6:0);break;case c:d=(a-g)/b+2;break;case a:d=(g-c)/b+4}d/=6}return[d,0===e?0:b/e,e]};
Color.prototype.set_hsv=function(a,b,c){var d,e,f;e=Math.floor(6*a);d=6*a-e;a=c*(1-b);f=c*(1-d*b);b=c*(1-(1-d)*b);switch(e%6){case 0:this.r=c;this.g=b;this.b=a;break;case 1:this.r=f;this.g=c;this.b=a;break;case 2:this.r=a;this.g=c;this.b=b;break;case 3:this.r=a;this.g=f;this.b=c;break;case 4:this.r=b;this.g=a;this.b=c;break;case 5:this.r=c,this.g=a,this.b=f}this.r*=255;this.g*=255;return this.b*=255};
Color.prototype.mixed=function(a,b){var c,d;c=Math.min(Math.max(a,0),1);d=1-c;return new Color(this.r*c+b.r*d,this.g*c+b.g*d,this.b*c+b.b*d)};Color.prototype.darker=function(a){var b;b=0.8333;a&&(b=(100-a)/100);return this.mixed(b,new Color(0,0,0))};Color.prototype.lighter=function(a){var b;b=0.8333;a&&(b=(100-a)/100);return this.mixed(b,new Color(255,255,255))};Color.prototype.dansDarker=function(){var a,b,c;a=this.hsv();b=new Color;c=Math.max(a[2]-0.16,0);b.set_hsv(a[0],a[1],c);return b};
Point=function(a,b){this.x=a||0;return this.y=b||0};Point.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())};Point.prototype.copy=function(){return new Point(this.x,this.y)};Point.prototype.eq=function(a){return this.x===a.x&&this.y===a.y};Point.prototype.lt=function(a){return this.x<a.x&&this.y<a.y};Point.prototype.gt=function(a){return this.x>a.x&&this.y>a.y};Point.prototype.ge=function(a){return this.x>=a.x&&this.y>=a.y};
Point.prototype.le=function(a){return this.x<=a.x&&this.y<=a.y};Point.prototype.max=function(a){return new Point(Math.max(this.x,a.x),Math.max(this.y,a.y))};Point.prototype.min=function(a){return new Point(Math.min(this.x,a.x),Math.min(this.y,a.y))};Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))};Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))};Point.prototype.neg=function(){return new Point(-this.x,-this.y)};
Point.prototype.mirror=function(){return new Point(this.y,this.x)};Point.prototype.floor=function(){return new Point(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))};Point.prototype.ceil=function(){return new Point(Math.ceil(this.x),Math.ceil(this.y))};Point.prototype.add=function(a){return a instanceof Point?new Point(this.x+a.x,this.y+a.y):new Point(this.x+a,this.y+a)};
Point.prototype.subtract=function(a){return a instanceof Point?new Point(this.x-a.x,this.y-a.y):new Point(this.x-a,this.y-a)};Point.prototype.multiplyBy=function(a){return a instanceof Point?new Point(this.x*a.x,this.y*a.y):new Point(this.x*a,this.y*a)};Point.prototype.divideBy=function(a){return a instanceof Point?new Point(this.x/a.x,this.y/a.y):new Point(this.x/a,this.y/a)};
Point.prototype.floorDivideBy=function(a){return a instanceof Point?new Point(Math.floor(this.x/a.x),Math.floor(this.y/a.y)):new Point(Math.floor(this.x/a),Math.floor(this.y/a))};Point.prototype.r=function(){var a;a=this.multiplyBy(this);return Math.sqrt(a.x+a.y)};Point.prototype.degrees=function(){var a;if(0===this.x)return 0<=this.y?90:270;a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?degrees(a):360+degrees(a):180+degrees(a)};
Point.prototype.theta=function(){var a;if(0===this.x)return 0<=this.y?radians(90):radians(270);a=Math.atan(this.y/this.x);return 0<=this.x?0<=this.y?a:radians(360)+a:radians(180)+a};Point.prototype.crossProduct=function(a){return this.multiplyBy(a.mirror())};Point.prototype.distanceTo=function(a){return a.subtract(this).r()};Point.prototype.rotate=function(a,b){var c;c=this.subtract(b);return"right"===a?(new Point(-c.y,c.y)).add(b):"left"===a?(new Point(c.y,-c.y)).add(b):b.subtract(c)};
Point.prototype.flip=function(a,b){return"vertical"===a?new Point(this.x,2*b.y-this.y):new Point(2*b.x-this.x,this.y)};Point.prototype.distanceAngle=function(a,b){var c,d;c=b;270<c?c-=360:-270>c&&(c+=360);if(-90<=c&&90>=c)return c=Math.sin(radians(c))*a,d=Math.sqrt(a*a-c*c),new Point(c+this.x,this.y-d);c=Math.sin(radians(180-c))*a;d=Math.sqrt(a*a-c*c);return new Point(c+this.x,this.y+d)};Point.prototype.scaleBy=function(a){return this.multiplyBy(a)};Point.prototype.translateBy=function(a){return this.add(a)};
Point.prototype.rotateBy=function(a,b){var c,d,e;c=b||new Point(0,0);d=this.subtract(c);e=d.r();d=a-d.theta();return new Point(c.x+e*Math.cos(d),c.y-e*Math.sin(d))};Point.prototype.asArray=function(){return[this.x,this.y]};Point.prototype.corner=function(a){return new Rectangle(this.x,this.y,a.x,a.y)};Point.prototype.rectangle=function(a){var b;b=this.min(a);a=this.max(a);return new Rectangle(b.x,b.y,a.x,a.y)};
Point.prototype.extent=function(a){a=this.add(a);return new Rectangle(this.x,this.y,a.x,a.y)};Rectangle=function(){return function(a,b,c,d){this.init(new Point(a||0,b||0),new Point(c||0,d||0))}}();Rectangle.prototype.init=function(a,b){this.origin=a;return this.corner=b};Rectangle.prototype.toString=function(){return"["+this.origin.toString()+" | "+this.extent().toString()+"]"};Rectangle.prototype.copy=function(){return new Rectangle(this.left(),this.top(),this.right(),this.bottom())};
Rectangle.prototype.setTo=function(a,b,c,d){this.origin=new Point(a||(0===a?0:this.left()),b||(0===b?0:this.top()));return this.corner=new Point(c||(0===c?0:this.right()),d||(0===d?0:this.bottom()))};Rectangle.prototype.area=function(){var a;a=this.width();return 0>a?0:Math.max(a*this.height(),0)};Rectangle.prototype.bottom=function(){return this.corner.y};Rectangle.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())};
Rectangle.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)};Rectangle.prototype.bottomRight=function(){return this.corner.copy()};Rectangle.prototype.boundingBox=function(){return this};Rectangle.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))};Rectangle.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]};Rectangle.prototype.extent=function(){return this.corner.subtract(this.origin)};
Rectangle.prototype.height=function(){return this.corner.y-this.origin.y};Rectangle.prototype.left=function(){return this.origin.x};Rectangle.prototype.leftCenter=function(){return new Point(this.left(),this.center().y)};Rectangle.prototype.right=function(){return this.corner.x};Rectangle.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)};Rectangle.prototype.top=function(){return this.origin.y};
Rectangle.prototype.topCenter=function(){return new Point(this.center().x,this.top())};Rectangle.prototype.topLeft=function(){return this.origin};Rectangle.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)};Rectangle.prototype.width=function(){return this.corner.x-this.origin.x};Rectangle.prototype.position=function(){return this.origin};Rectangle.prototype.eq=function(a){return this.origin.eq(a.origin)&&this.corner.eq(a.corner)};
Rectangle.prototype.abs=function(){var a,b;b=this.origin.abs();a=this.corner.max(b);return b.corner(a)};Rectangle.prototype.insetBy=function(a){var b;b=new Rectangle;b.origin=this.origin.add(a);b.corner=this.corner.subtract(a);return b};Rectangle.prototype.expandBy=function(a){var b;b=new Rectangle;b.origin=this.origin.subtract(a);b.corner=this.corner.add(a);return b};Rectangle.prototype.growBy=function(a){var b;b=new Rectangle;b.origin=this.origin.copy();b.corner=this.corner.add(a);return b};
Rectangle.prototype.intersect=function(a){var b;b=new Rectangle;b.origin=this.origin.max(a.origin);b.corner=this.corner.min(a.corner);return b};Rectangle.prototype.merge=function(a){var b;b=new Rectangle;b.origin=this.origin.min(a.origin);b.corner=this.corner.max(a.corner);return b};Rectangle.prototype.round=function(){return this.origin.round().corner(this.corner.round())};Rectangle.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil())};
Rectangle.prototype.amountToTranslateWithin=function(a){var b,c;c=b=void 0;this.right()>a.right()&&(b=a.right()-this.right());this.bottom()>a.bottom()&&(c=a.bottom()-this.bottom());this.left()+b<a.left()&&(b=a.left()-this.right());this.top()+c<a.top()&&(c=a.top()-this.top());return new Point(b,c)};Rectangle.prototype.containsPoint=function(a){return this.origin.le(a)&&a.lt(this.corner)};Rectangle.prototype.containsRectangle=function(a){return a.origin.gt(this.origin)&&a.corner.lt(this.corner)};
Rectangle.prototype.intersects=function(a){var b;b=a.origin;a=a.corner;return a.x>=this.origin.x&&a.y>=this.origin.y&&b.x<=this.corner.x&&b.y<=this.corner.y};Rectangle.prototype.scaleBy=function(a){var b;b=this.origin.multiplyBy(a);a=this.corner.multiplyBy(a);return new Rectangle(b.x,b.y,a.x,a.y)};Rectangle.prototype.translateBy=function(a){var b;b=this.origin.add(a);a=this.corner.add(a);return new Rectangle(b.x,b.y,a.x,a.y)};
Rectangle.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]};Rectangle.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]};MorphicNode=function(){return function(a,b){this.init(a||null,b||[])}}();MorphicNode.prototype.init=function(a,b){this.parent=a||null;return this.children=b||[]};MorphicNode.prototype.toString=function(){return"a MorphicNode["+this.children.length.toString()+"]"};
MorphicNode.prototype.addChild=function(a){this.children.push(a);return a.parent=this};MorphicNode.prototype.addChildFirst=function(a){this.children.splice(0,null,a);return a.parent=this};MorphicNode.prototype.removeChild=function(a){a=this.children.indexOf(a);if(-1!==a)return this.children.splice(a,1)};MorphicNode.prototype.root=function(){return null===this.parent?this:this.parent.root()};MorphicNode.prototype.depth=function(){return null===this.parent?0:this.parent.depth()+1};
MorphicNode.prototype.allChildren=function(){var a;a=[this];this.children.forEach(function(b){return a=a.concat(b.allChildren())});return a};MorphicNode.prototype.forAllChildren=function(a){0<this.children.length&&this.children.forEach(function(b){return b.forAllChildren(a)});return a.call(null,this)};MorphicNode.prototype.allLeafs=function(){var a;a=[];this.allChildren().forEach(function(b){if(0===b.children.length)return a.push(b)});return a};
MorphicNode.prototype.allParents=function(){var a;a=[this];null!==this.parent&&(a=a.concat(this.parent.allParents()));return a};MorphicNode.prototype.siblings=function(){var a;a=this;return null===this.parent?[]:this.parent.children.filter(function(b){return b!==a})};MorphicNode.prototype.parentThatIsA=function(a){return this instanceof a?this:!this.parent?null:this.parent.parentThatIsA(a)};
MorphicNode.prototype.parentThatIsAnyOf=function(a){var b,c;c=!1;b=this;a.forEach(function(a){b.constructor===a&&(c=!0)});return c?this:!this.parent?null:this.parent.parentThatIsAnyOf(a)};Morph=function(a){function b(){this.init()}__extends(b,a);return b}(MorphicNode);Morph.prototype.trackChanges=!0;Morph.prototype.shadowBlur=4;
Morph.prototype.init=function(){Morph.__super__.init.call(this);this.isMorph=!0;this.bounds=new Rectangle(0,0,50,40);this.color=new Color(80,80,80);this.cachedTexture=this.texture=null;this.alpha=1;this.isVisible=!0;this.noticesTransparentClick=this.acceptsDrops=this.isTemplate=this.isDraggable=!1;this.drawNew();this.fps=0;this.customContextMenu=null;return this.lastTime=Date.now()};
Morph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+" "+this.children.length.toString()+" "+this.bounds};Morph.prototype.destroy=function(){if(null!==this.parent)return this.fullChanged(),this.parent.removeChild(this)};Morph.prototype.stepFrame=function(){var a,b;if(!this.step)return null;b=b=a=void 0;a=Date.now();b=a-this.lastTime;b=0<this.fps?1E3/this.fps-b:0;if(1>b)return this.lastTime=a,this.step(),this.children.forEach(function(a){return a.stepFrame()})};
Morph.prototype.step=function(){return nop()};Morph.prototype.left=function(){return this.bounds.left()};Morph.prototype.right=function(){return this.bounds.right()};Morph.prototype.top=function(){return this.bounds.top()};Morph.prototype.bottom=function(){return this.bounds.bottom()};Morph.prototype.center=function(){return this.bounds.center()};Morph.prototype.bottomCenter=function(){return this.bounds.bottomCenter()};Morph.prototype.bottomLeft=function(){return this.bounds.bottomLeft()};
Morph.prototype.bottomRight=function(){return this.bounds.bottomRight()};Morph.prototype.boundingBox=function(){return this.bounds};Morph.prototype.corners=function(){return this.bounds.corners()};Morph.prototype.leftCenter=function(){return this.bounds.leftCenter()};Morph.prototype.rightCenter=function(){return this.bounds.rightCenter()};Morph.prototype.topCenter=function(){return this.bounds.topCenter()};Morph.prototype.topLeft=function(){return this.bounds.topLeft()};Morph.prototype.topRight=function(){return this.bounds.topRight()};
Morph.prototype.position=function(){return this.bounds.origin};Morph.prototype.extent=function(){return this.bounds.extent()};Morph.prototype.width=function(){return this.bounds.width()};Morph.prototype.height=function(){return this.bounds.height()};Morph.prototype.fullBounds=function(){var a;a=void 0;a=this.bounds;this.children.forEach(function(b){if(b.isVisible)return a=a.merge(b.fullBounds())});return a};
Morph.prototype.fullBoundsNoShadow=function(){var a;a=void 0;a=this.bounds;this.children.forEach(function(b){if(!(b instanceof ShadowMorph)&&b.isVisible)return a=a.merge(b.fullBounds())});return a};Morph.prototype.visibleBounds=function(){var a;a=this.bounds;this.allParents().filter(function(a){return a instanceof FrameMorph}).forEach(function(b){return a=a.intersect(b.bounds)});return a};
Morph.prototype.moveBy=function(a){this.changed();this.bounds=this.bounds.translateBy(a);this.children.forEach(function(b){return b.moveBy(a)});return this.changed()};Morph.prototype.silentMoveBy=function(a){this.bounds=this.bounds.translateBy(a);return this.children.forEach(function(b){return b.silentMoveBy(a)})};Morph.prototype.setPosition=function(a){a=a.subtract(this.topLeft());if(0!==a.x||0!==a.y)return this.moveBy(a)};
Morph.prototype.silentSetPosition=function(a){a=a.subtract(this.topLeft());if(0!==a.x||0!==a.y)return this.silentMoveBy(a)};Morph.prototype.setLeft=function(a){return this.setPosition(new Point(a,this.top()))};Morph.prototype.setRight=function(a){return this.setPosition(new Point(a-this.width(),this.top()))};Morph.prototype.setTop=function(a){return this.setPosition(new Point(this.left(),a))};Morph.prototype.setBottom=function(a){return this.setPosition(new Point(this.left(),a-this.height()))};
Morph.prototype.setCenter=function(a){return this.setPosition(a.subtract(this.extent().floorDivideBy(2)))};Morph.prototype.setFullCenter=function(a){return this.setPosition(a.subtract(this.fullBounds().extent().floorDivideBy(2)))};
Morph.prototype.keepWithin=function(a){var b;b=this.fullBounds().left()-a.left();0>b&&this.moveBy(new Point(-b,0));b=this.fullBounds().right()-a.right();0<b&&this.moveBy(new Point(-b,0));b=this.fullBounds().top()-a.top();0>b&&this.moveBy(new Point(0,-b));a=this.fullBounds().bottom()-a.bottom();if(0<a)return this.moveBy(new Point(0,-a))};Morph.prototype.setExtent=function(a){if(!a.eq(this.extent()))return this.changed(),this.silentSetExtent(a),this.changed(),this.drawNew()};
Morph.prototype.silentSetExtent=function(a){var b;b=a.round();a=Math.max(b.x,0);b=Math.max(b.y,0);return this.bounds.corner=new Point(this.bounds.origin.x+a,this.bounds.origin.y+b)};Morph.prototype.setWidth=function(a){return this.setExtent(new Point(a||0,this.height()))};Morph.prototype.silentSetWidth=function(a){a=Math.max(Math.round(a||0),0);return this.bounds.corner=new Point(this.bounds.origin.x+a,this.bounds.corner.y)};
Morph.prototype.setHeight=function(a){return this.setExtent(new Point(this.width(),a||0))};Morph.prototype.silentSetHeight=function(a){a=Math.max(Math.round(a||0),0);return this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+a)};Morph.prototype.setColor=function(a){if(a&&!this.color.eq(a))return this.color=a,this.changed(),this.drawNew()};
Morph.prototype.drawNew=function(){var a;this.image=newCanvas(this.extent());a=this.image.getContext("2d");a.fillStyle=this.color.toString();a.fillRect(0,0,this.width(),this.height());if(this.cachedTexture)return this.drawCachedTexture();if(this.texture)return this.drawTexture(this.texture)};Morph.prototype.drawTexture=function(a){var b;b=this;this.cachedTexture=new Image;this.cachedTexture.onload=function(){return b.drawCachedTexture()};return this.cachedTexture.src=this.texture=a};
Morph.prototype.drawCachedTexture=function(){var a,b,c,d,e,f;a=this.cachedTexture;b=Math.floor(this.image.width/a.width);d=Math.floor(this.image.height/a.height);c=this.image.getContext("2d");for(f=0;f<=d;){for(e=0;e<=b;)c.drawImage(a,e*a.width,f*a.height),e+=1;f+=1}return this.changed()};
Morph.prototype.drawOn=function(a,b){var c,d,e,f,g;if(!this.isVisible)return null;c=(b||this.bounds()).intersect(this.bounds).round();if(c.extent().gt(new Point(0,0)))return d=this.position().neg(),g=c.copy().translateBy(d).round(),d=a.getContext("2d"),d.globalAlpha=this.alpha,f=g.left(),e=g.top(),f=Math.min(g.width(),this.image.width-f),e=Math.min(g.height(),this.image.height-e),1>f||1>e?null:d.drawImage(this.image,g.left(),g.top(),f,e,c.left(),c.top(),f,e)};
Morph.prototype.fullDrawOn=function(a,b){var c;c=void 0;if(!this.isVisible)return null;c=b||this.fullBounds();this.drawOn(a,c);return this.children.forEach(function(b){return b.fullDrawOn(a,c)})};Morph.prototype.hide=function(){this.isVisible=!1;this.changed();return this.children.forEach(function(a){return a.hide()})};Morph.prototype.show=function(){this.isVisible=!0;this.changed();return this.children.forEach(function(a){return a.show()})};
Morph.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible;this.changed();return this.children.forEach(function(a){return a.toggleVisibility()})};Morph.prototype.fullImageClassic=function(){var a,b;a=this.fullBounds();b=newCanvas(a.extent());this.fullDrawOn(b,a);b.globalAlpha=this.alpha;return b};
Morph.prototype.fullImage=function(){var a,b,c;b=a=c=void 0;c=newCanvas(this.fullBounds().extent());a=c.getContext("2d");b=this.fullBounds();this.allChildren().forEach(function(c){if(c.isVisible)return a.globalAlpha=c.alpha,a.drawImage(c.image,c.bounds.origin.x-b.origin.x,c.bounds.origin.y-b.origin.y)});return c};
Morph.prototype.shadowImage=function(a,b){var c,d,e,f,g,h;g=a||new Point(7,7);c=b||new Color(0,0,0);e=this.fullBounds().extent();f=this.fullImage();h=newCanvas(e);d=h.getContext("2d");d.drawImage(f,0,0);d.globalCompositeOperation="destination-out";d.drawImage(f,-g.x,-g.y);f=newCanvas(e);d=f.getContext("2d");d.drawImage(h,0,0);d.globalCompositeOperation="source-atop";d.fillStyle=c.toString();d.fillRect(0,0,e.x,e.y);return f};
Morph.prototype.shadowImageBlurred=function(a,b){var c,d,e,f,g,h;g=a||new Point(7,7);c=this.shadowBlur;d=b||new Color(0,0,0);e=this.fullBounds().extent().add(2*c);f=this.fullImage();h=newCanvas(e);e=h.getContext("2d");e.shadowOffsetX=g.x;e.shadowOffsetY=g.y;e.shadowBlur=c;e.shadowColor=d.toString();e.drawImage(f,c-g.x,c-g.y);e.shadowOffsetX=0;e.shadowOffsetY=0;e.shadowBlur=0;e.globalCompositeOperation="destination-out";e.drawImage(f,c-g.x,c-g.y);return h};
Morph.prototype.shadow=function(a,b,c){var d,e;e=new ShadowMorph;a=a||new Point(7,7);b=b||(0===b?0:0.2);d=this.fullBounds();e.setExtent(d.extent().add(2*this.shadowBlur));useBlurredShadows?(e.image=this.shadowImageBlurred(a,c),e.alpha=b,e.setPosition(d.origin.add(a).subtract(this.shadowBlur))):(e.image=this.shadowImage(a,c),e.alpha=b,e.setPosition(d.origin.add(a)));return e};
Morph.prototype.addShadow=function(a,b,c){a=this.shadow(a||new Point(7,7),b||(0===b?0:0.2),c);this.addBack(a);this.fullChanged();return a};Morph.prototype.getShadow=function(){var a;a=void 0;a=this.children.slice(0).reverse().filter(function(a){return a instanceof ShadowMorph});return 0!==a.length?a[0]:null};Morph.prototype.removeShadow=function(){var a;a=this.getShadow();if(null!==a)return this.fullChanged(),this.removeChild(a)};Morph.prototype.penTrails=function(){return this.image};
Morph.prototype.changed=function(){var a;this.trackChanges&&(a=this.root(),a instanceof WorldMorph&&a.broken.push(this.visibleBounds().spread()));if(this.parent)return this.parent.childChanged(this)};Morph.prototype.fullChanged=function(){var a;if(this.trackChanges&&(a=this.root(),a instanceof WorldMorph))return a.broken.push(this.fullBounds().spread())};Morph.prototype.childChanged=function(){if(this.parent)return this.parent.childChanged(this)};
Morph.prototype.world=function(){var a;a=this.root();return a instanceof WorldMorph?a:a instanceof HandMorph?a.world:null};Morph.prototype.add=function(a){var b;b=a.parent;null!==b&&b.removeChild(a);return this.addChild(a)};Morph.prototype.addBack=function(a){var b;b=a.parent;null!==b&&b.removeChild(a);return this.addChildFirst(a)};Morph.prototype.topMorphSuchThat=function(a){var b;return a.call(null,this)?(b=detect(this.children.slice(0).reverse(),a))?b.topMorphSuchThat(a):this:null};
Morph.prototype.morphAt=function(a){var b,c;b=this.allChildren().slice(0).reverse();c=null;b.forEach(function(b){if(b.fullBounds().containsPoint(a)&&null===c)return c=b});return c};Morph.prototype.overlappedMorphs=function(){var a,b,c,d,e,f;f=this.world();c=this.fullBounds();e=this;b=this.allParents();a=this.allChildren();d=void 0;d=f.allChildren();return d.filter(function(d){return d.isVisible&&d!==e&&d!==f&&!contains(b,d)&&!contains(a,d)&&d.fullBounds().intersects(c)})};
Morph.prototype.getPixelColor=function(a){a=a.subtract(this.bounds.origin);a=this.image.getContext("2d").getImageData(a.x,a.y,1,1);return new Color(a.data[0],a.data[1],a.data[2],a.data[3])};Morph.prototype.isTransparentAt=function(a){var b;if(this.bounds.containsPoint(a)){if(this.texture)return!1;b=a.subtract(this.bounds.origin);a=this.image.getContext("2d");a=a.getImageData(Math.floor(b.x),Math.floor(b.y),1,1);return 0===a.data[3]}return!1};
Morph.prototype.copy=function(){var a;a=copy(this);a.parent=null;a.children=[];a.bounds=this.bounds.copy();return a};Morph.prototype.fullCopy=function(){var a,b;b={};a=void 0;a=this.copyRecordingReferences(b);a.forAllChildren(function(a){return a.updateReferences(b)});return a};Morph.prototype.copyRecordingReferences=function(a){var b;b=this.copy();a[this]=b;this.children.forEach(function(c){return b.add(c.copyRecordingReferences(a))});return b};
Morph.prototype.updateReferences=function(a){var b,c;b=void 0;c=[];for(b in this)b.isMorph&&a[b]?c.push(this[b]=a[b]):c.push(void 0);return c};Morph.prototype.rootForGrab=function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||!0===this.isDraggable?this:this.parent.rootForGrab()};
Morph.prototype.wantsDropOf=function(a){return a instanceof HandleMorph||a instanceof MenuMorph||a instanceof InspectorMorph?!1:this.acceptsDrops};Morph.prototype.pickUp=function(a){a=a||this.world();this.setPosition(a.hand.position().subtract(this.extent().floorDivideBy(2)));return a.hand.grab(this)};Morph.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)};
Morph.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null};
Morph.prototype.slideBackTo=function(a,b){var c,d,e,f,g,h,j,i;h=b||5;f=a.origin.position().add(a.position);j=-(this.left()-f.x)/h;i=-(this.top()-f.y)/h;g=0;e=this.step;d=this.fps;c=this;this.fps=0;return this.step=function(){c.fullChanged();c.silentMoveBy(new Point(j,i));c.fullChanged();g+=1;if(g===h)return a.origin.add(c),a.origin.reactToDropOf&&a.origin.reactToDropOf(c),c.step=e,c.fps=d}};Morph.prototype.nop=function(){return nop()};
Morph.prototype.resize=function(){return this.world().activeHandle=new HandleMorph(this)};Morph.prototype.move=function(){return this.world().activeHandle=new HandleMorph(this,null,null,null,null,"move")};Morph.prototype.hint=function(a){var b;(b=a)?a.toString&&(b=a.toString()):b="NULL";a=new MenuMorph(this,b);a.isDraggable=!0;return a.popUpCenteredAtHand(this.world())};
Morph.prototype.inform=function(a){var b;(b=a)?a.toString&&(b=a.toString()):b="NULL";a=new MenuMorph(this,b);a.addItem("Ok");a.isDraggable=!0;return a.popUpCenteredAtHand(this.world())};
Morph.prototype.prompt=function(a,b,c,d,e,f,g,h){var j,i,k;i=i=j=k=void 0;g&&(i=!0);k=new MenuMorph(b||null,a||"",c||null);j=new StringFieldMorph(d||"",e||100,MorphicPreferences.prompterFontSize,MorphicPreferences.prompterFontName,!1,!1,i);k.items.push(j);if(g||MorphicPreferences.useSliderForInput)i=new SliderMorph(f||0,g,parseFloat(d),Math.floor((g-f)/4),"horizontal"),i.alpha=1,i.color=new Color(225,225,225),i.button.color=k.borderColor,i.button.highlightColor=i.button.color.copy(),i.button.highlightColor.b+=
100,i.button.pressColor=i.button.color.copy(),i.button.pressColor.b+=150,i.setHeight(MorphicPreferences.prompterSliderSize),i.action=h?function(a){j.changed();j.text.text=Math.round(a).toString();j.text.drawNew();j.text.changed();return j.text.edit()}:function(a){j.changed();j.text.text=a.toString();j.text.drawNew();return j.text.changed()},k.items.push(i);k.addLine(2);k.addItem("Ok",function(){return j.string()});k.addItem("Cancel",function(){return null});k.isDraggable=!0;k.popUpAtHand(this.world());
return j.text.edit()};Morph.prototype.pickColor=function(a,b,c,d){var e,f;e=f=void 0;f=new MenuMorph(b||null,a||"",c||null);e=new ColorPickerMorph(d);f.items.push(e);f.addLine(2);f.addItem("Ok",function(){return e.getChoice()});f.addItem("Cancel",function(){return null});f.isDraggable=!0;return f.popUpAtHand(this.world())};Morph.prototype.inspect=function(a){var b,c;c=this.world();b=this;a&&(b=a);a=new InspectorMorph(b);a.setPosition(c.hand.position());a.keepWithin(c);c.add(a);return a.changed()};
Morph.prototype.contextMenu=function(){var a;return this.customContextMenu?this.customContextMenu:(a=this.world())&&a.isDevMode?this.parent===a?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu()};
Morph.prototype.hierarchyMenu=function(){var a,b,c;b=this.allParents();c=this.world();a=new MenuMorph(this,null);b.forEach(function(b){if(b.developersMenu&&b!==c)return a.addItem(b.toString().slice(0,50),function(){return b.developersMenu().popUpAtHand(c)})});return a};
Morph.prototype.developersMenu=function(){var a,b,c;c=this.world();b=this.userMenu()||this.parent&&this.parent.userMenu();a=new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]);b&&(a.addItem("user features...",function(){return b.popUpAtHand(c)}),a.addLine());a.addItem("color...",function(){return this.pickColor(a.title+"\ncolor:",this.setColor,this,this.color)},"choose another color \nfor this morph");a.addItem("transparency...",function(){return this.prompt(a.title+
"\nalpha\nvalue:",this.setAlphaScaled,this,(this.alpha*100).toString(),null,1,100,true)},"set this morph's\nalpha value");a.addItem("resize...","resize","show a handle\nwhich can be dragged\nto change this morph's extent");a.addLine();a.addItem("duplicate",function(){return this.fullCopy().pickUp(this.world())},"make a copy\nand pick it up");a.addItem("pick up","pickUp","disattach and put \ninto the hand");a.addItem("attach...","attach","stick this morph\nto another one");a.addItem("move...","move",
"show a handle\nwhich can be dragged\nto move this morph");a.addItem("inspect...","inspect","open a window\non all properties");a.addLine();this.isDraggable?a.addItem("lock","toggleIsDraggable","make this morph\nunmovable"):a.addItem("unlock","toggleIsDraggable","make this morph\nmovable");a.addItem("hide","hide");a.addItem("delete","destroy");this instanceof WorldMorph||(a.addLine(),a.addItem("World...",function(){return c.contextMenu().popUpAtHand(c)},"show the\nWorld's menu"));return a};
Morph.prototype.userMenu=function(){return null};Morph.prototype.setAlphaScaled=function(a){"number"===typeof a?this.alpha=Math.min(Math.max(a/100,0.1),1):(a=parseFloat(a),isNaN(a)||(this.alpha=Math.min(Math.max(a/100,0.1),1)));return this.changed()};Morph.prototype.attach=function(){var a,b,c;a=this.overlappedMorphs();b=new MenuMorph(this,"choose new parent:");c=this;a.forEach(function(a){return b.addItem(a.toString().slice(0,50),function(){a.add(c);return c.isDraggable=!1})});if(0<a.length)return b.popUpAtHand(this.world())};
Morph.prototype.toggleIsDraggable=function(){return this.isDraggable=!this.isDraggable};Morph.prototype.colorSetters=function(){return["color"]};Morph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled"]};Morph.prototype.allEntryFields=function(){return this.allChildren().filter(function(a){return a.isEditable})};Morph.prototype.nextEntryField=function(a){var b;b=this.allEntryFields();a=b.indexOf(a);if(-1!==a)return b.length>a-1?b[a+1]:b[0]};
Morph.prototype.previousEntryField=function(a){var b;b=this.allEntryFields();a=b.indexOf(a);if(-1!==a)return a-1>b.length?b[a-1]:b[b.length+1]};Morph.prototype.tab=function(a){if(this.nextTab)return this.nextTab(a);if(this.parent)return this.parent.tab(a)};Morph.prototype.backTab=function(a){if(this.previousTab)return this.previousTab(a);if(this.parent)return this.parent.backTab(a)};Morph.prototype.escalateEvent=function(a,b){var c;for(c=this.parent;!c[a]&&null!==c.parent;)c=c.parent;if(c[a])return c[a](b)};
Morph.prototype.evaluateString=function(a){var b;b=void 0;try{b=eval(a),this.drawNew(),this.changed()}catch(c){this.inform(c)}return b};Morph.prototype.isTouching=function(a){a=this.overlappingImage(a);a=a.getContext("2d").getImageData(1,1,a.width,a.height).data;return null!==detect(a,function(a){return 0!==a})};
Morph.prototype.overlappingImage=function(a){var b,c,d,e,f;c=this.fullBounds();f=a.fullBounds();e=c.intersect(f);d=newCanvas(e.extent());b=d.getContext("2d");if(1>e.width()||1>e.height())return newCanvas(new Point(1,1));b.drawImage(this.fullImage(),e.origin.x-c.origin.x,e.origin.y-c.origin.y);b.globalCompositeOperation="source-in";b.drawImage(a.fullImage(),f.origin.x-e.origin.x,f.origin.y-e.origin.y);return d};HandleMorph=function(a){function b(a,b,e,f,g,h){this.init(a,b,e,f,g,h)}__extends(b,a);return b}(Morph);
HandleMorph.prototype.init=function(a,b,c,d,e,f){var g;g=MorphicPreferences.handleSize;this.target=a||null;this.minExtent=new Point(b||0,c||0);this.inset=new Point(d||0,e||d||0);this.type=f||"resize";HandleMorph.__super__.init.call(this);this.color=new Color(255,255,255);this.isDraggable=!1;this.noticesTransparentClick=!0;return this.setExtent(new Point(g,g))};
HandleMorph.prototype.drawNew=function(){this.normalImage=newCanvas(this.extent());this.highlightImage=newCanvas(this.extent());this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100));this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255));this.image=this.normalImage;if(this.target)return this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed()};
HandleMorph.prototype.drawOnCanvas=function(a,b,c){var d,e,f,g,a=a.getContext("2d");a.lineWidth=1;a.lineCap="round";a.strokeStyle=b.toString();if("move"===this.type){d=this.bottomLeft().subtract(this.position());e=d.copy();f=this.topRight().subtract(this.position());g=f.copy();for(b=0;b<=this.height();)e.y=d.y-b,g.y=f.y-b,a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(g.x,g.y),a.closePath(),a.stroke(),b+=6}d=this.bottomLeft().subtract(this.position());e=d.copy();f=this.topRight().subtract(this.position());
g=f.copy();for(b=0;b<=this.width();)e.x=d.x+b,g.x=f.x+b,a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(g.x,g.y),a.closePath(),a.stroke(),b+=6;a.strokeStyle=c.toString();if("move"===this.type){d=this.bottomLeft().subtract(this.position());e=d.copy();f=this.topRight().subtract(this.position());g=f.copy();for(b=-2;b<=this.height();)e.y=d.y-b,g.y=f.y-b,a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(g.x,g.y),a.closePath(),a.stroke(),b+=6}d=this.bottomLeft().subtract(this.position());e=d.copy();f=this.topRight().subtract(this.position());
g=f.copy();b=2;for(c=[];b<=this.width();)e.x=d.x+b,g.x=f.x+b,a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(g.x,g.y),a.closePath(),a.stroke(),c.push(b+=6);return c};HandleMorph.prototype.step=null;
HandleMorph.prototype.mouseDownLeft=function(a){var b,c,d;d=this.root();c=a.subtract(this.bounds.origin);b=this;if(!this.target)return null;this.step=function(){var a;return d.hand.mouseButton?(a=d.hand.bounds.origin.copy().subtract(c),"resize"===this.type?(a=a.add(b.extent().add(b.inset)).subtract(b.target.bounds.origin),a=a.max(b.minExtent),b.target.setExtent(a),b.setPosition(b.target.bottomRight().subtract(b.extent().add(b.inset)))):b.target.setPosition(a.subtract(this.target.extent()).add(this.extent()))):
this.step=null};if(!this.target.step)return this.target.step=function(){return nop()}};HandleMorph.prototype.rootForGrab=function(){return this};HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage;return this.changed()};HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage;return this.changed()};
HandleMorph.prototype.copyRecordingReferences=function(a){var b;b=HandleMorph.__super__.copyRecordingReferences.call(this,a);b.target&&a[this.target]&&(b.target=a[this.target]);return b};HandleMorph.prototype.attach=function(){var a,b,c;a=this.overlappedMorphs();b=new MenuMorph(this,"choose target:");c=this;a.forEach(function(a){return b.addItem(a.toString().slice(0,50),function(){c.isDraggable=!1;c.target=a;c.drawNew();return c.noticesTransparentClick=!0})});if(0<a.length)return b.popUpAtHand(this.world())};
ShadowMorph=function(a){function b(){this.init()}__extends(b,a);return b}(Morph);PenMorph=function(a){function b(){this.init()}__extends(b,a);return b}(Morph);PenMorph.prototype.init=function(){var a;a=4*MorphicPreferences.handleSize;this.wantsRedraw=this.isWarped=!1;this.heading=0;this.isDown=!0;this.size=1;PenMorph.__super__.init.call(this);return this.setExtent(new Point(a,a))};
PenMorph.prototype.changed=function(){var a;if(!1===this.isWarped&&(a=this.root(),a instanceof WorldMorph&&a.broken.push(this.visibleBounds().spread()),this.parent))return this.parent.childChanged(this)};
PenMorph.prototype.drawNew=function(a){var b,c,d,e,f;c=a||this.heading;if(this.isWarped)return this.wantsRedraw=!0,null;this.image=newCanvas(this.extent());a=this.image.getContext("2d");e=this.width()/2;f=this.center().subtract(this.bounds.origin);b=f.distanceAngle(0.75*e,c-180);d=f.distanceAngle(e,c+195);c=f.distanceAngle(e,c-195);a.fillStyle=this.color.toString();a.beginPath();a.moveTo(f.x,f.y);a.lineTo(d.x,d.y);a.lineTo(b.x,b.y);a.lineTo(c.x,c.y);a.closePath();a.strokeStyle="white";a.lineWidth=
3;a.stroke();a.strokeStyle="black";a.lineWidth=1;a.stroke();a.fill();return this.wantsRedraw=!1};PenMorph.prototype.setHeading=function(a){this.heading=parseFloat(a)%360;if(!1===this.isWarped)return this.drawNew(),this.changed()};
PenMorph.prototype.drawLine=function(a,b){var c,d,e;c=this.parent.penTrails().getContext("2d");d=a.subtract(this.parent.bounds.origin);e=b.subtract(this.parent.bounds.origin);if(this.isDown&&(c.lineWidth=this.size,c.strokeStyle=this.color.toString(),c.lineCap="round",c.lineJoin="round",c.beginPath(),c.moveTo(d.x,d.y),c.lineTo(e.x,e.y),c.stroke(),!1===this.isWarped))return this.world().broken.push(a.rectangle(b).expandBy(Math.max(this.size/2,1)).intersect(this.parent.visibleBounds()).spread())};
PenMorph.prototype.turn=function(a){return this.setHeading(this.heading+parseFloat(a))};PenMorph.prototype.forward=function(a){var b;b=this.center();a=parseFloat(a);this.setPosition(0<=a?this.position().distanceAngle(a,this.heading):this.position().distanceAngle(Math.abs(a),this.heading-180));return this.drawLine(b,this.center())};PenMorph.prototype.down=function(){return this.isDown=!0};PenMorph.prototype.up=function(){return this.isDown=!1};
PenMorph.prototype.clear=function(){this.parent.drawNew();return this.parent.changed()};PenMorph.prototype.startWarp=function(){return this.isWarped=!0};PenMorph.prototype.endWarp=function(){this.wantsRedraw&&this.drawNew();this.changed();this.parent.changed();return this.isWarped=!1};PenMorph.prototype.warp=function(a){this.startWarp();a.call(this);return this.endWarp()};PenMorph.prototype.warpOp=function(a,b){this.startWarp();this[a].apply(this,b);return this.endWarp()};
PenMorph.prototype.warpSierpinski=function(a,b){return this.warpOp("sierpinski",[a,b])};PenMorph.prototype.sierpinski=function(a,b){var c,d;if(a>b){c=0;for(d=[];3>c;)this.sierpinski(0.5*a,b),this.turn(120),this.forward(a),d.push(c+=1);return d}};PenMorph.prototype.warpTree=function(a,b,c){return this.warpOp("tree",[a,b,c])};PenMorph.prototype.tree=function(a,b,c){if(0<a)return this.size=a,this.forward(b),this.turn(c),this.tree(a-1,0.75*b,c),this.turn(-2*c),this.tree(a-1,0.75*b,c),this.turn(c),this.forward(-b)};
ColorPaletteMorph=function(a){function b(a,b){this.init(a||null,b||new Point(80,50))}__extends(b,a);return b}(Morph);ColorPaletteMorph.prototype.init=function(a,b){ColorPaletteMorph.__super__.init.call(this);this.target=a;this.targetSetter="color";this.silentSetExtent(b);this.choice=null;return this.drawNew()};
ColorPaletteMorph.prototype.drawNew=function(){var a,b,c,d,e,f,g;b=this.extent();this.image=newCanvas(this.extent());a=this.image.getContext("2d");this.choice=new Color;e=0;for(g=[];e<=b.x;){c=360*e/b.x;for(f=0;f<=b.y;)d=100-100*(f/b.y),a.fillStyle="hsl("+c+",100%,"+d+"%)",a.fillRect(e,f,1,1),f+=1;g.push(e+=1)}return g};ColorPaletteMorph.prototype.mouseMove=function(a){this.choice=this.getPixelColor(a);return this.updateTarget()};
ColorPaletteMorph.prototype.mouseDownLeft=function(a){this.choice=this.getPixelColor(a);return this.updateTarget()};ColorPaletteMorph.prototype.updateTarget=function(){if(this.target instanceof Morph&&null!==this.choice){if(this.target[this.targetSetter]instanceof Function)return this.target[this.targetSetter](this.choice);this.target[this.targetSetter]=this.choice;this.target.drawNew();return this.target.changed()}};
ColorPaletteMorph.prototype.copyRecordingReferences=function(a){var b;b=ColorPaletteMorph.__super__.copyRecordingReferences.call(this,a);b.target&&a[this.target]&&(b.target=a[this.target]);return b};ColorPaletteMorph.prototype.developersMenu=function(){var a;a=ColorPaletteMorph.__super__.developersMenu.call(this);a.addLine();a.addItem("set target","setTarget","choose another morph\nwhose color property\n will be controlled by this one");return a};
ColorPaletteMorph.prototype.setTarget=function(){var a,b,c;a=this.overlappedMorphs();b=new MenuMorph(this,"choose target:");c=this;a.push(this.world());a.forEach(function(a){return b.addItem(a.toString().slice(0,50),function(){c.target=a;return c.setTargetSetter()})});if(1===a.length)return this.target=a[0],this.setTargetSetter();if(0<a.length)return b.popUpAtHand(this.world())};
ColorPaletteMorph.prototype.setTargetSetter=function(){var a,b,c;a=this.target.colorSetters();b=new MenuMorph(this,"choose target property:");c=this;a.forEach(function(a){return b.addItem(a,function(){return c.targetSetter=a})});if(1===a.length)return this.targetSetter=a[0];if(0<a.length)return b.popUpAtHand(this.world())};GrayPaletteMorph=function(a){function b(a,b){this.init(a||null,b||new Point(80,10))}__extends(b,a);return b}(ColorPaletteMorph);
GrayPaletteMorph.prototype.drawNew=function(){var a,b,c;b=this.extent();this.image=newCanvas(this.extent());a=this.image.getContext("2d");this.choice=new Color;c=a.createLinearGradient(0,0,b.x,b.y);c.addColorStop(0,"black");c.addColorStop(1,"white");a.fillStyle=c;return a.fillRect(0,0,b.x,b.y)};ColorPickerMorph=function(a){function b(a){this.init(a||new Color(255,255,255))}__extends(b,a);return b}(Morph);
ColorPickerMorph.prototype.init=function(a){this.choice=a;ColorPickerMorph.__super__.init.apply(this,arguments);this.color=new Color(255,255,255);this.silentSetExtent(new Point(80,80));return this.drawNew()};ColorPickerMorph.prototype.drawNew=function(){ColorPickerMorph.__super__.drawNew.apply(this,arguments);return this.buildSubmorphs()};
ColorPickerMorph.prototype.buildSubmorphs=function(){var a,b;b=a=b=a=void 0;this.children.forEach(function(a){return a.destroy()});this.children=[];this.feedback=new Morph;this.feedback.color=this.choice;this.feedback.setExtent(new Point(20,20));a=new ColorPaletteMorph(this.feedback,new Point(this.width(),50));b=new GrayPaletteMorph(this.feedback,new Point(this.width(),5));a.setPosition(this.bounds.origin);this.add(a);b.setPosition(a.bottomLeft());this.add(b);a=b.left()+Math.floor((b.width()-this.feedback.width())/
2);b=b.bottom()+Math.floor((this.bottom()-b.bottom()-this.feedback.height())/2);this.feedback.setPosition(new Point(a,b));return this.add(this.feedback)};ColorPickerMorph.prototype.getChoice=function(){return this.feedback.color};ColorPickerMorph.prototype.rootForGrab=function(){return this};BlinkerMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(Morph);BlinkerMorph.prototype.init=function(a){BlinkerMorph.__super__.init.call(this);this.color=new Color(0,0,0);this.fps=a||2;return this.drawNew()};
BlinkerMorph.prototype.step=function(){return this.toggleVisibility()};CursorMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(BlinkerMorph);
CursorMorph.prototype.init=function(a){this.keyDownEventUsed=!1;this.target=a;this.originalContents=this.target.text;this.slot=this.target.text.length;CursorMorph.__super__.init.call(this);a=fontHeight(this.target.fontSize);this.setExtent(new Point(Math.max(Math.floor(a/20),1),a));this.drawNew();this.image.getContext("2d").font=this.target.font();return this.gotoSlot(this.slot)};
CursorMorph.prototype.processKeyPress=function(a){var b;if(this.keyDownEventUsed)return this.keyDownEventUsed=!1,null;if(40===a.keyCode||40===a.charCode)return this.insert("("),null;if(37===a.keyCode||37===a.charCode)return this.insert("%"),null;b=[8,13,18,27,35,36,37,38,40];a.keyCode?contains(b,a.keyCode)||(a.ctrlKey?this.ctrl(a.keyCode):this.insert(String.fromCharCode(a.keyCode))):a.charCode&&(contains(b,a.charCode)||(a.ctrlKey?this.ctrl(a.charCode):this.insert(String.fromCharCode(a.charCode))));
return this.target.escalateEvent("reactToKeystroke",a)};
CursorMorph.prototype.processKeyDown=function(a){this.keyDownEventUsed=!1;if(a.ctrlKey)this.ctrl(a.keyCode),this.target.escalateEvent("reactToKeystroke",a);else{switch(a.keyCode){case 37:this.goLeft();this.keyDownEventUsed=!0;break;case 39:this.goRight();this.keyDownEventUsed=!0;break;case 38:this.goUp();this.keyDownEventUsed=!0;break;case 40:this.goDown();this.keyDownEventUsed=!0;break;case 36:this.goHome();this.keyDownEventUsed=!0;break;case 35:this.goEnd();this.keyDownEventUsed=!0;break;case 46:this.deleteRight();
this.keyDownEventUsed=!0;break;case 8:this.deleteLeft();this.keyDownEventUsed=!0;break;case 13:this.target instanceof StringMorph?this.accept():this.insert("\n");this.keyDownEventUsed=!0;break;case 27:this.cancel(),this.keyDownEventUsed=!0}return this.target.escalateEvent("reactToKeystroke",a)}};CursorMorph.prototype.gotoSlot=function(a){this.setPosition(this.target.slotPosition(a));return this.slot=Math.max(a,0)};
CursorMorph.prototype.goLeft=function(){this.target.clearSelection();return this.gotoSlot(this.slot-1)};CursorMorph.prototype.goRight=function(){this.target.clearSelection();return this.gotoSlot(this.slot+1)};CursorMorph.prototype.goUp=function(){this.target.clearSelection();return this.gotoSlot(this.target.upFrom(this.slot))};CursorMorph.prototype.goDown=function(){this.target.clearSelection();return this.gotoSlot(this.target.downFrom(this.slot))};
CursorMorph.prototype.goHome=function(){this.target.clearSelection();return this.gotoSlot(this.target.startOfLine(this.slot))};CursorMorph.prototype.goEnd=function(){this.target.clearSelection();return this.gotoSlot(this.target.endOfLine(this.slot))};CursorMorph.prototype.gotoPos=function(a){this.gotoSlot(this.target.slotAt(a));return this.show()};CursorMorph.prototype.accept=function(){var a;(a=this.root())&&a.stopEditing();return this.escalateEvent("accept",null)};
CursorMorph.prototype.cancel=function(){var a;(a=this.root())&&a.stopEditing();this.target.text=this.originalContents;this.target.changed();this.target.drawNew();this.target.changed();return this.escalateEvent("cancel",null)};
CursorMorph.prototype.insert=function(a){var b;if("\t"===a)return this.target.tab(this.target);if(!this.target.isNumeric||!isNaN(parseFloat(a))||contains(["-","."],a))return""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),b=this.target.text,b=b.slice(0,this.slot)+a+b.slice(this.slot),this.target.text=b,this.target.drawNew(),this.target.changed(),this.goRight()};
CursorMorph.prototype.ctrl=function(a){if(97===a||65===a)return this.target.selectAll(),null;if(123===a)return this.insert("{"),null;if(125===a)return this.insert("}"),null;if(91===a)return this.insert("["),null;if(93===a)return this.insert("]"),null};
CursorMorph.prototype.deleteRight=function(){var a;if(""!==this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection();a=this.target.text;this.target.changed();a=a.slice(0,this.slot)+a.slice(this.slot+1);this.target.text=a;return this.target.drawNew()};
CursorMorph.prototype.deleteLeft=function(){var a;""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection());a=this.target.text;this.target.changed();a=a.slice(0,Math.max(this.slot-1,0))+a.slice(this.slot);this.target.text=a;this.target.drawNew();return this.goLeft()};
CursorMorph.prototype.inspectKeyEvent=function(a){return this.inform("Key pressed: "+String.fromCharCode(a.charCode)+"\n------------------------\ncharCode: "+a.charCode.toString()+"\nkeyCode: "+a.keyCode.toString()+"\naltKey: "+a.altKey.toString()+"\nctrlKey: "+a.ctrlKey.toString())};BoxMorph=function(a){function b(a,b,e){this.init(a,b,e)}__extends(b,a);return b}(Morph);BoxMorph.prototype.init=function(a,b,c){this.edge=a||4;this.border=b||(0===b?0:2);this.borderColor=c||new Color;return BoxMorph.__super__.init.call(this)};
BoxMorph.prototype.drawNew=function(){var a;this.image=newCanvas(this.extent());a=this.image.getContext("2d");if(0===this.edge&&0===this.border)return BoxMorph.__super__.drawNew.call(this),null;a.fillStyle=this.color.toString();a.beginPath();this.outlinePath(a,Math.max(this.edge-this.border,0),this.border);a.closePath();a.fill();if(0<this.border)return a.lineWidth=this.border,a.strokeStyle=this.borderColor.toString(),a.beginPath(),this.outlinePath(a,this.edge,this.border/2),a.closePath(),a.stroke()};
BoxMorph.prototype.outlinePath=function(a,b,c){var d,e;d=b+c;e=this.width();c=this.height();a.arc(d,d,b,radians(-180),radians(-90),!1);a.arc(e-d,d,b,radians(-90),radians(-0.0),!1);a.arc(e-d,c-d,b,radians(0),radians(90),!1);return a.arc(d,c-d,b,radians(90),radians(180),!1)};
BoxMorph.prototype.developersMenu=function(){var a;a=BoxMorph.__super__.developersMenu.call(this);a.addLine();a.addItem("border width...",function(){return this.prompt(a.title+"\nborder\nwidth:",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)},"set the border's\nline size");a.addItem("border color...",function(){return this.pickColor(a.title+"\nborder color:",this.setBorderColor,this,this.borderColor)},"set the border's\nline color");a.addItem("corner size...",function(){return this.prompt(a.title+
"\ncorner\nsize:",this.setCornerSize,this,this.edge.toString(),null,0,100,!0)},"set the corner's\nradius");return a};BoxMorph.prototype.setBorderWidth=function(a){"number"===typeof a?this.border=Math.max(a,0):(a=parseFloat(a),isNaN(a)||(this.border=Math.max(a,0)));this.drawNew();return this.changed()};BoxMorph.prototype.setBorderColor=function(a){if(a)return this.borderColor=a,this.drawNew(),this.changed()};
BoxMorph.prototype.setCornerSize=function(a){"number"===typeof a?this.edge=Math.max(a,0):(a=parseFloat(a),isNaN(a)||(this.edge=Math.max(a,0)));this.drawNew();return this.changed()};BoxMorph.prototype.colorSetters=function(){return["color","borderColor"]};BoxMorph.prototype.numericalSetters=function(){var a;a=BoxMorph.__super__.numericalSetters.call(this);a.push("setBorderWidth","setCornerSize");return a};
SpeechBubbleMorph=function(a){function b(a,b,e,f,g,h,j){this.init(a,b,e,f,g,h,j)}__extends(b,a);return b}(BoxMorph);SpeechBubbleMorph.prototype.init=function(a,b,c,d,e,f,g){this.isPointingRight=!0;this.contents=a||"";this.padding=f||0;this.isThought=g||!1;SpeechBubbleMorph.__super__.init.call(this,c||6,d||(0===d?0:1),e||new Color(140,140,140));this.color=b||new Color(230,230,230);return this.drawNew()};
SpeechBubbleMorph.prototype.popUp=function(a,b){this.drawNew();this.setPosition(b.subtract(new Point(0,this.height())));this.addShadow(new Point(2,2),80);this.keepWithin(a);a.add(this);this.changed();a.hand.destroyTemporaries();a.hand.temporaries.push(this);return this.mouseEnter=function(){return this.destroy()}};
SpeechBubbleMorph.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy();this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):
this.contentsMorph=new TextMorph(this.contents.toString(),MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center");this.add(this.contentsMorph);this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge));this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2);SpeechBubbleMorph.__super__.drawNew.call(this);return this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))};
SpeechBubbleMorph.prototype.outlinePath=function(a,b,c){var d,e,f,g,h;d=function(b,c,d){a.moveTo(b+d,c);return a.arc(b,c,d,radians(0),radians(360))};f=b+c;h=this.width();e=this.height();g=void 0;a.arc(f,f,b,radians(-180),radians(-90),!1);a.arc(h-f,f,b,radians(-90),radians(-0.0),!1);a.arc(h-f,e-f-b,b,radians(0),radians(90),!1);this.isThought||(this.isPointingRight?(a.lineTo(f+b,e-f),a.lineTo(b/2+c,e-c)):(a.lineTo(h-(b/2+c),e-c),a.lineTo(h-(f+b),e-f)));a.arc(f,e-f-b,b,radians(90),radians(180),!1);if(this.isThought){a.lineTo(c,
f);if(this.isPointingRight)return g=b/4,d(g+c,e-g-c,g),g=b/3.2,d(2*g+c,e-g-2*c,g),g=b/2.8,d(3*g+2*c,e-g-4*c,g);g=b/4;d(h-(g+c),e-g-c,g);g=b/3.2;d(h-(2*g+c),e-g-2*c,g);g=b/2.8;return d(h-(3*g+2*c),e-g-4*c,g)}};CircleBoxMorph=function(a){function b(a){this.init(a||"vertical")}__extends(b,a);return b}(Morph);CircleBoxMorph.prototype.init=function(a){CircleBoxMorph.__super__.init.call(this);this.orientation=a;this.autoOrient=!0;return this.setExtent(new Point(20,100))};
CircleBoxMorph.prototype.autoOrientation=function(){return this.height()>this.width()?this.orientation="vertical":this.orientation="horizontal"};
CircleBoxMorph.prototype.drawNew=function(){var a,b,c,d,e,f;a=c=f=f=a=f=b=a=e=void 0;d=this;this.autoOrient&&this.autoOrientation();this.image=newCanvas(this.extent());c=this.image.getContext("2d");"vertical"===this.orientation?(e=this.width()/2,f=this.center().x,a=new Point(f,this.top()+e),b=new Point(f,this.bottom()-e),f=this.bounds.origin.add(new Point(0,e)).corner(this.bounds.corner.subtract(new Point(0,e)))):(e=this.height()/2,f=this.center().y,a=new Point(this.left()+e,f),b=new Point(this.right()-
e,f),f=this.bounds.origin.add(new Point(e,0)).corner(this.bounds.corner.subtract(new Point(e,0))));a=[a.subtract(this.bounds.origin),b.subtract(this.bounds.origin)];a.forEach(function(a){c.fillStyle=d.color.toString();c.beginPath();c.arc(a.x,a.y,e,0,2*Math.PI,false);c.closePath();return c.fill()});f=f.translateBy(this.bounds.origin.neg());a=f.extent();if(0<a.x&&0<a.y)return c.fillRect(f.origin.x,f.origin.y,f.width(),f.height())};
CircleBoxMorph.prototype.developersMenu=function(){var a;a=CircleBoxMorph.__super__.developersMenu.call(this);a.addLine();"vertical"===this.orientation?a.addItem("horizontal...","toggleOrientation","toggle the\norientation"):a.addItem("vertical...","toggleOrientation","toggle the\norientation");return a};
CircleBoxMorph.prototype.toggleOrientation=function(){var a;a=this.center();this.changed();this.orientation="vertical"===this.orientation?"horizontal":"vertical";this.silentSetExtent(new Point(this.height(),this.width()));this.setCenter(a);this.drawNew();return this.changed()};MouseSensorMorph=function(a){function b(a,b,e){this.init(a,b,e)}__extends(b,a);return b}(BoxMorph);
MouseSensorMorph.prototype.init=function(a,b,c){MouseSensorMorph.__super__.init.apply(this,arguments);this.edge=a||4;this.border=b||2;this.color=new Color(255,255,255);this.borderColor=c||new Color;this.isTouched=!1;this.upStep=0.05;this.downStep=0.02;this.noticesTransparentClick=!1;return this.drawNew()};
MouseSensorMorph.prototype.touch=function(){var a;a=this;if(!this.isTouched)return this.isTouched=!0,this.alpha=0.6,this.step=function(){a.isTouched?1>a.alpha&&(a.alpha+=a.upStep):a.alpha>a.downStep?a.alpha-=a.downStep:(a.alpha=0,a.step=null);return a.changed()}};MouseSensorMorph.prototype.unTouch=function(){return this.isTouched=!1};MouseSensorMorph.prototype.mouseEnter=function(){return this.touch()};MouseSensorMorph.prototype.mouseLeave=function(){return this.unTouch()};
MouseSensorMorph.prototype.mouseDownLeft=function(){return this.touch()};MouseSensorMorph.prototype.mouseClickLeft=function(){return this.unTouch()};InspectorMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(BoxMorph);
InspectorMorph.prototype.init=function(a){this.target=a;this.currentProperty=null;this.showing="attributes";this.markOwnProperties=!1;InspectorMorph.__super__.init.call(this);this.silentSetExtent(new Point(20*MorphicPreferences.handleSize,40*MorphicPreferences.handleSize/3));this.isDraggable=!0;this.border=1;this.edge=5;this.color=new Color(60,60,60);this.borderColor=new Color(95,95,95);this.drawNew();this.resizer=this.buttonEdit=this.buttonSubset=this.buttonClose=this.buttonInspect=this.work=this.detail=
this.list=this.label=null;if(this.target)return this.buildPanes()};InspectorMorph.prototype.setTarget=function(a){this.target=a;this.currentProperty=null;return this.buildPanes()};
InspectorMorph.prototype.buildPanes=function(){var a,b,c,d;a=[];d=void 0;c=this;b=b=void 0;this.children.forEach(function(a){if(a!==this.work)return a.destroy()});this.children=[];this.label=new TextMorph(this.target.toString());this.label.fontSize=MorphicPreferences.menuFontSize;this.label.isBold=!0;this.label.color=new Color(255,255,255);this.label.drawNew();this.add(this.label);for(d in this.target)d&&a.push(d);"attributes"===this.showing?a=a.filter(function(a){return"function"!==typeof c.target[a]}):
"methods"===this.showing&&(a=a.filter(function(a){return"function"===typeof c.target[a]}));this.list=new ListMorph(this.target instanceof Array?a:a.sort(),null,this.markOwnProperties?[[new Color(0,0,180),function(a){return c.target.hasOwnProperty(a)}]]:null);this.list.action=function(a){a=c.target[a];c.currentProperty=a;a=null===a?"NULL":isString(a)?a:a.toString();a=new TextMorph(a);a.isEditable=!0;a.enableSelecting();a.setReceiver(c.target);return c.detail.setContents(a)};this.list.hBar.alpha=0.6;
this.list.vBar.alpha=0.6;this.add(this.list);this.detail=new ScrollFrameMorph;this.detail.acceptsDrops=!1;this.detail.contents.acceptsDrops=!1;this.detail.isTextLineWrapping=!0;this.detail.color=new Color(255,255,255);this.detail.hBar.alpha=0.6;this.detail.vBar.alpha=0.6;b=new TextMorph("");b.isEditable=!0;b.enableSelecting();b.setReceiver(this.target);this.detail.setContents(b);this.add(this.detail);null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=
!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=0.6,this.work.vBar.alpha=0.6,b=new TextMorph(""),b.isEditable=!0,b.enableSelecting(),b.setReceiver(this.target),this.work.setContents(b));this.add(this.work);this.buttonSubset=new TriggerMorph;this.buttonSubset.labelString="show...";this.buttonSubset.action=function(){var a;a=void 0;a=new MenuMorph;a.addItem("attributes",function(){c.showing="attributes";return c.buildPanes()});a.addItem("methods",function(){c.showing=
"methods";return c.buildPanes()});a.addItem("all",function(){c.showing="all";return c.buildPanes()});a.addLine();a.addItem(c.markOwnProperties?"un-mark own":"mark own",function(){c.markOwnProperties=!c.markOwnProperties;return c.buildPanes()},"highlight\n'own' properties");return a.popUpAtHand(c.world())};this.add(this.buttonSubset);this.buttonInspect=new TriggerMorph;this.buttonInspect.labelString="inspect...";this.buttonInspect.action=function(){var a,b,d;a=d=b=void 0;if(isObject(c.currentProperty)){b=
new MenuMorph;b.addItem("in new inspector...",function(){d=c.world();a=new InspectorMorph(c.currentProperty);a.setPosition(d.hand.position());a.keepWithin(d);d.add(a);return a.changed()});b.addItem("here...",function(){return c.setTarget(c.currentProperty)});return b.popUpAtHand(c.world())}return c.inform((c.currentProperty===null?"null":typeof c.currentProperty)+"\nis not inspectable")};this.add(this.buttonInspect);this.buttonEdit=new TriggerMorph;this.buttonEdit.labelString="edit...";this.buttonEdit.action=
function(){var a;a=new MenuMorph(c);a.addItem("save","save","accept changes");a.addLine();a.addItem("add property...","addProperty");a.addItem("rename...","renameProperty");a.addItem("remove...","removeProperty");return a.popUpAtHand(c.world())};this.add(this.buttonEdit);this.buttonClose=new TriggerMorph;this.buttonClose.labelString="close";this.buttonClose.action=function(){return c.destroy()};this.add(this.buttonClose);this.resizer=new HandleMorph(this,150,100,this.edge,this.edge);return this.fixLayout()};
InspectorMorph.prototype.fixLayout=function(){var a,b,c,d;Morph.prototype.trackChanges=!1;c=this.left()+this.edge;d=this.top()+this.edge;b=this.right()-this.edge;b-=c;this.label.setPosition(new Point(c,d));this.label.setWidth(b);this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew());d=this.label.bottom()+2;b=Math.min(Math.floor(this.width()/3),this.list.listContents.width());b-=this.edge;a=this.bottom()-2*this.edge-
MorphicPreferences.handleSize-d;this.list.setPosition(new Point(c,d));this.list.setExtent(new Point(b,a));c=this.list.right()+this.edge;b=this.right()-this.edge;b-=c;this.detail.setPosition(new Point(c,d));this.detail.setExtent(new Point(b,2*a/3-this.edge));d=this.detail.bottom()+this.edge;this.work.setPosition(new Point(c,d));this.work.setExtent(new Point(b,a/3));c=this.list.left();d=this.list.bottom()+this.edge;b=this.list.width();a=MorphicPreferences.handleSize;this.buttonSubset.setPosition(new Point(c,
d));this.buttonSubset.setExtent(new Point(b,a));c=this.detail.left();b=this.detail.width()-this.edge-MorphicPreferences.handleSize;b=b/3-this.edge/3;this.buttonInspect.setPosition(new Point(c,d));this.buttonInspect.setExtent(new Point(b,a));c=this.buttonInspect.right()+this.edge;this.buttonEdit.setPosition(new Point(c,d));this.buttonEdit.setExtent(new Point(b,a));c=this.buttonEdit.right()+this.edge;b=this.detail.right()-this.edge-MorphicPreferences.handleSize;b-=c;this.buttonClose.setPosition(new Point(c,
d));this.buttonClose.setExtent(new Point(b,a));Morph.prototype.trackChanges=!0;return this.changed()};InspectorMorph.prototype.setExtent=function(a){InspectorMorph.__super__.setExtent.call(this,a);return this.fixLayout()};InspectorMorph.prototype.save=function(){var a,b;b=this.detail.contents.children[0].text.toString();a=this.list.selected;try{if(this.target.evaluateString("this."+a+" = "+b),this.target.drawNew)return this.target.changed(),this.target.drawNew(),this.target.changed()}catch(c){return this.inform(c)}};
InspectorMorph.prototype.addProperty=function(){var a;a=this;return this.prompt("new property name:",function(b){if(b&&(a.target[b]=null,a.buildPanes(),a.target.drawNew))return a.target.changed(),a.target.drawNew(),a.target.changed()},this,"property")};
InspectorMorph.prototype.renameProperty=function(){var a,b;a=this;b=this.list.selected;return this.prompt("property name:",function(c){try{delete a.target[b],a.target[c]=a.currentProperty}catch(d){a.inform(d)}a.buildPanes();if(a.target.drawNew)return a.target.changed(),a.target.drawNew(),a.target.changed()},this,b)};
InspectorMorph.prototype.removeProperty=function(){var a;a=this.list.selected;try{if(delete this.target[a],this.currentProperty=null,this.buildPanes(),this.target.drawNew)return this.target.changed(),this.target.drawNew(),this.target.changed()}catch(b){return this.inform(b)}};MenuMorph=function(a){function b(a,b,e,f){this.init(a,b,e,f)}__extends(b,a);return b}(BoxMorph);
MenuMorph.prototype.init=function(a,b,c,d){this.target=a;this.title=b||null;this.environment=c||null;this.fontSize=d||null;this.items=[];this.world=this.label=null;this.isListContents=!1;MenuMorph.__super__.init.call(this);this.isDraggable=!1;return this.edge=this.border=null};MenuMorph.prototype.addItem=function(a,b,c,d){return this.items.push([localize(a||"close"),b||nop,c,d])};MenuMorph.prototype.addLine=function(a){return this.items.push([0,a||1])};
MenuMorph.prototype.createLabel=function(){var a;null!==this.label&&this.label.destroy();a=new TextMorph(localize(this.title),this.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,!0,!1,"center");a.alignment="center";a.color=new Color(255,255,255);a.backgroundColor=this.borderColor;a.drawNew();this.label=new BoxMorph(3,0);this.label.color=this.borderColor;this.label.borderColor=this.borderColor;this.label.setExtent(a.extent().add(4));this.label.drawNew();this.label.add(a);
return this.label.text=a};
MenuMorph.prototype.drawNew=function(){var a,b,c,d,e,f;d=this;f=e=a=c=void 0;b=!1;this.children.forEach(function(a){return a.destroy()});this.children=[];this.isListContents||(this.edge=5,this.border=2);this.color=new Color(255,255,255);this.borderColor=new Color(60,60,60);this.silentSetExtent(new Point(0,0));f=2;e=this.left()+4;this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),this.add(this.label),f=this.label.bottom()):f=this.top()+4);f+=1;this.items.forEach(function(a){b=
false;if(a instanceof StringFieldMorph||a instanceof ColorPickerMorph||a instanceof SliderMorph)c=a;else if(a[0]===0){b=true;c=new Morph;c.color=d.borderColor;c.setHeight(a[1])}else c=new MenuItemMorph(d.target,a[1],a[0],d.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,d.environment,a[2],a[3]);b&&(f=f+1);c.setPosition(new Point(e,f));d.add(c);f=f+c.height();if(b)return f=f+1});a=this.fullBounds();this.silentSetExtent(a.extent().add(4));this.adjustWidths();return MenuMorph.__super__.drawNew.call(this)};
MenuMorph.prototype.maxWidth=function(){var a;a=0;this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(a=this.parent.width());this.children.forEach(function(b){if(b instanceof MenuItemMorph||b instanceof StringFieldMorph||b instanceof ColorPickerMorph||b instanceof SliderMorph)return a=Math.max(a,b.width())});this.label&&(a=Math.max(a,this.label.width()));return a};
MenuMorph.prototype.adjustWidths=function(){var a,b;b=this.maxWidth();a=this;return this.children.forEach(function(c){c.silentSetWidth(b);if(c instanceof MenuItemMorph)return c.createBackgrounds();c.drawNew();if(c===a.label)return c.text.setPosition(c.center().subtract(c.text.extent().floorDivideBy(2)))})};MenuMorph.prototype.unselectAllItems=function(){this.children.forEach(function(a){if(a instanceof MenuItemMorph)return a.image=a.normalImage});return this.changed()};
MenuMorph.prototype.popup=function(a,b){this.drawNew();this.setPosition(b);this.addShadow(new Point(2,2),80);this.keepWithin(a);a.activeMenu&&a.activeMenu.destroy();a.add(this);a.activeMenu=this;return this.fullChanged()};MenuMorph.prototype.popUpAtHand=function(a){a=a||this.world;return this.popup(a,a.hand.position())};MenuMorph.prototype.popUpCenteredAtHand=function(a){a=a||this.world;this.drawNew();return this.popup(a,a.hand.position().subtract(this.extent().floorDivideBy(2)))};
MenuMorph.prototype.popUpCenteredInWorld=function(a){a=a||this.world;this.drawNew();return this.popup(a,a.center().subtract(this.extent().floorDivideBy(2)))};StringMorph=function(a){function b(a,b,e,f,g,h,j,i,k,l){this.init(a,b,e,f,g,h,j,i,k,l)}__extends(b,a);return b}(Morph);StringMorph.prototype=new Morph;
StringMorph.prototype.init=function(a,b,c,d,e,f,g,h,j,i){this.text=a||(""===a?"":"StringMorph");this.fontSize=b||12;this.fontName=i||MorphicPreferences.globalFontFamily;this.fontStyle=c||"sans-serif";this.isBold=d||!1;this.isItalic=e||!1;this.isEditable=!1;this.isNumeric=f||!1;this.shadowOffset=g||new Point(0,0);this.shadowColor=h||null;this.isShowingBlanks=!1;this.blanksColor=new Color(180,140,140);this.currentlySelecting=!1;this.endMark=this.startMark=0;this.markedTextColor=new Color(255,255,255);
this.markedBackgoundColor=new Color(60,60,120);StringMorph.__super__.init.call(this);this.color=j||new Color(0,0,0);this.noticesTransparentClick=!0;return this.drawNew()};StringMorph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+'("'+this.text.slice(0,30)+'...")'};
StringMorph.prototype.font=function(){var a;a="";this.isBold&&(a+="bold ");this.isItalic&&(a+="italic ");return a+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle};
StringMorph.prototype.drawNew=function(){var a,b,c,d,e,f,g;this.image=newCanvas();b=this.image.getContext("2d");b.font=this.font();e=Math.max(b.measureText(this.text).width+Math.abs(this.shadowOffset.x),1);this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(this.shadowOffset.y)));this.image.width=e;this.image.height=this.height();b.font=this.font();b.textAlign="left";b.textBaseline="bottom";this.shadowColor&&(f=Math.max(this.shadowOffset.x,0),g=Math.max(this.shadowOffset.y,
0),b.fillStyle=this.shadowColor.toString(),b.fillText(this.text,f,fontHeight(this.fontSize)+g));f=Math.abs(Math.min(this.shadowOffset.x,0));g=Math.abs(Math.min(this.shadowOffset.y,0));b.fillStyle=this.color.toString();this.isShowingBlanks?this.renderWithBlanks(b,f,fontHeight(this.fontSize)+g):b.fillText(this.text,f,fontHeight(this.fontSize)+g);a=Math.min(this.startMark,this.endMark);e=Math.max(this.startMark,this.endMark);for(c=a;c<e;)d=this.slotPosition(c).subtract(this.position()),a=this.text.charAt(c),
b.fillStyle=this.markedBackgoundColor.toString(),b.fillRect(d.x,d.y,b.measureText(a).width+1+f,fontHeight(this.fontSize)+g),b.fillStyle=this.markedTextColor.toString(),b.fillText(a,d.x+f,fontHeight(this.fontSize)+g),c+=1;if(this.parent&&this.parent.fixLayout)return this.parent.fixLayout()};
StringMorph.prototype.renderWithBlanks=function(a,b,c){var d,e,f,g,h,j,i;f=function(){a.drawImage(d,i,0);return i+=h};h=a.measureText(" ").width;d=newCanvas(new Point(h,this.height()));e=d.getContext("2d");j=this.text.split(" ");i=b||0;g=!0;e.fillStyle=this.blanksColor.toString();e.arc(h/2,d.height/2,h/2,radians(0),radians(360));e.fill();return j.forEach(function(b){g||f();g=!1;if(""!==b)return a.fillText(b,i,c),i+=a.measureText(b).width})};
StringMorph.prototype.slotPosition=function(a){var b,c,d;b=Math.min(Math.max(a,0),this.text.length);a=this.image.getContext("2d");for(c=d=0;c<b;)d+=a.measureText(this.text[c]).width,c+=1;this.pos=b;a=this.left()+d;b=this.top();return new Point(a,b)};
StringMorph.prototype.slotAt=function(a){var b,c,d;b=d=0;for(c=this.image.getContext("2d");a.x-this.left()>b;)if(b+=c.measureText(this.text[d]).width,d+=1,d===this.text.length&&c.measureText(this.text).width-c.measureText(this.text[d-1]).width/2<a.x-this.left())return d;return d-1};StringMorph.prototype.upFrom=function(a){return a};StringMorph.prototype.downFrom=function(a){return a};StringMorph.prototype.startOfLine=function(){return 0};StringMorph.prototype.endOfLine=function(){return this.text.length};
StringMorph.prototype.developersMenu=function(){var a;a=StringMorph.__super__.developersMenu.call(this);a.addLine();a.addItem("edit","edit");a.addItem("font size...",function(){return this.prompt(a.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)},"set this String's\nfont point size");"serif"!==this.fontStyle&&a.addItem("serif","setSerif");"sans-serif"!==this.fontStyle&&a.addItem("sans-serif","setSansSerif");this.isBold?a.addItem("normal weight","toggleWeight"):
a.addItem("bold","toggleWeight");this.isItalic?a.addItem("normal style","toggleItalic"):a.addItem("italic","toggleItalic");this.isShowingBlanks?a.addItem("hide blanks","toggleShowBlanks"):a.addItem("show blanks","toggleShowBlanks");return a};StringMorph.prototype.toggleIsDraggable=function(){return(this.isDraggable=!this.isDraggable)?this.disableSelecting():this.enableSelecting()};
StringMorph.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks;this.changed();this.drawNew();return this.changed()};StringMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold;this.changed();this.drawNew();return this.changed()};StringMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic;this.changed();this.drawNew();return this.changed()};StringMorph.prototype.setSerif=function(){this.fontStyle="serif";this.changed();this.drawNew();return this.changed()};
StringMorph.prototype.setSansSerif=function(){this.fontStyle="sans-serif";this.changed();this.drawNew();return this.changed()};StringMorph.prototype.setFontSize=function(a){"number"===typeof a?this.fontSize=Math.round(Math.min(Math.max(a,4),500)):(a=parseFloat(a),isNaN(a)||(this.fontSize=Math.round(Math.min(Math.max(a,4),500))));this.changed();this.drawNew();return this.changed()};StringMorph.prototype.setText=function(a){this.text=Math.round(a).toString();this.changed();this.drawNew();return this.changed()};
StringMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]};StringMorph.prototype.edit=function(){return this.root().edit(this)};StringMorph.prototype.selection=function(){var a,b;a=Math.min(this.startMark,this.endMark);b=Math.max(this.startMark,this.endMark);return this.text.slice(a,b)};StringMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)};
StringMorph.prototype.clearSelection=function(){this.currentlySelecting=!1;this.endMark=this.startMark=0;this.drawNew();return this.changed()};StringMorph.prototype.deleteSelection=function(){var a,b,c;c=this.text;a=Math.min(this.startMark,this.endMark);b=Math.max(this.startMark,this.endMark);this.text=c.slice(0,a)+c.slice(b);this.changed();return this.clearSelection()};
StringMorph.prototype.selectAll=function(){if(this.mouseDownLeft)return this.startMark=0,this.endMark=this.text.length,this.drawNew(),this.changed()};StringMorph.prototype.mouseClickLeft=function(a){return this.isEditable?(this.currentlySelecting||this.edit(),this.root().cursor.gotoPos(a),this.currentlySelecting=!1):this.escalateEvent("mouseClickLeft",a)};
StringMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(a){this.clearSelection();if(this.isEditable&&!this.isDraggable)return this.edit(),this.root().cursor.gotoPos(a),this.endMark=this.startMark=this.slotAt(a),this.currentlySelecting=!0};return this.mouseMove=function(a){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable&&(a=this.slotAt(a),a!==this.endMark))return this.endMark=a,this.drawNew(),this.changed()}};
StringMorph.prototype.disableSelecting=function(){delete this.mouseDownLeft;return delete this.mouseMove};TextMorph=function(a){function b(a,b,e,f,g,h,j,i,k,l){this.init(a,b,e,f,g,h,j,i,k,l)}__extends(b,a);return b}(Morph);
TextMorph.prototype.init=function(a,b,c,d,e,f,g,h,j,i){this.text=a||(""===a?a:"TextMorph");this.words=[];this.lines=[];this.lineSlots=[];this.fontSize=b||12;this.fontName=h||MorphicPreferences.globalFontFamily;this.fontStyle=c||"sans-serif";this.isBold=d||!1;this.isItalic=e||!1;this.alignment=f||"left";this.shadowOffset=j||new Point(0,0);this.shadowColor=i||null;this.maxWidth=g||0;this.maxLineWidth=0;this.backgroundColor=null;this.isEditable=!1;this.receiver=null;this.currentlySelecting=!1;this.endMark=
this.startMark=0;this.markedTextColor=new Color(255,255,255);this.markedBackgoundColor=new Color(60,60,120);TextMorph.__super__.init.call(this);this.color=new Color(0,0,0);this.noticesTransparentClick=!0;return this.drawNew()};TextMorph.prototype.toString=function(){return'a TextMorph("'+this.text.slice(0,30)+'...")'};TextMorph.prototype.font=function(){var a;a="";this.isBold&&(a+="bold ");this.isItalic&&(a+="italic ");return a+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle};
TextMorph.prototype.parse=function(){var a,b,c,d,e,f,g;b=this;e=this.text.split("\n");a=newCanvas().getContext("2d");d="";g=c=void 0;f=0;a.font=this.font();this.maxLineWidth=0;this.lines=[];this.lineSlots=[0];this.words=[];e.forEach(function(a){b.words=b.words.concat(a.split(" "));return b.words.push("\n")});return this.words.forEach(function(e){if("\n"===e)return b.lines.push(d),b.lineSlots.push(f),b.maxLineWidth=Math.max(b.maxLineWidth,a.measureText(d).width),d="";0<b.maxWidth?(c=d+e+" ",g=a.measureText(c).width,
g>b.maxWidth?(b.lines.push(d),b.lineSlots.push(f),b.maxLineWidth=Math.max(b.maxLineWidth,a.measureText(d).width),d=e+" "):d=c):d=d+e+" ";return f+=e.length+1})};
TextMorph.prototype.drawNew=function(){var a,b,c,d,e,f,g,h,j;this.image=newCanvas();b=this.image.getContext("2d");b.font=this.font();this.parse();a=Math.abs(this.shadowOffset.x);g=Math.abs(this.shadowOffset.y);b=this.lines.length*(fontHeight(this.fontSize)+g);this.bounds=0===this.maxWidth?this.bounds.origin.extent(new Point(this.maxLineWidth+a,b)):this.bounds.origin.extent(new Point(this.maxWidth+a,b));this.image.width=this.width();this.image.height=this.height();b=this.image.getContext("2d");b.font=
this.font();b.textAlign="left";b.textBaseline="bottom";this.backgroundColor&&(b.fillStyle=this.backgroundColor.toString(),b.fillRect(0,0,this.width(),this.height()));if(this.shadowColor){e=Math.max(this.shadowOffset.x,0);f=Math.max(this.shadowOffset.y,0);b.fillStyle=this.shadowColor.toString();for(c=0;c<this.lines.length;)d=this.lines[c],h=b.measureText(d).width+a,h="right"===this.alignment?this.width()-h:"center"===this.alignment?(this.width()-h)/2:0,j=(c+1)*(fontHeight(this.fontSize)+g)-g,b.fillText(d,
h+e,j+f),c+=1}e=Math.abs(Math.min(this.shadowOffset.x,0));f=Math.abs(Math.min(this.shadowOffset.y,0));b.fillStyle=this.color.toString();for(c=0;c<this.lines.length;)d=this.lines[c],h=b.measureText(d).width+a,h="right"===this.alignment?this.width()-h:"center"===this.alignment?(this.width()-h)/2:0,j=(c+1)*(fontHeight(this.fontSize)+g)-g,b.fillText(d,h+e,j+f),c+=1;c=Math.min(this.startMark,this.endMark);for(g=Math.max(this.startMark,this.endMark);c<g;)d=this.slotPosition(c).subtract(this.position()),
a=this.text.charAt(c),b.fillStyle=this.markedBackgoundColor.toString(),b.fillRect(d.x,d.y,b.measureText(a).width+1,fontHeight(this.fontSize)),b.fillStyle=this.markedTextColor.toString(),b.fillText(a,d.x,d.y+fontHeight(this.fontSize)),c+=1;if(this.parent&&this.parent.layoutChanged)return this.parent.layoutChanged()};TextMorph.prototype.setExtent=function(a){this.maxWidth=Math.max(a.x,0);this.changed();return this.drawNew()};
TextMorph.prototype.columnRow=function(a){var b,c,d;for(d=0;d<this.lines.length;){c=this.lineSlots[d];for(b=0;b<this.lines[d].length;){if(c===a)return new Point(b,d);c+=1;b+=1}d+=1}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)};
TextMorph.prototype.slotPosition=function(a){var b,c,d,e,a=this.columnRow(a);b=this.image.getContext("2d");d=Math.abs(this.shadowOffset.y);e=0;d=a.y*(fontHeight(this.fontSize)+d);for(c=0;c<a.x;)e+=b.measureText(this.lines[a.y][c]).width,c+=1;a=this.left()+e;b=this.top()+d;return new Point(a,b)};
TextMorph.prototype.slotAt=function(a){var b,c,d,e,f;c=e=b=0;f=Math.abs(this.shadowOffset.y);for(d=this.image.getContext("2d");a.y-this.top()>(fontHeight(this.fontSize)+f)*e;)e+=1;for(e=Math.max(e,1);a.x-this.left()>b;)b+=d.measureText(this.lines[e-1][c]).width,c+=1;return this.lineSlots[Math.max(e-1,0)]+c-1};TextMorph.prototype.upFrom=function(a){var b;b=this.columnRow(a);if(1>b.y)return a;a=this.lines[b.y-1];return a.length<b.x-1?this.lineSlots[b.y-1]+a.length:this.lineSlots[b.y-1]+b.x};
TextMorph.prototype.downFrom=function(a){var b;b=this.columnRow(a);if(b.y>this.lines.length-2)return a;a=this.lines[b.y+1];return a.length<b.x-1?this.lineSlots[b.y+1]+a.length:this.lineSlots[b.y+1]+b.x};TextMorph.prototype.startOfLine=function(a){return this.lineSlots[this.columnRow(a).y]};TextMorph.prototype.endOfLine=function(a){return this.startOfLine(a)+this.lines[this.columnRow(a).y].length-1};TextMorph.prototype.edit=function(){return this.root().edit(this)};
TextMorph.prototype.selection=function(){var a,b;a=Math.min(this.startMark,this.endMark);b=Math.max(this.startMark,this.endMark);return this.text.slice(a,b)};TextMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)};TextMorph.prototype.clearSelection=function(){this.currentlySelecting=!1;this.endMark=this.startMark=0;this.drawNew();return this.changed()};
TextMorph.prototype.deleteSelection=function(){var a,b,c;c=this.text;a=Math.min(this.startMark,this.endMark);b=Math.max(this.startMark,this.endMark);this.text=c.slice(0,a)+c.slice(b);this.changed();return this.clearSelection()};TextMorph.prototype.selectAll=function(){this.startMark=0;this.endMark=this.text.length;this.drawNew();return this.changed()};TextMorph.prototype.selectAllAndEdit=function(){this.edit();return this.selectAll()};
TextMorph.prototype.mouseClickLeft=function(a){return this.isEditable?(this.currentlySelecting||this.edit(),this.root().cursor.gotoPos(a),this.currentlySelecting=!1):this.escalateEvent("mouseClickLeft",a)};
TextMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(a){this.clearSelection();if(this.isEditable&&!this.isDraggable)return this.edit(),this.root().cursor.gotoPos(a),this.endMark=this.startMark=this.slotAt(a),this.currentlySelecting=!0};return this.mouseMove=function(a){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable&&(a=this.slotAt(a),a!==this.endMark))return this.endMark=a,this.drawNew(),this.changed()}};
TextMorph.prototype.disableSelecting=function(){delete this.mouseDownLeft;return delete this.mouseMove};
TextMorph.prototype.developersMenu=function(){var a;a=TextMorph.__super__.developersMenu.call(this);a.addLine();a.addItem("edit","edit");a.addItem("font size...",function(){return this.prompt(a.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)},"set this Text's\nfont point size");"left"!==this.alignment&&a.addItem("align left","setAlignmentToLeft");"right"!==this.alignment&&a.addItem("align right","setAlignmentToRight");"center"!==this.alignment&&a.addItem("align center",
"setAlignmentToCenter");a.addLine();"serif"!==this.fontStyle&&a.addItem("serif","setSerif");"sans-serif"!==this.fontStyle&&a.addItem("sans-serif","setSansSerif");this.isBold?a.addItem("normal weight","toggleWeight"):a.addItem("bold","toggleWeight");this.isItalic?a.addItem("normal style","toggleItalic"):a.addItem("italic","toggleItalic");return a};TextMorph.prototype.toggleIsDraggable=function(){return(this.isDraggable=!this.isDraggable)?this.disableSelecting():this.enableSelecting()};
TextMorph.prototype.setAlignmentToLeft=function(){this.alignment="left";this.drawNew();return this.changed()};TextMorph.prototype.setAlignmentToRight=function(){this.alignment="right";this.drawNew();return this.changed()};TextMorph.prototype.setAlignmentToCenter=function(){this.alignment="center";this.drawNew();return this.changed()};TextMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold;this.changed();this.drawNew();return this.changed()};
TextMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic;this.changed();this.drawNew();return this.changed()};TextMorph.prototype.setSerif=function(){this.fontStyle="serif";this.changed();this.drawNew();return this.changed()};TextMorph.prototype.setSansSerif=function(){this.fontStyle="sans-serif";this.changed();this.drawNew();return this.changed()};TextMorph.prototype.setText=function(a){this.text=Math.round(a).toString();this.changed();this.drawNew();return this.changed()};
TextMorph.prototype.setFontSize=function(a){"number"===typeof a?this.fontSize=Math.round(Math.min(Math.max(a,4),500)):(a=parseFloat(a),isNaN(a)||(this.fontSize=Math.round(Math.min(Math.max(a,4),500))));this.changed();this.drawNew();return this.changed()};TextMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]};
TextMorph.prototype.evaluationMenu=function(){var a;a=new MenuMorph(this,null);a.addItem("do it","doIt","evaluate the\nselected expression");a.addItem("show it","showIt","evaluate the\nselected expression\nand show the result");a.addItem("inspect it","inspectIt","evaluate the\nselected expression\nand inspect the result");a.addLine();a.addItem("select all","selectAllAndEdit");return a};TextMorph.prototype.setReceiver=function(a){this.receiver=a;return this.customContextMenu=this.evaluationMenu()};
TextMorph.prototype.doIt=function(){this.receiver.evaluateString(this.selection());return this.edit()};TextMorph.prototype.showIt=function(){var a;a=this.receiver.evaluateString(this.selection());if(null!==a)return this.inform(a)};TextMorph.prototype.inspectIt=function(){var a,b;a=this.receiver.evaluateString(this.selection());b=this.world();if(null!==a)return a=new InspectorMorph(a),a.setPosition(b.hand.position()),a.keepWithin(b),b.add(a),a.changed()};
TriggerMorph=function(a){function b(a,b,e,f,g,h,j,i){this.init(a,b,e,f,g,h,j,i)}__extends(b,a);return b}(Morph);
TriggerMorph.prototype.init=function(a,b,c,d,e,f,g,h){this.target=a||null;this.action=b||null;this.environment=f||null;this.labelString=c||null;this.label=null;this.hint=g||null;this.fontSize=d||MorphicPreferences.menuFontSize;this.fontStyle=e||"sans-serif";this.highlightColor=new Color(192,192,192);this.pressColor=new Color(128,128,128);this.labelColor=h||new Color(0,0,0);TriggerMorph.__super__.init.call(this);this.color=new Color(255,255,255);return this.drawNew()};
TriggerMorph.prototype.drawNew=function(){this.createBackgrounds();if(null!==this.labelString)return this.createLabel()};
TriggerMorph.prototype.createBackgrounds=function(){var a,b;b=this.extent();this.normalImage=newCanvas(b);a=this.normalImage.getContext("2d");a.fillStyle=this.color.toString();a.fillRect(0,0,b.x,b.y);this.highlightImage=newCanvas(b);a=this.highlightImage.getContext("2d");a.fillStyle=this.highlightColor.toString();a.fillRect(0,0,b.x,b.y);this.pressImage=newCanvas(b);a=this.pressImage.getContext("2d");a.fillStyle=this.pressColor.toString();a.fillRect(0,0,b.x,b.y);return this.image=this.normalImage};
TriggerMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy();this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,!1,!1,!1,null,null,this.labelColor);this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2)));return this.add(this.label)};TriggerMorph.prototype.copyRecordingReferences=function(a){var b;b=TriggerMorph.__super__.copyRecordingReferences.call(this,a);b.label&&a[this.label]&&(b.label=a[this.label]);return b};
TriggerMorph.prototype.trigger=function(){return"function"===typeof this.target?"function"===typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"===typeof this.action?this.action.call(this.target):this.target[this.action]()};TriggerMorph.prototype.mouseEnter=function(){this.image=this.highlightImage;this.changed();if(this.hint)return this.bubbleHelp(this.hint)};
TriggerMorph.prototype.mouseLeave=function(){this.image=this.normalImage;this.changed();if(this.hint)return this.world().hand.destroyTemporaries()};TriggerMorph.prototype.mouseDownLeft=function(){this.image=this.pressImage;return this.changed()};TriggerMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage;this.changed();return this.trigger()};
TriggerMorph.prototype.bubbleHelp=function(a){var b;b=this;this.fps=2;return this.step=function(){this.bounds.containsPoint(this.world().hand.position())&&b.popUpbubbleHelp(a);b.fps=0;return delete b.step}};TriggerMorph.prototype.popUpbubbleHelp=function(a){return(new SpeechBubbleMorph(localize(a),null,null,1)).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))};MenuItemMorph=function(a){function b(a,b,e,f,g,h,j,i){this.init(a,b,e,f,g,h,j,i)}__extends(b,a);return b}(TriggerMorph);
MenuItemMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy();this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,!1,!1,!1,null,null,this.labelColor);this.silentSetExtent(this.label.extent().add(new Point(8,0)));this.label.bounds=this.position().add(new Point(4,0)).extent(this.label.extent());return this.add(this.label)};MenuItemMorph.prototype.mouseEnter=function(){this.isListItem()||(this.image=this.highlightImage,this.changed());if(this.hint)return this.bubbleHelp(this.hint)};
MenuItemMorph.prototype.mouseLeave=function(){this.isListItem()||(this.image=this.normalImage,this.changed());if(this.hint)return this.world().hand.destroyTemporaries()};MenuItemMorph.prototype.mouseDownLeft=function(a){this.isListItem()&&(this.parent.unselectAllItems(),this.escalateEvent("mouseDownLeft",a));this.image=this.pressImage;return this.changed()};MenuItemMorph.prototype.mouseMove=function(){if(this.isListItem())return this.escalateEvent("mouseMove")};
MenuItemMorph.prototype.mouseClickLeft=function(){this.isListItem()||(this.parent.destroy(),this.root().activeMenu=null);return this.trigger()};MenuItemMorph.prototype.isListItem=function(){return this.parent?this.parent.isListContents:!1};MenuItemMorph.prototype.isSelectedListItem=function(){return this.isListItem()?this.image===this.pressImage:!1};FrameMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(Morph);
FrameMorph.prototype.init=function(a){this.scrollFrame=a||null;FrameMorph.__super__.init.call(this);this.color=new Color(255,250,245);this.drawNew();this.acceptsDrops=!0;if(this.scrollFrame)return this.noticesTransparentClick=this.isDraggable=!1,this.alpha=0};FrameMorph.prototype.fullBounds=function(){var a;a=this.getShadow();return null!==a?this.bounds.merge(a.bounds):this.bounds};FrameMorph.prototype.fullImage=function(){return this.image};
FrameMorph.prototype.fullDrawOn=function(a,b){var c,d;c=this;d=void 0;if(!this.isVisible)return null;d=b||this.fullBounds();this.drawOn(a,d);return this.children.forEach(function(b){return b instanceof ShadowMorph?b.fullDrawOn(a,d):b.fullDrawOn(a,c.bounds.intersect(d))})};FrameMorph.prototype.moveBy=function(a){this.changed();this.bounds=this.bounds.translateBy(a);this.children.forEach(function(b){return b.silentMoveBy(a)});return this.changed()};
FrameMorph.prototype.submorphBounds=function(){var a;a=null;0<this.children.length&&(a=this.children[0].bounds,this.children.forEach(function(b){return a=a.merge(b.fullBounds())}));return a};
FrameMorph.prototype.keepInScrollFrame=function(){if(null===this.scrollFrame)return null;this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0));this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0));this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top()));if(this.bottom()<this.scrollFrame.bottom())return this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))};
FrameMorph.prototype.adjustBounds=function(){var a,b;b=b=void 0;a=this;if(null===this.scrollFrame)return null;b=(b=this.submorphBounds())&&!this.scrollFrame.isTextLineWrapping?b.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy();this.bounds.eq(b)||(this.bounds=b,this.drawNew(),this.keepInScrollFrame());this.scrollFrame.isTextLineWrapping&&this.children.forEach(function(b){if(b instanceof TextMorph){b.setWidth(a.width());
return a.setHeight(Math.max(b.height(),a.scrollFrame.height()))}});return this.scrollFrame.adjustScrollBars()};FrameMorph.prototype.reactToDropOf=function(){return this.adjustBounds()};FrameMorph.prototype.reactToGrabOf=function(){return this.adjustBounds()};FrameMorph.prototype.copyRecordingReferences=function(a){var b;b=FrameMorph.__super__.copyRecordingReferences.call(this,a);b.frame&&a[this.scrollFrame]&&(b.frame=a[this.scrollFrame]);return b};
FrameMorph.prototype.developersMenu=function(){var a;a=FrameMorph.__super__.developersMenu.call(this);0<this.children.length&&(a.addLine(),a.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"));return a};FrameMorph.prototype.keepAllSubmorphsWithin=function(){var a;a=this;return this.children.forEach(function(b){return b.keepWithin(a)})};BouncerMorph=function(a){function b(){this.init()}__extends(b,a);return b}(Morph);
BouncerMorph.prototype.init=function(a,b){BouncerMorph.__super__.init.call(this);this.fps=50;this.isStopped=!1;this.type=a||"vertical";this.direction="vertical"===this.type?"down":"right";return this.speed=b||1};BouncerMorph.prototype.moveUp=function(){return this.moveBy(new Point(0,-this.speed))};BouncerMorph.prototype.moveDown=function(){return this.moveBy(new Point(0,this.speed))};BouncerMorph.prototype.moveRight=function(){return this.moveBy(new Point(this.speed,0))};
BouncerMorph.prototype.moveLeft=function(){return this.moveBy(new Point(-this.speed,0))};
BouncerMorph.prototype.step=function(){if(!this.isStopped)if("vertical"===this.type){if("down"===this.direction?this.moveDown():this.moveUp(),this.fullBounds().top()<this.parent.top()&&"up"===this.direction&&(this.direction="down"),this.fullBounds().bottom()>this.parent.bottom()&&"down"===this.direction)return this.direction="up"}else if("horizontal"===this.type&&("right"===this.direction?this.moveRight():this.moveLeft(),this.fullBounds().left()<this.parent.left()&&"left"===this.direction&&(this.direction=
"right"),this.fullBounds().right()>this.parent.right()&&"right"===this.direction))return this.direction="left"};HandMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(Morph);HandMorph.prototype.init=function(a){HandMorph.__super__.init.call(this);this.bounds=new Rectangle;this.world=a;this.mouseButton=null;this.mouseOverList=[];this.grabOrigin=this.morphToGrab=this.mouseDownMorph=null;this.temporaries=[];return this.touchHoldTimeout=null};
HandMorph.prototype.changed=function(){var a;if(null!==this.world&&(a=this.fullBounds(),!a.extent().eq(new Point)))return this.world.broken.push(this.fullBounds().spread())};
HandMorph.prototype.morphAtPointer=function(){var a,b,c;a=this.world.allChildren().slice(0).reverse();b=this;c=null;a.forEach(function(a){if(a.visibleBounds().containsPoint(b.bounds.origin)&&null===c&&a.isVisible&&(a.noticesTransparentClick||!a.isTransparentAt(b.bounds.origin))&&!(a instanceof ShadowMorph))return c=a});return null!==c?c:this.world};HandMorph.prototype.allMorphsAtPointer=function(){var a,b;a=this.world.allChildren();b=this;return a.filter(function(a){return a.isVisible&&a.visibleBounds().containsPoint(b.bounds.origin)})};
HandMorph.prototype.dropTargetFor=function(a){var b;for(b=this.morphAtPointer();!b.wantsDropOf(a);)b=b.parent;return b};HandMorph.prototype.grab=function(a){var b;b=a.parent;if(a instanceof WorldMorph)return null;if(0===this.children.length&&(this.world.stopEditing(),this.grabOrigin=a.situation(),a.addShadow(),a.prepareToBeGrabbed&&a.prepareToBeGrabbed(this),this.add(a),this.changed(),b&&b.reactToGrabOf))return b.reactToGrabOf(a)};
HandMorph.prototype.drop=function(){var a,b;if(0!==this.children.length)return a=this.children[0],b=this.dropTargetFor(a),this.changed(),b.add(a),a.changed(),a.removeShadow(),this.children=[],this.setExtent(new Point),a.justDropped&&a.justDropped(this),b.reactToDropOf&&b.reactToDropOf(a,this),this.dragOrigin=null};
HandMorph.prototype.processMouseDown=function(a){var b,c;this.destroyTemporaries();this.morphToGrab=null;if(0!==this.children.length)return this.drop(),this.mouseButton=null;c=this.morphAtPointer();this.world.activeMenu&&(contains(c.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):this.world.activeMenu.destroy());this.world.activeHandle&&c!==this.world.activeHandle&&this.world.activeHandle.destroy();this.world.cursor&&c!==this.world.cursor.target&&this.world.stopEditing();
c.mouseMove||(this.morphToGrab=c.rootForGrab());2===a.button||a.ctrlKey?(this.mouseButton="right",a="mouseDownRight",b="mouseClickRight"):(this.mouseButton="left",a="mouseDownLeft",b="mouseClickLeft");for(this.mouseDownMorph=c;!this.mouseDownMorph[b];)this.mouseDownMorph=this.mouseDownMorph.parent;for(;!c[a];)c=c.parent;return c[a](this.bounds.origin)};
HandMorph.prototype.processTouchStart=function(a){var b;b=this;clearInterval(this.touchHoldTimeout);if(1===a.touches.length)return this.touchHoldTimeout=setInterval(function(){b.processMouseDown({button:2});b.processMouseUp({button:2});a.preventDefault();return clearInterval(b.touchHoldTimeout)},400),this.processMouseMove(a.touches[0]),this.processMouseDown({button:0}),a.preventDefault()};
HandMorph.prototype.processTouchMove=function(a){if(1===a.touches.length)return a=a.touches[0],this.processMouseMove(a),clearInterval(this.touchHoldTimeout)};HandMorph.prototype.processTouchEnd=function(a){clearInterval(this.touchHoldTimeout);nop(a);return this.processMouseUp({button:0})};
HandMorph.prototype.processMouseUp=function(){var a,b,c,d;d=this.morphAtPointer();this.destroyTemporaries();if(0!==this.children.length)this.drop();else{if("left"===this.mouseButton)c="mouseClickLeft";else if(c="mouseClickRight",this.mouseButton){a=d;for(b=a.contextMenu();!b&&a.parent;)a=a.parent,b=a.contextMenu();b&&b.popUpAtHand(this.world)}for(;!d[c];)d=d.parent;d[c](this.bounds.origin)}return this.mouseButton=null};HandleMorph.prototype.rootForGrab=function(){return this};
HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage;return this.changed()};HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage;return this.changed()};HandleMorph.prototype.copyRecordingReferences=function(a){var b;b=HandleMorph.__super__.copyRecordingReferences.call(this,a);b.target&&a[this.target]&&(b.target=a[this.target]);return b};
HandleMorph.prototype.attach=function(){var a,b,c;c=b=a=void 0;a=this.overlappedMorphs();b=new MenuMorph(this,"choose target:");c=this;a.forEach(function(a){return b.addItem(a.toString().slice(0,50),function(){c.isDraggable=!1;c.target=a;c.drawNew();return c.noticesTransparentClick=!0})});if(0<a.length)return b.popUpAtHand(this.world())};
HandMorph.prototype.processMouseScroll=function(a){var b;for(b=this.morphAtPointer();b&&!b.mouseScroll;)b=b.parent;if(b)return b.mouseScroll(a.detail/-3||(a.hasOwnProperty("wheelDeltaY")?a.wheelDeltaY/120:a.wheelDelta/120),a.wheelDeltaX/120||0)};
HandMorph.prototype.processDrop=function(a){var b,c,d,e,f,g,h,j,i;d=a instanceof FileList?a:a.target.files||a.dataTransfer.files;c=void 0;c=a.dataTransfer?a.dataTransfer.getData("Text/HTML"):null;a=void 0;i=this.morphAtPointer();f=new Image;e=b=void 0;h=function(a){var c,d;d=new Image;for(c=new FileReader;!i.droppedImage;)i=i.parent;d.onload=function(){b=newCanvas(new Point(d.width,d.height));b.getContext("2d").drawImage(d,0,0);return i.droppedImage(b,a.name)};c=new FileReader;c.onloadend=function(a){return d.src=
a.target.result};return c.readAsDataURL(a)};a=function(a){var b,c;c=new Audio;for(b=new FileReader;!i.droppedAudio;)i=i.parent;b.onloadend=function(b){c.src=b.target.result;return i.droppedAudio(c,a.name)};return b.readAsDataURL(a)};j=function(a){var b;for(b=new FileReader;!i.droppedText;)i=i.parent;b.onloadend=function(b){return i.droppedText(b.target.result,a.name)};return b.readAsText(a)};g=function(a){var b,c;c="";e=void 0;b=a.indexOf('<img src="');if(-1===b)return null;for(e=b+10;e<a.length;){b=
a[e];if('"'===b)return c;c=c.concat(b);e+=1}return null};if(0<d.length){e=0;for(g=[];e<d.length;)c=d[e],0===c.type.indexOf("image")?h(c):0===c.type.indexOf("audio")?a(c):0===c.type.indexOf("text")&&j(c),g.push(e+=1);return g}if(c){for(;!i.droppedImage;)i=i.parent;f=new Image;f.onload=function(){b=newCanvas(new Point(f.width,f.height));b.getContext("2d").drawImage(f,0,0);return i.droppedImage(b)};if(a=g(c))return f.src=a}};
HandMorph.prototype.destroyTemporaries=function(){this.temporaries.forEach(function(a){return a.destroy()});return this.temporaries=[]};HandMorph.prototype.moveBy=function(a){Morph.prototype.trackChanges=!1;HandMorph.__super__.moveBy.call(this,a);Morph.prototype.trackChanges=!0;return this.fullChanged()};
HandMorph.prototype.processMouseMove=function(a){var b,c,d,e,f;f=void 0;f=getDocumentPositionOf(this.world.worldCanvas);d=void 0;e=this;b=b=c=void 0;f=new Point(a.pageX-f.x,a.pageY-f.y);this.setPosition(f);d=this.morphAtPointer().allParents();if(0===this.children.length&&"left"===this.mouseButton&&(b=this.morphAtPointer(),c=b.rootForGrab(),b.mouseMove&&b.mouseMove(f),this.morphToGrab&&(this.morphToGrab.isDraggable?(c=this.morphToGrab,this.grab(c)):this.morphToGrab.isTemplate&&(c=this.morphToGrab.fullCopy(),
c.isTemplate=!1,c.isDraggable=!0,this.grab(c),this.grabOrigin=this.morphToGrab.situation()),b=c.fullBounds(),!b.containsPoint(f))))this.bounds.origin=b.center(),this.grab(c),this.setPosition(f);this.mouseOverList.forEach(function(a){if(!contains(d,a)&&(a.mouseLeave&&a.mouseLeave(),a.mouseLeaveDragging&&this.mouseButton))return a.mouseLeaveDragging()});d.forEach(function(a){contains(e.mouseOverList,a)||(a.mouseEnter&&a.mouseEnter(),a.mouseEnterDragging&&this.mouseButton&&a.mouseEnterDragging());if(0<
e.children.length&&a instanceof ScrollFrameMorph&&!a.bounds.insetBy(3*MorphicPreferences.scrollBarSize).containsPoint(e.bounds.origin))return a.startAutoScrolling()});return this.mouseOverList=d};StringFieldMorph=function(a){function b(a,b,e,f,g,h,j){this.init(a||"",b||100,e||12,f||"sans-serif",g||!1,h||!1,j)}__extends(b,a);return b}(FrameMorph);
StringFieldMorph.prototype.init=function(a,b,c,d,e,f,g){this.defaultContents=a;this.minWidth=b;this.fontSize=c;this.fontStyle=d;this.isBold=e;this.isItalic=f;this.isNumeric=g||!1;this.text=null;StringFieldMorph.__super__.init.call(this);this.color=new Color(255,255,255);this.isEditable=!0;this.acceptsDrops=!1;return this.drawNew()};
StringFieldMorph.prototype.drawNew=function(){var a;a=void 0;a=this.text?this.string():this.defaultContents;this.text=null;this.children.forEach(function(a){return a.destroy()});this.children=[];this.text=new StringMorph(a,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric);this.text.isNumeric=this.isNumeric;this.text.setPosition(this.bounds.origin.copy());this.text.isEditable=this.isEditable;this.text.isDraggable=!1;this.text.enableSelecting();this.silentSetExtent(new Point(Math.max(this.width(),
this.minWidth),this.text.height()));StringFieldMorph.__super__.drawNew.call(this);return this.add(this.text)};StringFieldMorph.prototype.string=function(){return this.text.text};StringFieldMorph.prototype.mouseClickLeft=function(){if(this.isEditable)return this.text.edit()};StringFieldMorph.prototype.copyRecordingReferences=function(a){var b;b=StringFieldMorph.__super__.copyRecordingReferences.call(this,a);b.text&&a[this.text]&&(b.text=a[this.text]);return b};
WorldMorph=function(a){function b(a,b){this.init(a,b)}__extends(b,a);return b}(FrameMorph);WorldMorph.prototype=new FrameMorph;
WorldMorph.prototype.init=function(a,b){WorldMorph.__super__.init.call(this);this.color=new Color(205,205,205);this.alpha=1;this.bounds=new Rectangle(0,0,a.width,a.height);this.drawNew();this.isVisible=!0;this.isDraggable=!1;this.currentKey=null;this.worldCanvas=a;this.useFillPage=b;void 0===this.useFillPage&&(this.useFillPage=!0);this.isDevMode=!1;this.broken=[];this.hand=new HandMorph(this);this.virtualKeyboard=this.trailsCanvas=this.activeHandle=this.activeMenu=this.cursor=this.lastEditedText=
this.keyboardReceiver=null;return this.initEventListeners()};WorldMorph.prototype.drawNew=function(){WorldMorph.__super__.drawNew.call(this);return this.trailsCanvas=newCanvas(this.extent())};WorldMorph.prototype.penTrails=function(){return this.trailsCanvas};WorldMorph.prototype.brokenFor=function(a){var b;b=a.fullBounds();return this.broken.filter(function(a){return a.intersects(b)})};
WorldMorph.prototype.fullDrawOn=function(a,b){var c,d,e,f,g,h;d=h=g=e=c=c=f=void 0;f=b||this.fullBounds();c=f.intersect(this.bounds);e=c.left();g=c.top();h=c.width();d=c.height();if(0>h||0>d)return null;c=a.getContext("2d");c.globalAlpha=1;c.fillStyle=this.color.toString();c.fillRect(e,g,h,d);this.trailsCanvas&&1<h&&1<d&&c.drawImage(this.trailsCanvas,e,g,h,d,e,g,h,d);this.children.forEach(function(b){return b.fullDrawOn(a,f)});return this.hand.fullDrawOn(a,f)};
WorldMorph.prototype.updateBroken=function(){var a;a=this;this.broken.forEach(function(b){if(b.extent().gt(new Point(0,0)))return a.fullDrawOn(a.worldCanvas,b)});return this.broken=[]};WorldMorph.prototype.doOneCycle=function(){this.stepFrame();return this.updateBroken()};
WorldMorph.prototype.fillPage=function(){var a,b,c,d;d=getDocumentPositionOf(this.worldCanvas);a=window.innerHeight;b=window.innerWidth;c=this;0<d.x&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.left="0px",d.x=0);0<d.y&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.top="0px",d.y=0);document.body.scrollTop&&(a=document.documentElement.clientHeight);document.body.scrollLeft&&(b=document.documentElement.clientWidth);this.worldCanvas.width!==b&&(this.worldCanvas.width=
b,this.setWidth(b));this.worldCanvas.height!==a&&(this.worldCanvas.height=a,this.setHeight(a));return this.children.forEach(function(a){if(a.reactToWorldResize)return a.reactToWorldResize(c.bounds.copy())})};WorldMorph.prototype.getGlobalPixelColor=function(a){a=this.worldCanvas.getContext("2d").getImageData(a.x,a.y,1,1).data;return new Color(a[0],a[1],a[2])};
WorldMorph.prototype.initVirtualKeyboard=function(){var a;a=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null);if(MorphicPreferences.useVirtualKeyboard)return this.virtualKeyboard=document.createElement("input"),this.virtualKeyboard.type="text",this.virtualKeyboard.style.color="transparent",this.virtualKeyboard.style.backgroundColor="transparent",this.virtualKeyboard.style.border="none",this.virtualKeyboard.style.outline="none",this.virtualKeyboard.style.position=
"absolute",this.virtualKeyboard.style.top="0px",this.virtualKeyboard.style.left="0px",this.virtualKeyboard.style.width="0px",this.virtualKeyboard.style.height="0px",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener("keydown",function(b){a.currentKey=b.keyCode;a.keyboardReceiver&&a.keyboardReceiver.processKeyDown(b);(b.keyIdentifier==="U+0008"||b.keyIdentifier==="Backspace")&&b.preventDefault();if(b.keyIdentifier==="U+0009"||b.keyIdentifier==="Tab"){a.keyboardReceiver&&
a.keyboardReceiver.processKeyPress(b);return b.preventDefault()}},!1),this.virtualKeyboard.addEventListener("keyup",function(b){a.currentKey=null;a.keyboardReceiver&&a.keyboardReceiver.processKeyUp&&a.keyboardReceiver.processKeyUp(b);return b.preventDefault()},!1),this.virtualKeyboard.addEventListener("keypress",function(b){a.keyboardReceiver&&a.keyboardReceiver.processKeyPress(b);return b.preventDefault()},!1)};
WorldMorph.prototype.initEventListeners=function(){var a,b;a=this.worldCanvas;b=this;b.useFillPage?b.fillPage():this.changed();a.addEventListener("mousedown",function(a){return b.hand.processMouseDown(a)},!1);a.addEventListener("touchstart",function(a){return b.hand.processTouchStart(a)},!1);a.addEventListener("mouseup",function(a){a.preventDefault();return b.hand.processMouseUp(a)},!1);a.addEventListener("touchend",function(a){return b.hand.processTouchEnd(a)},!1);a.addEventListener("mousemove",
function(a){return b.hand.processMouseMove(a)},!1);a.addEventListener("touchmove",function(a){return b.hand.processTouchMove(a)},!1);a.addEventListener("contextmenu",function(a){return a.preventDefault()},!1);a.addEventListener("keydown",function(a){b.currentKey=a.keyCode;b.keyboardReceiver&&b.keyboardReceiver.processKeyDown(a);("U+0008"===a.keyIdentifier||"Backspace"===a.keyIdentifier)&&a.preventDefault();if("U+0009"===a.keyIdentifier||"Tab"===a.keyIdentifier)return b.keyboardReceiver&&b.keyboardReceiver.processKeyPress(a),
a.preventDefault()},!1);a.addEventListener("keyup",function(a){b.currentKey=null;b.keyboardReceiver&&b.keyboardReceiver.processKeyUp&&b.keyboardReceiver.processKeyUp(a);return a.preventDefault()},!1);a.addEventListener("keypress",function(a){b.keyboardReceiver&&b.keyboardReceiver.processKeyPress(a);return a.preventDefault()},!1);a.addEventListener("mousewheel",function(a){b.hand.processMouseScroll(a);return a.preventDefault()},!1);a.addEventListener("DOMMouseScroll",function(a){b.hand.processMouseScroll(a);
return a.preventDefault()},!1);window.addEventListener("dragover",function(a){return a.preventDefault()},!1);window.addEventListener("drop",function(a){b.hand.processDrop(a);return a.preventDefault()},!1);window.addEventListener("resize",function(){if(b.useFillPage)return b.fillPage()},!1);return window.onbeforeunload=function(a){if(a=a||window.event)a.returnValue="Are you sure you want to leave?";return"Are you sure you want to leave?"}};WorldMorph.prototype.mouseDownLeft=function(){return nop()};
WorldMorph.prototype.mouseClickLeft=function(){return nop()};WorldMorph.prototype.mouseDownRight=function(){return nop()};WorldMorph.prototype.mouseClickRight=function(){return nop()};WorldMorph.prototype.wantsDropOf=function(){return this.acceptsDrops};WorldMorph.prototype.droppedImage=function(){return null};WorldMorph.prototype.nextTab=function(a){var b;b=this.nextEntryField(a);a.clearSelection();b.selectAll();return b.edit()};
WorldMorph.prototype.previousTab=function(a){var b;b=this.previousEntryField(a);a.clearSelection();b.selectAll();return b.edit()};
WorldMorph.prototype.contextMenu=function(){var a;a=void 0;a=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]):new MenuMorph(this,"Morphic");this.isDevMode&&(a.addItem("demo...","userCreateMorph","sample morphs"),a.addLine(),a.addItem("hide all...","hideAll"),a.addItem("show all...","showAllHiddens"),a.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"),a.addItem("inspect...","inspect","open a window on\nall properties"),
a.addLine(),a.addItem("restore display","changed","redraw the\nscreen once"),a.addItem("fill page...","fillPage","let the World automatically\nadjust to browser resizings"),useBlurredShadows?a.addItem("sharp shadows...","toggleBlurredShadows","sharp drop shadows\nuse for old browsers"):a.addItem("blurred shadows...","toggleBlurredShadows","blurry shades,\n use for new browsers"),a.addItem("color...",function(){return this.pickColor(a.title+"\ncolor:",this.setColor,this,this.color)},"choose the World's\nbackground color"),
MorphicPreferences===standardSettings?a.addItem("touch screen settings","togglePreferences","bigger menu fonts\nand sliders"):a.addItem("standard settings","togglePreferences","smaller menu fonts\nand sliders"),a.addLine());this.isDevMode?a.addItem("user mode...","toggleDevMode","disable developers'\ncontext menus"):a.addItem("development mode...","toggleDevMode");a.addItem("about morphic.js...","about");return a};
WorldMorph.prototype.userCreateMorph=function(){var a,b,c,d;a=function(a){a.isDraggable=!0;return a.pickUp(c)};c=this;d=b=void 0;b=new MenuMorph(this,"make a morph");b.addItem("rectangle",function(){return a(new Morph)});b.addItem("box",function(){return a(new BoxMorph)});b.addItem("circle box",function(){return a(new CircleBoxMorph)});b.addLine();b.addItem("slider",function(){return a(new SliderMorph)});b.addItem("frame",function(){d=new FrameMorph;d.setExtent(new Point(350,250));return a(d)});b.addItem("scroll frame",
function(){d=new ScrollFrameMorph;d.contents.acceptsDrops=!0;d.contents.adjustBounds();d.setExtent(new Point(350,250));return a(d)});b.addItem("handle",function(){return a(new HandleMorph)});b.addLine();b.addItem("string",function(){d=new StringMorph("Hello, World!");d.isEditable=!0;return a(d)});b.addItem("text",function(){d=new TextMorph("Ich wei\u00df nicht, was soll es bedeuten, dass ich so traurig bin, ein M\u00e4rchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist k\u00fchl und es dunkelt, und ruhig flie\u00dft der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die sch\u00f6nste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie k\u00e4mmt ihr goldenes Haar, sie k\u00e4mmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die H\u00f6h'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan.");
d.isEditable=!0;d.maxWidth=300;d.drawNew();return a(d)});b.addItem("speech bubble",function(){d=new SpeechBubbleMorph("Hello, World!");return a(d)});b.addLine();b.addItem("gray scale palette",function(){return a(new GrayPaletteMorph)});b.addItem("color palette",function(){return a(new ColorPaletteMorph)});b.addItem("color picker",function(){return a(new ColorPickerMorph)});b.addLine();b.addItem("sensor demo",function(){d=new MouseSensorMorph;d.setColor(new Color(230,200,100));d.edge=35;d.border=15;
d.borderColor=new Color(200,100,50);d.alpha=0.2;d.setExtent(new Point(100,100));return a(d)});b.addItem("animation demo",function(){var b,c,d,h,j;d=new BouncerMorph;d.setPosition(new Point(50,20));d.setExtent(new Point(300,200));d.alpha=0.9;d.speed=3;b=new BouncerMorph;b.setColor(new Color(50,50,50));b.setPosition(new Point(80,80));b.setExtent(new Point(80,250));b.type="horizontal";b.direction="right";b.alpha=0.9;b.speed=5;c=new BouncerMorph;c.setColor(new Color(20,20,20));c.setPosition(new Point(90,
140));c.setExtent(new Point(40,30));c.type="horizontal";c.direction="right";c.speed=3;j=new BouncerMorph;j.setColor(new Color(200,20,20));j.setPosition(new Point(90,140));j.setExtent(new Point(20,20));j.type="vertical";j.direction="up";j.speed=8;h=new BouncerMorph;h.setColor(new Color(20,200,20));h.setPosition(new Point(120,140));h.setExtent(new Point(20,20));h.type="vertical";h.direction="down";h.speed=4;b.add(j);b.add(c);d.add(h);d.add(b);return a(d)});b.addItem("pen",function(){return a(new PenMorph)});
c.customMorphs&&(b.addLine(),c.customMorphs().forEach(function(c){return b.addItem(c.toString(),function(){return a(c)})}));return b.popUpAtHand(this)};WorldMorph.prototype.toggleDevMode=function(){return this.isDevMode=!this.isDevMode};WorldMorph.prototype.hideAll=function(){return this.children.forEach(function(a){return a.hide()})};WorldMorph.prototype.showAllHiddens=function(){return this.forAllChildren(function(a){if(!a.isVisible)return a.show()})};
WorldMorph.prototype.about=function(){var a,b;b="";a=void 0;for(a in modules)modules.hasOwnProperty(a)&&(b+="\n"+a+" ("+modules[a]+")");""!==b&&(b="\n\nmodules:\n\nmorphic ("+morphicVersion+")"+b);return this.inform("morphic.js\n\na lively Web GUI\ninspired by Squeak\n"+morphicVersion+"\n\nwritten by Jens M\u00f6nig\njens@moenig.org"+b)};
WorldMorph.prototype.edit=function(a){var b;b=getDocumentPositionOf(this.worldCanvas);if(!a.isEditable)return null;this.cursor&&this.cursor.destroy();this.lastEditedText&&this.lastEditedText.clearSelection();this.cursor=new CursorMorph(a);a.parent.add(this.cursor);this.keyboardReceiver=this.cursor;this.initVirtualKeyboard();MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+b.y+"px",this.virtualKeyboard.style.left=this.cursor.left()+b.x+"px",this.virtualKeyboard.focus());
if(MorphicPreferences.useSliderForInput&&!a.parentThatIsA(MenuMorph))return this.slide(a)};
WorldMorph.prototype.slide=function(a){var b,c,d;d=parseFloat(a.text);c=b=void 0;isNaN(d)&&(d=0);b=new MenuMorph;c=new SliderMorph(d-25,d+25,d,10,"horizontal");c.alpha=1;c.color=new Color(225,225,225);c.button.color=b.borderColor;c.button.highlightColor=c.button.color.copy();c.button.highlightColor.b+=100;c.button.pressColor=c.button.color.copy();c.button.pressColor.b+=150;c.silentSetHeight(MorphicPreferences.scrollBarSize);c.silentSetWidth(10*MorphicPreferences.menuFontSize);c.drawNew();c.action=
function(b){a.changed();a.text=Math.round(b).toString();a.drawNew();return a.changed()};b.items.push(c);return b.popup(this,a.bottomLeft().add(new Point(0,5)))};
WorldMorph.prototype.stopEditing=function(){this.cursor&&(this.lastEditedText=this.cursor.target,this.cursor.destroy(),this.lastEditedText.escalateEvent("reactToEdit",this.lastEditedText));this.keyboardReceiver=null;this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null);return this.worldCanvas.focus()};WorldMorph.prototype.toggleBlurredShadows=function(){return useBlurredShadows=!useBlurredShadows};
WorldMorph.prototype.togglePreferences=function(){return MorphicPreferences===standardSettings?MorphicPreferences=touchScreenSettings:MorphicPreferences=standardSettings};SliderButtonMorph=function(a){function b(a){this.init(a)}__extends(b,a);return b}(CircleBoxMorph);
SliderButtonMorph.prototype.init=function(a){this.color=new Color(80,80,80);this.highlightColor=new Color(90,90,140);this.pressColor=new Color(80,80,160);this.hasMiddleDip=this.is3D=!0;return SliderButtonMorph.__super__.init.call(this,a)};SliderButtonMorph.prototype.autoOrientation=function(){return nop()};
SliderButtonMorph.prototype.drawNew=function(){var a;a=this.color.copy();SliderButtonMorph.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.normalImage=this.image;this.color=this.highlightColor.copy();SliderButtonMorph.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.highlightImage=this.image;this.color=this.pressColor.copy();SliderButtonMorph.__super__.drawNew.call(this);this.is3D&&this.drawEdges();this.pressImage=this.image;this.color=a;return this.image=this.normalImage};
SliderButtonMorph.prototype.drawEdges=function(){var a,b,c,d,e;a=this.image.getContext("2d");e=this.width();c=this.height();a.lineJoin="round";a.lineCap="round";if("vertical"===this.orientation){if(a.lineWidth=e/3,b=a.createLinearGradient(0,0,a.lineWidth,0),b.addColorStop(0,"white"),b.addColorStop(1,this.color.toString()),a.strokeStyle=b,a.beginPath(),a.moveTo(0.5*a.lineWidth,e/2),a.lineTo(0.5*a.lineWidth,c-e/2),a.stroke(),b=a.createLinearGradient(e-a.lineWidth,0,e,0),b.addColorStop(0,this.color.toString()),
b.addColorStop(1,"black"),a.strokeStyle=b,a.beginPath(),a.moveTo(e-0.5*a.lineWidth,e/2),a.lineTo(e-0.5*a.lineWidth,c-e/2),a.stroke(),this.hasMiddleDip)return b=a.createLinearGradient(a.lineWidth,0,e-a.lineWidth,0),d=e/4,b.addColorStop(0,"black"),b.addColorStop(0.35,this.color.toString()),b.addColorStop(0.65,this.color.toString()),b.addColorStop(1,"white"),a.fillStyle=b,a.beginPath(),a.arc(e/2,c/2,d,radians(0),radians(360),!1),a.closePath(),a.fill()}else if("horizontal"===this.orientation&&(a.lineWidth=
c/3,b=a.createLinearGradient(0,0,0,a.lineWidth),b.addColorStop(0,"white"),b.addColorStop(1,this.color.toString()),a.strokeStyle=b,a.beginPath(),a.moveTo(c/2,0.5*a.lineWidth),a.lineTo(e-c/2,0.5*a.lineWidth),a.stroke(),b=a.createLinearGradient(0,c-a.lineWidth,0,c),b.addColorStop(0,this.color.toString()),b.addColorStop(1,"black"),a.strokeStyle=b,a.beginPath(),a.moveTo(c/2,c-0.5*a.lineWidth),a.lineTo(e-c/2,c-0.5*a.lineWidth),a.stroke(),this.hasMiddleDip))return b=a.createLinearGradient(0,a.lineWidth,
0,c-a.lineWidth),d=c/4,b.addColorStop(0,"black"),b.addColorStop(0.35,this.color.toString()),b.addColorStop(0.65,this.color.toString()),b.addColorStop(1,"white"),a.fillStyle=b,a.beginPath(),a.arc(this.width()/2,this.height()/2,d,radians(0),radians(360),!1),a.closePath(),a.fill()};SliderButtonMorph.prototype.mouseEnter=function(){this.image=this.highlightImage;return this.changed()};SliderButtonMorph.prototype.mouseLeave=function(){this.image=this.normalImage;return this.changed()};
SliderButtonMorph.prototype.mouseDownLeft=function(a){this.image=this.pressImage;this.changed();return this.escalateEvent("mouseDownLeft",a)};SliderButtonMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage;return this.changed()};SliderButtonMorph.prototype.mouseMove=function(){return nop()};SliderMorph=function(a){function b(a,b,e,f,g,h){this.init(a||1,b||100,e||50,f||10,g||"vertical",h)}__extends(b,a);return b}(CircleBoxMorph);
SliderMorph.prototype.init=function(a,b,c,d,e,f){this.action=this.target=null;this.start=a;this.stop=b;this.value=c;this.size=d;this.offset=null;this.button=new SliderButtonMorph;this.button.isDraggable=!1;this.button.color=new Color(200,200,200);this.button.highlightColor=new Color(210,210,255);this.button.pressColor=new Color(180,180,255);SliderMorph.__super__.init.call(this,e);this.add(this.button);this.alpha=0.3;this.color=f||new Color(0,0,0);return this.setExtent(new Point(20,100))};
SliderMorph.prototype.autoOrientation=function(){return nop()};SliderMorph.prototype.rangeSize=function(){return this.stop-this.start};SliderMorph.prototype.ratio=function(){return this.size/this.rangeSize()};SliderMorph.prototype.unitSize=function(){return"vertical"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-this.button.width())/this.rangeSize()};
SliderMorph.prototype.drawNew=function(){var a,b;SliderMorph.__super__.drawNew.call(this);this.button.orientation=this.orientation;"vertical"===this.orientation?(b=this.width()-2,a=Math.max(b,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(b,a)),a=1,b=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(a=this.height()-2,b=Math.max(a,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(b,a)),b=1,a=
Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width()));this.button.setPosition((new Point(a,b)).add(this.bounds.origin));this.button.drawNew();return this.button.changed()};SliderMorph.prototype.updateValue=function(){var a;a="vertical"===this.orientation?this.button.top()-this.top():this.button.left()-this.left();this.value=Math.round(a/this.unitSize()+this.start);return this.updateTarget()};
SliderMorph.prototype.updateTarget=function(){if(this.action)return"function"===typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value)};SliderMorph.prototype.copyRecordingReferences=function(a){var b;b=SliderMorph.__super__.copyRecordingReferences.call(this,a);b.target&&a[this.target]&&(b.target=a[this.target]);b.button&&a[this.button]&&(b.button=a[this.button]);return b};
SliderMorph.prototype.developersMenu=function(){var a;a=SliderMorph.__super__.developersMenu.call(this);a.addItem("show value...","showValue","display a dialog box\nshowing the selected number");a.addItem("floor...",function(){return this.prompt(a.title+"\nfloor:",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)},"set the minimum value\nwhich can be selected");a.addItem("ceiling...",function(){return this.prompt(a.title+"\nceiling:",this.setStop,this,this.stop.toString(),null,
this.start+this.size,100*this.size,!0)},"set the maximum value\nwhich can be selected");a.addItem("button size...",function(){return this.prompt(a.title+"\nbutton size:",this.setSize,this,this.size.toString(),null,1,this.stop-this.start,!0)},"set the range\ncovered by\nthe slider button");a.addLine();a.addItem("set target","setTarget","select another morph\nwhose numerical property\nwill be controlled by this one");return a};SliderMorph.prototype.showValue=function(){return this.inform(this.value)};
SliderMorph.prototype.userSetStart=function(a){return this.start=Math.max(a,this.stop)};SliderMorph.prototype.setStart=function(a){"number"===typeof a?this.start=Math.min(Math.max(a,0),this.stop-this.size):(a=parseFloat(a),isNaN(a)||(this.start=Math.min(Math.max(a,0),this.stop-this.size)));this.value=Math.max(this.value,this.start);this.updateTarget();this.drawNew();return this.changed()};
SliderMorph.prototype.setStop=function(a){"number"===typeof a?this.stop=Math.max(a,this.start+this.size):(a=parseFloat(a),isNaN(a)||(this.stop=Math.max(a,this.start+this.size)));this.value=Math.min(this.value,this.stop);this.updateTarget();this.drawNew();return this.changed()};
SliderMorph.prototype.setSize=function(a){"number"===typeof a?this.size=Math.min(Math.max(a,1),this.stop-this.start):(a=parseFloat(a),isNaN(a)||(this.size=Math.min(Math.max(a,1),this.stop-this.start)));this.value=Math.min(this.value,this.stop-this.size);this.updateTarget();this.drawNew();return this.changed()};
SliderMorph.prototype.setTarget=function(){var a,b,c;a=this.overlappedMorphs();b=new MenuMorph(this,"choose target:");c=this;a.push(this.world());a.forEach(function(a){return b.addItem(a.toString().slice(0,50),function(){c.target=a;return c.setTargetSetter()})});if(1===a.length)return this.target=a[0],this.setTargetSetter();if(0<a.length)return b.popUpAtHand(this.world())};
SliderMorph.prototype.setTargetSetter=function(){var a,b,c;a=this.target.numericalSetters();b=new MenuMorph(this,"choose target property:");c=this;a.forEach(function(a){return b.addItem(a,function(){return c.action=a})});if(1===a.length)return this.action=a[0];if(0<a.length)return b.popUpAtHand(this.world())};SliderMorph.prototype.numericalSetters=function(){var a;a=SliderMorph.__super__.numericalSetters.call(this);a.push("setStart","setStop","setSize");return a};SliderMorph.prototype.step=null;
SliderMorph.prototype.mouseDownLeft=function(a){var b,c;c=void 0;b=this;this.offset=this.button.bounds.containsPoint(a)?a.subtract(this.button.bounds.origin):new Point;c=this.root();return this.step=function(){var a,e,f;return c.hand.mouseButton?(a=c.hand.bounds.origin,"vertical"===b.orientation?(e=b.button.bounds.origin.x,f=Math.max(Math.min(a.y-b.offset.y,b.bottom()-b.button.height()),b.top())):(f=b.button.bounds.origin.y,e=Math.max(Math.min(a.x-b.offset.x,b.right()-b.button.width()),b.left())),
b.button.setPosition(new Point(e,f)),b.updateValue()):this.step=null}};ScrollFrameMorph=function(a){function b(a,b,e){this.init(a,b,e)}__extends(b,a);return b}(FrameMorph);
ScrollFrameMorph.prototype.init=function(a,b,c){var d;d=this;ScrollFrameMorph.__super__.init.call(this);this.scrollBarSize=b||MorphicPreferences.scrollBarSize;this.autoScrollTrigger=null;this.hasVelocity=this.isScrollingByDragging=!0;this.growth=this.padding=0;this.isTextLineWrapping=!1;this.contents=a||new FrameMorph(this);this.add(this.contents);this.hBar=new SliderMorph(null,null,null,null,"horizontal",c);this.hBar.setHeight(this.scrollBarSize);this.hBar.action=function(a){return d.contents.setPosition(new Point(d.left()-
a,d.contents.position().y))};this.hBar.isDraggable=!1;this.add(this.hBar);this.vBar=new SliderMorph(null,null,null,null,"vertical",c);this.vBar.setWidth(this.scrollBarSize);this.vBar.action=function(a){return d.contents.setPosition(new Point(d.contents.position().x,d.top()-a))};this.vBar.isDraggable=!1;return this.add(this.vBar)};
ScrollFrameMorph.prototype.adjustScrollBars=function(){var a,b;a=this.width()-this.scrollBarSize;b=this.height()-this.scrollBarSize;this.changed();this.contents.width()>this.width()+MorphicPreferences.scrollBarSize?(this.hBar.show(),this.hBar.width()!==a&&this.hBar.setWidth(a),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width(),this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=
this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide();return this.contents.height()>this.height()+this.scrollBarSize?(this.vBar.show(),this.vBar.height()!==b&&this.vBar.setHeight(b),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height(),this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide()};
ScrollFrameMorph.prototype.addContents=function(a){this.contents.add(a);return this.contents.adjustBounds()};ScrollFrameMorph.prototype.setContents=function(a){this.contents.children.forEach(function(a){return a.destroy()});this.contents.children=[];a.setPosition(this.position().add(new Point(2,2)));return this.addContents(a)};
ScrollFrameMorph.prototype.setExtent=function(a){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy());ScrollFrameMorph.__super__.setExtent.call(this,a);return this.contents.adjustBounds()};ScrollFrameMorph.prototype.scrollX=function(a){var b,c,d,e;b=this.contents.left();d=this.left();c=this.contents.width();e=this.right();a=b+a;a>d&&(a=d);a+c<e&&(a=e-c);if(a!==b)return this.contents.setLeft(a)};
ScrollFrameMorph.prototype.scrollY=function(a){var b,c,d,e;d=this.contents.top();e=this.top();c=this.contents.height();b=this.bottom();a=d+a;a>e&&(a=e);a+c<b&&(a=b-c);if(a!==d)return this.contents.setTop(a)};ScrollFrameMorph.prototype.step=function(){return nop()};
ScrollFrameMorph.prototype.mouseDownLeft=function(a){var b,c,d,e,f;if(!this.isScrollingByDragging)return null;f=this.root();e=a;d=this;c=b=0;return this.step=function(){var a;a=void 0;f.hand.mouseButton&&0===f.hand.children.length&&d.bounds.containsPoint(f.hand.position())?(a=f.hand.bounds.origin,b=a.x-e.x,0!==b&&d.scrollX(b),c=a.y-e.y,0!==c&&d.scrollY(c),e=a):d.hasVelocity?0.5>Math.abs(b)&&0.5>Math.abs(c)?d.step=function(){return nop()}:(b*=0.8,d.scrollX(Math.round(b)),c*=0.8,d.scrollY(Math.round(c))):
d.step=function(){return nop()};return this.adjustScrollBars()}};
ScrollFrameMorph.prototype.startAutoScrolling=function(){var a,b,c,d,e,f;d=this;c=3*MorphicPreferences.scrollBarSize;f=this.world();e=b=a=void 0;if(!f)return null;a=f.hand;this.autoScrollTrigger||(this.autoScrollTrigger=Date.now());return this.step=function(){e=a.bounds.origin;b=d.bounds.insetBy(c);if(d.bounds.containsPoint(e)&&!b.containsPoint(e)&&a.children.length>0)return d.autoScroll(e);d.step=function(){return nop()};return d.autoScrollTrigger=null}};
ScrollFrameMorph.prototype.autoScroll=function(a){var b,c;if(500>Date.now()-this.autoScrollTrigger)return null;c=3*MorphicPreferences.scrollBarSize;b=this.topLeft().extent(new Point(this.width(),c));b.containsPoint(a)&&this.scrollY(c-(a.y-this.top()));b=this.topLeft().extent(new Point(c,this.height()));b.containsPoint(a)&&this.scrollX(c-(a.x-this.left()));b=(new Point(this.right()-c,this.top())).extent(new Point(c,this.height()));b.containsPoint(a)&&this.scrollX(-(c-(this.right()-a.x)));b=(new Point(this.left(),
this.bottom()-c)).extent(new Point(this.width(),c));b.containsPoint(a)&&this.scrollY(-(c-(this.bottom()-a.y)));return this.adjustScrollBars()};ScrollFrameMorph.prototype.mouseScroll=function(a,b){a&&this.scrollY(a*MorphicPreferences.mouseScrollAmount);b&&this.scrollX(b*MorphicPreferences.mouseScrollAmount);return this.adjustScrollBars()};
ScrollFrameMorph.prototype.copyRecordingReferences=function(a){var b;b=ScrollFrameMorph.__super__.copyRecordingReferences.call(this,a);b.contents&&a[this.contents]&&(b.contents=a[this.contents]);b.hBar&&a[this.hBar]&&(b.hBar=a[this.hBar],b.hBar.action=function(a){return b.contents.setPosition(new Point(b.left()-a,b.contents.position().y))});b.vBar&&a[this.vBar]&&(b.vBar=a[this.vBar],b.vBar.action=function(a){return b.contents.setPosition(new Point(b.contents.position().x,b.top()-a))});return b};
ScrollFrameMorph.prototype.developersMenu=function(){var a;a=ScrollFrameMorph.__super__.developersMenu.call(this);this.isTextLineWrapping?a.addItem("auto line wrap off...","toggleTextLineWrapping","turn automatic\nline wrapping\noff"):a.addItem("auto line wrap on...","toggleTextLineWrapping","enable automatic\nline wrapping");return a};ScrollFrameMorph.prototype.toggleTextLineWrapping=function(){return this.isTextLineWrapping=!this.isTextLineWrapping};
ListMorph=function(a){function b(a,b,e){this.init(a||[],b||function(a){return isString(a)?a:a.toSource?a.toSource():a.toString()},e||[])}__extends(b,a);return b}(ScrollFrameMorph);ListMorph.prototype.init=function(a,b,c){ListMorph.__super__.init.call(this);this.contents.acceptsDrops=!1;this.color=new Color(255,255,255);this.hBar.alpha=0.6;this.vBar.alpha=0.6;this.elements=a||[];this.labelGetter=b;this.format=c;this.action=this.selected=this.listContents=null;this.acceptsDrops=!1;return this.buildListContents()};
ListMorph.prototype.buildListContents=function(){var a;a=this;this.listContents&&this.listContents.destroy();this.listContents=new MenuMorph(this.select,null,this);0===this.elements.length&&(this.elements=["(empty)"]);this.elements.forEach(function(b){var c;c=null;a.format.forEach(function(a){if(a[1].call(null,b))return c=a[0]});return a.listContents.addItem(a.labelGetter(b),b,null,c)});this.listContents.setPosition(this.contents.position());this.listContents.isListContents=!0;this.listContents.drawNew();
return this.addContents(this.listContents)};ListMorph.prototype.select=function(a){this.selected=a;if(this.action)return this.action.call(null,a)};
ListMorph.prototype.setExtent=function(a){var b,c;b=this.listContents.bounds;c=this.bounds.origin.copy().corner(this.bounds.origin.add(a));c.right()>b.right()&&c.width()<=b.width()&&this.listContents.setRight(c.right());c.bottom()>b.bottom()&&c.height()<=b.height()&&this.listContents.setBottom(c.bottom());return ListMorph.__super__.setExtent.call(this,a)};
