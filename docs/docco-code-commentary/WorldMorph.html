<!DOCTYPE html>  <html> <head>   <title>WorldMorph.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="BlinkerMorph.html">                 BlinkerMorph.coffee               </a>                                           <a class="source" href="BouncerMorph.html">                 BouncerMorph.coffee               </a>                                           <a class="source" href="BoxMorph.html">                 BoxMorph.coffee               </a>                                           <a class="source" href="CaretMorph.html">                 CaretMorph.coffee               </a>                                           <a class="source" href="CircleBoxMorph.html">                 CircleBoxMorph.coffee               </a>                                           <a class="source" href="CloseCircleButtonMorph.html">                 CloseCircleButtonMorph.coffee               </a>                                           <a class="source" href="Color.html">                 Color.coffee               </a>                                           <a class="source" href="ColorPaletteMorph.html">                 ColorPaletteMorph.coffee               </a>                                           <a class="source" href="ColorPickerMorph.html">                 ColorPickerMorph.coffee               </a>                                           <a class="source" href="FrameMorph.html">                 FrameMorph.coffee               </a>                                           <a class="source" href="GrayPaletteMorph.html">                 GrayPaletteMorph.coffee               </a>                                           <a class="source" href="HandMorph.html">                 HandMorph.coffee               </a>                                           <a class="source" href="HandleMorph.html">                 HandleMorph.coffee               </a>                                           <a class="source" href="InspectorMorph.html">                 InspectorMorph.coffee               </a>                                           <a class="source" href="ListMorph.html">                 ListMorph.coffee               </a>                                           <a class="source" href="MenuItemMorph.html">                 MenuItemMorph.coffee               </a>                                           <a class="source" href="MenuMorph.html">                 MenuMorph.coffee               </a>                                           <a class="source" href="Morph.html">                 Morph.coffee               </a>                                           <a class="source" href="MorphicNode.html">                 MorphicNode.coffee               </a>                                           <a class="source" href="MorphsListMorph.html">                 MorphsListMorph.coffee               </a>                                           <a class="source" href="MouseSensorMorph.html">                 MouseSensorMorph.coffee               </a>                                           <a class="source" href="Mousetrap.html">                 Mousetrap.coffee               </a>                                           <a class="source" href="PenMorph.html">                 PenMorph.coffee               </a>                                           <a class="source" href="Point.html">                 Point.coffee               </a>                                           <a class="source" href="Point2.html">                 Point2.coffee               </a>                                           <a class="source" href="Rectangle.html">                 Rectangle.coffee               </a>                                           <a class="source" href="RectangleMorph.html">                 RectangleMorph.coffee               </a>                                           <a class="source" href="ScrollFrameMorph.html">                 ScrollFrameMorph.coffee               </a>                                           <a class="source" href="ShadowMorph.html">                 ShadowMorph.coffee               </a>                                           <a class="source" href="SliderButtonMorph.html">                 SliderButtonMorph.coffee               </a>                                           <a class="source" href="SliderMorph.html">                 SliderMorph.coffee               </a>                                           <a class="source" href="SpeechBubbleMorph.html">                 SpeechBubbleMorph.coffee               </a>                                           <a class="source" href="StringFieldMorph.html">                 StringFieldMorph.coffee               </a>                                           <a class="source" href="StringMorph.html">                 StringMorph.coffee               </a>                                           <a class="source" href="SystemTest_SimpleMenuTest.html">                 SystemTest_SimpleMenuTest.coffee               </a>                                           <a class="source" href="SystemTestsRecorderAndPlayer.html">                 SystemTestsRecorderAndPlayer.coffee               </a>                                           <a class="source" href="TextMorph.html">                 TextMorph.coffee               </a>                                           <a class="source" href="TriggerMorph.html">                 TriggerMorph.coffee               </a>                                           <a class="source" href="WorkspaceMorph.html">                 WorkspaceMorph.coffee               </a>                                           <a class="source" href="WorldMorph.html">                 WorldMorph.coffee               </a>                                           <a class="source" href="globalFunctions.html">                 globalFunctions.coffee               </a>                                           <a class="source" href="globalSettings.html">                 globalSettings.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               WorldMorph.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>WorldMorph //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>these comments below needed to figure our dependencies between classes
REQUIRES globalFunctions
REQUIRES globalSettings</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>I represent the <canvas> element</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">WorldMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>these variables shouldn't be static to the WorldMorph, because
in pure theory you could have multiple worlds in the same
page with different settings
(but anyways, it was global before, so it's not any worse than before)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@MorphicPreferences: </span><span class="nx">standardSettings</span>
  <span class="vi">@currentTime: </span><span class="kc">null</span>
  <span class="vi">@showRedraws: </span><span class="kc">false</span>
  <span class="nv">systemTestsRecorderAndPlayer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(aCanvas, fillPage) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="c1"># (130, 130, 130)</span>
    <span class="vi">@alpha = </span><span class="mi">1</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="vi">@isVisible = </span><span class="kc">true</span>
    <span class="vi">@isDraggable = </span><span class="kc">false</span>
    <span class="vi">@worldCanvas = </span><span class="nx">aCanvas</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@stamp = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="c1"># reference in multi-world setups</span>
    <span class="vi">@useFillPage = </span><span class="nx">fillPage</span>
    <span class="vi">@useFillPage = </span><span class="kc">true</span>  <span class="k">if</span> <span class="nx">@useFillPage</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    <span class="vi">@isDevMode = </span><span class="kc">false</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
    <span class="vi">@hand = </span><span class="k">new</span> <span class="nx">HandMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="vi">@keyboardEventsReceiver = </span><span class="kc">null</span>
    <span class="vi">@lastEditedText = </span><span class="kc">null</span>
    <span class="vi">@caret = </span><span class="kc">null</span>
    <span class="vi">@activeMenu = </span><span class="kc">null</span>
    <span class="vi">@activeHandle = </span><span class="kc">null</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@initEventListeners</span><span class="p">()</span>
    <span class="vi">@systemTestsRecorderAndPlayer = </span><span class="k">new</span> <span class="nx">SystemTestsRecorderAndPlayer</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">@hand</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>World Morph display:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">brokenFor: </span><span class="nf">(aMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">()</span>
    <span class="nx">@broken</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(rect) -&gt;</span>
      <span class="nx">rect</span><span class="p">.</span><span class="nx">intersects</span> <span class="nx">fb</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>all fullDraws result into actual blittings of images done
by the blit function.
The blit function is defined in Morph and is not overriden by
any morph.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">recursivelyBlit: </span><span class="nf">(aCanvas, aRect) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>invokes the Morph's recursivelyBlit, which has only two implementations:
the default one by Morph which just invokes the blit of all children
and the interesting one in FrameMorph which </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>the mouse cursor is always drawn on top of everything
and it'd not attached to the WorldMorph.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@hand</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span>
  
  <span class="nv">updateBroken: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>console.log "number of broken rectangles: " + @broken.length</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@broken</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(rect) =&gt;</span>
      <span class="nx">@recursivelyBlit</span> <span class="nx">@worldCanvas</span><span class="p">,</span> <span class="nx">rect</span>  <span class="k">if</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">()</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
  
  <span class="nv">doOneCycle: </span><span class="nf">-&gt;</span>
    <span class="nv">WorldMorph.currentTime = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="nx">@runChildrensStepFunction</span><span class="p">()</span>
    <span class="nx">@updateBroken</span><span class="p">()</span>
  
  <span class="nv">fillPage: </span><span class="nf">-&gt;</span>
    <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
    <span class="nv">clientHeight = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
    <span class="nv">clientWidth = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.left = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.x = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.top = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.y = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>scrolled down b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientHeight = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>scrolled left b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientWidth = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">isnt</span> <span class="nx">clientWidth</span>
      <span class="vi">@worldCanvas.width = </span><span class="nx">clientWidth</span>
      <span class="nx">@setWidth</span> <span class="nx">clientWidth</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">isnt</span> <span class="nx">clientHeight</span>
      <span class="vi">@worldCanvas.height = </span><span class="nx">clientHeight</span>
      <span class="nx">@setHeight</span> <span class="nx">clientHeight</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) =&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span>
  
  
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>WorldMorph global pixel access:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getGlobalPixelColor: </span><span class="nf">(point) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>answer the color at the given point.</p>

<p>Note: for some strange reason this method works fine if the page is
opened via HTTP, but <em>not</em>, if it is opened from a local uri
(e.g. from a directory), in which case it's always null.</p>

<p>This behavior is consistent throughout several browsers. I have no
clue what's behind this, apparently the imageData attribute of
canvas context only gets filled with meaningful data if transferred
via HTTP ???</p>

<p>This is somewhat of a showstopper for color detection in a planned
offline version of Snap.</p>

<p>The issue has also been discussed at: (join lines before pasting)
http://stackoverflow.com/questions/4069400/
canvas-getimagedata-doesnt-work-when-running-locally-on-windows-
security-excep</p>

<p>The suggestion solution appears to work, since the settings are
applied globally.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dta = </span><span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">dta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>WorldMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initVirtualKeyboard: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@inputDOMElementForVirtualKeyboard</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@inputDOMElementForVirtualKeyboard</span>
      <span class="vi">@inputDOMElementForVirtualKeyboard = </span><span class="kc">null</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">isTouchDevice</span> <span class="o">and</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.type = </span><span class="s">&quot;text&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.color = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.backgroundColor = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.border = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.outline = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.position = </span><span class="s">&quot;absolute&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.top = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.left = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.width = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.style.height = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@inputDOMElementForVirtualKeyboard.autocapitalize = </span><span class="s">&quot;none&quot;</span> <span class="c1"># iOS specific</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@inputDOMElementForVirtualKeyboard</span>

    <span class="nx">@inputDOMElementForVirtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>

      <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@inputDOMElementForVirtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>  
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@inputDOMElementForVirtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
  
  <span class="nv">initEventListeners: </span><span class="nf">-&gt;</span>
    <span class="nv">canvas = </span><span class="nx">@worldCanvas</span>
    <span class="k">if</span> <span class="nx">@useFillPage</span>
      <span class="nx">@fillPage</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;dblclick&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processDoubleClick</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseDown</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchstart&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchStart</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseUp</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchend&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchEnd</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseMove</span>  <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchmove&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchMove</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;gesturestart&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Disable browser zoom</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;gesturechange&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Disable browser zoom</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;contextmenu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>suppress context menu for Mac-Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>    
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@keyboardEventsReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardEventsReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Safari, Chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousewheel&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;DOMMouseScroll&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>in theory there should be no scroll event on the page
window.addEventListener "scroll", ((event) =>
 nop # nothing to do, I just need this to set an interrupt point.
), false</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>snippets of clipboard-handling code taken from
http://codebits.glennjones.net/editing/setclipboarddata.htm
Note that this works only in Chrome. Firefox and Safari need a piece of
text to be selected in order to even trigger the copy event. Chrome does
enable clipboard access instead even if nothing is selected.
There are a couple of solutions to this - one is to keep a hidden textfield that
handles all copy/paste operations.
Another one is to not use a clipboard, but rather an internal string as
local memory. So the OS clipboard wouldn't be used, but at least there would
be some copy/paste working. Also one would need to intercept the copy/paste
key combinations manually instead of from the copy/paste events.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;copy&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="k">if</span> <span class="nx">@caret</span>
        <span class="nv">selectedText = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
          <span class="nv">setStatus = </span><span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span> <span class="nx">selectedText</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span>
          <span class="nv">event.returnValue = </span><span class="kc">false</span>
          <span class="nv">setStatus = </span><span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span> <span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="nx">selectedText</span>

    <span class="p">),</span> <span class="kc">false</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;paste&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="k">if</span> <span class="nx">@caret</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Look for access to data if types array is missing</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">text = </span><span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>url = event.clipboardData.getData("text/uri-list")
html = event.clipboardData.getData("text/html")
custom = event.clipboardData.getData("text/xcustom")
IE event is attached to the window object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>The schema is fixed</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">text = </span><span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>url = window.clipboardData.getData("URL")</p>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Needs a few msec to excute paste</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">@caret</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">text</span><span class="p">)),</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>console.log "binding with mousetrap"</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">bind</span> <span class="p">[</span><span class="s">&quot;command+k&quot;</span><span class="p">,</span> <span class="s">&quot;ctrl+k&quot;</span><span class="p">],</span> <span class="nf">(e) =&gt;</span>
      <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">()</span>
      <span class="kc">false</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;dragover&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;drop&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processDrop</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">=&gt;</span>
      <span class="nx">@fillPage</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@useFillPage</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">onbeforeunload = </span><span class="nf">(evt) -&gt;</span>
      <span class="nv">e = </span><span class="nx">evt</span> <span class="o">or</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span>
      <span class="nv">msg = </span><span class="s">&quot;Are you sure you want to leave?&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>For IE and Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">e.returnValue = </span><span class="nx">msg</span>  <span class="k">if</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>For Safari / chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">msg</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseDownRight: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickRight: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">wantsDropOf: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>allow handle drops if any drops are allowed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@acceptsDrops</span>
  
  <span class="nv">droppedImage: </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>

  <span class="nv">droppedSVG: </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>WorldMorph text field tabbing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">nextTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">next = </span><span class="nx">@nextEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">next</span>
      <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
      <span class="nx">next</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
      <span class="nx">next</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">previousTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">prev = </span><span class="nx">@previousEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">prev</span>
      <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
      <span class="nx">prev</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
      <span class="nx">prev</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">testsList: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Check which objects have the right name start</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">)).</span><span class="nx">filter</span> <span class="nf">(i) -&gt;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;SystemTest_&quot;</span><span class="p">)</span>
      <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;SystemTest_&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

  <span class="nv">runSystemTests: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@testsList</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@testsList</span><span class="p">()</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nb">window</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="vi">@systemTestsRecorderAndPlayer.eventQueue = </span><span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">testData</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>the Zombie kernel safari pop-up is painted weird, needs a refresh
for some unknown reason</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>start from clean slate</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@destroyAll</span><span class="p">()</span>
      <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">startTestPlaying</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>WorldMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">contextMenu: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span>
        <span class="nx">@</span><span class="p">,</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;Morphic&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;demo...&quot;</span><span class="p">,</span> <span class="s">&quot;userCreateMorph&quot;</span><span class="p">,</span> <span class="s">&quot;sample morphs&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide all...&quot;</span><span class="p">,</span> <span class="s">&quot;hideAll&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;delete all...&quot;</span><span class="p">,</span> <span class="s">&quot;destroyAll&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show all...&quot;</span><span class="p">,</span> <span class="s">&quot;showAllHiddens&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect...&quot;</span><span class="p">,</span> <span class="s">&quot;inspect&quot;</span><span class="p">,</span> <span class="s">&quot;open a window on\nall properties&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;restore display&quot;</span><span class="p">,</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span> <span class="s">&quot;redraw the\nscreen once&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;fill page...&quot;</span><span class="p">,</span> <span class="s">&quot;fillPage&quot;</span><span class="p">,</span> <span class="s">&quot;let the World automatically\nadjust to browser resizings&quot;</span>
      <span class="k">if</span> <span class="nx">useBlurredShadows</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sharp shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;sharp drop shadows\nuse for old browsers&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;blurred shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;blurry shades,\n use for new browsers&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
        <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncolor:&quot;</span><span class="p">,</span> <span class="nx">@setColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@color</span>
      <span class="p">),</span> <span class="s">&quot;choose the World&#39;s\nbackground color&quot;</span>
      <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;touch screen settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;bigger menu fonts\nand sliders&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;standard settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;smaller menu fonts\nand sliders&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;run system tests&quot;</span><span class="p">,</span>  <span class="s">&quot;runSystemTests&quot;</span><span class="p">,</span> <span class="s">&quot;runs all the system tests&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;start test rec&quot;</span><span class="p">,</span>  <span class="s">&quot;startTestRecording&quot;</span><span class="p">,</span> <span class="s">&quot;start recording a test&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;stop test rec&quot;</span><span class="p">,</span>  <span class="s">&quot;stopTestRecording&quot;</span><span class="p">,</span> <span class="s">&quot;stop recording the test&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;play test&quot;</span><span class="p">,</span>  <span class="s">&quot;startTestPlaying&quot;</span><span class="p">,</span> <span class="s">&quot;start playing the test&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show test source&quot;</span><span class="p">,</span>  <span class="s">&quot;showTestSource&quot;</span><span class="p">,</span> <span class="s">&quot;opens a window with the source of the latest test&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;user mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span><span class="p">,</span> <span class="s">&quot;disable developers&#39;\ncontext menus&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;development mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;about Zombie Kernel...&quot;</span><span class="p">,</span> <span class="s">&quot;about&quot;</span>
    <span class="nx">menu</span>

  <span class="nv">startTestRecording: </span><span class="nf">-&gt;</span>
    <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">startTestRecording</span><span class="p">()</span>

  <span class="nv">stopTestRecording: </span><span class="nf">-&gt;</span>
    <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">stopTestRecording</span><span class="p">()</span>

  <span class="nv">startTestPlaying: </span><span class="nf">-&gt;</span>
    <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">startTestPlaying</span><span class="p">()</span>

  <span class="nv">showTestSource: </span><span class="nf">-&gt;</span>
    <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">showTestSource</span><span class="p">()</span>
  
  <span class="nv">userCreateMorph: </span><span class="nf">-&gt;</span>
    <span class="nv">create = </span><span class="nf">(aMorph) =&gt;</span>
      <span class="nv">aMorph.isDraggable = </span><span class="kc">true</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">pickUp</span> <span class="nx">@</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;make a morph&quot;</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;rectangle&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">RectangleMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;box&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;circle box&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">CircleBoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;slider&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;frame&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">FrameMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;scroll frame&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
      <span class="nv">newMorph.contents.acceptsDrops = </span><span class="kc">true</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;handle&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;Ich wei nicht, was soll es bedeuten, dass ich so &quot;</span> <span class="o">+</span>
        <span class="s">&quot;traurig bin, ein Mrchen aus uralten Zeiten, das &quot;</span> <span class="o">+</span>
        <span class="s">&quot;kommt mir nicht aus dem Sinn. Die Luft ist khl &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und es dunkelt, und ruhig fliet der Rhein; der &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Gipfel des Berges funkelt im Abendsonnenschein. &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Die schnste Jungfrau sitzet dort oben wunderbar, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;ihr gold&#39;nes Geschmeide blitzet, sie kmmt ihr &quot;</span> <span class="o">+</span>
        <span class="s">&quot;goldenes Haar, sie kmmt es mit goldenem Kamme, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und singt ein Lied dabei; das hat eine wundersame, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;gewalt&#39;ge Melodei. Den Schiffer im kleinen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Schiffe, ergreift es mit wildem Weh; er schaut &quot;</span> <span class="o">+</span>
        <span class="s">&quot;nicht die Felsenriffe, er schaut nur hinauf in &quot;</span> <span class="o">+</span>
        <span class="s">&quot;die Hh&#39;. Ich glaube, die Wellen verschlingen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;am Ende Schiffer und Kahn, und das hat mit ihrem &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Singen, die Loreley getan.&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nv">newMorph.maxWidth = </span><span class="mi">300</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;speech bubble&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">SpeechBubbleMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;gray scale palette&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">GrayPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color palette&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color picker&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPickerMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sensor demo&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MouseSensorMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nv">newMorph.edge = </span><span class="mi">35</span>
      <span class="nv">newMorph.border = </span><span class="mi">15</span>
      <span class="nv">newMorph.borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nv">newMorph.alpha = </span><span class="mf">0.2</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;animation demo&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">foo = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
      <span class="nv">foo.alpha = </span><span class="mf">0.9</span>
      <span class="nv">foo.speed = </span><span class="mi">3</span>
      <span class="nv">bar = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nv">bar.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">bar.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">bar.alpha = </span><span class="mf">0.9</span>
      <span class="nv">bar.speed = </span><span class="mi">5</span>
      <span class="nv">baz = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
      <span class="nv">baz.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">baz.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">baz.speed = </span><span class="mi">3</span>
      <span class="nv">garply = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">garply.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">garply.direction = </span><span class="s">&quot;up&quot;</span>
      <span class="nv">garply.speed = </span><span class="mi">8</span>
      <span class="nv">fred = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">fred.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">fred.direction = </span><span class="s">&quot;down&quot;</span>
      <span class="nv">fred.speed = </span><span class="mi">4</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">garply</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">baz</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">fred</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">bar</span>
      <span class="nx">create</span> <span class="nx">foo</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pen&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">PenMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;view all...&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MorphsListMorph</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;closing window&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">WorkspaceMorph</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>

    <span class="k">if</span> <span class="nx">@customMorphs</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">@customMorphs</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(morph) -&gt;</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nf">-&gt;</span>
          <span class="nx">create</span> <span class="nx">morph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@</span>
  
  <span class="nv">toggleDevMode: </span><span class="nf">-&gt;</span>
    <span class="vi">@isDevMode = </span><span class="o">not</span> <span class="nx">@isDevMode</span>
  
  <span class="nv">hideAll: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  <span class="nv">showAllHiddens: </span><span class="nf">-&gt;</span>
    <span class="nx">@forAllChildren</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span>
  
  <span class="nv">about: </span><span class="nf">-&gt;</span>
    <span class="nv">versions = </span><span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">module</span> <span class="k">of</span> <span class="nx">modules</span>
      <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span>
        <span class="nx">versions</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">module</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">modules</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">versions</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
      <span class="nv">versions = </span><span class="s">&quot;\n\nmodules:\n\n&quot;</span> <span class="o">+</span> <span class="s">&quot;morphic (&quot;</span> <span class="o">+</span> <span class="nx">morphicVersion</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="nx">versions</span>  
    <span class="nx">@inform</span> <span class="s">&quot;Zombie Kernel\n\n&quot;</span> <span class="o">+</span>
      <span class="s">&quot;a lively Web GUI\ninspired by Squeak\n&quot;</span> <span class="o">+</span>
      <span class="nx">morphicVersion</span> <span class="o">+</span>
      <span class="s">&quot;\n\nby Davide Della Casa&quot;</span> <span class="o">+</span>
      <span class="s">&quot;\n\nbased on morphic.js by&quot;</span> <span class="o">+</span>
      <span class="s">&quot;\nJens Mnig (jens@moenig.org)&quot;</span>
  
  <span class="nv">edit: </span><span class="nf">(aStringMorphOrTextMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>first off, if the Morph is not editable
then there is nothing to do</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">isEditable</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>there is only one caret in the World, so destroy
the previous one if there was one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@caret</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>empty the previously ongoing selection
if there was one.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@lastEditedText = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">target</span>
      <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@lastEditedText</span>
      <span class="nx">@caret</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>create the new Caret</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@caret = </span><span class="k">new</span> <span class="nx">CaretMorph</span><span class="p">(</span><span class="nx">aStringMorphOrTextMorph</span><span class="p">)</span>
    <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@caret</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>this is the only place where the @keyboardEventsReceiver is set</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@keyboardEventsReceiver = </span><span class="nx">@caret</span>

    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">isTouchDevice</span> <span class="o">and</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span>
      <span class="nx">@initVirtualKeyboard</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>For touch devices, giving focus on the textbox causes
the keyboard to slide up, and since the page viewport
shrinks, the page is scrolled to where the texbox is.
So, it is important to position the textbox around
where the caret is, so that the changed text is going to
be visible rather than out of the viewport.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
      <span class="vi">@inputDOMElementForVirtualKeyboard.style.top = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="vi">@inputDOMElementForVirtualKeyboard.style.left = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="nx">@inputDOMElementForVirtualKeyboard</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useSliderForInput</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">parentThatIsA</span><span class="p">(</span><span class="nx">MenuMorph</span><span class="p">)</span>
        <span class="nx">@slide</span> <span class="nx">aStringMorphOrTextMorph</span>
  </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Editing can stop because of three reasons:
  cancel (user hits ESC)
  accept (on stringmorph, user hits enter)
  user clicks/drags another morph</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">stopEditing: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@caret</span>
      <span class="vi">@lastEditedText = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">target</span>
      <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
      <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToEdit&quot;</span><span class="p">,</span> <span class="nx">@lastEditedText</span>
      <span class="nx">@caret</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="vi">@caret = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>the only place where the @keyboardEventsReceiver is unset
(and the hidden input is removed)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@keyboardEventsReceiver = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@inputDOMElementForVirtualKeyboard</span>
      <span class="nx">@inputDOMElementForVirtualKeyboard</span><span class="p">.</span><span class="nx">blur</span><span class="p">()</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@inputDOMElementForVirtualKeyboard</span>
      <span class="vi">@inputDOMElementForVirtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
  
  <span class="nv">slide: </span><span class="nf">(aStringMorphOrTextMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>display a slider for numeric text entries</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">val = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
    <span class="nv">val = </span><span class="mi">0</span>  <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
    <span class="nv">slider = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="nx">val</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
    <span class="nv">slider.alpha = </span><span class="mi">1</span>
    <span class="nv">slider.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">)</span>
    <span class="nv">slider.button.color = </span><span class="nx">menu</span><span class="p">.</span><span class="nx">borderColor</span>
    <span class="nv">slider.button.highlightColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">highlightColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">100</span>
    <span class="nv">slider.button.pressColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">pressColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">150</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
      <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nv">aStringMorphOrTextMorph.text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">escalateEvent</span><span class="p">(</span>
          <span class="s">&#39;reactToSliderEdit&#39;</span><span class="p">,</span>
          <span class="nx">aStringMorphOrTextMorph</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slider</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popup</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">aStringMorphOrTextMorph</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
  
  <span class="nv">toggleBlurredShadows: </span><span class="nf">-&gt;</span>
    <span class="nv">useBlurredShadows = </span><span class="o">not</span> <span class="nx">useBlurredShadows</span>
  
  <span class="nv">togglePreferences: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">touchScreenSettings</span>
    <span class="k">else</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">standardSettings</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 