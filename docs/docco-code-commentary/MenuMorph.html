<!DOCTYPE html>  <html> <head>   <title>MenuMorph.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="BlinkerMorph.html">                 BlinkerMorph.coffee               </a>                                           <a class="source" href="BouncerMorph.html">                 BouncerMorph.coffee               </a>                                           <a class="source" href="BoxMorph.html">                 BoxMorph.coffee               </a>                                           <a class="source" href="CaretMorph.html">                 CaretMorph.coffee               </a>                                           <a class="source" href="CircleBoxMorph.html">                 CircleBoxMorph.coffee               </a>                                           <a class="source" href="CloseCircleButtonMorph.html">                 CloseCircleButtonMorph.coffee               </a>                                           <a class="source" href="Color.html">                 Color.coffee               </a>                                           <a class="source" href="ColorPaletteMorph.html">                 ColorPaletteMorph.coffee               </a>                                           <a class="source" href="ColorPickerMorph.html">                 ColorPickerMorph.coffee               </a>                                           <a class="source" href="FrameMorph.html">                 FrameMorph.coffee               </a>                                           <a class="source" href="GrayPaletteMorph.html">                 GrayPaletteMorph.coffee               </a>                                           <a class="source" href="HandMorph.html">                 HandMorph.coffee               </a>                                           <a class="source" href="HandleMorph.html">                 HandleMorph.coffee               </a>                                           <a class="source" href="InspectorMorph.html">                 InspectorMorph.coffee               </a>                                           <a class="source" href="ListMorph.html">                 ListMorph.coffee               </a>                                           <a class="source" href="MenuItemMorph.html">                 MenuItemMorph.coffee               </a>                                           <a class="source" href="MenuMorph.html">                 MenuMorph.coffee               </a>                                           <a class="source" href="Morph.html">                 Morph.coffee               </a>                                           <a class="source" href="MorphicNode.html">                 MorphicNode.coffee               </a>                                           <a class="source" href="MorphsListMorph.html">                 MorphsListMorph.coffee               </a>                                           <a class="source" href="MouseSensorMorph.html">                 MouseSensorMorph.coffee               </a>                                           <a class="source" href="Mousetrap.html">                 Mousetrap.coffee               </a>                                           <a class="source" href="PenMorph.html">                 PenMorph.coffee               </a>                                           <a class="source" href="Point.html">                 Point.coffee               </a>                                           <a class="source" href="Point2.html">                 Point2.coffee               </a>                                           <a class="source" href="Rectangle.html">                 Rectangle.coffee               </a>                                           <a class="source" href="RectangleMorph.html">                 RectangleMorph.coffee               </a>                                           <a class="source" href="ScrollFrameMorph.html">                 ScrollFrameMorph.coffee               </a>                                           <a class="source" href="ShadowMorph.html">                 ShadowMorph.coffee               </a>                                           <a class="source" href="SliderButtonMorph.html">                 SliderButtonMorph.coffee               </a>                                           <a class="source" href="SliderMorph.html">                 SliderMorph.coffee               </a>                                           <a class="source" href="SpeechBubbleMorph.html">                 SpeechBubbleMorph.coffee               </a>                                           <a class="source" href="StringFieldMorph.html">                 StringFieldMorph.coffee               </a>                                           <a class="source" href="StringMorph.html">                 StringMorph.coffee               </a>                                           <a class="source" href="SystemTest_SimpleMenuTest.html">                 SystemTest_SimpleMenuTest.coffee               </a>                                           <a class="source" href="SystemTestsRecorderAndPlayer.html">                 SystemTestsRecorderAndPlayer.coffee               </a>                                           <a class="source" href="TextMorph.html">                 TextMorph.coffee               </a>                                           <a class="source" href="TriggerMorph.html">                 TriggerMorph.coffee               </a>                                           <a class="source" href="WorkspaceMorph.html">                 WorkspaceMorph.coffee               </a>                                           <a class="source" href="WorldMorph.html">                 WorldMorph.coffee               </a>                                           <a class="source" href="globalFunctions.html">                 globalFunctions.coffee               </a>                                           <a class="source" href="globalSettings.html">                 globalSettings.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               MenuMorph.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>MenuMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MenuMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">title: </span><span class="kc">null</span>
  <span class="nv">environment: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">items: </span><span class="kc">null</span>
  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">world: </span><span class="kc">null</span>
  <span class="nv">isListContents: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(@target, @title = null, @environment = null, @fontSize = null) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Note that Morph does a updateRendering upon creation (TODO Why?), so we need
to initialise the items before calling super. We can't initialise it
outside the constructor because the array would be shared across instantiated
objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@items = </span><span class="p">[]</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@border = </span><span class="kc">null</span> <span class="c1"># the Box Morph constructor puts this to 2</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>important not to traverse all the children for stepping through, because
there could be a lot of entries for example in the inspector the number
of properties of an object - there could be a 100 of those and we don't
want to traverse them all. Setting step to null (as opposed to nop) means
that</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">addItem: </span><span class="nf">(</span>
<span class="nf">      labelString,</span>
<span class="nf">      action,</span>
<span class="nf">      hint,</span>
<span class="nf">      color,</span>
<span class="nf">      bold = false,</span>
<span class="nf">      italic = false,</span>
<span class="nf">      doubleClickAction # optional, when used as list contents</span>
<span class="nf">      ) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>labelString is normally a single-line string. But it can also be one
of the following:
    * a multi-line string (containing line breaks)
    * an icon (either a Morph or a Canvas)
    * a tuple of format: [icon, string]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span>
      <span class="nx">localize</span><span class="p">(</span><span class="nx">labelString</span> <span class="o">or</span> <span class="s">&quot;close&quot;</span><span class="p">),</span>
      <span class="nx">action</span> <span class="o">or</span> <span class="nx">nop</span><span class="p">,</span>
      <span class="nx">hint</span><span class="p">,</span>
      <span class="nx">color</span><span class="p">,</span>
      <span class="nx">bold</span><span class="p">,</span>
      <span class="nx">italic</span><span class="p">,</span>
      <span class="nx">doubleClickAction</span>
    <span class="p">]</span>

  <span class="nv">prependItem: </span><span class="nf">(</span>
<span class="nf">      labelString,</span>
<span class="nf">      action,</span>
<span class="nf">      hint,</span>
<span class="nf">      color,</span>
<span class="nf">      bold = false,</span>
<span class="nf">      italic = false,</span>
<span class="nf">      doubleClickAction # optional, when used as list contents</span>
<span class="nf">      ) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>labelString is normally a single-line string. But it can also be one
of the following:
    * a multi-line string (containing line breaks)
    * an icon (either a Morph or a Canvas)
    * a tuple of format: [icon, string]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@items</span><span class="p">.</span><span class="nx">unshift</span> <span class="p">[</span>
      <span class="nx">localize</span><span class="p">(</span><span class="nx">labelString</span> <span class="o">or</span> <span class="s">&quot;close&quot;</span><span class="p">),</span>
      <span class="nx">action</span> <span class="o">or</span> <span class="nx">nop</span><span class="p">,</span>
      <span class="nx">hint</span><span class="p">,</span>
      <span class="nx">color</span><span class="p">,</span>
      <span class="nx">bold</span><span class="p">,</span>
      <span class="nx">italic</span><span class="p">,</span>
      <span class="nx">doubleClickAction</span>
    <span class="p">]</span>
  
  <span class="nv">addLine: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="o">or</span> <span class="mi">1</span><span class="p">]</span>

  <span class="nv">prependLine: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">unshift</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="o">or</span> <span class="mi">1</span><span class="p">]</span>
  
  <span class="nv">createLabel: </span><span class="nf">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nv">text = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">localize</span><span class="p">(</span><span class="nx">@title</span><span class="p">),</span>
      <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="nv">text.alignment = </span><span class="s">&quot;center&quot;</span>
    <span class="nv">text.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nv">text.backgroundColor = </span><span class="nx">@borderColor</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">isFlat</span>
      <span class="vi">@label.edge = </span><span class="mi">0</span>
    <span class="vi">@label.color = </span><span class="nx">@borderColor</span>
    <span class="vi">@label.borderColor = </span><span class="nx">@borderColor</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">add</span> <span class="nx">text</span>
    <span class="vi">@label.text = </span><span class="nx">text</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">isLine = </span><span class="kc">false</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="k">unless</span> <span class="nx">@isListContents</span>
      <span class="vi">@edge = </span><span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">isFlat</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">5</span>
      <span class="vi">@border = </span><span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">isFlat</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">y = </span><span class="mi">2</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="k">unless</span> <span class="nx">@isListContents</span>
      <span class="k">if</span> <span class="nx">@title</span>
        <span class="nx">@createLabel</span><span class="p">()</span>
        <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="nx">@add</span> <span class="nx">@label</span>
        <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(tuple) =&gt;</span>
      <span class="nv">isLine = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span>
          <span class="nv">item = </span><span class="nx">tuple</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">isLine = </span><span class="kc">true</span>
        <span class="nv">item = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
        <span class="nv">item.color = </span><span class="nx">@borderColor</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>bubble help hint</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">item = </span><span class="k">new</span> <span class="nx">MenuItemMorph</span><span class="p">(</span>
          <span class="nx">@target</span><span class="p">,</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
          <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="nx">@environment</span><span class="p">,</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="c1"># color</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="c1"># bold</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="c1"># italic</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># doubleclick action</span>
          <span class="p">)</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nx">@add</span> <span class="nx">item</span>
      <span class="nv">y = </span><span class="nx">y</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@adjustWidths</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  
  <span class="nv">maxWidth: </span><span class="nf">-&gt;</span>
    <span class="nv">w = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span>
      <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">scrollFrame</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
        <span class="nv">w = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">scrollFrame</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>    
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span><span class="p">)</span>
        <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span><span class="p">)</span>
          <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">@label</span>
    <span class="nx">w</span>
  
  <span class="nv">adjustWidths: </span><span class="nf">-&gt;</span>
    <span class="nv">w = </span><span class="nx">@maxWidth</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) =&gt;</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">w</span>
      <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span>
        <span class="nv">isSelected = </span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">image</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pressImage</span><span class="p">)</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">createBackgrounds</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">isSelected</span> <span class="k">then</span> <span class="nv">item.image = </span><span class="nx">item</span><span class="p">.</span><span class="nx">pressImage</span>          
      <span class="k">else</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">item</span> <span class="o">is</span> <span class="nx">@label</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">item</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  
  <span class="nv">unselectAllItems: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="nv">item.image = </span><span class="nx">item</span><span class="p">.</span><span class="nx">normalImage</span>  <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">popup: </span><span class="nf">(world, pos) -&gt;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span>
    <span class="nx">@keepWithin</span> <span class="nx">world</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>keep only one active menu at a time, destroy the
previous one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
    <span class="nv">world.activeMenu = </span><span class="nx">@</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
  
  <span class="nv">popUpAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
  
  <span class="nv">popUpCenteredAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  <span class="nv">popUpCenteredInWorld: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 