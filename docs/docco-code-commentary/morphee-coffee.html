<!DOCTYPE html>  <html> <head>   <title>morphee-coffee.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               morphee-coffee.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Global Functions ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This is used for testing purposes, we hash the
data URL of a canvas object so to get a fingerprint
of the image data, and compare it with "OK" pre-recorded
values.
adapted from http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">hashCode = </span><span class="nf">(stringToBeHashed) -&gt;</span>
  <span class="nv">hash = </span><span class="mi">0</span>
  <span class="k">return</span> <span class="nx">hash</span>  <span class="k">if</span> <span class="nx">stringToBeHashed</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">stringToBeHashed</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
    <span class="nv">char = </span><span class="nx">stringToBeHashed</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="nv">hash = </span><span class="p">((</span><span class="nx">hash</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="nx">hash</span><span class="p">)</span> <span class="o">+</span> <span class="nx">char</span>
    <span class="nv">hash = </span><span class="nx">hash</span> <span class="o">&amp;</span> <span class="nx">hash</span> <span class="c1"># Convert to 32bit integer</span>
  <span class="nx">hash</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>returns the function that does nothing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">nop = </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>this is the function that does nothing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nf">-&gt;</span>
    <span class="kc">null</span>

<span class="nv">noOperation = </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>

<span class="nv">isFunction = </span><span class="nf">(functionToCheck) -&gt;</span>
  <span class="k">typeof</span><span class="p">(</span><span class="nx">functionToCheck</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>

<span class="nv">localize = </span><span class="nf">(string) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>override this function with custom localizations</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">string</span>

<span class="nv">isNil = </span><span class="nf">(thing) -&gt;</span>
  <span class="nx">thing</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">or</span> <span class="nx">thing</span> <span class="o">is</span> <span class="kc">null</span>

<span class="nv">contains = </span><span class="nf">(list, element) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>answer true if element is a member of list</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">list</span><span class="p">.</span><span class="nx">some</span> <span class="nf">(any) -&gt;</span>
    <span class="nx">any</span> <span class="o">is</span> <span class="nx">element</span>

<span class="nv">detect = </span><span class="nf">(list, predicate) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>answer the first element of list for which predicate evaluates
true, otherwise answer null</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">element</span> <span class="k">in</span> <span class="nx">list</span>
    <span class="k">return</span> <span class="nx">element</span>  <span class="k">if</span> <span class="nx">predicate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span>
  <span class="kc">null</span>

<span class="nv">sizeOf = </span><span class="nf">(object) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>answer the number of own properties</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">size = </span><span class="mi">0</span>
  <span class="nv">key = </span><span class="kc">undefined</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">object</span>
    <span class="nx">size</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
  <span class="nx">size</span>

<span class="nv">isString = </span><span class="nf">(target) -&gt;</span>
  <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="o">or</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nb">String</span>

<span class="nv">isObject = </span><span class="nf">(target) -&gt;</span>
  <span class="nx">target</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span> <span class="o">or</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span>

<span class="nv">radians = </span><span class="nf">(degrees) -&gt;</span>
  <span class="nx">degrees</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span>

<span class="nv">degrees = </span><span class="nf">(radians) -&gt;</span>
  <span class="nx">radians</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span>

<span class="nv">fontHeight = </span><span class="nf">(height) -&gt;</span>
  <span class="nv">minHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">height</span><span class="p">,</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">minimumFontHeight</span><span class="p">)</span>
  <span class="nx">minHeight</span> <span class="o">*</span> <span class="mf">1.2</span> <span class="c1"># assuming 1/5 font size for ascenders</span>

<span class="nv">newCanvas = </span><span class="nf">(extentPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>answer a new empty instance of Canvas, don't display anywhere</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ext = </span><span class="nx">extentPoint</span> <span class="o">or</span>
    <span class="nv">x: </span><span class="mi">0</span>
    <span class="nv">y: </span><span class="mi">0</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">ext</span><span class="p">.</span><span class="nx">x</span>
  <span class="nv">canvas.height = </span><span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
  <span class="nx">canvas</span>

<span class="nv">getMinimumFontHeight = </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>answer the height of the smallest font renderable in pixels</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">str = </span><span class="s">&quot;I&quot;</span>
  <span class="nv">size = </span><span class="mi">50</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">size</span>
  <span class="nv">canvas.height = </span><span class="nx">size</span>
  <span class="nv">ctx = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.font = </span><span class="s">&quot;1px serif&quot;</span>
  <span class="nv">maxX = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">width</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;black&quot;</span>
  <span class="nv">ctx.textBaseline = </span><span class="s">&quot;bottom&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span>
  <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">size</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">maxX</span><span class="p">]</span>
      <span class="nv">data = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">0</span>
  <span class="mi">0</span>

<span class="nv">getBlurredShadowSupport = </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>check for Chrome issue 90001
http://code.google.com/p/chromium/issues/detail?id=90001</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">source = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">source.width = </span><span class="mi">10</span>
  <span class="nv">source.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">source</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;rgb(255, 0, 0)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="nv">target = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">target.width = </span><span class="mi">10</span>
  <span class="nv">target.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">target</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.shadowBlur = </span><span class="mi">10</span>
  <span class="nv">ctx.shadowColor = </span><span class="s">&quot;rgba(0, 0, 255, 1)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">source</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="k">if</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span><span class="p">)</span>

<span class="nv">getDocumentPositionOf = </span><span class="nf">(aDOMelement) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>answer the absolute coordinates of a DOM element in the document</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">aDOMelement</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="nv">x: </span><span class="mi">0</span>
      <span class="nv">y: </span><span class="mi">0</span>
    <span class="p">)</span>
  <span class="nv">pos =</span>
    <span class="nv">x: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nv">y: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetTop</span>
  <span class="nv">offsetParent = </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="k">while</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetTop</span>
    <span class="k">if</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">and</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollLeft</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollTop</span>
    <span class="nv">offsetParent = </span><span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="nx">pos</span>

<span class="nv">clone = </span><span class="nf">(target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>answer a new instance of target's type</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
    <span class="nv">Clone = </span><span class="nf">-&gt;</span>

    <span class="nv">Clone:: = </span><span class="nx">target</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Clone</span><span class="p">()</span>
  <span class="nx">target</span>

<span class="nv">copy = </span><span class="nf">(target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>answer a shallow copy of target</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">target</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="s">&quot;object&quot;</span>
  <span class="nv">value = </span><span class="nx">target</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="nx">value</span>
  <span class="k">if</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">and</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">isnt</span> <span class="nb">Object</span>
    <span class="nv">c = </span><span class="nx">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="o">::</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nv">c = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">unless</span> <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  <span class="nx">c</span>

<span class="nv">getMinimumFontHeight = </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>answer the height of the smallest font renderable in pixels</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">str = </span><span class="s">&quot;I&quot;</span>
  <span class="nv">size = </span><span class="mi">50</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">size</span>
  <span class="nv">canvas.height = </span><span class="nx">size</span>
  <span class="nv">ctx = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.font = </span><span class="s">&quot;1px serif&quot;</span>
  <span class="nv">maxX = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">width</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;black&quot;</span>
  <span class="nv">ctx.textBaseline = </span><span class="s">&quot;bottom&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span>
  <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">size</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">maxX</span><span class="p">]</span>
      <span class="nv">data = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">0</span>
  <span class="mi">0</span>


<span class="nv">getBlurredShadowSupport = </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>check for Chrome issue 90001
http://code.google.com/p/chromium/issues/detail?id=90001</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">source = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">source.width = </span><span class="mi">10</span>
  <span class="nv">source.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">source</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;rgb(255, 0, 0)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="nv">target = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">target.width = </span><span class="mi">10</span>
  <span class="nv">target.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">target</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.shadowBlur = </span><span class="mi">10</span>
  <span class="nv">ctx.shadowColor = </span><span class="s">&quot;rgba(0, 0, 255, 1)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">source</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="k">if</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span><span class="p">)</span>

<span class="nv">getDocumentPositionOf = </span><span class="nf">(aDOMelement) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>answer the absolute coordinates of a DOM element in the document</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">aDOMelement</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="nv">x: </span><span class="mi">0</span>
      <span class="nv">y: </span><span class="mi">0</span>
    <span class="p">)</span>
  <span class="nv">pos =</span>
    <span class="nv">x: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nv">y: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetTop</span>

  <span class="nv">offsetParent = </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="k">while</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetTop</span>
    <span class="k">if</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">and</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollLeft</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollTop</span>
    <span class="nv">offsetParent = </span><span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="nx">pos</span>

<span class="nv">clone = </span><span class="nf">(target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>answer a new instance of target's type</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
    <span class="nv">Clone = </span><span class="nf">-&gt;</span>

    <span class="nv">Clone:: = </span><span class="nx">target</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Clone</span><span class="p">()</span>
  <span class="nx">target</span>

<span class="nv">copy = </span><span class="nf">(target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>answer a shallow copy of target</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">target</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="s">&quot;object&quot;</span>
  <span class="nv">value = </span><span class="nx">target</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="nx">value</span>
  <span class="k">if</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">and</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">isnt</span> <span class="nb">Object</span>
    <span class="nv">c = </span><span class="nx">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="o">::</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nv">c = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">unless</span> <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  <span class="nx">c</span>
<span class="k">class</span> <span class="nx">MorphicNode</span>

  <span class="nv">parent: </span><span class="kc">null</span>
  <span class="nv">children: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@parent = null, @children = []) -&gt;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>MorphicNode string representation: e.g. 'a MorphicNode[3]'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="nf">-&gt;</span>
    <span class="s">&quot;a MorphicNode&quot;</span> <span class="o">+</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>MorphicNode accessing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">addChild: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="nx">aMorphicNode</span>
    <span class="nv">aMorphicNode.parent = </span><span class="nx">@</span>
  
  <span class="nv">addChildFirst: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">splice</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">aMorphicNode</span>
    <span class="nv">aMorphicNode.parent = </span><span class="nx">@</span>
  
  <span class="nv">removeChild: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nv">idx = </span><span class="nx">@children</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">aMorphicNode</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>MorphicNode functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">root: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">root</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@parent</span><span class="o">?</span>
    <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>currently unused</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">depth: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="mi">0</span>  <span class="k">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">depth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Returns all the internal/terminal nodes in the subtree starting
at this node - including this node</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">allChildren: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="p">[</span><span class="nx">@</span><span class="p">]</span> <span class="c1"># includes myself</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">())</span>
    <span class="nx">result</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>A shorthand to run a function on all the internal/terminal nodes in the subtree
starting at this node - including this node.
Note that the function is run starting form the "bottom" leaf and the all the
way "up" to the current node.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">forAllChildren: </span><span class="nf">(aFunction) -&gt;</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">forAllChildren</span> <span class="nx">aFunction</span>
    <span class="nx">aFunction</span><span class="p">.</span><span class="nx">call</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@</span>
  
  <span class="nv">allLeafs: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="p">[]</span>
    <span class="nx">@allChildren</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(element) -&gt;</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span> <span class="nx">element</span>  <span class="k">if</span> <span class="o">!</span><span class="nx">element</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Return all "parent" nodes from this node up to the root (including both)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">allParents: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>includes myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="p">[</span><span class="nx">@</span><span class="p">]</span>
    <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">allParents</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">@parent</span><span class="o">?</span>
    <span class="nx">result</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The direct children of the parent of this node. (current node not included)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">siblings: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="p">[]</span>  <span class="k">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(child) =&gt;</span>
      <span class="nx">child</span> <span class="o">isnt</span> <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>returns the first parent (going up from this node) that is of a particular class
(includes this particular node)
This is a subcase of "parentThatIsAnyOf".</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">parentThatIsA: </span><span class="nf">(constructor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>including myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@</span> <span class="k">if</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">constructor</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">parentThatIsA</span> <span class="nx">constructor</span>
  </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>returns the first parent (going up from this node) that belongs to a set
of classes. (includes this particular node).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">parentThatIsAnyOf: </span><span class="nf">(constructors) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>including myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">constructors</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="k">if</span> <span class="nx">@constructor</span> <span class="o">is</span> <span class="nx">each</span>
        <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">parentThatIsAnyOf</span> <span class="nx">constructors</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Morph //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Morph</span> <span class="k">extends</span> <span class="nx">MorphicNode</span>
  </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Just some tests here ////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">propertyUpTheChain: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
  <span class="nv">morphMethod: </span><span class="nf">-&gt;</span>
    <span class="mf">3.14</span>
  <span class="vi">@morphStaticMethod: </span><span class="nf">-&gt;</span>
    <span class="mf">3.14</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>End of tests here ////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isMorph: </span><span class="kc">true</span>
  <span class="nv">bounds: </span><span class="kc">null</span>
  <span class="nv">color: </span><span class="kc">null</span>
  <span class="nv">texture: </span><span class="kc">null</span> <span class="c1"># optional url of a fill-image</span>
  <span class="nv">cachedTexture: </span><span class="kc">null</span> <span class="c1"># internal cache of actual bg image</span>
  <span class="nv">lastTime: </span><span class="kc">null</span>
  <span class="nv">alpha: </span><span class="mi">1</span>
  <span class="nv">isVisible: </span><span class="kc">true</span>
  <span class="nv">isDraggable: </span><span class="kc">false</span>
  <span class="nv">isTemplate: </span><span class="kc">false</span>
  <span class="nv">acceptsDrops: </span><span class="kc">false</span>
  <span class="nv">noticesTransparentClick: </span><span class="kc">false</span>
  <span class="nv">fps: </span><span class="mi">0</span>
  <span class="nv">customContextMenu: </span><span class="kc">null</span>
  <span class="nv">trackChanges: </span><span class="kc">true</span>
  <span class="nv">shadowBlur: </span><span class="mi">4</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>note that image contains only the CURRENT morph, not the composition of this
morph with all of the submorphs. I.e. for an inspector, this will only
contain the background of the window pane. Not any of its contents.
for the worldMorph, this only contains the background</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">image: </span><span class="kc">null</span>
  <span class="nv">onNextStep: </span><span class="kc">null</span> <span class="c1"># optional function to be run once. Not currently used in Zombie Kernel</span>
  
  <span class="nv">constructor: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>[TODO] why is there this strange non-zero default bound?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="vi">@lastTime = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>damage list housekeeping</p>

<p>the trackChanges property of the Morph prototype is a Boolean switch
that determines whether the World's damage list ('broken' rectangles)
tracks changes. By default the switch is always on. If set to false
changes are not stored. This can be very useful for housekeeping of
the damage list in situations where a large number of (sub-) morphs
are changed more or less at once. Instead of keeping track of every
single submorph's changes tremendous performance improvements can be
achieved by setting the trackChanges flag to false before propagating
the layout changes, setting it to true again and then storing the full
bounds of the surrounding morph. An an example refer to the</p>

<pre><code>fixLayout()
</code></pre>

<p>method of InspectorMorph, or the</p>

<pre><code>startLayout()
endLayout()
</code></pre>

<p>methods of SyntaxElementMorph in the Snap application.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Morph string representation: e.g. 'a Morph 2 [20@45 | 130@250]'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="nf">-&gt;</span>
    <span class="s">&quot;a &quot;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
      <span class="s">&quot; &quot;</span> <span class="o">+</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span>
      <span class="s">&quot; &quot;</span> <span class="o">+</span>
      <span class="nx">@bounds</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Morph deleting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@</span>
  
  <span class="nv">destroyAll: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>this is a typical case: we need to make a copy of the children
array first pecause we are iterating over an array that changes
its values (and length) while we are iterating on it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">childrenCopy = </span><span class="nx">@children</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(x) -&gt;</span> <span class="kc">true</span>
    <span class="nx">childrenCopy</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) =&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Morph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">runChildrensStepFunction: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>step is the function that this Morph wants to run at each step.
If the Morph wants to do nothing and let no-one of the children do nothing,
then step is set to null.
If the morph wants to do nothing but the children might want to do something,
then step is set to the function that does nothing (i.e. a function noOperation that
only returns null) </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@step</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>for objects where @fps is defined, check which ones are due to be stepped
and which ones want to wait. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">elapsed = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">@lastTime</span>
    <span class="k">if</span> <span class="nx">@fps</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">timeRemainingToWaitedFrame = </span><span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="nx">@fps</span><span class="p">)</span> <span class="o">-</span> <span class="nx">elapsed</span>
    <span class="k">else</span>
      <span class="nv">timeRemainingToWaitedFrame = </span><span class="mi">0</span>
    </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Question: why 1 here below?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">timeRemainingToWaitedFrame</span> <span class="o">&lt;</span> <span class="mi">1</span>
      <span class="vi">@lastTime = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">currentTime</span>
      <span class="k">if</span> <span class="nx">@onNextStep</span>
        <span class="nv">nxt = </span><span class="nx">@onNextStep</span>
        <span class="vi">@onNextStep = </span><span class="kc">null</span>
        <span class="nx">nxt</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
      <span class="nx">@step</span><span class="p">()</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">runChildrensStepFunction</span><span class="p">()</span>

  <span class="nv">nextSteps: </span><span class="nf">(arrayOfFunctions) -&gt;</span>
    <span class="nv">lst = </span><span class="nx">arrayOfFunctions</span> <span class="o">or</span> <span class="p">[]</span>
    <span class="nv">nxt = </span><span class="nx">lst</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">nxt</span>
      <span class="vi">@onNextStep = </span><span class="o">=&gt;</span>
        <span class="nx">nxt</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span>
        <span class="nx">@nextSteps</span> <span class="nx">lst</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>leaving this function as step means that the morph want to do nothing
but the children <em>are</em> traversed and their step function is invoked.
If a Morph wants to do nothing and wants to prevent the children to be
traversed, then this function should be set to null.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="nx">noOperation</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Morph accessing - geometry getting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">left: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
  
  <span class="nv">right: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
  
  <span class="nv">top: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
  
  <span class="nv">bottom: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
  
  <span class="nv">center: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">center</span><span class="p">()</span>
  
  <span class="nv">bottomCenter: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomCenter</span><span class="p">()</span>
  
  <span class="nv">bottomLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">()</span>
  
  <span class="nv">bottomRight: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">()</span>
  
  <span class="nv">boundingBox: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span>
  
  <span class="nv">corners: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">corners</span><span class="p">()</span>
  
  <span class="nv">leftCenter: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">leftCenter</span><span class="p">()</span>
  
  <span class="nv">rightCenter: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">rightCenter</span><span class="p">()</span>
  
  <span class="nv">topCenter: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topCenter</span><span class="p">()</span>
  
  <span class="nv">topLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topLeft</span><span class="p">()</span>
  
  <span class="nv">topRight: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topRight</span><span class="p">()</span>
  
  <span class="nv">position: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
  
  <span class="nv">extent: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">extent</span><span class="p">()</span>
  
  <span class="nv">width: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
  
  <span class="nv">height: </span><span class="nf">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
  
  <span class="nv">boundsIncludingChildren: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@bounds</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">boundsIncludingChildrenNoShadow: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>answer my full bounds but ignore any shadow</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="nx">@bounds</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">child</span> <span class="o">not</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">)</span>
        <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">visibleBounds: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>answer which part of me is not clipped by a Frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">visible = </span><span class="nx">@bounds</span>
    <span class="nv">frames = </span><span class="nx">@allParents</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(p) -&gt;</span>
      <span class="nx">p</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span>
    <span class="p">)</span>
    <span class="nx">frames</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(f) -&gt;</span>
      <span class="nv">visible = </span><span class="nx">visible</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">visible</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Morph accessing - simple changes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>question: why is changed() called two times?
question: can't we use silentMoveBy?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">moveBy</span> <span class="nx">delta</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">silentMoveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">silentMoveBy</span> <span class="nx">delta</span>
  
  
  <span class="nv">setPosition: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">delta = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@topLeft</span><span class="p">())</span>
    <span class="nx">@moveBy</span> <span class="nx">delta</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">y</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">silentSetPosition: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">delta = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@topLeft</span><span class="p">())</span>
    <span class="nx">@silentMoveBy</span> <span class="nx">delta</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">y</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">setLeft: </span><span class="nf">(x) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">())</span>
  
  <span class="nv">setRight: </span><span class="nf">(x) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">())</span>
  
  <span class="nv">setTop: </span><span class="nf">(y) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">setBottom: </span><span class="nf">(y) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">y</span> <span class="o">-</span> <span class="nx">@height</span><span class="p">())</span>
  
  <span class="nv">setCenter: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  <span class="nv">setFullCenter: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>make sure I am completely within another Morph's bounds</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">keepWithin: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">leftOff = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">leftOff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">leftOff</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">rightOff = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">rightOff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">rightOff</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nv">topOff = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">topOff</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">topOff</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">bottomOff = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">bottomOff</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">bottomOff</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Morph accessing - dimensional changes requiring a complete redraw</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">unless</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>question: why two "changed" invocations?</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@silentSetExtent</span> <span class="nx">aPoint</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">silentSetExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">ext = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">round</span><span class="p">()</span>
    <span class="nv">newWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">newHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">newWidth</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">newHeight</span><span class="p">)</span>
  
  <span class="nv">setWidth: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">width</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@height</span><span class="p">())</span>
  
  <span class="nv">silentSetWidth: </span><span class="nf">(width) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>do not updateRendering() just yet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">width</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">setHeight: </span><span class="nf">(height) -&gt;</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">height</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">silentSetHeight: </span><span class="nf">(height) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>do not updateRendering() just yet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">h = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">height</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">h</span><span class="p">)</span>
  
  <span class="nv">setColor: </span><span class="nf">(aColor) -&gt;</span>
    <span class="k">if</span> <span class="nx">aColor</span>
      <span class="k">unless</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">aColor</span><span class="p">)</span>
        <span class="vi">@color = </span><span class="nx">aColor</span>
        <span class="nx">@changed</span><span class="p">()</span>
        <span class="nx">@updateRendering</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Morph displaying ###########################################################</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>There are three fundamental methods for rendering and displaying anything.
* updateRendering: this one creates/updates the local canvas of this morph only
  i.e. not the children
* blit: takes the local canvas and blits it to a specific area in a passed
  canvas. The local canvas doesn't contain any rendering of the children of
  this morph.
* recursivelyBlit: recursively draws all the local canvas of this morph and all
  its children into a specific area of a passed canvas.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>initialize my surface property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@cachedTexture</span>
      <span class="nx">@drawCachedTexture</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">@drawTexture</span> <span class="nx">@texture</span>  <span class="k">if</span> <span class="nx">@texture</span>
  
  <span class="nv">drawTexture: </span><span class="nf">(url) -&gt;</span>
    <span class="vi">@cachedTexture = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
    <span class="vi">@cachedTexture.onload = </span><span class="o">=&gt;</span>
      <span class="nx">@drawCachedTexture</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@cachedTexture.src = @texture = </span><span class="nx">url</span> <span class="c1"># make absolute</span>
  </pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>tiles the texture</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawCachedTexture: </span><span class="nf">-&gt;</span>
    <span class="nv">bg = </span><span class="nx">@cachedTexture</span>
    <span class="nv">cols = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@image</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
    <span class="nv">lines = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@image</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">lines</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">cols</span><span class="p">]</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">bg</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">width</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Morph.prototype.drawCachedTexture = function () {
   var context = this.image.getContext('2d'),
       pattern = context.createPattern(this.cachedTexture, 'repeat');
context.fillStyle = pattern;
   context.fillRect(0, 0, this.image.width, this.image.height);
   this.changed();
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>This method only paints this very morph's "image",
it doesn't descend the children
recursively. The recursion mechanism is done by recursivelyBlit, which
eventually invokes blit.
Note that this morph might paint something on the screen even if
it's not a "leaf".</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">blit: </span><span class="nf">(aCanvas, clippingRectangle = @bounds) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@isVisible</span>
    <span class="nv">area = </span><span class="nx">clippingRectangle</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">).</span><span class="nx">round</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>test whether anything that we are going to be drawing
is visible (i.e. within the clippingRectangle)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">()</span>
      <span class="nv">delta = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">neg</span><span class="p">()</span>
      <span class="nv">src = </span><span class="nx">area</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">).</span><span class="nx">round</span><span class="p">()</span>
      <span class="nv">context = </span><span class="nx">aCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
      <span class="nv">context.globalAlpha = </span><span class="nx">@alpha</span>
      <span class="nv">sl = </span><span class="nx">src</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nv">st = </span><span class="nx">src</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nv">al = </span><span class="nx">area</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nv">at = </span><span class="nx">area</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">@image</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">sl</span><span class="p">)</span>
      <span class="nv">h = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span> <span class="nx">@image</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">st</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">1</span>

      <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">@image</span><span class="p">,</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">sl</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">st</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">w</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">h</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">al</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">at</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">w</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>

      <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">showRedraws</span>
        <span class="nv">randomR = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
        <span class="nv">randomG = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
        <span class="nv">randomB = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
        <span class="nv">context.globalAlpha = </span><span class="mf">0.5</span>
        <span class="nv">context.fillStyle = </span><span class="s">&quot;rgb(&quot;</span><span class="o">+</span><span class="nx">randomR</span><span class="o">+</span><span class="s">&quot;,&quot;</span><span class="o">+</span><span class="nx">randomG</span><span class="o">+</span><span class="s">&quot;,&quot;</span><span class="o">+</span><span class="nx">randomB</span><span class="o">+</span><span class="s">&quot;)&quot;</span><span class="p">;</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">al</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">at</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">w</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">h</span><span class="p">));</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>"for debugging purposes:"</p>

<pre><code>try {
    context.drawImage(
        this.image,
        src.left(),
        src.top(),
        w,
        h,
        area.left(),
        area.top(),
        w,
        h
    );
} catch (err) {
    alert('internal error\n\n' + err
        + '\n ---'
        + '\n canvas: ' + aCanvas
        + '\n canvas.width: ' + aCanvas.width
        + '\n canvas.height: ' + aCanvas.height
        + '\n ---'
        + '\n image: ' + this.image
        + '\n image.width: ' + this.image.width
        + '\n image.height: ' + this.image.height
        + '\n ---'
        + '\n w: ' + w
        + '\n h: ' + h
        + '\n sl: ' + sl
        + '\n st: ' + st
        + '\n area.left: ' + area.left()
        + '\n area.top ' + area.top()
        );
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">recursivelyBlit: </span><span class="p">(</span><span class="nx">aCanvas</span><span class="p">,</span> <span class="nv">clippingRectangle = </span><span class="nx">@boundsIncludingChildren</span><span class="p">())</span> <span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@isVisible</span>
    <span class="nx">@blit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">clippingRectangle</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">clippingRectangle</span>
  
  
  <span class="nv">hide: </span><span class="nf">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="kc">false</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  
  <span class="nv">show: </span><span class="nf">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
  
  
  <span class="nv">toggleVisibility: </span><span class="nf">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="p">(</span><span class="o">not</span> <span class="nx">@isVisible</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">toggleVisibility</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Morph full image:</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>this function is not used.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fullImageClassic: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>why doesn't this work for all Morphs?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nx">@recursivelyBlit</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">fb</span>
    <span class="nv">img.globalAlpha = </span><span class="nx">@alpha</span>
    <span class="nx">img</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>fixes https://github.com/jmoenig/morphic.js/issues/7</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fullImage: </span><span class="nf">-&gt;</span>
    <span class="nv">boundsIncludingChildren = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">boundsIncludingChildren</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nv">ctx = </span><span class="nx">img</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span> <span class="o">-</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="p">,</span> <span class="o">-</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@recursivelyBlit</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">boundsIncludingChildren</span>
    <span class="nx">img</span>

  <span class="nv">fullImageData: </span><span class="nf">-&gt;</span>
    <span class="nx">@fullImage</span><span class="p">().</span><span class="nx">toDataURL</span><span class="p">()</span>

  <span class="nv">fullImageHashCode: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">hashCode</span><span class="p">(</span><span class="nx">@fullImageData</span><span class="p">())</span>
  </pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Morph shadow:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shadowImage: </span><span class="nf">(off_, color) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>fallback for Windows Chrome-Shadow bug</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">extent</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">@fullImage</span><span class="p">()</span>
    <span class="nv">outline = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">outline</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">outline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;source-atop&quot;</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">sha</span>
  
  <span class="nv">shadowImageBlurred: </span><span class="nf">(off_, color) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">blur = </span><span class="nx">@shadowBlur</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">blur</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nv">img = </span><span class="nx">@fullImage</span><span class="p">()</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">ctx.shadowBlur = </span><span class="nx">blur</span>
    <span class="nv">ctx.shadowColor = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowBlur = </span><span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">sha</span>
  
  <span class="nv">shadow: </span><span class="nf">(off_, a, color) -&gt;</span>
    <span class="nv">shadow = </span><span class="k">new</span> <span class="nx">ShadowMorph</span><span class="p">()</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">alpha = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.2</span><span class="p">))</span>
    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nx">shadow</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@shadowBlur</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">useBlurredShadows</span>
      <span class="nv">shadow.image = </span><span class="nx">@shadowImageBlurred</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
      <span class="nv">shadow.alpha = </span><span class="nx">alpha</span>
      <span class="nx">shadow</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@shadowBlur</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">shadow.image = </span><span class="nx">@shadowImage</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
      <span class="nv">shadow.alpha = </span><span class="nx">alpha</span>
      <span class="nx">shadow</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">)</span>
    <span class="nx">shadow</span>
  
  <span class="nv">addShadow: </span><span class="nf">(off_, a, color) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">alpha = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.2</span><span class="p">))</span>
    <span class="nv">shadow = </span><span class="nx">@shadow</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
    <span class="nx">@addBack</span> <span class="nx">shadow</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
    <span class="nx">shadow</span>
  
  <span class="nv">getShadow: </span><span class="nf">-&gt;</span>
    <span class="nv">shadows = </span><span class="nx">@children</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(child) -&gt;</span>
      <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nx">shadows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">shadows</span><span class="p">.</span><span class="nx">length</span>
    <span class="kc">null</span>
  
  <span class="nv">removeShadow: </span><span class="nf">-&gt;</span>
    <span class="nv">shadow = </span><span class="nx">@getShadow</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">shadow</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@removeChild</span> <span class="nx">shadow</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Morph pen trails:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">penTrails: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>answer my pen trails canvas. default is to answer my image</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@image</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Morph updating ///////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">changed: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@trackChanges</span>
      <span class="nv">w = </span><span class="nx">@root</span><span class="p">()</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@visibleBounds</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">w</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">childChanged</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">fullChanged: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@trackChanges</span>
      <span class="nv">w = </span><span class="nx">@root</span><span class="p">()</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">w</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
  
  <span class="nv">childChanged: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>react to a  change in one of my children,
default is to just pass this message on upwards
override this method for Morphs that need to adjust accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">childChanged</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Morph accessing - structure //////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">world: </span><span class="nf">-&gt;</span>
    <span class="nv">root = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">root</span>  <span class="k">if</span> <span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">world</span>  <span class="k">if</span> <span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">HandMorph</span>
    <span class="kc">null</span>
  
  <span class="nv">add: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">owner = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="nx">owner</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">owner</span><span class="o">?</span>
    <span class="nx">@addChild</span> <span class="nx">aMorph</span>
  
  <span class="nv">addBack: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">owner = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="nx">owner</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">owner</span><span class="o">?</span>
    <span class="nx">@addChildFirst</span> <span class="nx">aMorph</span>
  
  <span class="nv">topMorphSuchThat: </span><span class="nf">(predicate) -&gt;</span>
    <span class="k">if</span> <span class="nx">predicate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
      <span class="nv">next = </span><span class="nx">detect</span><span class="p">(</span><span class="nx">@children</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">(),</span> <span class="nx">predicate</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">topMorphSuchThat</span><span class="p">(</span><span class="nx">predicate</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">next</span>
      <span class="k">return</span> <span class="nx">@</span>
    <span class="kc">null</span>
  
  <span class="nv">morphAt: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@allChildren</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nv">result = </span><span class="nx">m</span>  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">result</span> <span class="o">is</span> <span class="kc">null</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  </pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>alternative -  more elegant and possibly more
performant - solution for morphAt.
Has some issues, commented out for now</p>

<p>Morph.prototype.morphAt = function (aPoint) {
return this.topMorphSuchThat(function (m) {
    return m.boundsIncludingChildren().containsPoint(aPoint);
});
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>used for example:
- to determine which morphs you can attach a morph to
- for a SliderMorph's "set target" so you can change properties of another Morph
- by the HandleMorph when you attach it to some other morph</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">overlappedMorphs: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>find all morphs in the world that intersect me,
excluding myself and the World
and any of my parents
   (cause I'm already attached to them directly or indirectly)
or any of my children
   (cause they are already attached to me directly or indirectly)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nv">allParents = </span><span class="nx">@allParents</span><span class="p">()</span>
    <span class="nv">allChildren = </span><span class="nx">@allChildren</span><span class="p">()</span>
    <span class="nv">morphs = </span><span class="nx">world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">()</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(m) =&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span>
        <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@</span> <span class="o">and</span>
        <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">world</span> <span class="o">and</span>
        <span class="o">not</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">allParents</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="o">and</span>
        <span class="o">not</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">allChildren</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="o">and</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">().</span><span class="nx">intersects</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Morph pixel access:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getPixelColor: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">point = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">data = </span><span class="nx">context</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  
  <span class="nv">isTransparentAt: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">if</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">false</span>  <span class="k">if</span> <span class="nx">@texture</span>
      <span class="nv">point = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
      <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
      <span class="nv">data = </span><span class="nx">context</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>check the 4th byte - the Alpha (RGBA)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Morph duplicating ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">copy: </span><span class="nf">-&gt;</span>
    <span class="nv">c = </span><span class="nx">copy</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="nv">c.parent = </span><span class="kc">null</span>
    <span class="nv">c.children = </span><span class="p">[]</span>
    <span class="nv">c.bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">c</span>
  
  <span class="nv">fullCopy: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Produce a copy of me with my entire tree of submorphs. Morphs
mentioned more than once are all directed to a single new copy.
Other properties are also <em>shallow</em> copied, so you must override
to deep copy Arrays and (complex) Objects</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dict = </span><span class="p">{}</span>
    <span class="nv">c = </span><span class="nx">@copyRecordingReferences</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">forAllChildren</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">updateReferences</span> <span class="nx">dict</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">c</span>
  
  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Recursively copy this entire composite morph, recording the
correspondence between old and new morphs in the given dictionary.
This dictionary will be used to update intra-composite references
in the copy. See updateReferences().
Note: This default implementation copies ONLY morphs in the
submorph hierarchy. If a morph stores morphs in other properties
that it wants to copy, then it should override this method to do so.
The same goes for morphs that contain other complex data that
should be copied when the morph is duplicated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="nx">@copy</span><span class="p">()</span>
    <span class="nx">dict</span><span class="p">[</span><span class="nx">@</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">m</span><span class="p">.</span><span class="nx">copyRecordingReferences</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">c</span>
  
  <span class="nv">updateReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Update intra-morph references within a composite morph that has
been copied. For example, if a button refers to morph X in the
orginal composite then the copy of that button in the new composite
should refer to the copy of X in new composite, not the original X.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">@</span>
      <span class="nx">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">property</span><span class="p">.</span><span class="nx">isMorph</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Morph dragging and dropping /////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">rootForGrab: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
    <span class="k">return</span> <span class="nx">@parent</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span>
      <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span> <span class="o">or</span>
      <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span> <span class="o">or</span>
      <span class="nx">@isDraggable</span> <span class="o">is</span> <span class="kc">true</span>
        <span class="k">return</span> <span class="nx">@</span>  
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>
  
  <span class="nv">wantsDropOf: </span><span class="nf">(aMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>default is to answer the general flag - change for my heirs</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">HandleMorph</span><span class="p">)</span> <span class="o">or</span>
      <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">MenuMorph</span><span class="p">)</span> <span class="o">or</span>
      <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">InspectorMorph</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>  
    <span class="nx">@acceptsDrops</span>
  
  <span class="nv">pickUp: </span><span class="nf">(wrrld) -&gt;</span>
    <span class="nv">world = </span><span class="nx">wrrld</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">grab</span> <span class="nx">@</span>
  
  <span class="nv">isPickedUp: </span><span class="nf">-&gt;</span>
    <span class="nx">@parentThatIsA</span><span class="p">(</span><span class="nx">HandMorph</span><span class="p">)</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">situation: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>answer a dictionary specifying where I am right now, so
I can slide back to it if I'm dropped somewhere else</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@parent</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="nv">origin: </span><span class="nx">@parent</span>
        <span class="nv">position: </span><span class="nx">@position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">position</span><span class="p">())</span>
      <span class="p">)</span>
    <span class="kc">null</span>
  
  <span class="nv">slideBackTo: </span><span class="nf">(situation, inSteps) -&gt;</span>
    <span class="nv">steps = </span><span class="nx">inSteps</span> <span class="o">or</span> <span class="mi">5</span>
    <span class="nv">pos = </span><span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">situation</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
    <span class="nv">xStep = </span><span class="o">-</span><span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span>
    <span class="nv">yStep = </span><span class="o">-</span><span class="p">(</span><span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span>
    <span class="nv">stepCount = </span><span class="mi">0</span>
    <span class="nv">oldStep = </span><span class="nx">@step</span>
    <span class="nv">oldFps = </span><span class="nx">@fps</span>
    <span class="vi">@fps = </span><span class="mi">0</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@silentMoveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">xStep</span><span class="p">,</span> <span class="nx">yStep</span><span class="p">)</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">stepCount</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">stepCount</span> <span class="o">is</span> <span class="nx">steps</span>
        <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
        <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">reactToDropOf</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">reactToDropOf</span>
        <span class="vi">@step = </span><span class="nx">oldStep</span>
        <span class="vi">@fps = </span><span class="nx">oldFps</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Morph utilities ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">resize: </span><span class="nf">-&gt;</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nv">activeHandle = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
  
  <span class="nv">move: </span><span class="nf">-&gt;</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nv">activeHandle = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">)</span>
  
  <span class="nv">hint: </span><span class="nf">(msg) -&gt;</span>
    <span class="nv">text = </span><span class="nx">msg</span>
    <span class="k">if</span> <span class="nx">msg</span>
      <span class="nv">text = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="s">&quot;NULL&quot;</span>
    <span class="nv">m = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span>
    <span class="nv">m.isDraggable = </span><span class="kc">true</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">popUpCenteredAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">inform: </span><span class="nf">(msg) -&gt;</span>
    <span class="nv">text = </span><span class="nx">msg</span>
    <span class="k">if</span> <span class="nx">msg</span>
      <span class="nv">text = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="s">&quot;NULL&quot;</span>
    <span class="nv">m = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span>
    <span class="nv">m.isDraggable = </span><span class="kc">true</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">popUpCenteredAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">prompt: </span><span class="nf">(msg, callback, environment, defaultContents, width, floorNum,</span>
<span class="nf">    ceilingNum, isRounded) -&gt;</span>
    <span class="nv">isNumeric = </span><span class="kc">true</span>  <span class="k">if</span> <span class="nx">ceilingNum</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">callback</span> <span class="o">or</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">environment</span> <span class="o">or</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">entryField = </span><span class="k">new</span> <span class="nx">StringFieldMorph</span><span class="p">(</span>
      <span class="nx">defaultContents</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">width</span> <span class="o">or</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterFontSize</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterFontName</span><span class="p">,</span>
      <span class="kc">false</span><span class="p">,</span>
      <span class="kc">false</span><span class="p">,</span>
      <span class="nx">isNumeric</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">entryField</span>
    <span class="k">if</span> <span class="nx">ceilingNum</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useSliderForInput</span>
      <span class="nv">slider = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span>
        <span class="nx">floorNum</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">ceilingNum</span><span class="p">,</span>
        <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">defaultContents</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">ceilingNum</span> <span class="o">-</span> <span class="nx">floorNum</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
      <span class="nv">slider.alpha = </span><span class="mi">1</span>
      <span class="nv">slider.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">)</span>
      <span class="nv">slider.button.color = </span><span class="nx">menu</span><span class="p">.</span><span class="nx">borderColor</span>
      <span class="nv">slider.button.highlightColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">highlightColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">100</span>
      <span class="nv">slider.button.pressColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">pressColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">150</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterSliderSize</span>
      <span class="k">if</span> <span class="nx">isRounded</span>
        <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nv">entryField.text.text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nv">entryField.text.text = </span><span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slider</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span> <span class="mi">2</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">entryField</span><span class="p">.</span><span class="nx">string</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">menu.isDraggable = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">pickColor: </span><span class="nf">(msg, callback, environment, defaultContents) -&gt;</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">callback</span> <span class="o">or</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">environment</span> <span class="o">or</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">colorPicker = </span><span class="k">new</span> <span class="nx">ColorPickerMorph</span><span class="p">(</span><span class="nx">defaultContents</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">colorPicker</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span> <span class="mi">2</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">colorPicker</span><span class="p">.</span><span class="nx">getChoice</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">menu.isDraggable = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">inspect: </span><span class="nf">(anotherObject) -&gt;</span>
    <span class="nv">world = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@world</span> <span class="k">instanceof</span> <span class="nb">Function</span> <span class="k">then</span> <span class="nx">@world</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="nx">@root</span><span class="p">()</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">))</span>
    <span class="nv">inspectee = </span><span class="nx">@</span>
    <span class="nv">inspectee = </span><span class="nx">anotherObject</span>  <span class="k">if</span> <span class="nx">anotherObject</span>
    <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">inspectee</span><span class="p">)</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Morph menus ////////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">contextMenu: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">@customContextMenu</span>  <span class="k">if</span> <span class="nx">@customContextMenu</span>
    <span class="nv">world = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@world</span> <span class="k">instanceof</span> <span class="nb">Function</span> <span class="k">then</span> <span class="nx">@world</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="nx">@root</span><span class="p">()</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">world</span> <span class="o">and</span> <span class="nx">world</span><span class="p">.</span><span class="nx">isDevMode</span>
      <span class="k">return</span> <span class="nx">@developersMenu</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="nx">world</span>
      <span class="k">return</span> <span class="nx">@hierarchyMenu</span><span class="p">()</span>
    <span class="nx">@userMenu</span><span class="p">()</span> <span class="o">or</span> <span class="p">(</span><span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">userMenu</span><span class="p">())</span>
  
  <span class="nv">hierarchyMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">parents = </span><span class="nx">@allParents</span><span class="p">()</span>
    <span class="nv">world = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@world</span> <span class="k">instanceof</span> <span class="nb">Function</span> <span class="k">then</span> <span class="nx">@world</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="nx">@root</span><span class="p">()</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">))</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">parents</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) -&gt;</span>
      <span class="k">if</span> <span class="nx">each</span><span class="p">.</span><span class="nx">developersMenu</span> <span class="o">and</span> <span class="p">(</span><span class="nx">each</span> <span class="o">isnt</span> <span class="nx">world</span><span class="p">)</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="nf">-&gt;</span>
          <span class="nx">each</span><span class="p">.</span><span class="nx">developersMenu</span><span class="p">().</span><span class="nx">popUpAtHand</span> <span class="nx">world</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span>
  
  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>'name' is not an official property of a function, hence:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">world = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@world</span> <span class="k">instanceof</span> <span class="nb">Function</span> <span class="k">then</span> <span class="nx">@world</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="nx">@root</span><span class="p">()</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">))</span>
    <span class="nv">userMenu = </span><span class="nx">@userMenu</span><span class="p">()</span> <span class="o">or</span> <span class="p">(</span><span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">userMenu</span><span class="p">())</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span>
      <span class="nx">@</span><span class="p">,</span>
      <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nx">userMenu</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;user features...&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
        <span class="nx">userMenu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">world</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncolor:&quot;</span><span class="p">,</span> <span class="nx">@setColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@color</span>
    <span class="p">),</span> <span class="s">&quot;choose another color \nfor this morph&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;transparency...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nalpha\nvalue:&quot;</span><span class="p">,</span>
        <span class="nx">@setAlphaScaled</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="p">(</span><span class="nx">@alpha</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this morph&#39;s\nalpha value&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;resize...&quot;</span><span class="p">,</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="s">&quot;show a handle\nwhich can be dragged\nto change this morph&#39;s&quot;</span> <span class="o">+</span> <span class="s">&quot; extent&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;duplicate&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@fullCopy</span><span class="p">().</span><span class="nx">pickUp</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="p">),</span> <span class="s">&quot;make a copy\nand pick it up&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pick up&quot;</span><span class="p">,</span> <span class="s">&quot;pickUp&quot;</span><span class="p">,</span> <span class="s">&quot;disattach and put \ninto the hand&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;attach...&quot;</span><span class="p">,</span> <span class="s">&quot;attach&quot;</span><span class="p">,</span> <span class="s">&quot;stick this morph\nto another one&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move...&quot;</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">,</span> <span class="s">&quot;show a handle\nwhich can be dragged\nto move this morph&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect...&quot;</span><span class="p">,</span> <span class="s">&quot;inspect&quot;</span><span class="p">,</span> <span class="s">&quot;open a window\non all properties&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pic...&quot;</span><span class="p">,</span> <span class="p">(()</span><span class="nf">-&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">@fullImageData</span><span class="p">())),</span> <span class="s">&quot;open a new window\nwith a picture of this morph&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isDraggable</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;lock&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsDraggable&quot;</span><span class="p">,</span> <span class="s">&quot;make this morph\nunmovable&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;unlock&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsDraggable&quot;</span><span class="p">,</span> <span class="s">&quot;make this morph\nmovable&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="s">&quot;hide&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;delete&quot;</span><span class="p">,</span> <span class="s">&quot;destroy&quot;</span>
    <span class="k">unless</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;World...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
        <span class="nx">world</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">().</span><span class="nx">popUpAtHand</span> <span class="nx">world</span>
      <span class="p">),</span> <span class="s">&quot;show the\nWorld&#39;s menu&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">userMenu: </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Morph menu actions</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">calculateAlphaScaled: </span><span class="nf">(alpha) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">alpha</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="nv">unscaled = </span><span class="nx">alpha</span> <span class="o">/</span> <span class="mi">100</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">unscaled</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newAlpha = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
      <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newAlpha</span><span class="p">)</span>
        <span class="nv">unscaled = </span><span class="nx">newAlpha</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">unscaled</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

  <span class="nv">setAlphaScaled: </span><span class="nf">(alpha) -&gt;</span>
    <span class="vi">@alpha = </span><span class="nx">@calculateAlphaScaled</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">attach: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose new parent:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="nx">each</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
        <span class="vi">@isDraggable = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span>
  
  <span class="nv">toggleIsDraggable: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isDraggable = </span><span class="o">not</span> <span class="nx">@isDraggable</span>
  
  <span class="nv">colorSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span>
  
  <span class="nv">numericalSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;setLeft&quot;</span><span class="p">,</span> <span class="s">&quot;setTop&quot;</span><span class="p">,</span> <span class="s">&quot;setWidth&quot;</span><span class="p">,</span> <span class="s">&quot;setHeight&quot;</span><span class="p">,</span> <span class="s">&quot;setAlphaScaled&quot;</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Morph entry field tabbing //////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">allEntryFields: </span><span class="nf">-&gt;</span>
    <span class="nx">@allChildren</span><span class="p">().</span><span class="nx">filter</span> <span class="nf">(each) -&gt;</span>
      <span class="nx">each</span><span class="p">.</span><span class="nx">isEditable</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">each</span> <span class="k">instanceof</span> <span class="nx">StringMorph</span> <span class="o">||</span> <span class="nx">each</span> <span class="k">instanceof</span> <span class="nx">TextMorph</span><span class="p">);</span>
  
  
  <span class="nv">nextEntryField: </span><span class="nf">(current) -&gt;</span>
    <span class="nv">fields = </span><span class="nx">@allEntryFields</span><span class="p">()</span>
    <span class="nv">idx = </span><span class="nx">fields</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
  <span class="nv">previousEntryField: </span><span class="nf">(current) -&gt;</span>
    <span class="nv">fields = </span><span class="nx">@allEntryFields</span><span class="p">()</span>
    <span class="nv">idx = </span><span class="nx">fields</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nx">idx</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
      <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
  <span class="nv">tab: </span><span class="nf">(editField) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>the <tab> key was pressed in one of my edit fields.
invoke my "nextTab()" function if it exists, else
propagate it up my owner chain.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@nextTab</span>
      <span class="nx">@nextTab</span> <span class="nx">editField</span>
    <span class="k">else</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">tab</span> <span class="nx">editField</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">backTab: </span><span class="nf">(editField) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>the <back tab> key was pressed in one of my edit fields.
invoke my "previousTab()" function if it exists, else
propagate it up my owner chain.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@previousTab</span>
      <span class="nx">@previousTab</span> <span class="nx">editField</span>
    <span class="k">else</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">backTab</span> <span class="nx">editField</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>the following are examples of what the navigation methods should
look like. Insert these at the World level for fallback, and at lower
levels in the Morphic tree (e.g. dialog boxes) for a more fine-grained
control over the tabbing cycle.</p>

<p>Morph.prototype.nextTab = function (editField) {
var    next = this.nextEntryField(editField);
editField.clearSelection();
next.selectAll();
next.edit();
};</p>

<p>Morph.prototype.previousTab = function (editField) {
var    prev = this.previousEntryField(editField);
editField.clearSelection();
prev.selectAll();
prev.edit();
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Morph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">escalateEvent: </span><span class="nf">(functionName, arg) -&gt;</span>
    <span class="nv">handler = </span><span class="nx">@parent</span>
    <span class="nv">handler = </span><span class="nx">handler</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">while</span> <span class="o">not</span> <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span> <span class="o">and</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">parent</span><span class="o">?</span>
    <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span> <span class="nx">arg</span>  <span class="k">if</span> <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Morph eval:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">evaluateString: </span><span class="nf">(code) -&gt;</span>
    <span class="k">try</span>
      <span class="nv">result = </span><span class="nb">eval</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span>
    <span class="nx">result</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>Morph collision detection - not used anywhere at the moment ////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">isTouching: </span><span class="nf">(otherMorph) -&gt;</span>
    <span class="nv">oImg = </span><span class="nx">@overlappingImage</span><span class="p">(</span><span class="nx">otherMorph</span><span class="p">)</span>
    <span class="nv">data = </span><span class="nx">oImg</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">oImg</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">oImg</span><span class="p">.</span><span class="nx">height</span><span class="p">).</span><span class="nx">data</span>
    <span class="nx">detect</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nf">(each) -&gt;</span>
      <span class="nx">each</span> <span class="o">isnt</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">overlappingImage: </span><span class="nf">(otherMorph) -&gt;</span>
    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nv">otherFb = </span><span class="nx">otherMorph</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">()</span>
    <span class="nv">oRect = </span><span class="nx">fb</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">)</span>
    <span class="nv">oImg = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nv">ctx = </span><span class="nx">oImg</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">@fullImage</span><span class="p">(),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;source-in&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">otherMorph</span><span class="p">.</span><span class="nx">fullImage</span><span class="p">(),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">oImg</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>HandMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>The mouse cursor. Note that it's not a child of the WorldMorph, this Morph
is never added to any other morph. [TODO] Find out why and write explanation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">HandMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">world: </span><span class="kc">null</span>
  <span class="nv">mouseButton: </span><span class="kc">null</span>
  <span class="nv">mouseDownMorph: </span><span class="kc">null</span>
  <span class="nv">morphToGrab: </span><span class="kc">null</span>
  <span class="nv">grabOrigin: </span><span class="kc">null</span>
  <span class="nv">mouseOverList: </span><span class="kc">null</span>
  <span class="nv">temporaries: </span><span class="kc">null</span>
  <span class="nv">touchHoldTimeout: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@world) -&gt;</span>
    <span class="vi">@mouseOverList = </span><span class="p">[]</span>
    <span class="vi">@temporaries = </span><span class="p">[]</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
  
  <span class="nv">changed: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@world</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nv">b = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
      <span class="nx">@world</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">b</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">eq</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">())</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>HandMorph navigation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">morphAtPointer: </span><span class="nf">-&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) =&gt;</span>
      <span class="nv">result = </span><span class="nx">m</span>  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">visibleBounds</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span> <span class="o">and</span>
        <span class="nx">result</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">noticesTransparentClick</span> <span class="o">or</span>
        <span class="p">(</span><span class="o">not</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isTransparentAt</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)))</span> <span class="o">and</span> <span class="p">(</span><span class="nx">m</span> <span class="o">not</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">result</span>  <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@world</span>
  </pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>alternative -  more elegant and possibly more
performant - solution for morphAtPointer.
Has some issues, commented out for now</p>

<p>HandMorph.prototype.morphAtPointer = function () {
var myself = this;
return this.world.topMorphSuchThat(function (m) {
    return m.visibleBounds().containsPoint(myself.bounds.origin) &amp;&amp;
        m.isVisible &amp;&amp;
        (m.noticesTransparentClick ||
            (! m.isTransparentAt(myself.bounds.origin))) &amp;&amp;
        (! (m instanceof ShadowMorph));
});
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">allMorphsAtPointer: </span><span class="nf">-&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">()</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(m) =&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span> <span class="nx">m</span><span class="p">.</span><span class="nx">visibleBounds</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
  
  
  </pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>HandMorph dragging and dropping:</p>

<p>drag 'n' drop events, method(arg) -> receiver:</p>

<pre><code>prepareToBeGrabbed(handMorph) -&gt; grabTarget
reactToGrabOf(grabbedMorph) -&gt; oldParent
wantsDropOf(morphToDrop) -&gt;  newParent
justDropped(handMorph) -&gt; droppedMorph
reactToDropOf(droppedMorph, handMorph) -&gt; newParent
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">dropTargetFor: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">target = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">target = </span><span class="nx">target</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">target</span><span class="p">.</span><span class="nx">wantsDropOf</span><span class="p">(</span><span class="nx">aMorph</span><span class="p">)</span>
    <span class="nx">target</span>
  
  <span class="nv">grab: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">oldParent = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">@world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>
      <span class="vi">@grabOrigin = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">situation</span><span class="p">()</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">addShadow</span><span class="p">()</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">prepareToBeGrabbed</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">prepareToBeGrabbed</span>
      <span class="nx">@add</span> <span class="nx">aMorph</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">oldParent</span><span class="p">.</span><span class="nx">reactToGrabOf</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">oldParent</span> <span class="o">and</span> <span class="nx">oldParent</span><span class="p">.</span><span class="nx">reactToGrabOf</span>
  
  <span class="nv">drop: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">morphToDrop = </span><span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">target = </span><span class="nx">@dropTargetFor</span><span class="p">(</span><span class="nx">morphToDrop</span><span class="p">)</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">target</span><span class="p">.</span><span class="nx">add</span> <span class="nx">morphToDrop</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">removeShadow</span><span class="p">()</span>
      <span class="vi">@children = </span><span class="p">[]</span>
      <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">()</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">justDropped</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">justDropped</span>
      <span class="nx">target</span><span class="p">.</span><span class="nx">reactToDropOf</span> <span class="nx">morphToDrop</span><span class="p">,</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">reactToDropOf</span>
      <span class="vi">@dragOrigin = </span><span class="kc">null</span>
  </pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>HandMorph event dispatching:</p>

<p>mouse events:</p>

<pre><code>mouseDownLeft
mouseDownRight
mouseClickLeft
mouseClickRight
mouseEnter
mouseLeave
mouseEnterDragging
mouseLeaveDragging
mouseMove
mouseScroll
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processMouseDown: </span><span class="nf">(button, ctrlKey) -&gt;</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">addMouseDownEvent</span><span class="p">(</span><span class="nx">button</span><span class="p">,</span> <span class="nx">ctrlKey</span><span class="p">)</span>

    <span class="nx">@destroyTemporaries</span><span class="p">()</span>
    <span class="vi">@morphToGrab = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">@drop</span><span class="p">()</span>
      <span class="vi">@mouseButton = </span><span class="kc">null</span>
    <span class="k">else</span>
      <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span>
        <span class="k">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">allParents</span><span class="p">(),</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">)</span>
          <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="o">isnt</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span>
          <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>    
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">cursor</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="o">isnt</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">target</span>  
          <span class="nx">@world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  
      <span class="vi">@morphToGrab = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseMove</span>
      <span class="k">if</span> <span class="nx">button</span> <span class="o">is</span> <span class="mi">2</span> <span class="o">or</span> <span class="nx">ctrlKey</span>
        <span class="vi">@mouseButton = </span><span class="s">&quot;right&quot;</span>
        <span class="nv">actualClick = </span><span class="s">&quot;mouseDownRight&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickRight&quot;</span>
      <span class="k">else</span>
        <span class="vi">@mouseButton = </span><span class="s">&quot;left&quot;</span>
        <span class="nv">actualClick = </span><span class="s">&quot;mouseDownLeft&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickLeft&quot;</span>
      <span class="vi">@mouseDownMorph = </span><span class="nx">morph</span>
      <span class="vi">@mouseDownMorph = </span><span class="nx">@mouseDownMorph</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">@mouseDownMorph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span>
      <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">morph</span><span class="p">[</span><span class="nx">actualClick</span><span class="p">]</span>
      <span class="nx">morph</span><span class="p">[</span><span class="nx">actualClick</span><span class="p">]</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
  
  <span class="nv">processTouchStart: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>simulate mouseRightClick</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@touchHoldTimeout = </span><span class="nx">setInterval</span><span class="p">(</span><span class="o">=&gt;</span>
        <span class="nx">@processMouseDown</span> <span class="nv">button: </span><span class="mi">2</span>
        <span class="nx">@processMouseUp</span> <span class="nv">button: </span><span class="mi">2</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
      <span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
      <span class="nx">@processMouseMove</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># update my position</span>
      <span class="nx">@processMouseDown</span> <span class="nv">button: </span><span class="mi">0</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
  
  <span class="nv">processTouchMove: </span><span class="nf">(event) -&gt;</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="nv">touch = </span><span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@processMouseMove</span> <span class="nx">touch</span>
      <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
  
  <span class="nv">processTouchEnd: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
    <span class="nx">@processMouseUp</span> <span class="nv">button: </span><span class="mi">0</span>
  
  <span class="nv">processMouseUp: </span><span class="nf">-&gt;</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">addMouseUpEvent</span><span class="p">()</span>

    <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nx">@destroyTemporaries</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">@drop</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">@mouseButton</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickLeft&quot;</span>
      <span class="k">else</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickRight&quot;</span>
        <span class="k">if</span> <span class="nx">@mouseButton</span>
          <span class="nv">context = </span><span class="nx">morph</span>
          <span class="nv">contextMenu = </span><span class="nx">context</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">()</span>
          <span class="k">while</span> <span class="p">(</span><span class="o">not</span> <span class="nx">contextMenu</span><span class="p">)</span> <span class="o">and</span> <span class="nx">context</span><span class="p">.</span><span class="nx">parent</span>
            <span class="nv">context = </span><span class="nx">context</span><span class="p">.</span><span class="nx">parent</span>
            <span class="nv">contextMenu = </span><span class="nx">context</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">()</span>
          <span class="nx">contextMenu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span>  <span class="k">if</span> <span class="nx">contextMenu</span>
      <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">morph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span>
      <span class="nx">morph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
    <span class="vi">@mouseButton = </span><span class="kc">null</span>
  
  <span class="nv">processMouseScroll: </span><span class="nf">(event) -&gt;</span>
    <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">while</span> <span class="nx">morph</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseScroll</span>
    <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseScroll</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span> <span class="o">/</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s">&quot;wheelDeltaY&quot;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDeltaY</span> <span class="o">/</span> <span class="mi">120</span> <span class="k">else</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">/</span> <span class="mi">120</span><span class="p">)),</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDeltaX</span> <span class="o">/</span> <span class="mi">120</span> <span class="o">or</span> <span class="mi">0</span>  <span class="k">if</span> <span class="nx">morph</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>drop event:</p>

<pre><code>   droppedImage
   droppedSVG
   droppedAudio
   droppedText
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processDrop: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>find out whether an external image or audio file was dropped
   onto the world canvas, turn it into an offscreen canvas or audio
   element and dispatch the</p>

<pre><code>   droppedImage(canvas, name)
   droppedSVG(image, name)
   droppedAudio(audio, name)
</code></pre>

<p>events to interested Morphs at the mouse pointer
   if none of the above content types can be determined, the file contents
   is dispatched as an ArrayBuffer to interested Morphs:</p>

<p><code>droppedBinary(anArrayBuffer, name)</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">files = </span><span class="p">(</span><span class="k">if</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="nx">FileList</span> <span class="k">then</span> <span class="nx">event</span> <span class="k">else</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">files</span><span class="p">))</span>
    <span class="nv">txt = </span><span class="p">(</span><span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span> <span class="k">then</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;Text/HTML&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">targetDrop = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>

    <span class="nv">readSVG = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">pic = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">target = </span><span class="nx">target</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">target</span><span class="p">.</span><span class="nx">droppedSVG</span>
      <span class="nv">pic.onload = </span><span class="nf">-&gt;</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">droppedSVG</span> <span class="nx">pic</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nv">pic.src = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsDataURL</span> <span class="nx">aFile</span>

    <span class="nv">readImage = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">pic = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span>
      <span class="nv">pic.onload = </span><span class="nf">-&gt;</span>
        <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">pic</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">pic</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">drawImage</span> <span class="nx">pic</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nv">pic.src = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsDataURL</span> <span class="nx">aFile</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">readAudio = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">snd = </span><span class="k">new</span> <span class="nx">Audio</span><span class="p">()</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedAudio</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nv">snd.src = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedAudio</span> <span class="nx">snd</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsDataURL</span> <span class="nx">aFile</span>
    
    <span class="nv">readText = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedText</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedText</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsText</span> <span class="nx">aFile</span>


    <span class="nv">readBinary = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedBinary</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedBinary</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsArrayBuffer</span> <span class="nx">aFile</span>

    <span class="nv">parseImgURL = </span><span class="nf">(html) -&gt;</span>
      <span class="nv">url = </span><span class="s">&quot;&quot;</span>
      <span class="nv">start = </span><span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;&lt;img src=\&quot;&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">start</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">start</span> <span class="o">+=</span> <span class="mi">10</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">start</span><span class="p">...</span><span class="nx">html</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
        <span class="nv">c = </span><span class="nx">html</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="nx">url</span>  <span class="k">if</span> <span class="nx">c</span> <span class="o">is</span> <span class="s">&quot;\&quot;&quot;</span>
        <span class="nv">url = </span><span class="nx">url</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
      <span class="kc">null</span>
    
    <span class="k">if</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">files</span>
        <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;svg&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">rasterizeSVGs</span>
          <span class="nx">readSVG</span> <span class="nx">file</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">readImage</span> <span class="nx">file</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;audio&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">readAudio</span> <span class="nx">file</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">readText</span> <span class="nx">file</span>
        <span class="k">else</span>
          <span class="nx">readBinary</span> <span class="nx">file</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">txt</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span>
      <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">img.onload = </span><span class="nf">-&gt;</span>
        <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span> <span class="nx">canvas</span>
      <span class="nv">src = </span><span class="nx">parseImgURL</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span>
      <span class="nv">img.src = </span><span class="nx">src</span>  <span class="k">if</span> <span class="nx">src</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>HandMorph tools</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroyTemporaries: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>temporaries are just an array of morphs which will be deleted upon
the next mouse click, or whenever another temporary Morph decides
that it needs to remove them. The primary purpose of temporaries is
to display tools tips of speech bubble help.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@temporaries</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(morph) =&gt;</span>
      <span class="k">unless</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">isClickable</span> <span class="o">and</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
        <span class="nx">morph</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
        <span class="nx">@temporaries</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">@temporaries</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">morph</span><span class="p">),</span> <span class="mi">1</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>HandMorph dragging optimization</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span>
    <span class="k">super</span> <span class="nx">delta</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>

  <span class="nv">processMouseMove: </span><span class="nf">(pageX, pageY) -&gt;</span>
    <span class="nx">@world</span><span class="p">.</span><span class="nx">systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">addMouseMoveEvent</span><span class="p">(</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">pageY</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>startProcessMouseMove = new Date().getTime()</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">posInDocument = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@world</span><span class="p">.</span><span class="nx">worldCanvas</span><span class="p">)</span>
    <span class="nv">pos = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">posInDocument</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pageY</span> <span class="o">-</span> <span class="nx">posInDocument</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>determine the new mouse-over-list:
mouseOverNew = this.allMorphsAtPointer();</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">mouseOverNew = </span><span class="nx">@morphAtPointer</span><span class="p">().</span><span class="nx">allParents</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">@children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">@mouseButton</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
      <span class="nv">topMorph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
      <span class="nv">morph = </span><span class="nx">topMorph</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>
      <span class="nx">topMorph</span><span class="p">.</span><span class="nx">mouseMove</span> <span class="nx">pos</span>  <span class="k">if</span> <span class="nx">topMorph</span><span class="p">.</span><span class="nx">mouseMove</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>if a morph is marked for grabbing, just grab it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@morphToGrab</span>
        <span class="k">if</span> <span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">isDraggable</span>
          <span class="nv">morph = </span><span class="nx">@morphToGrab</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">isTemplate</span>
          <span class="nv">morph = </span><span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">fullCopy</span><span class="p">()</span>
          <span class="nv">morph.isTemplate = </span><span class="kc">false</span>
          <span class="nv">morph.isDraggable = </span><span class="kc">true</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
          <span class="vi">@grabOrigin = </span><span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">situation</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>if the mouse has left its boundsIncludingChildren, center it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">fb = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">()</span>
        <span class="k">unless</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
          <span class="vi">@bounds.origin = </span><span class="nx">fb</span><span class="p">.</span><span class="nx">center</span><span class="p">()</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
          <span class="nx">@setPosition</span> <span class="nx">pos</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>endProcessMouseMove = new Date().getTime()
timeProcessMouseMove = endProcessMouseMove - startProcessMouseMove;
console.log('Execution time ProcessMouseMove: ' + timeProcessMouseMove);</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>original, more cautious code for grabbing Morphs,
retained in case of needing    to fall back:</p>

<pre><code>if (morph === this.morphToGrab) {
    if (morph.isDraggable) {
        this.grab(morph);
    } else if (morph.isTemplate) {
        morph = morph.fullCopy();
        morph.isTemplate = false;
        morph.isDraggable = true;
        this.grab(morph);
    }
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@mouseOverList</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(old) -&gt;</span>
      <span class="k">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">mouseOverNew</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span>
        <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeave</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeave</span>
        <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeaveDragging</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeaveDragging</span> <span class="o">and</span> <span class="nx">@mouseButton</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">mouseOverNew</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(newMorph) =&gt;</span>
      <span class="k">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">@mouseOverList</span><span class="p">,</span> <span class="nx">newMorph</span><span class="p">)</span>
        <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnter</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnter</span>
        <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnterDragging</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnterDragging</span> <span class="o">and</span> <span class="nx">@mouseButton</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>autoScrolling support:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
          <span class="k">if</span> <span class="nx">newMorph</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
              <span class="k">if</span> <span class="o">!</span><span class="nx">newMorph</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">insetBy</span><span class="p">(</span>
                <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="p">).</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
                  <span class="nx">newMorph</span><span class="p">.</span><span class="nx">startAutoScrolling</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@mouseOverList = </span><span class="nx">mouseOverNew</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Colors //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Color</span>

  <span class="nv">a: </span><span class="kc">null</span>
  <span class="nv">r: </span><span class="kc">null</span>
  <span class="nv">g: </span><span class="kc">null</span>
  <span class="nv">b: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@r = 0, @g = 0, @b = 0, a) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>all values are optional, just (r, g, b) is fine</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@a = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Color string representation: e.g. 'rgba(255,165,0,1)'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="nf">-&gt;</span>
    <span class="s">&quot;rgba(&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@r</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@g</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@b</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">@a</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Color copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="nf">-&gt;</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">@r</span><span class="p">,</span> <span class="nx">@g</span><span class="p">,</span> <span class="nx">@b</span><span class="p">,</span> <span class="nx">@a</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Color comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eq: </span><span class="nf">(aColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>==</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">aColor</span> <span class="o">and</span> <span class="nx">@r</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">r</span> <span class="o">and</span> <span class="nx">@g</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">g</span> <span class="o">and</span> <span class="nx">@b</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">b</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>Color conversion (hsv):</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">hsv: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rr = </span><span class="nx">@r</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">gg = </span><span class="nx">@g</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">bb = </span><span class="nx">@b</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span> <span class="nx">gg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">)</span>
    <span class="nv">min = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span> <span class="nx">gg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">)</span>
    <span class="nv">h = </span><span class="nx">max</span>
    <span class="nv">s = </span><span class="nx">max</span>
    <span class="nv">v = </span><span class="nx">max</span>
    <span class="nv">d = </span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span>
    <span class="nv">s = </span><span class="p">(</span><span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">d</span> <span class="o">/</span> <span class="nx">max</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="nx">min</span>
      <span class="nv">h = </span><span class="mi">0</span>
    <span class="k">else</span>
      <span class="k">switch</span> <span class="nx">max</span>
        <span class="k">when</span> <span class="nx">rr</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">gg</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">gg</span> <span class="o">&lt;</span> <span class="nx">bb</span> <span class="k">then</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">when</span> <span class="nx">gg</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">bb</span> <span class="o">-</span> <span class="nx">rr</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">when</span> <span class="nx">bb</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">rr</span> <span class="o">-</span> <span class="nx">gg</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span>
      <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span>
    <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span>
  
  <span class="nv">set_hsv: </span><span class="nf">(h, s, v) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>ignore alpha, h, s and v are to be within [0, 1]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">i = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
    <span class="nv">f = </span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="nx">i</span>
    <span class="nv">p = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">q = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">t = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span><span class="p">)</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>
    <span class="k">switch</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">6</span>
      <span class="k">when</span> <span class="mi">0</span>
        <span class="vi">@r = </span><span class="nx">v</span>
        <span class="vi">@g = </span><span class="nx">t</span>
        <span class="vi">@b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">1</span>
        <span class="vi">@r = </span><span class="nx">q</span>
        <span class="vi">@g = </span><span class="nx">v</span>
        <span class="vi">@b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">2</span>
        <span class="vi">@r = </span><span class="nx">p</span>
        <span class="vi">@g = </span><span class="nx">v</span>
        <span class="vi">@b = </span><span class="nx">t</span>
      <span class="k">when</span> <span class="mi">3</span>
        <span class="vi">@r = </span><span class="nx">p</span>
        <span class="vi">@g = </span><span class="nx">q</span>
        <span class="vi">@b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">4</span>
        <span class="vi">@r = </span><span class="nx">t</span>
        <span class="vi">@g = </span><span class="nx">p</span>
        <span class="vi">@b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">5</span>
        <span class="vi">@r = </span><span class="nx">v</span>
        <span class="vi">@g = </span><span class="nx">p</span>
        <span class="vi">@b = </span><span class="nx">q</span>
    <span class="nx">@r</span> <span class="o">*=</span> <span class="mi">255</span>
    <span class="nx">@g</span> <span class="o">*=</span> <span class="mi">255</span>
    <span class="nx">@b</span> <span class="o">*=</span> <span class="mi">255</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Color mixing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mixed: </span><span class="nf">(proportion, otherColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>answer a copy of this color mixed with another color, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">frac1 = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">proportion</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">frac2 = </span><span class="mi">1</span> <span class="o">-</span> <span class="nx">frac1</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span>
      <span class="nx">@r</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">,</span>
      <span class="nx">@g</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">,</span>
      <span class="nx">@b</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">)</span>
  
  <span class="nv">darker: </span><span class="nf">(percent) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>return an rgb-interpolated darker copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fract = </span><span class="mf">0.8333</span>
    <span class="nv">fract = </span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="k">if</span> <span class="nx">percent</span>
    <span class="nx">@mixed</span> <span class="nx">fract</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">lighter: </span><span class="nf">(percent) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>return an rgb-interpolated lighter copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fract = </span><span class="mf">0.8333</span>
    <span class="nv">fract = </span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="k">if</span> <span class="nx">percent</span>
    <span class="nx">@mixed</span> <span class="nx">fract</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
  
  <span class="nv">dansDarker: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>return an hsv-interpolated darker copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hsv = </span><span class="nx">@hsv</span><span class="p">()</span>
    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="nv">vv = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">hsv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">set_hsv</span> <span class="nx">hsv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">hsv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">vv</span>
    <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>StringMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>I am a single line of text</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">StringMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">text: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontName: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span>
  <span class="nv">isBold: </span><span class="kc">null</span>
  <span class="nv">isItalic: </span><span class="kc">null</span>
  <span class="nv">isEditable: </span><span class="kc">false</span>
  <span class="nv">isNumeric: </span><span class="kc">null</span>
  <span class="nv">isPassword: </span><span class="kc">false</span>
  <span class="nv">shadowOffset: </span><span class="kc">null</span>
  <span class="nv">shadowColor: </span><span class="kc">null</span>
  <span class="nv">isShowingBlanks: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">blanksColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Properties for text-editing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isScrollable: </span><span class="kc">true</span>
  <span class="nv">currentlySelecting: </span><span class="kc">false</span>
  <span class="nv">startMark: </span><span class="mi">0</span>
  <span class="nv">endMark: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">markedTextColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">markedBackgoundColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">      text,</span>
<span class="nf">      @fontSize = 12,</span>
<span class="nf">      @fontStyle = &quot;sans-serif&quot;,</span>
<span class="nf">      @isBold = false,</span>
<span class="nf">      @isItalic = false,</span>
<span class="nf">      @isNumeric = false,</span>
<span class="nf">      shadowOffset,</span>
<span class="nf">      @shadowColor,</span>
<span class="nf">      color,</span>
<span class="nf">      fontName</span>
<span class="nf">      ) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@text = </span><span class="nx">text</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">text</span> <span class="o">is</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;&quot;</span> <span class="k">else</span> <span class="s">&quot;StringMorph&quot;</span><span class="p">))</span>
    <span class="vi">@fontName = </span><span class="nx">fontName</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">globalFontFamily</span>
    <span class="vi">@shadowOffset = </span><span class="nx">shadowOffset</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>override inherited properites:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">toString: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>e.g. 'a StringMorph("Hello World")'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;a &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;(\&quot;&quot;</span> <span class="o">+</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;...\&quot;)&quot;</span>
  
  <span class="nv">password: </span><span class="nf">(letter, length) -&gt;</span>
    <span class="nv">ans = </span><span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">length</span><span class="p">]</span>
      <span class="nx">ans</span> <span class="o">+=</span> <span class="nx">letter</span>
    <span class="nx">ans</span>

  <span class="nv">font: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>answer a font string, e.g. 'bold italic 12px sans-serif'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">font = </span><span class="s">&quot;&quot;</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;bold &quot;</span>  <span class="k">if</span> <span class="nx">@isBold</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;italic &quot;</span>  <span class="k">if</span> <span class="nx">@isItalic</span>
    <span class="nx">font</span> <span class="o">+</span> <span class="nx">@fontSize</span> <span class="o">+</span> <span class="s">&quot;px &quot;</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@fontName</span> <span class="k">then</span> <span class="nx">@fontName</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="nx">@fontStyle</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">text = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@isPassword</span> <span class="k">then</span> <span class="nx">@password</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@text</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>initialize my surface property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>set my extent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">width = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">width</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)))</span>
    <span class="vi">@image.width = </span><span class="nx">width</span>
    <span class="vi">@image.height = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>prepare context for drawing text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nv">context.textAlign = </span><span class="s">&quot;left&quot;</span>
    <span class="nv">context.textBaseline = </span><span class="s">&quot;bottom&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>first draw the shadow, if any</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shadowColor</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>now draw the actual text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isShowingBlanks</span>
      <span class="nx">@renderWithBlanks</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span>
    <span class="k">else</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>draw the selection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">start</span><span class="p">...</span><span class="nx">stop</span><span class="p">]</span>
      <span class="nv">p = </span><span class="nx">@slotPosition</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">c = </span><span class="nx">text</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedBackgoundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span><span class="p">,</span>
        <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedTextColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>notify my parent of layout change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">fixLayout</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">fixLayout</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">renderWithBlanks: </span><span class="nf">(context, startX, y) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>create the blank form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">drawBlank = </span><span class="nf">-&gt;</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">blank</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="mi">0</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="nx">space</span>
    <span class="nv">space = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">width</span>
    <span class="nv">blank = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">space</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nv">ctx = </span><span class="nx">blank</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">words = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
    <span class="nv">x = </span><span class="nx">startX</span> <span class="o">or</span> <span class="mi">0</span>
    <span class="nv">isFirst = </span><span class="kc">true</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">@blanksColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">space</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">space</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>render my text inserting blanks</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">words</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(word) -&gt;</span>
      <span class="nx">drawBlank</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">isFirst</span>
      <span class="nv">isFirst = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">word</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">word</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
        <span class="nx">x</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">word</span><span class="p">).</span><span class="nx">width</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>StringMorph mesuring:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">slotPosition: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>answer the position point of the given index ("slot")
where the caret should be placed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">text = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@isPassword</span> <span class="k">then</span> <span class="nx">@password</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@text</span><span class="p">)</span>
    <span class="nv">dest = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">slot</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">xOffset = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">dest</span><span class="p">]</span>
      <span class="nx">xOffset</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">text</span><span class="p">[</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
    <span class="vi">@pos = </span><span class="nx">dest</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">xOffset</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">slotAt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>answer the slot (index) closest to the given point
so the caret can be moved accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">text = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@isPassword</span> <span class="k">then</span> <span class="nx">@password</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@text</span><span class="p">)</span>
    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="nv">charX = </span><span class="mi">0</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">charX</span>
      <span class="nx">charX</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">text</span><span class="p">[</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">idx</span> <span class="o">is</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">width</span> <span class="o">-</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">text</span><span class="p">[</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]).</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">())</span>  
          <span class="k">return</span> <span class="nx">idx</span>
    <span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span>
  
  <span class="nv">upFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>answer the slot above the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">slot</span>
  
  <span class="nv">downFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>answer the slot below the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">slot</span>
  
  <span class="nv">startOfLine: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>answer the first slot (index) of the line for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="mi">0</span>
  
  <span class="nv">endOfLine: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>answer the slot (index) indicating the EOL for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>

  <span class="nv">rawHeight: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>answer my corrected fontSize</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1.2</span>
    </pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>StringMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;edit&quot;</span><span class="p">,</span> <span class="s">&quot;edit&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;font size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfont\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setFontSize</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this String&#39;s\nfont point size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;serif&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sans-serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSansSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;sans-serif&quot;</span>

    <span class="k">if</span> <span class="nx">@isBold</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal weight&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>

    <span class="k">if</span> <span class="nx">@isItalic</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal style&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;italic&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>

    <span class="k">if</span> <span class="nx">@isShowingBlanks</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide blanks&quot;</span><span class="p">,</span> <span class="s">&quot;toggleShowBlanks&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show blanks&quot;</span><span class="p">,</span> <span class="s">&quot;toggleShowBlanks&quot;</span>

    <span class="k">if</span> <span class="nx">@isPassword</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show characters&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsPassword&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide characters&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsPassword&quot;</span>

    <span class="nx">menu</span>
  
  <span class="nv">toggleIsDraggable: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isDraggable = </span><span class="o">not</span> <span class="nx">@isDraggable</span>
    <span class="k">if</span> <span class="nx">@isDraggable</span>
      <span class="nx">@disableSelecting</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@enableSelecting</span><span class="p">()</span>
  
  <span class="nv">toggleShowBlanks: </span><span class="nf">-&gt;</span>
    <span class="vi">@isShowingBlanks = </span><span class="o">not</span> <span class="nx">@isShowingBlanks</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleWeight: </span><span class="nf">-&gt;</span>
    <span class="vi">@isBold = </span><span class="o">not</span> <span class="nx">@isBold</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleItalic: </span><span class="nf">-&gt;</span>
    <span class="vi">@isItalic = </span><span class="o">not</span> <span class="nx">@isItalic</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleIsPassword: </span><span class="nf">-&gt;</span>
    <span class="vi">@isPassword = </span><span class="o">not</span> <span class="nx">@isPassword</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSerif: </span><span class="nf">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSansSerif: </span><span class="nf">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;sans-serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setFontSize: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setText: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">size</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">numericalSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;setLeft&quot;</span><span class="p">,</span> <span class="s">&quot;setTop&quot;</span><span class="p">,</span> <span class="s">&quot;setAlphaScaled&quot;</span><span class="p">,</span> <span class="s">&quot;setFontSize&quot;</span><span class="p">,</span> <span class="s">&quot;setText&quot;</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>StringMorph editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">edit: </span><span class="nf">-&gt;</span>
    <span class="nx">@root</span><span class="p">().</span><span class="nx">edit</span> <span class="nx">@</span>
  
  <span class="nv">selection: </span><span class="nf">-&gt;</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">stop</span>
  
  <span class="nv">selectionStartSlot: </span><span class="nf">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span>
  
  <span class="nv">clearSelection: </span><span class="nf">-&gt;</span>
    <span class="vi">@currentlySelecting = </span><span class="kc">false</span>
    <span class="vi">@startMark = </span><span class="mi">0</span>
    <span class="vi">@endMark = </span><span class="mi">0</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">deleteSelection: </span><span class="nf">-&gt;</span>
    <span class="nv">text = </span><span class="nx">@text</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="vi">@text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@clearSelection</span><span class="p">()</span>
  
  <span class="nv">selectAll: </span><span class="nf">-&gt;</span>
    <span class="vi">@startMark = </span><span class="mi">0</span>
    <span class="vi">@endMark = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>

  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">@isEditable</span>
      <span class="nx">@clearSelection</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseDownLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>

  <span class="nv">mouseClickLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="nv">caret = </span><span class="nx">@root</span><span class="p">().</span><span class="nx">caret</span><span class="p">;</span>
    <span class="k">if</span> <span class="nx">@isEditable</span>
      <span class="nx">@edit</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">@currentlySelecting</span>
      <span class="k">if</span> <span class="nx">caret</span> <span class="k">then</span> <span class="nx">caret</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
      <span class="nx">@root</span><span class="p">().</span><span class="nx">caret</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
      <span class="vi">@currentlySelecting = </span><span class="kc">true</span>
    <span class="k">else</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseClickLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
  
  <span class="nv">enableSelecting: </span><span class="nf">-&gt;</span>
    <span class="vi">@mouseDownLeft = </span><span class="nf">(pos) -&gt;</span>
      <span class="nx">@clearSelection</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nx">@edit</span><span class="p">()</span>
        <span class="nx">@root</span><span class="p">().</span><span class="nx">caret</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
        <span class="vi">@startMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="vi">@endMark = </span><span class="nx">@startMark</span>
        <span class="vi">@currentlySelecting = </span><span class="kc">true</span>
    
    <span class="vi">@mouseMove = </span><span class="nf">(pos) -&gt;</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="nx">@currentlySelecting</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nv">newMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">newMark</span> <span class="o">isnt</span> <span class="nx">@endMark</span>
          <span class="vi">@endMark = </span><span class="nx">newMark</span>
          <span class="nx">@updateRendering</span><span class="p">()</span>
          <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">disableSelecting: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>re-establish the original definition of the method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@mouseDownLeft = </span><span class="nx">StringMorph</span><span class="o">::</span><span class="nx">mouseDownLeft</span>
    <span class="k">delete</span> <span class="nx">@mouseMove</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>How to play a test:
from the Chrome console (Option-Command-J) OR Safari console (Option-Command-C):
window.world.systemTestsRecorderAndPlayer.eventQueue = SystemTestsRepo_NAMEOFTHETEST.testData
window.world.systemTestsRecorderAndPlayer.startPlaying()</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>How to save a test:
window.world.systemTestsRecorderAndPlayer.startRecording()
...do the test...
window.world.systemTestsRecorderAndPlayer.stopRecording()
if you want to verify the test on the spot:
window.world.systemTestsRecorderAndPlayer.startPlaying()
then to save the test:
console.log(JSON.stringify( window.world.systemTestsRecorderAndPlayer.eventQueue ))
copy that blurb
For recording screenshot data at any time:
console.log(JSON.stringify(window.world.systemTestsRecorderAndPlayer.takeScreenshot()))
Note for Chrome: You have to replace the data URL because
it contains an ellipsis for more comfortable viewing in the console.
Workaround: find that url and right-click: open in new tab and then copy the
full data URL from the location bar and subsitute it with the one
of the ellipses.
Then pass the JSON into http://js2coffee.org/
and save it in this file.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>Tests name must start with "SystemTest_"</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SystemTest_SimpleMenuTest</span>
  <span class="vi">@testData = </span><span class="p">[</span>
    <span class="nv">type: </span><span class="s">&quot;systemInfo&quot;</span>
    <span class="nv">time: </span><span class="mi">0</span>
    <span class="nv">systemInfo:</span>
      <span class="nv">zombieKernelTestHarnessVersionMajor: </span><span class="mi">0</span>
      <span class="nv">zombieKernelTestHarnessVersionMinor: </span><span class="mi">1</span>
      <span class="nv">zombieKernelTestHarnessVersionRelease: </span><span class="mi">0</span>
      <span class="nv">userAgent: </span><span class="s">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31&quot;</span>
      <span class="nv">screenWidth: </span><span class="mi">1920</span>
      <span class="nv">screenHeight: </span><span class="mi">1080</span>
      <span class="nv">screenColorDepth: </span><span class="mi">24</span>
      <span class="nv">screenPixelRatio: </span><span class="mi">1</span>
      <span class="nv">appCodeName: </span><span class="s">&quot;Mozilla&quot;</span>
      <span class="nv">appName: </span><span class="s">&quot;Netscape&quot;</span>
      <span class="nv">appVersion: </span><span class="s">&quot;5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31&quot;</span>
      <span class="nv">cookieEnabled: </span><span class="kc">true</span>
      <span class="nv">platform: </span><span class="s">&quot;MacIntel&quot;</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">604</span>
    <span class="nv">mouseY: </span><span class="mi">4</span>
    <span class="nv">time: </span><span class="mi">1742</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">592</span>
    <span class="nv">mouseY: </span><span class="mi">14</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">581</span>
    <span class="nv">mouseY: </span><span class="mi">21</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">556</span>
    <span class="nv">mouseY: </span><span class="mi">25</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">544</span>
    <span class="nv">mouseY: </span><span class="mi">28</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">529</span>
    <span class="nv">mouseY: </span><span class="mi">37</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">513</span>
    <span class="nv">mouseY: </span><span class="mi">44</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">492</span>
    <span class="nv">mouseY: </span><span class="mi">55</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">482</span>
    <span class="nv">mouseY: </span><span class="mi">59</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">472</span>
    <span class="nv">mouseY: </span><span class="mi">64</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">464</span>
    <span class="nv">mouseY: </span><span class="mi">66</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">461</span>
    <span class="nv">mouseY: </span><span class="mi">67</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">460</span>
    <span class="nv">mouseY: </span><span class="mi">68</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">460</span>
    <span class="nv">mouseY: </span><span class="mi">69</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">458</span>
    <span class="nv">mouseY: </span><span class="mi">70</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">456</span>
    <span class="nv">mouseY: </span><span class="mi">72</span>
    <span class="nv">time: </span><span class="mi">18</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">455</span>
    <span class="nv">mouseY: </span><span class="mi">72</span>
    <span class="nv">time: </span><span class="mi">15</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">452</span>
    <span class="nv">mouseY: </span><span class="mi">74</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">450</span>
    <span class="nv">mouseY: </span><span class="mi">74</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">449</span>
    <span class="nv">mouseY: </span><span class="mi">75</span>
    <span class="nv">time: </span><span class="mi">50</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">448</span>
    <span class="nv">mouseY: </span><span class="mi">76</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">447</span>
    <span class="nv">mouseY: </span><span class="mi">77</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">445</span>
    <span class="nv">mouseY: </span><span class="mi">79</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">444</span>
    <span class="nv">mouseY: </span><span class="mi">80</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">444</span>
    <span class="nv">mouseY: </span><span class="mi">81</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">442</span>
    <span class="nv">mouseY: </span><span class="mi">83</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">436</span>
    <span class="nv">mouseY: </span><span class="mi">91</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">433</span>
    <span class="nv">mouseY: </span><span class="mi">95</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">423</span>
    <span class="nv">mouseY: </span><span class="mi">106</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">417</span>
    <span class="nv">mouseY: </span><span class="mi">115</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">414</span>
    <span class="nv">mouseY: </span><span class="mi">118</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">408</span>
    <span class="nv">mouseY: </span><span class="mi">123</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">396</span>
    <span class="nv">mouseY: </span><span class="mi">131</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">387</span>
    <span class="nv">mouseY: </span><span class="mi">135</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">380</span>
    <span class="nv">mouseY: </span><span class="mi">138</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">379</span>
    <span class="nv">mouseY: </span><span class="mi">139</span>
    <span class="nv">time: </span><span class="mi">66</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">378</span>
    <span class="nv">mouseY: </span><span class="mi">141</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">375</span>
    <span class="nv">mouseY: </span><span class="mi">142</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">373</span>
    <span class="nv">mouseY: </span><span class="mi">145</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">368</span>
    <span class="nv">mouseY: </span><span class="mi">149</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">365</span>
    <span class="nv">mouseY: </span><span class="mi">154</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">364</span>
    <span class="nv">mouseY: </span><span class="mi">154</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">364</span>
    <span class="nv">mouseY: </span><span class="mi">155</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseDown&quot;</span>
    <span class="nv">time: </span><span class="mi">145</span>
    <span class="nv">button: </span><span class="mi">2</span>
    <span class="nv">ctrlKey: </span><span class="kc">false</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseUp&quot;</span>
    <span class="nv">time: </span><span class="mi">113</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">364</span>
    <span class="nv">mouseY: </span><span class="mi">156</span>
    <span class="nv">time: </span><span class="mi">1809</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;takeScreenshot&quot;</span>
    <span class="nv">time: </span><span class="mi">801</span>
    <span class="nv">screenShotImageData: </span><span class="p">[[</span>
      <span class="nv">zombieKernelTestHarnessVersionMajor: </span><span class="mi">0</span>
      <span class="nv">zombieKernelTestHarnessVersionMinor: </span><span class="mi">1</span>
      <span class="nv">zombieKernelTestHarnessVersionRelease: </span><span class="mi">0</span>
      <span class="nv">userAgent: </span><span class="s">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31&quot;</span>
      <span class="nv">screenWidth: </span><span class="mi">1920</span>
      <span class="nv">screenHeight: </span><span class="mi">1080</span>
      <span class="nv">screenColorDepth: </span><span class="mi">24</span>
      <span class="nv">screenPixelRatio: </span><span class="mi">1</span>
      <span class="nv">appCodeName: </span><span class="s">&quot;Mozilla&quot;</span>
      <span class="nv">appName: </span><span class="s">&quot;Netscape&quot;</span>
      <span class="nv">appVersion: </span><span class="s">&quot;5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31&quot;</span>
      <span class="nv">cookieEnabled: </span><span class="kc">true</span>
      <span class="nv">platform: </span><span class="s">&quot;MacIntel&quot;</span>
      <span class="p">,</span> <span class="s">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAJYCAYAAACadoJwAAAgAElEQVR4XuzdCZhU1Z338T+KLKIgOrggjMiAoyDLgASIedkGRxxAEGVTUAMBF5AJIxNlBzPRQFRAGRWBCYtsKoJBgUQWFUSRfVE0rogsIkuUsBhF3vf3n7n1Fk03Vd1ddauq63ufpx8a6t5zzv2cmzz185xzT7F169adMA4EEEAAAQQQQAABBBBAIASBYgSQEJSpAgEEEEAAAQQQQAABBFyAAMKDgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIzgAACCCCAAAIIIIAAAqEJEEBCo6YiBBBAAAEEEEAAAQQQIIDwDCCAAAIIIIAAAggggEBoAgSQ0KipCAEEEEAAAQQQQAABBAggPAMIIIAAAggggAACCCAQmgABJDRqKkIAAQQQQAABBBBAAAECCM8AAggggAACCCCAAAIIhCZAAAmNmooQQAABBBBAAAEEEECAAMIz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A0jWwWTpDRNAsrTjuW0EioAAAaQIdCK3gAAC2SFAAMmOfo73Lgkg8UpxHgIIpJsAASTdeoT2IIAAAnkIEEB4NKIFCCA8DwggkKkCBJBM7TnajQACWSeQM4AEX0CzDiLLb3jFihUuQADJ8geB20cggwUIIBnceTQdAQSyS4ARkOzq71h3SwCJJcTnCCCQrgIEkHTtGdqFAAII5BAggPBIRAsQQHgeEEAgUwUIIJnac7QbAQSyToAAknVdftobJoDwPCCAQKYKEEAytedoNwIIZJ1ArACSc0PBaKBt27b5buebN2+2M8888yQ77ZLeqFEj39G8fPnyhXb9+OOPrXnz5vb+++/bV199Ffn93HPPLXTZFPD/BQggPA0IIJCpAgSQTO052o0AAlknEE8AUcjYuHGjFStW7CQfbUCoHdEbN258itvnn39u2u08kQHk2muv9fL2799vwe+JCDdZ1+mnuWECCE8DAghkqgABJFN7jnYjgEDWCcQTQFq1amUDBw60Xr16WaVKley1116zK6+80r788kubM2eO9e/f33dJf/fdd61r1652wQUXeECYOXNmJIBoROT++++3efPmWb9+/WzYsGF+Xs7j9ddft549e9qnn35qnTp1sjFjxljFihVNIyAEkOQ/ngSQ5BtTAwIIJEeAAJIcV0pFAAEEEi4QK4Doi3/16tWtY8eONnjwYJsyZYqtW7fOFBQ+/PBD69Kli61fv96nRtWuXdsDg6ZetWvXztuqEQsdCiwKHipn6NChtnv3blu2bJkVL148ck8KNJUrV7ZZs2b5qMrYsWNt79699txzz9knn3xCAEl4759aIAEkBGSqQACBpAgQQJLCSqEIIIBA4gXiCSD16tUzTak6//zz/c9gatW+fft8DciGDRs8NCxcuNBmzJgRCR5Nmzb1ALJkyRIbMmSIT9dS4FD40KiGRjkuv/zyyE1pSpdGUVq0aGHff/+9TZ8+3aZNm2bLly83jaAwApL4/s9ZIgEk+cbUgAACyREggCTHlVIRQACBhAvECiBahN6+ffvIQvPoqVDRAeTuu++2a665xnr37u1tjD5v6dKlPvKR81izZo1fExxHjhyxRx991IYPHx75t7Zt29r8+fM9rBBAEt79pxRIAEm+MTUggEByBAggyXGlVAQQQCDhAvEEkGCUQ+s88gogWt+hNR0a6dAR/RYsjYxM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FiCAJBiU4hBAAIFkCcQKIHrTlfbr0B4a2m1cr7bVpoPRu43rzVHRGwgmq62Um3wBAkjyjakBAQSSI0AASY4rpSKAAAIJF4gVQB555BHf2K9evXq+i7k2+9PO49oLIwgdeQWQHTt22JNPPmkXX3yx7yB+/fXX+y7ql112md+H9ubQHh0qq1OnTr4pYcWKFf0zbVT485//3F9127t3b9/YT5sA6u8afVF52tiwX79+NmzYMN8JnaPwAgSQwhtSAgIIpEaAAJIad2pFAAEE8i0QK4AocOjNTpp+pSDRo0cP0w7lCgGxAohGSbTBn67RxoOayvXWW2/5a2oVWipXruzlakRl7NixtnfvXt/BXGFD1z377LNWs2ZNr0f7hWi/Dh0akVHw6Nixow0dOtR2795ty5Yti7mfSL5xsvACAkgWdjq3jEARESCAFJGO5DYQQKDoC8QKIJqCdfXVV3vo0AZ+2i9jw4YNcY2AfPTRR9aqVavIvhh63a3Cw6uvvmpXXHGFj3Jo4z7VMX36dJs2bZrvYK7fVZ92GNexZcsWa9mypQcQ7ZquMKOpYNr8T+FDoyYaRbn88suLfocl+Q4JIEkGpngEEEiaAAEkabQUjAACCCRWIFYA0cZ6derUsXfeece010V+A4imT2mHce1QrrLq169vU6dOtRo1atijjz7qoyLB0bZtW5s/f77ddtttvqhd1+qIXm+isjTykfNYs2aNr1HhKJwAAaRwflyNAAKpEyCApM6emhFAAIF8CSQ7gLRv395HMIIAoilVc+bMsS+//NLXcShQVKlSxVatWmUPPvigrwv53e9+Zz/88IMNHjzY70UjH02bNvU/Fy5c6OtINBKic/SjERlN4ypRokS+7p2TTxUggPBUIIBApgoQQDK152g3AghknUAyA0iwBuSll16ym266ySZNmmQjR460bdu2+a7hWlS+adMmO3TokLVu3drXeWgE5I033vDztV7k0ksv9Wlc27dv9wCitSfasXzlypVWu3Ztn641YMAA+/zzz+2ss87yhfLt2rXzUJPb79WqVcu6Ps7PDRNA8qPFuQggkE4CBJB06g3aggACCJxGIL8BRG+t0ihF8BYshQztA6KF4vo9eh+QIIBEV681HgoQGgHRqIbK0TFixAj/0bqP++67z8NKr169/LNGjRrZgQMHbOPGjVa6dOmTPtPna9eu9aldmuKlEZbZs2dbrVq1cv29QYMGPA+nESCA8HgggECmChBAMrXnaDcCCGSdQKwAUhgQjVjcc889Ps1Kb70655xzPEAEx/Hjxz1YKLTo9bpHjx71UQyNcuhHb98qVqyYL0jXK3k11UpTuXR8++23vni9XLlyvP2qMJ2U41oCSAIxKQoBBEIVIICEyk1lCCCAQMEFkhlANNVKi9a1c/qZZ54ZdyO1u7pGMrRAvWrVqnbHHXf463q7dOkSdxmcWDABAkjB3LgKAQRSL0AASX0f0AIEEEAgLoFkBhC9dlfTpjTlSiMZ+Tn0Ct/XXnvNdu7cirzqbQAAIABJREFUaW3atPFF5hzJFyCAJN+YGhBAIDkCBJDkuFIqAgggkHCBZAaQhDeWApMuQABJOjEVIIBAkgQIIEmCpVgEEEAg0QIEkESLZnZ5BJDM7j9aj0A2CxBAsrn3uXcEEMgogVgBRFOhgjdfBQvAgxvUW660YaDWbES//SqZAFqcrrdiaYF7+fLlY1Z1uvbHvDjqhPzWm5+y0+lcAkg69QZtQQCB/AgQQPKjxbkIIIBACgViBZDgTVbLli07ZR1H9A7l8YSBRNym9vto2LBhvgKIFsJrLUp+16FEtze/9SbiXlNRBgEkFerUiQACiRAggCRCkTIQQACBEARiBZAgZPziF7+whx9+2K6//np75plnfKO/6ADyzTff2Pjx42306NH+qlx9YQ/+roXkTz/9tG8cqPr0Wt6ZM2dG/q6Q85e//MV3Rp83b57169fPhg0bZhdccIELvPvuu9a1a1f/u/Yb0bU5R0C0I/qUKVMie4dMmzbNunXr5m3URoYDBw70zypVquSL26+88kovW3uaaIRH+5F06tTJxowZYxUrVoxZr14N3LFjR7+uR48eft/nn3++PfDAA3bjjTfaz372M1u9erU98sgj9txzz/kriHWO3u4lw9zaWpiAlKhHhQCSKEnKQQCBsAUIIGGLUx8CCCBQQIF4Akj16tXt3nvv9R9tFLhkyRLbunWrv6FKgUBhQJsRdu7c2ffs0Ct39W/B3zV9SWVop/OnnnrKatSo4T/B3/WlVxsHKnjoS/3QoUNt9+7dplEXvcpXwUXBQFOvtMu5jpwBZM2aNdahQwdbtGiR7xGidilcaCd11a1yBw8e7F/8161b55/t2rXLKleu7K/41Vu2xo4da3v37vXAoPvLq16FJb0eeOLEidayZUsvV5shvvfee972H3/80UaNGmW//e1vPfho9EX3W7duXQ9Pf/vb33JtqzZmTPVBAEl1D1A/AggUVIAAUlA5rkMAAQRCFogVQLSGQiMI+sKvTQIPHz7sX75fffVVO++88yIBZN++fb7nR7BZoK4L/q5Rgnr16vlohEKH/oz++wsvvGBDhgzxL/DFixf38KFRCF23atUqW7hwoc2YMSMSPPRFPWcAefnll61v3762ePFi/7KvOrTpoXZHV10akdEIRfRUKgUlja60aNHCNzWcPn26aeREu7VrN/W86p0/f76HsKBNCjwKOQpMGgnSSMumTZt8pEP/poCjNv/kJz+xP//5z/anP/0p17ZqdCbVBwEk1T1A/QggUFABAkhB5bgOAQQQCFkgngASvQhdX+jr169vU6dOPW0AUQC4+eabPZAoSAQjJVorknPtyIsvvugjFDkPjWo8++yzds0111jv3r3947zWnRw5csRHUCZPnuzn6fdBgwb5aEj79u0jmyFGX1+yZEl79NFHfcPD4Gjbtq0pYNx999151quRIC2+D9oUmGh0pVq1aj69S+FFn6vsP/zhDz4t65VXXvH7yautF110Uci9f2p1BJCUdwENQACBAgoQQAoIx2UIIIBA2ALxBBB9gd+yZYuv7dCXba1jmDNnzikBJPqLvsKD1nRoqlOsAKKRhAkTJviogtZy6EfBRdOitKZCaz80QqIjr7dR7dmzx0dPypQp49On+vTp41PA9MU/emQmOoC88cYb3katSdGaFo22PPjgg95m/Xte9Wpti9ZrBG0KRoU02qHRF4UpTR1r3bq1t1//pkOjKxoVyautqjPVBwEk1T1A/QggUFABAkhB5bgOAQQQCFkgVgDRF3ZNL5o7d67ddNNNPsKghdW5rQG56qqrfC2ERgGaNGlil112mY8mxAogWjei3dJXrlzp6y40FWrAgAE+XUpTpDQqoQXdmvqlUQ2t0cg5BUsBRkFGC8xLlCjhay8qVKhw2gCiUYqHHnrIp0sdOnTIA4OmiKnNb731Vp71bt682T9T2zTaofUpCiXBNDWt87jtttsiZpripVcVay3IJZdc4mErt7aqL8aNG+frXBSIcvtdtsk8CCDJ1KVsBBBIpgABJJm6lI0AAggkUCDeABJUqf0+NEIQrOHQ1CqFFL3lSaHh8ccf91Ovu+46K1Wq1EkBROfp+mAUIvi7zp80aVLkDVb6u4KMpnqdOHHCRo4c6T86unfv7ms0tF6kbNmyEYmvv/7aQ4y+6OvQeooVK1b42o7oKWRB3VqjoulZWpuhgKRjxIgR/qOF9lpPkle9uge9ESwYAVFo0eiNFtLrCEKb1nsovKk8rfvQOhWtO8mrrRdffLGPLmn9icrK7fcGDRoksPdPLYoAklReCkcAgSQKEECSiEvRCCCAQCIFYgWQoK7jx4/7q3I1xUnBIq/jwIEDprUVOi+/hwKBAkO5cuV8OlX0oXI1BUwL30936M1W+pKvUBDPa211XypboUL3dfToUV9sH9R/unoPHjzo56uunO2N597z29Z4yizsOQSQwgpyPQIIpEqAAJIqeepFAAEE8ikQbwDJZ7GcnqECBJAM7TiajQACRgDhIUAAAQQyRIAAkiEdFVIzCSAhQVMNAggkXIAAknBSCkQAAQSSI0AASY5rppZKAMnUnqPdCCBAAOEZQAABBDJEgACSIR0VUjMJICFBUw0CCCRcgACScFIKRAABBJIjkIwAordAaaM+vZFKi7s5MkeAAJI5fUVLEUDgZAECCE8EAgggkCECyQog0TufZwgFzfx/AgQQHgMEEMhUAQJIpvYc7UYAgawTiCeAaMO9rl27+n4Z/fr1s+HDh9v5559v2kBQu37r33v06GGjR4/23cOjdxsvX758nuft2LHDnn76ad98UO3Iublg1nVGGtwwASQNOoEmIIBAgQQIIAVi4yIEEEAgfIFYASTYVG/ixImmUY0uXbp46NBO39qZXP/esmVLGzx4sG8eqA0CtYN5MAKivUNOd5426tM+Gk899ZTvLq5dzDlSJ0AASZ09NSOAQOEECCCF8+NqBBBAIDSBWAFkypQp9tJLL/mO5toIcMOGDbZ06VIf6dDu3zNmzPC2ahNBhYlly5b5RoRBANF1pzsv2FFdIYQj9QIEkNT3AS1AAIGCCRBACubGVQgggEDoArECiKZeaUF57969I207ceKE3XrrrSf9+7Fjx6x+/fqmwKJpV0EAuffee+M6T9dwpF6AAJL6PqAFCCBQMAECSMHcuAoBBBAIXSBWAPn1r39t33//vT300EPeNq3T0JqQ7du3W7FixWzIkCH+74cPH/apVjlHQMaPHx/XeQSQ0Ls+1woJIOnRD7QCAQTyL0AAyb8ZVyCAAAIpEYgVQFatWmWtWrXy0FG5cmVr06aNNWnSxFq0aOFrNvTvV155pY0ZM8YUNhRQFE6CEZDNmzfHdZ4CyA8//GDjxo2zdu3aWZUqVXL9vVq1ailxypZKCSDZ0tPcJwJFT4AAUvT6lDtCAIEiKhArgGi61eOPP24DBgxwgUaNGtmCBQt8DcjDDz8cGQHRGg6t9ahVq1bkLVhawH7OOefEdZ72C9E0rpo1a9rs2bO9nNx+b9CgQRHtifS4LQJIevQDrUAAgfwLEEDyb8YVCCCAQEoEYgWQoFFaZP7jjz/aeeedd1I7Dx48aEePHvU3WRUvXjzPe4j3vJQgUGlEgADCw4AAApkqQADJ1J6j3QggkHUC8QaQrIPJ0hsmgGRpx3PbCBQBAQJIEehEbgEBBLJDgACSHf0c710SQOKV4jwEEEg3AQJIuvUI7UEAAQTyECCA8GhECxBAeB4QQCBTBQggmdpztBsBBLJOgACSdV1+2hsmgPA8IIBApgoQQDK152g3AghknUCsAKJX427cuNHq1KljZ511VkJ9PvroI+vZs6e9/vrrvst6Nh3RrtpPJTDWm8NuueUW0+uLzzzzzNBJCCChk1MhAggkSIAAkiBIikEAAQSSLRArgGgTwhIlStg333xjZcuWTWhzFED0ZVtfvvUlPJuOaNfSpUtHjGXw3nvvWePGjVPCQQBJCTuVIoBAAgQIIAlApAgEEEAgDIFYAeS2226zmTNn+v4fixYtsk8//dQ6duzof/bo0cNGjx7te4J8/vnnvhGh/q7RjJx/14aFXbt29ev69etnw4cPt/379/smhwMHDrRevXpZpUqV7LXXXvONDaMPjRZMmTLFz9Exbdo069atm4eW3MrVruxPP/201a5d23R/2hzxL3/5i91///02b948r3/YsGHebh2fffZZrp/t2LHDxo4da3Xr1rXbb7/dXzWs0Zqrrroq7vblVna5cuXsjjvuiLhqg8cXXnjBjSdPnuzO/fv3t507d562ft37z3/+cytVqpT17t3bPvnkE9+xXq9Dzssr1jNFAIklxOcIIJCuAgSQdO0Z2oUAAgjkEIgVQFasWGG33nqrTZgwwapXr25XXHGFTZw40Vq2bGmDBw+2tWvX+n+x19Shzp072/r1633qkL70B3/Xl3Bdq+u0Q3qXLl08xOhP/bt+V1n60rxu3bpTpmStWbPGOnTo4F/MtR+JylAQuPTSS09brgLDU089ZfpSrY0NFTxU19ChQ2337t22bNkyO3TokAee3D5TiFL7brjhBv9ir/Zv27Yt7vYpAOVV9ttvvx1xPfvss6179+5urDCicCXHwC23+hXk1LZnn33WN2yUie5X7uqL3LyaNm0a8/kngMQk4gQEEEhTAQJImnYMzUIAAQRyCsQKIJoqdPXVV5tCwNy5c3238xkzZngxCgP6Eqwv8pqmpelUGzZs8BGQYHqV/q4Ri5deesnmz5/vn+nfli5dau3bt7d69er5aMn555/vfzZs2NC/RJcvXz7S1Jdfftn69u1rixcvtho1avgXbE1bUltOV67O05dyjS4MGTLEg5JGBxQ+Klas6KMxClB5fXb8+HFvn0YWKlSoENnhPd72KWTkVbZGewJX3Uvw+1dffRVxVPvyql8mCilPPPGEO23ZssVDodr25ptv5uqlOmMdBJBYQnyOAALpKkAASdeeoV0IIIBAPkdAjh075gvQ33nnHbv33nutefPmPt1Hhz6rX7++j1xoh/ToAKIv/zfffLOHDU3jir4uaIJCikJIsOBa1+i/5Of8gn/kyBEfodD0JB36fdCgQfbLX/4y13JzlvPiiy/6yEfOQ6FKoSevzzRVKuc95ad9Gj3Kq2wFjsBVAST4fd++fZE6FXzyqj9nX0Tfc8mSJXP1uuiii2I+/wSQmEScgAACaSpAAEnTjqFZCCCAQE6BWCMgQQDRl/Vx48b5ugv9V30dWmtRtWrVyAhIdJjQ+VpzoalSv/nNb0wjKZrGpEMBQ+sXtNA6ni/4e/bs8ZGLMmXK2NatW61Pnz4+vUvBJLdyf/rTn54UZDRio+lNGjHRehL9KBipfo2O5PXZ9u3bC9W+iy++OM+yf/zxRw8dctLoUfB79AjI6QKIpl7pPjR1LTDVFCvZfvfdd7l6qT9iHQSQWEJ8jgAC6SpAAEnXnqFdCCCAQA6BWAFEX/K1fkKLtw8ePGht27b18KC1DWPGjPGF5/rSqy/LWpytKU3VqlWzJk2a2GWXXebTrjR6osXmuk5rHNq0aeOfa61DPAFEAUEhQgvU9WVdi9Y1JUoBIrdytZ4ieqRCU5WaNWtmK1eu9IXp06dPtwEDBvjoh9Z05PXZl19+Waj2adQnr7JPnDgRcZVXYKzRkMDkdAFE93TTTTfZW2+95Wth5KDApL54/vnnc/UigPA/fwQQKMoCBJCi3LvcGwIIFCmBWAFE/5VdIxtaV6AvuFrUHYyAaH2FRhX05VlfqPWl/vHHH3ef6667zt/OpACiURP9uz7Xobc9LViwwANN9D4gwTQiTc2KfuXv119/7V/k33//fb9eaxk0vUkBJ7dy9cYrBRCVd+655/o1kyZNirxFS39XUNL0sdN9lnOfkvy2r0qVKnnWG+2qtR533nmnGy9fvtzfgKWRIwWQ0/lE35NMDxw44K80/utf/5qrl9oT62AEJJYQnyOAQLoKEEDStWdoFwIIIJBDIFYACU7XtB6tLdCh4HD06FFf4K2pUdGHvgTrPE2Xynlo0bqmHmm9SEGOXbt2+Ru2VG/0viHxlqvzNGVLaztytvt0n8Xb1tO1L696o12jf49Vp8KR3pKloCcLjYjolbzBSwB0fV7tOV3ZBJBY8nyOAALpKkAASdeeoV0IIIBAAQMIcOkloNEgvX5X+6loHY72FZk1a5a/2rgwBwGkMHpciwACqRQggKRSn7oRQACBfAjEOwKSjyI5NSQBjYJoXYw2LNS6mkTsnk4ACanzqAYBBBIuQABJOCkFIoAAAskRIIAkxzVTSyWAZGrP0W4EECCA8AwggAACGSKQM4AEX0AzpPk0M0ECWtSvgwCSIFCKQQCB0AUIIKGTUyECCCBQMAFGQArmVlSvIoAU1Z7lvhAo+gIEkKLfx9whAggUEQECSBHpyATdBgEkQZAUgwACoQsQQEInp0IEEECgYAIEkIK5FdWrCCBFtWe5LwSKvgABpOj3MXeIAAJFRCCTA4g289PGe3Xq1LGzzjoroT1S2LILe31CbyYfhRFA8oHFqQggkFYCBJC06g4agwACCOQtkMkBRJv7lShRwr755puTdk5PRH8XtuzCXp+IeyhIGQSQgqhxDQIIpIMAASQdeoE2IIAAAnEIxAogO3bssKefftpq165tOlf7TkybNs1Gjx5tZ5xxhn3++ec2fvx4/7v2oxg7dqzVrVvXbr/9dt+x/PXXX7errrrqpJZodGDKlCnWq1cv/3eV161bNxs5cqRdc801vqeFjrfeesvmzp1ro0aNsqlTp550fteuXX3zvZkzZ1qjRo1s0aJFvkP7/fffb/PmzbN+/frZsGHD7IILLjDdw7hx4/wedE2PHj3s7rvv9nJV/qRJk6xnz56RNqp98Zad273kbNsrr7zibcp5v9G7ucfRVaGcQgAJhZlKEEAgCQIEkCSgUiQCCCCQDIFYAeTjjz+26tWre5h46qmn7IorrvCwsH79ejvzzDPtgw8+sM6dO/vfP/vsMz/3hhtusIceesgmTpxo27Zt8xCisBIca9assQ4dOnho+Pbbb+3aa6/1c7S7t3bzXr58uZetUHDppZda27Ztcz1fZd566602YcIEa9CggV199dUePDp27GhDhw613bt327JlyzwkqV2dOnWy/v3721133WWbN2+26dOnW/ny5T3wbN261XcWDw69ljaesjds2BCzbeeff763Kef9Nm3aNBldWqgyCSCF4uNiBBBIoQABJIX4VI0AAgjkRyCeAFKvXj1TEFEI0e7bt9xyi+mLtwJA9N8//fRT07mffPKJVahQwa9RuFBI0Rf94Hj55Zetb9++tnjxYqtRo4afV7p0adO0papVq9quXbusTJkyHhoUIPR5budfdNFFHjoUaP74xz/akCFD7L333rPixYt7+KhYsaKpTcePH/d2bd++3dsxY8YMW7hwof+pOjVioxEWjb4Eh/49nrIVZGK1TYEqt3MqVaqUn64K5VwCSCjMVIIAAkkQIIAkAZUiEUAAgWQIxBNAokNEzgCicHDzzTd7IFHwiA4neQWQI0eO+EjF5MmT/Zb0+6BBgzzgtGjRwn71q1/51Knu3bv7yITCQG7nlytXzhegv/POO7Z06VIfZch5KJzovPbt2/uoh0ZWNMqyb98+u+++++zYsWM+8jFnzpyTAoj+PZ6yFaBita1kyZK5nqMAlW4HASTdeoT2IIBAvAIEkHilOA8BBBBIsUBBAkj0l3l9wde6C02hijeA7Nmzx0cpNMqhgNGnTx+fxqVyNCqhEZJLLrnEp3vps7zO12cKCWrDggULfCrWkiVLTOsy9KNQ1LhxYx/5iA5GqkNlqr5YASRW2QcOHMj1XqLbpsCV1/2muPtPqZ4Akm49QnsQQCBeAQJIvFKchwACCKRYIL8BRNOptKh87dq1Vq1aNWvSpIlddtllNn/+/LgDiIKCQoAWtOstVgMHDvQpWwoECgYKHzoUaDQlK6/z77nnHqtVq5Yv8FbgaNasma1cudIXm2t9x4ABA3z9x5dffpnvAKLQEE/ZWkCf271Et+3tt9/O835T3P0EkHTrANqDAAIFFiCAFJiOCxFAAIFwBeINIJpOde6559qJEyf8i/3jjz/uDb3uuuusVKlSkQCihePBovNgCpambZUtWzZyY19//bWHBS0616G1EFr0XaVKFS9fb6DSyIJCjUYO8jpf12k05s033/RRDr3RKnjTlMpVSKpfv76vU4lul6ZgaZ1JMALSsGFDnw4WvQZEgSaesuNpmxbot2vXLtf7Dbe3Y9fGCEhsI85AAIH0FCCApGe/0CoEEEDgFIFYASQvMgUErW3QNKqCHgoBWpOhtR/BK2kVQLQOROsz9Kas6CO38/X5d999523Robdqac2I1n0ovBT2iLfseNqW1zmFbWMiryeAJFKTshBAIEwBAkiY2tSFAAIIFEKgoAGkEFXmeammS7Vu3drXZWhtiN6MxRGuAAEkXG9qQwCBxAkQQBJnSUkIIIBAUgXSKYDozVRagK5pXX//93+f1Pum8NwFCCA8GQggkKkCBJBM7TnajQACWSeQTgEk6/DT8IYJIGnYKTQJAQTiEiCAxMXESQgggEDqBXIGkOALaOpbRgvCFNBLAHQQQMJUpy4EEEikAAEkkZqUhQACCCRRgBGQJOJmYNEEkAzsNJqMAAIuQADhQUAAAQQyRIAAkiEdFVIzCSAhQVMNAggkXIAAknBSCkQAAQSSI0AASY5rppZKAMnUnqPdCCBAAOEZQAABBDJEoKgHkM8++8waNWpk2sG9fPnyGdIrqWsmASR19tSMAAKFEyCAFM6PqxFAAIHQBIp6ANHeItrpnAAS3yNFAInPibMQQCD9BAgg6dcntAgBBBDIVSBWANEX+PHjx9vo0aPtjDPOsOi///jjjzZlyhTr1auXlz1t2jTr1q2b72qukYf777/f5s2bZ/369bNhw4bZBRdcYDt27LCnn37aateubao7Ohjos3Hjxvlnd9xxh/Xo0cPuvvtuGzVqlM2dO9cmTZpkPXv29LrWr19vHTt2tE8//dTPU/tUvo53333Xunbt6n+/9tprbebMmZF68moXj8f/CBBAeBIQQCBTBQggmdpztBsBBLJOIFYAUUDo3Lmzf+E/88wz/Yt88Hf9W4cOHWzRokX27bff+pf9119/3QPElVde6cFDIWHo0KG2e/duW7ZsmQeY6tWr24UXXmhPPfWUtW3b1kqUKOHuH3/8sX/WqVMn69+/v9111122efNmmz59uk+fatOmje+QfvbZZ1vVqlVt4sSJ1rJlSxs8eLCtXbvW3nvvPdu2bZvXP2bMGJ961a5dOy9b7daRV7uKFy+edX2f2w0TQHgMEEAgUwUIIJnac7QbAQSyTiBWAPnoo4/slltusQ0bNvgISPTfFyxYYH379rXFixdbjRo1PECULl3a3n77bRsyZIgHAn2xV/ioWLGij1YcP37c6tWr5+cqhEQf+jd9tn37dg8cM2bMsIULF/qf33//vdWtW9emTp1qW7ZssSVLlvi/61D4UXBRwNm4cWPkmiB4NG3a1AOIrsmrXZdffnnW9T0BhC5HAIGiJEAAKUq9yb0ggECRFshvAFFIuPnmmz2QHDt2zEc5Jk+e7Eb6fdCgQaZN7TTykfNYs2aNnXfeeT5SktuaDIWb9u3b+6iHRltmzZpl+/bts/vuu8/rqlmzps2ZM8cee+wxa968ufXu3dur0Gf169f36WAaFbnmmmsin6m9QX1Lly7Ns126hoMpWDwDCCCQuQIEkMztO1qOAAJZJhBPAIkOBQoRWtuhqVZ79+71EY4yZcr41Kg+ffr49KyLL77YJkyY4CMOP/zwg/8osDRu3Ni++OKL0waQ6NEWjXDs2bPH64sOIJrypXUmGs3QcfjwYZ+SpREQrRPR2o/gs+i3YGk0Ja92BdPAsqz7T7ldpmBl+xPA/SOQuQIEkMztO1qOAAJZJhArgGik4qqrrvI1FtWqVbMmTZrYZZddZvPnz/fRBoWE1157zddxDBw40CpUqOCjE82aNbOVK1f6egyt4RgwYICv/9i5c2ehA4gCh9aOaLG51nRovYcWyqutq1at8s9Wr17toUQjMs8995x/pjCSV7vOOussXwCvNSNVqlTJ9Xfdf1E/CCBFvYe5PwSKrgABpOj2LXeGAAJFTCBWADlx4oSHh8cff9zv/LrrrrNSpUp5ANm/f79/oX///ff9s0qVKvn0K32B10hE8HYsfaYAo2lSwZQo/XnuueeepKkpWHrLlUZXtN5EU7B27doVGQHR63Q13UvlPPzww5FRDq0l0WhLrVq1TO0dOXKk/+jo3r27LV++3NejlC1bNs92BSMss2fP9nI03Svn7w0aNChivX/q7RBAinwXc4MIFFkBAkiR7VpuDAEEippArAAS3O+BAwesZMmSPt0q56GQoDUbCgKaGhUcWhyuxePlypXzqVqJPg4ePGhHjx71enOWr/YqxGjNSc4j2e1K9H2GWR4BJExt6kIAgUQKEEASqUlZCCCAQBIF4g0gSWwCRaeRAAEkjTqDpiCAQL4ECCD54uJkBBBAIHUCBJDU2adjzQSQdOwV2oQAAvEIEEDiUeIcBBBAIA0ECCBp0Alp1AQCSBp1Bk1BAIF8CRBA8sXFyQgggEDqBAggqbNPx5oJIOnYK7QJAQTiESCAxKPEOQgggEAaCBQmgOR8a1Uibkd7hmg38zp16phejZuq43T3tm3bNt8dPtgwMVYb83t+rPKS+TkBJJm6lI0AAskUIIAkU5eyEUAAgQQKFCaAaG+Ne+65xzcAjH77VWGap7dmaU+Rb775xl+bm6pDAUQhQ2Eo573pLVp6ra82Vozn0Nu69Kpi7cie7gcBJN17iPYhgEBeAgQQng0EEEAgQwTiCSDal0P7c3z66afWqVMn3/ivYsWKkT09fvGLX/i+HNdff70988ydEeBvAAAWQUlEQVQzvg+IjvXr11vHjh39uh49etjo0aN9l3JtSKiNA/V3vSo3+Psjjzxid955p82cOdMaNWpk2vE8eI3ujh07fHNAbWx4xx13eHl33323jRo1yubOnev7e6iNp6tXZTz99NNehu576dKlNm3aNN+5Xbutq/3aKV0bLSqAtGrVyjdX1H4m2uNEGy5q48Mvv/zS5syZY/379/f2a0PErl27+n3269fPhg8fbueff37kCYg+/8cff7QpU6ZE9khR/d26dUtYgCvsY0cAKawg1yOAQKoECCCpkqdeBBBAIJ8CsQKIvjxXrlzZNwXUf/EfO3as7d2713cX/+STT6x69ep27733+s8TTzzhGwJu3brV9uzZ4zuRa7f0li1b2uDBg30zQo0caBPCzp07e0DR/iEaSQn+rp3Mb731Vg8C2vQwmIala1SXApC++N91110+BUq7rJcvX97atGnj9Z599tl51qugozK0b8hTTz1lNWrU8B+FmSFDhnhweOutt7wc7diucxWg1HaFhnXr1vkmiR9++KF16dLF26/d1XWe7lMjHPp3XaPygkNTsILzdU2HDh08XGkkRdeozKZNm+az55JzOgEkOa6UigACyRcggCTfmBoQQACBhAjECiD6kqz/wt+iRQvfVFBf+PVf7bW7uP6Lv0YJFCAUFA4fPuxf/l999VXbsmWLh5EZM2Z4O1WOvqhrupamWGl604YNG3wEIZjupL8fP37crr76aluzZs1JU7AUQOrVq2fbt2/3wKFyFy5c6H+qXXXr1rWpU6eetl5tpKgyVJZCSDDKocBRunRp01QpjXCo/Rp50bkKLRrN0J/aiV33um/fvkj7ZfHSSy/5zvC6F92DRlY0ohJM3Yq+vwULFljfvn1t8eLFHn7UFtWtEZZ0OAgg6dALtAEBBAoiQAApiBrXIIAAAikQiBVAjhw5Yo8++qiPDgRH27Zt/Qu3RkA07Un/BV9fvo8dO2b169f3IPDYY49Z8+bNrXfv3n5Z8JlGEvTlPjqA6Ev4zTff7F/e//a3v/kC9HfeeceDRnDoS3z79u0jC781IqMgcN9993nZNWvW9GlRp6tX5WnEQSFCv6tMtU+BIWf7tXt7dH1qY3BtdAC57bbbTrrP3LowOoCorZqmNXnyZD9Vvw8aNMguuuiiFPT+qVUSQNKiG2gEAggUQIAAUgA0LkEAAQRSIRArgCho6L/m60u61nZoitSDDz7ooUMBRF/SNdoRfIEPgoCmGGkEIJiKFIyOBCMg0V/uNdqhOlRmEEByjoBEf4lXXRr50DQvXRcdQE5Xr0ZAcgaQvNqvAJIzJOUWQH7zm9/4CMxDDz3k3adwoxGj7t275zoCoulrxYsXtzJlyvhUrz59+vj0M91HOhwEkHToBdqAAAIFESCAFESNaxBAAIEUCMQKIPqiry/XmzZtskOHDlnr1q19+pKCSbCmQovAb7rpJv+v+lpIri/W+hKukRL9qWlNWriuhef6gq7gctVVV/makGrVqlmTJk184bfKVJioVauWzZs3zxeLB0e8AURBJ696NX0rOoAE60o0hUrt10L2kSNHmtZs7N69O64AopEaTUPTfWqtjNai6H6GDh3qi+bbtWtnJ06ciJSltSIy1YJ2TUXTIvcKFSr4ovjgfAW93H6XVbIPAkiyhSkfAQSSJUAASZYs5SKAAAIJFogVQLQIXQuktd5Dx4gRI/xHC85vuOEGX9cRHOeee66PYmjthL50681YwQiIQovWhChc6LMBAwbY448/7pdqsXmpUqU8gOgtURqVePPNNyPrPXROzn05NAVr165dkREQrc9QANIUsLzqDaZR6U+1NQgg0aRa29KsWbNT6guuVTu++uqryNQzjfLoPnQ/OvT2Lq3zOOecc3xa2OzZs70ujXJoitn+/fu9fL2WV4fWfqxYscLfxBWcL6Pcfm/QoEGCe//U4gggSSemAgQQSJIAASRJsBSLAAIIJFogVgBRfVoYfuDAAf8iraBw9OjR/9veHdxIea5BGJ0ICIElibAgB3ZIiKAIgBwgAXIgCrbs7K/ttjCykDXChqf+06srjRnqPcWm7nTPf/vQ+Xkr0f3rnz9/vr2t6Hz969f5YPf5788Auf/396+f73neFnX+3LevL1++3L722Nf3/t7797w/x+S8vewMgzMazgfCH/M6H7I/4+n+a4O//h7nJ0XnJyH3D92fr53xdH4D2HH5Uc9QeUzub/+MAfIjFH0PAgR+hoAB8jPU/Z0ECBB4hMC/GSCP+LaJP/J/PKH8jI/nz58/PH369K8Pu//KOAbIr9yObAQIfE/AAPHvgwABAhGB8yC/8//Gn2ddnM8yXOl1fkpynnR+3hL1X/0U4vwd561n521s56cdv/Lr/Grg86H68yyVDx8+3KKeZ594ESBAoCBggBRakpEAAQK/C5zPbJwPfJ/PIJzPUDx58oTLBQXOW8hevXp1e8jk+S1j5zM4BsgF/yE4mUBYwAAJlyc6AQLXE7j/FOSMkNevXz+8ePHieggXvvj9+/cPb9++vY2P89OP86H487mdZ8+ePZwP+3sRIECgIGCAFFqSkQABAn8K3B82eD6I7XVdgTM+Pn78ePv1wOffwnk2ycuXL68L4nICBFICBkiqLmEJECDwh8B52vl5EOAZJF7XETjD4zx/5Tz88fzvMz789OM6/buUwIqAAbLSpDsIELiUwHnQ4Js3bx4+ffp0qbsd+3eBMz7OW7LOr132IkCAQEXAAKk0JScBAgT+QeDdu3e3h+kZItf653GGx3mKvLddXat31xJYETBAVpp0BwECBAgQIECAAIGAgAESKElEAgQIECBAgAABAisCBshKk+4gQIAAAQIECBAgEBAwQAIliUiAAAECBAgQIEBgRcAAWWnSHQQIECBAgAABAgQCAgZIoCQRCRAgQIAAAQIECKwIGCArTbqDAAECBAgQIECAQEDAAAmUJCIBAgQIECBAgACBFQEDZKVJdxAgQIAAAQIECBAICBgggZJEJECAAAECBAgQILAiYICsNOkOAgQIECBAgAABAgEBAyRQkogECBAgQIAAAQIEVgQMkJUm3UGAAAECBAgQIEAgIGCABEoSkQABAgQIECBAgMCKgAGy0qQ7CBAgQIAAAQIECAQEDJBASSISIECAAAECBAgQWBEwQFaadAcBAgQIECBAgACBgIABEihJRAIECBAgQIAAAQIrAgbISpPuIECAAAECBAgQIBAQMEACJYlIgAABAgQIECBAYEXAAFlp0h0ECBAgQIAAAQIEAgIGSKAkEQkQIECAAAECBAisCBggK026gwABAgQIECBAgEBAwAAJlCQiAQIECBAgQIAAgRUBA2SlSXcQIECAAAECBAgQCAgYIIGSRCRAgAABAgQIECCwImCArDTpDgIECBAgQIAAAQIBAQMkUJKIBAgQIECAAAECBFYEDJCVJt1BgAABAgQIECBAICBggARKEpEAAQIECBAgQIDAioABstKkOwgQIECAAAECBAgEBAyQQEkiEiBAgAABAgQIEFgRMEBWmnQHAQIECBAgQIAAgYCAARIoSUQCBAgQIECAAAECKwIGyEqT7iBAgAABAgQIECAQEDBAAiWJSIAAAQIECBAgQGBFwABZadIdBAgQIECAAAECBAICBkigJBEJECBAgAABAgQIrAgYICtNuoMAAQIECBAgQIBAQMAACZQkIgECBAgQIECAAIEVAQNkpUl3ECBAgAABAgQIEAgIGCCBkkQkQIAAAQIECBAgsCJggKw06Q4CBAgQIECAAAECAQEDJFCSiAQIECBAgAABAgRWBAyQlSbdQYAAAQIECBAgQCAgYIAEShKRAAECBAgQIECAwIqAAbLSpDsIECBAgAABAgQIBAQMkEBJIhIgQIAAAQIECBBYETBAVpp0BwECBAgQIECAAIGAgAESKElEAgQIECBAgAABAisCBshKk+4gQIAAAQIECBAgEBAwQAIliUiAAAECBAgQIEBgRcAAWWnSHQQIECBAgAABAgQCAgZIoCQRCRAgQIAAAQIECKwIGCArTbqDAAECBAgQIECAQEDAAAmUJCIBAgQIECBAgACBFQEDZKVJdxAgQIAAAQIECBAICBgggZJEJECAAAECBAgQILAiYICsNOkOAgQIECBAgAABAgEBAyRQkogECBAgQIAAAQIEVgQMkJUm3UGAAAECBAgQIEAgIGCABEoSkQABAgQIECBAgMCKgAGy0qQ7CBAgQIAAAQIECAQEDJBASSISIECAAAECBAgQWBEwQFaadAcBAgQIECBAgACBgIABEihJRAIECBAgQIAAAQIrAgbISpPuIECAAAECBAgQIBAQMEACJYlIgAABAgQIECBAYEXAAFlp0h0ECBAgQIAAAQIEAgIGSKAkEQkQIECAAAECBAisCBggK026gwABAgQIECBAgEBAwAAJlCQiAQIECBAgQIAAgRUBA2SlSXcQIECAAAECBAgQCAgYIIGSRCRAgAABAgQIECCwImCArDTpDgIECBAgQIAAAQIBAQMkUJKIBAgQIECAAAECBFYEDJCVJt1BgAABAgQIECBAICBggARKEpEAAQIECBAgQIDAioABstKkOwgQIECAAAECBAgEBAyQQEkiEiBAgAABAgQIEFgRMEBWmnQHAQIECBAgQIAAgYCAARIoSUQCBAgQIECAAAECKwIGyEqT7iBAgAABAgQIECAQEDBAAiWJSIAAAQIECBAgQGBFwABZadIdBAgQIECAAAECBAICBkigJBEJECBAgAABAgQIrAgYICtNuoMAAQIECBAgQIBAQMAACZQkIgECBAgQIECAAIEVAQNkpUl3ECBAgAABAgQIEAgIGCCBkkQkQIAAAQIECBAgsCJggKw06Q4CBAgQIECAAAECAQEDJFCSiAQIECBAgAABAgRWBAyQlSbdQYAAAQIECBAgQCAgYIAEShKRAAECBAgQIECAwIqAAbLSpDsIECBAgAABAgQIBAQMkEBJIhIgQIAAAQIECBBYETBAVpp0BwECBAgQIECAAIGAgAESKElEAgQIECBAgAABAisCBshKk+4gQIAAAQIECBAgEBAwQAIliUiAAAECBAgQIEBgRcAAWWnSHQQIECBAgAABAgQCAgZIoCQRCRAgQIAAAQIECKwIGCArTbqDAAECBAgQIECAQEDAAAmUJCIBAgQIECBAgACBFQEDZKVJdxAgQIAAAQIECBAICBgggZJEJECAAAECBAgQILAiYICsNOkOAgQIECBAgAABAgEBAyRQkogECBAgQIAAAQIEVgQMkJUm3UGAAAECBAgQIEAgIGCABEoSkQABAgQIECBAgMCKgAGy0qQ7CBAgQIAAAQIECAQEDJBASSISIECAAAECBAgQWBEwQFaadAcBAgQIECBAgACBgIABEihJRAIECBAgQIAAAQIrAgbISpPuIECAAAECBAgQIBAQMEACJYlIgAABAgQIECBAYEXAAFlp0h0ECBAgQIAAAQIEAgIGSKAkEQkQIECAAAECBAisCBggK026gwABAgQIECBAgEBAwAAJlCQiAQIECBAgQIAAgRUBA2SlSXcQIECAAAECBAgQCAgYIIGSRCRAgAABAgQIECCwImCArDTpDgIECBAgQIAAAQIBAQMkUJKIBAgQIECAAAECBFYEDJCVJt1BgAABAgQIECBAICBggARKEpEAAQIECBAgQIDAioABstKkOwgQIECAAAECBAgEBAyQQEkiEiBAgAABAgQIEFgRMEBWmnQHAQIECBAgQIAAgYCAARIoSUQCBAgQIECAAAECKwIGyEqT7iBAgAABAgQIECAQEDBAAiWJSIAAAQIECBAgQGBFwABZadIdBAgQIECAAAECBAICBkigJBEJECBAgAABAgQIrAgYICtNuoMAAQIECBAgQIBAQMAACZQkIgECBAgQIECAAIEVAQNkpUl3ECBAgAABAgQIEAgIGCCBkkQkQIAAAQIECBAgsCJggKw06Q4CBAgQIECAAAECAQEDJFCSiAQIECBAgAABAgRWBAyQlSbdQYAAAQIECBAgQCAgYIAEShKRAAECBAgQIECAwIqAAbLSpDsIECBAgAABAgQIBAQMkEBJIhIgQIAAAQIECBBYETBAVpp0BwECBAgQIECAAIGAgAESKElEAgQIECBAgAABAisCBshKk+4gQIAAAQIECBAgEBAwQAIliUiAAAECBAgQIEBgRcAAWWnSHQQIECBAgAABAgQCAgZIoCQRCRAgQIAAAQIECKwIGCArTbqDAAECBAgQIECAQEDAAAmUJCIBAgQIECBAgACBFQEDZKVJdxAgQIAAAQIECBAICBgggZJEJECAAAECBAgQILAiYICsNOkOAgQIECBAgAABAgEBAyRQkogECBAgQIAAAQIEVgQMkJUm3UGAAAECBAgQIEAgIGCABEoSkQABAgQIECBAgMCKgAGy0qQ7CBAgQIAAAQIECAQEDJBASSISIECAAAECBAgQWBEwQFaadAcBAgQIECBAgACBgIABEihJRAIECBAgQIAAAQIrAgbISpPuIECAAAECBAgQIBAQMEACJYlIgAABAgQIECBAYEXAAFlp0h0ECBAgQIAAAQIEAgIGSKAkEQkQIECAAAECBAisCBggK026gwABAgQIECBAgEBAwAAJlCQiAQIECBAgQIAAgRUBA2SlSXcQIECAAAECBAgQCAgYIIGSRCRAgAABAgQIECCwImCArDTpDgIECBAgQIAAAQIBAQMkUJKIBAgQIECAAAECBFYEDJCVJt1BgAABAgQIECBAICBggARKEpEAAQIECBAgQIDAioABstKkOwgQIECAAAECBAgEBAyQQEkiEiBAgAABAgQIEFgRMEBWmnQHAQIECBAgQIAAgYCAARIoSUQCBAgQIECAAAECKwIGyEqT7iBAgAABAgQIECAQEDBAAiWJSIAAAQIECBAgQGBFwABZadIdBAgQIECAAAECBAICBkigJBEJECBAgAABAgQIrAgYICtNuoMAAQIECBAgQIBAQMAACZQkIgECBAgQIECAAIEVAQNkpUl3ECBAgAABAgQIEAgIGCCBkkQkQIAAAQIECBAgsCJggKw06Q4CBAgQIECAAAECAQEDJFCSiAQIECBAgAABAgRWBAyQlSbdQYAAAQIECBAgQCAgYIAEShKRAAECBAgQIECAwIqAAbLSpDsIECBAgAABAgQIBAQMkEBJIhIgQIAAAQIECBBYETBAVpp0BwECBAgQIECAAIGAgAESKElEAgQIECBAgAABAisCBshKk+4gQIAAAQIECBAgEBAwQAIliUiAAAECBAgQIEBgRcAAWWnSHQQIECBAgAABAgQCAgZIoCQRCRAgQIAAAQIECKwIGCArTbqDAAECBAgQIECAQEDAAAmUJCIBAgQIECBAgACBFQEDZKVJdxAgQIAAAQIECBAICBgggZJEJECAAAECBAgQILAiYICsNOkOAgQIECBAgAABAgEBAyRQkogECBAgQIAAAQIEVgQMkJUm3UGAAAECBAgQIEAgIGCABEoSkQABAgQIECBAgMCKgAGy0qQ7CBAgQIAAAQIECAQEDJBASSISIECAAAECBAgQWBH4DTLBE+1uQpVLAAAAAElFTkSuQmCC&quot;</span>
      <span class="p">],[</span>
      <span class="nv">zombieKernelTestHarnessVersionMajor: </span><span class="mi">0</span>
      <span class="nv">zombieKernelTestHarnessVersionMinor: </span><span class="mi">1</span>
      <span class="nv">zombieKernelTestHarnessVersionRelease: </span><span class="mi">0</span>
      <span class="nv">userAgent: </span><span class="s">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17&quot;</span>
      <span class="nv">screenWidth: </span><span class="mi">1920</span>
      <span class="nv">screenHeight: </span><span class="mi">1080</span>
      <span class="nv">screenColorDepth: </span><span class="mi">24</span>
      <span class="nv">screenPixelRatio: </span><span class="mi">1</span>
      <span class="nv">appCodeName: </span><span class="s">&quot;Mozilla&quot;</span>
      <span class="nv">appName: </span><span class="s">&quot;Netscape&quot;</span>
      <span class="nv">appVersion: </span><span class="s">&quot;5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17&quot;</span>
      <span class="nv">cookieEnabled: </span><span class="kc">true</span>
      <span class="nv">platform: </span><span class="s">&quot;MacIntel&quot;</span>
      <span class="p">,</span> <span class="s">&quot;data:image/png;base64,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kSOtWbNmftfqiqVgQ+NA1AUraAHRM0NCAAEEElWAhQgT9ZuhXggggMDfBGKn3NUuDThWUssHKX8JBN+5WkGU1DKmWdHOnj1r6pp1+fJl36dnhoQAAggkqgABSKJ+M9QLAQQQiBHQD83kiW5XyUXy/ueUvvPz58+bXpqkQGOFUnpW8r4Md4gAArlJgAAkN31b1BUBBPKlgLrT5OcuNRpQfbNSbhhL8e2335peGhOkACS/Py8361nhugggkH4BApD0W5ETAQQQuCkCifKD8tlnn7VRo0aFBrfffru9/fbb1rdv33Bfw4YNbdOmTRmaoatu3br2xhtvhGXEbmjGr4ULF/ouTTerWcCef/752Cy+PXHiRD9WuXLlHxzL7I4GDRrY7NmzM3t6ZOcFrR7qdqVXojwvkQFwIQQQyHUCBCC57iujwgggkB8FEqEF5MMPPzT9KA9SkyZNTAPj9R4kHddsXeoOlBNJP7a1CrgGXQdJMz/9+Mc/9laAYF9+e48NOhLhWclv/twvAghkTIAAJGNe5EYAAQTyrYACkBo1aoStGwo8FixY4EFJ0E1KAcif//xnN9JsXXPnzrU1a9aYWijuuOMO31+1alX793//d+vZs6e99NJLP/D8u7/7O3v11VftlVdesVatWv3guBbga9myZbi/efPmprrFDrxO77UVuIwYMcKGDRtm//u//2vTp0+3ihUrhmVrRfEhQ4bY4sWLvU66/0RLQfARvCda/agPAgggkFyAACS5CJ8RQAABBFIUOHDggM+4pMXvlBSA/OEPfzCt0K2uV0p6VzCg7lITJkzwAENdtDRT07/92795niJFingAoeDi9ddf933BH00j+//+3/+zt956y/7zP//TunTpEhzyd43J+P3vf29t2rQJ97du3dq7ghUo8Nf/pWXk2pq6VoHQN99842tsHDx40B577LGw7OrVq1upUqVs7Nixpvv/p3/6p/AYGwgggAACmRMgAMmcG2chgAAC+VJArRsKMqpUqeItDl9++aVt3brVgxH98Fcrx/bt233RvE8++cS2bNliZ86csddee83UUhFMH3vLLbf4Qnp//OMfb3Bs3Lix7dq1y958801vSQnGfwSZ1CKhFpB77rnHW2K0AJ8Coc2bNwdZMnxtraUxZ84cX1l8xowZptYTXUdJs0upVURB1pIlS3zV8fBCbCCAAAIIZErg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BAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBByQqzmVIUCAAAECBAgQINAWcEDa+0hHgAABAgQIECBA4ErAAbmaUxkCBAgQIECAAAECbQEHpL2PdAQIECBAgAABAgSuBAaU0YynAt9EwgAAAABJRU5ErkJggg==&quot;</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">335</span>
    <span class="nv">mouseY: </span><span class="mi">134</span>
    <span class="nv">time: </span><span class="mi">915</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">318</span>
    <span class="nv">mouseY: </span><span class="mi">129</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">302</span>
    <span class="nv">mouseY: </span><span class="mi">128</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">218</span>
    <span class="nv">mouseY: </span><span class="mi">120</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">156</span>
    <span class="nv">mouseY: </span><span class="mi">121</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">97</span>
    <span class="nv">mouseY: </span><span class="mi">130</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">42</span>
    <span class="nv">mouseY: </span><span class="mi">134</span>
    <span class="nv">time: </span><span class="mi">17</span>
  <span class="p">,</span>
    <span class="nv">type: </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">mouseX: </span><span class="mi">12</span>
    <span class="nv">mouseY: </span><span class="mi">135</span>
    <span class="nv">time: </span><span class="mi">16</span>
  <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>BoxMorph ////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>I can have an optionally rounded border</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BoxMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">edge: </span><span class="kc">null</span>
  <span class="nv">border: </span><span class="kc">null</span>
  <span class="nv">borderColor: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@edge = 4, border, borderColor) -&gt;</span>
    <span class="vi">@border = </span><span class="nx">border</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span><span class="p">))</span>
    <span class="vi">@borderColor = </span><span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>BoxMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@edge</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">@border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">super</span><span class="p">()</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@outlinePath</span> <span class="nx">context</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@edge</span> <span class="o">-</span> <span class="nx">@border</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@border</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@border</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">context.lineWidth = </span><span class="nx">@border</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">@borderColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">@outlinePath</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@border</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
  
  <span class="nv">outlinePath: </span><span class="nf">(context, radius, inset) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">radius</span> <span class="o">+</span> <span class="nx">inset</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>top left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>top right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>bottom right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>bottom left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">),</span> <span class="kc">false</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>BoxMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;border width...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nborder\nwidth:&quot;</span><span class="p">,</span>
        <span class="nx">@setBorderWidth</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@border</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the border&#39;s\nline size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;border color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nborder color:&quot;</span><span class="p">,</span> <span class="nx">@setBorderColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@borderColor</span>
    <span class="p">),</span> <span class="s">&quot;set the border&#39;s\nline color&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;corner size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncorner\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setCornerSize</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@edge</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the corner&#39;s\nradius&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setBorderWidth: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@border = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@border = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setBorderColor: </span><span class="nf">(color) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">color</span>
      <span class="vi">@borderColor = </span><span class="nx">color</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setCornerSize: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@edge = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@edge = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">colorSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;borderColor&quot;</span><span class="p">]</span>
  
  <span class="nv">numericalSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;setBorderWidth&quot;</span><span class="p">,</span> <span class="s">&quot;setCornerSize&quot;</span>
    <span class="nx">list</span></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>MorphsListMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MorphsListMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span></pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>panes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">morphsList: </span><span class="kc">null</span>
  <span class="nv">buttonClose: </span><span class="kc">null</span>
  <span class="nv">resizer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(target) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>

    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="vi">@isDraggable = </span><span class="kc">true</span>
    <span class="vi">@border = </span><span class="mi">1</span>
    <span class="vi">@edge = </span><span class="mi">5</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">setTarget: </span><span class="nf">(target) -&gt;</span>
    <span class="vi">@target = </span><span class="nx">target</span>
    <span class="vi">@currentProperty = </span><span class="kc">null</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">buildPanes: </span><span class="nf">-&gt;</span>
    <span class="nv">attribs = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>remove existing panes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>keep work pane around</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@work</span>

    <span class="vi">@children = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;Morphs List&quot;</span><span class="p">)</span>
    <span class="vi">@label.fontSize = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span>
    <span class="vi">@label.isBold = </span><span class="kc">true</span>
    <span class="vi">@label.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@label</span></pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>Check which objects end with the word Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">theWordMorph = </span><span class="s">&quot;Morph&quot;</span>
    <span class="nv">ListOfMorphs = </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">)).</span><span class="nx">filter</span> <span class="nf">(i) -&gt;</span>
      <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">theWordMorph</span><span class="p">,</span> <span class="nx">i</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">theWordMorph</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
    <span class="vi">@morphsList = </span><span class="k">new</span> <span class="nx">ListMorph</span><span class="p">(</span><span class="nx">ListOfMorphs</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>so far nothing happens when items are selected
@morphsList.action = (selected) ->
 val = myself.target[selected]
 myself.currentProperty = val
 if val is null
   txt = "NULL"
 else if isString(val)
   txt = val
 else
   txt = val.toString()
 cnts = new TextMorph(txt)
 cnts.isEditable = true
 cnts.enableSelecting()
 cnts.setReceiver myself.target
 myself.detail.setContents cnts</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@morphsList.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@morphsList.vBar.alpha = </span><span class="mf">0.6</span>
    <span class="nx">@add</span> <span class="nx">@morphsList</span></pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonClose = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonClose.labelString = </span><span class="s">&quot;close&quot;</span>
    <span class="vi">@buttonClose.action = </span><span class="o">=&gt;</span>
      <span class="nx">@destroy</span><span class="p">()</span>

    <span class="nx">@add</span> <span class="nx">@buttonClose</span></pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>resizer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@resizer = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>update layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  <span class="nv">fixLayout: </span><span class="nf">-&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">w</span>
    <span class="k">if</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">@silentSetHeight</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">50</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@resizer</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>morphsList</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nx">w</span> <span class="o">-=</span> <span class="nx">@edge</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">@edge</span><span class="p">)</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">h = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">y</span>
    <span class="nx">@morphsList</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@morphsList</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">h = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@fixLayout</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>MouseSensorMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>for demo and debuggin purposes only, to be removed later</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MouseSensorMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>
  <span class="nv">constructor: </span><span class="nf">(edge, border, borderColor) -&gt;</span>
    <span class="k">super</span>
    <span class="vi">@edge = </span><span class="nx">edge</span> <span class="o">or</span> <span class="mi">4</span>
    <span class="vi">@border = </span><span class="nx">border</span> <span class="o">or</span> <span class="mi">2</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="vi">@isTouched = </span><span class="kc">false</span>
    <span class="vi">@upStep = </span><span class="mf">0.05</span>
    <span class="vi">@downStep = </span><span class="mf">0.02</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">false</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">touch: </span><span class="nf">-&gt;</span>
    <span class="k">unless</span> <span class="nx">@isTouched</span>
      <span class="vi">@isTouched = </span><span class="kc">true</span>
      <span class="vi">@alpha = </span><span class="mf">0.6</span>
      <span class="vi">@step = </span><span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@isTouched</span>
          <span class="vi">@alpha = </span><span class="nx">@alpha</span> <span class="o">+</span> <span class="nx">@upStep</span>  <span class="k">if</span> <span class="nx">@alpha</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@alpha</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@downStep</span><span class="p">)</span>
          <span class="vi">@alpha = </span><span class="nx">@alpha</span> <span class="o">-</span> <span class="nx">@downStep</span>
        <span class="k">else</span>
          <span class="vi">@alpha = </span><span class="mi">0</span>
          <span class="vi">@step = </span><span class="kc">null</span>
        <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">unTouch: </span><span class="nf">-&gt;</span>
    <span class="vi">@isTouched = </span><span class="kc">false</span>
  
  <span class="nv">mouseEnter: </span><span class="nf">-&gt;</span>
    <span class="nx">@touch</span><span class="p">()</span>
  
  <span class="nv">mouseLeave: </span><span class="nf">-&gt;</span>
    <span class="nx">@unTouch</span><span class="p">()</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">@touch</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">@unTouch</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>TextMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>I am a multi-line, word-wrapping String</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>Jens has made this quasi-inheriting from StringMorph i.e. he is copying
over manually the following methods like so:</p>

<p>TextMorph::font = StringMorph::font
 TextMorph::edit = StringMorph::edit
 TextMorph::selection = StringMorph::selection
 TextMorph::selectionStartSlot = StringMorph::selectionStartSlot
 TextMorph::clearSelection = StringMorph::clearSelection
 TextMorph::deleteSelection = StringMorph::deleteSelection
 TextMorph::selectAll = StringMorph::selectAll
 TextMorph::mouseClickLeft = StringMorph::mouseClickLeft
 TextMorph::enableSelecting = StringMorph::enableSelecting 
 TextMorph::disableSelecting = StringMorph::disableSelecting
 TextMorph::toggleIsDraggable = StringMorph::toggleIsDraggable
 TextMorph::toggleWeight = StringMorph::toggleWeight
 TextMorph::toggleItalic = StringMorph::toggleItalic
 TextMorph::setSerif = StringMorph::setSerif
 TextMorph::setSansSerif = StringMorph::setSansSerif
 TextMorph::setText = StringMorph::setText
 TextMorph::setFontSize = StringMorph::setFontSize
 TextMorph::numericalSetters = StringMorph::numericalSetters</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">TextMorph</span> <span class="k">extends</span> <span class="nx">StringMorph</span>

  <span class="nv">words: </span><span class="p">[]</span>
  <span class="nv">lines: </span><span class="p">[]</span>
  <span class="nv">lineSlots: </span><span class="p">[]</span>
  <span class="nv">alignment: </span><span class="kc">null</span>
  <span class="nv">maxWidth: </span><span class="kc">null</span>
  <span class="nv">maxLineWidth: </span><span class="mi">0</span>
  <span class="nv">backgroundColor: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>additional properties for ad-hoc evaluation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">receiver: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">    text, @fontSize = 12, @fontStyle = &quot;sans-serif&quot;, @isBold = false,</span>
<span class="nf">    @isItalic = false, @alignment = &quot;left&quot;, @maxWidth = 0, fontName, shadowOffset,</span>
<span class="nf">    @shadowColor = null</span>
<span class="nf">    ) -&gt;</span>
      <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>override inherited properites:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@markedTextColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
      <span class="vi">@markedBackgoundColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
      <span class="vi">@text = </span><span class="nx">text</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="nx">text</span> <span class="o">is</span> <span class="s">&quot;&quot;</span> <span class="k">then</span> <span class="nx">text</span> <span class="k">else</span> <span class="s">&quot;TextMorph&quot;</span><span class="p">))</span>
      <span class="vi">@fontName = </span><span class="nx">fontName</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">globalFontFamily</span>
      <span class="vi">@shadowOffset = </span><span class="nx">shadowOffset</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>

  <span class="nv">toString: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <p>e.g. 'a TextMorph("Hello World")'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;a TextMorph&quot;</span> <span class="o">+</span> <span class="s">&quot;(\&quot;&quot;</span> <span class="o">+</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;...\&quot;)&quot;</span>
  
  
  <span class="nv">parse: </span><span class="nf">-&gt;</span>
    <span class="nv">paragraphs = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
    <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">oldline = </span><span class="s">&quot;&quot;</span>
    <span class="nv">slot = </span><span class="mi">0</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="vi">@maxLineWidth = </span><span class="mi">0</span>
    <span class="vi">@lines = </span><span class="p">[]</span>
    <span class="vi">@lineSlots = </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="vi">@words = </span><span class="p">[]</span>
    <span class="nx">paragraphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(p) =&gt;</span>
      <span class="vi">@words = </span><span class="nx">@words</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
      <span class="nx">@words</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@words</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(word) =&gt;</span>
      <span class="k">if</span> <span class="nx">word</span> <span class="o">is</span> <span class="s">&quot;\n&quot;</span>
        <span class="nx">@lines</span><span class="p">.</span><span class="nx">push</span> <span class="nx">oldline</span>
        <span class="nx">@lineSlots</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slot</span>
        <span class="vi">@maxLineWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@maxLineWidth</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">oldline</span><span class="p">).</span><span class="nx">width</span><span class="p">)</span>
        <span class="nv">oldline = </span><span class="s">&quot;&quot;</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">@maxWidth</span> <span class="o">&gt;</span> <span class="mi">0</span>
          <span class="nv">newline = </span><span class="nx">oldline</span> <span class="o">+</span> <span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
          <span class="nv">w = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">newline</span><span class="p">).</span><span class="nx">width</span>
          <span class="k">if</span> <span class="nx">w</span> <span class="o">&gt;</span> <span class="nx">@maxWidth</span>
            <span class="nx">@lines</span><span class="p">.</span><span class="nx">push</span> <span class="nx">oldline</span>
            <span class="nx">@lineSlots</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slot</span>
            <span class="vi">@maxLineWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@maxLineWidth</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">oldline</span><span class="p">).</span><span class="nx">width</span><span class="p">)</span>
            <span class="nv">oldline = </span><span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
          <span class="k">else</span>
            <span class="nv">oldline = </span><span class="nx">newline</span>
        <span class="k">else</span>
          <span class="nv">oldline = </span><span class="nx">oldline</span> <span class="o">+</span> <span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        <span class="nx">slot</span> <span class="o">+=</span> <span class="nx">word</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
  
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nx">@parse</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>set my extent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadowWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">height = </span><span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@maxWidth</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@maxLineWidth</span> <span class="o">+</span> <span class="nx">shadowWidth</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@maxWidth</span> <span class="o">+</span> <span class="nx">shadowWidth</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
    <span class="vi">@image.width = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="vi">@image.height = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>prepare context for drawing text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nv">context.textAlign = </span><span class="s">&quot;left&quot;</span>
    <span class="nv">context.textBaseline = </span><span class="s">&quot;bottom&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>fill the background, if desired</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@backgroundColor</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@backgroundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>draw the shadow, if any</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shadowColor</span>
      <span class="nv">offx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">offy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>console.log 'shadow x: ' + offx + " y: " + offy</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">context.fillStyle = </span><span class="nx">@shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">@lines</span>
        <span class="nv">width = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">line</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">shadowWidth</span>
        <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
          <span class="nv">x = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;center&quot;</span>
          <span class="nv">x = </span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="c1"># &#39;left&#39;</span>
          <span class="nv">x = </span><span class="mi">0</span>
        <span class="nv">y = </span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">-</span> <span class="nx">shadowHeight</span>
        <span class="nx">i</span><span class="o">++</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">offx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">offy</span></pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p>now draw the actual text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">offy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>console.log 'maintext x: ' + offx + " y: " + offy</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">@lines</span>
      <span class="nv">width = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">line</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">shadowWidth</span>
      <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
        <span class="nv">x = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;center&quot;</span>
        <span class="nv">x = </span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="k">else</span> <span class="c1"># &#39;left&#39;</span>
        <span class="nv">x = </span><span class="mi">0</span>
      <span class="nv">y = </span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">-</span> <span class="nx">shadowHeight</span>
      <span class="nx">i</span><span class="o">++</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">offx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">offy</span></pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>draw the selection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">start</span><span class="p">...</span><span class="nx">stop</span><span class="p">]</span>
      <span class="nv">p = </span><span class="nx">@slotPosition</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">c = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedBackgoundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedTextColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>notify my parent of layout change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">layoutChanged</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">layoutChanged</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="vi">@maxWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>TextMorph mesuring:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">columnRow: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>answer the logical position point of the given index ("slot")</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="nv">idx = </span><span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">row</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">col</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">row</span><span class="p">].</span><span class="nx">length</span><span class="p">]</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">col</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">idx</span> <span class="o">is</span> <span class="nx">slot</span>
        <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>return new Point(0, 0);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  
  <span class="nv">slotPosition: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>answer the physical position point of the given index ("slot")
where the caret should be placed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">xOffset = </span><span class="mi">0</span>
    <span class="nv">yOffset = </span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span><span class="p">]</span>
      <span class="nx">xOffset</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span><span class="p">][</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">xOffset</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">yOffset</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">slotAt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>answer the slot (index) closest to the given point
so the caret can be moved accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">charX = </span><span class="mi">0</span>
    <span class="nv">row = </span><span class="mi">0</span>
    <span class="nv">col = </span><span class="mi">0</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">row</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">((</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">*</span> <span class="nx">row</span><span class="p">)</span>
    <span class="nv">row = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">charX</span>
      <span class="nx">charX</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">col</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">col</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">+</span> <span class="nx">col</span> <span class="o">-</span> <span class="mi">1</span>
  
  <span class="nv">upFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>answer the slot above the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">slot</span>  <span class="k">if</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="nv">above = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">above</span><span class="p">.</span><span class="nx">length</span>  <span class="k">if</span> <span class="nx">above</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">downFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>answer the slot below the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">slot</span>  <span class="k">if</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="nv">below = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">below</span><span class="p">.</span><span class="nx">length</span>  <span class="k">if</span> <span class="nx">below</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">startOfLine: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>answer the first slot (index) of the line for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">).</span><span class="nx">y</span><span class="p">]</span>
  
  <span class="nv">endOfLine: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>answer the slot (index) indicating the EOL for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@startOfLine</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">@lines</span><span class="p">[</span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">).</span><span class="nx">y</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>TextMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;edit&quot;</span><span class="p">,</span> <span class="s">&quot;edit&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;font size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfont\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setFontSize</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this Text&#39;s\nfont point size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align left&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToLeft&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;left&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align right&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToRight&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;right&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align center&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToCenter&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;center&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;serif&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sans-serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSansSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;sans-serif&quot;</span>
    <span class="k">if</span> <span class="nx">@isBold</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal weight&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">if</span> <span class="nx">@isItalic</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal style&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;italic&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setAlignmentToLeft: </span><span class="nf">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;left&quot;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setAlignmentToRight: </span><span class="nf">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;right&quot;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setAlignmentToCenter: </span><span class="nf">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;center&quot;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>TextMorph evaluation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">evaluationMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;do it&quot;</span><span class="p">,</span> <span class="s">&quot;doIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show it&quot;</span><span class="p">,</span> <span class="s">&quot;showIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression\nand show the result&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect it&quot;</span><span class="p">,</span> <span class="s">&quot;inspectIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression\nand inspect the result&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;select all&quot;</span><span class="p">,</span> <span class="s">&quot;selectAllAndEdit&quot;</span>
    <span class="nx">menu</span>

  <span class="nv">selectAllAndEdit: </span><span class="nf">-&gt;</span>
    <span class="nx">@edit</span><span class="p">()</span>
    <span class="nx">@selectAll</span><span class="p">()</span>
   
  <span class="nv">setReceiver: </span><span class="nf">(obj) -&gt;</span>
    <span class="vi">@receiver = </span><span class="nx">obj</span>
    <span class="vi">@customContextMenu = </span><span class="nx">@evaluationMenu</span><span class="p">()</span>
  
  <span class="nv">doIt: </span><span class="nf">-&gt;</span>
    <span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span> <span class="nx">@selection</span><span class="p">()</span>
    <span class="nx">@edit</span><span class="p">()</span>
  
  <span class="nv">showIt: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span><span class="p">(</span><span class="nx">@selection</span><span class="p">())</span>
    <span class="k">if</span> <span class="nx">result</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@inform</span> <span class="nx">result</span>
  
  <span class="nv">inspectIt: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span><span class="p">(</span><span class="nx">@selection</span><span class="p">())</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">result</span><span class="o">?</span>
      <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
      <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>BlinkerMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>can be used for text caret</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BlinkerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>
  <span class="nv">constructor: </span><span class="nf">(@fps = 2) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>BlinkerMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="nf">-&gt;</span>
    <span class="nx">@toggleVisibility</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>CaretMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>I am a String/Text editing widget</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">CaretMorph</span> <span class="k">extends</span> <span class="nx">BlinkerMorph</span>

  <span class="nv">keyDownEventUsed: </span><span class="kc">false</span>
  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">originalContents: </span><span class="kc">null</span>
  <span class="nv">slot: </span><span class="kc">null</span>
  <span class="nv">viewPadding: </span><span class="mi">1</span>

  <span class="nv">constructor: </span><span class="nf">(@target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@originalContents = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
    <span class="vi">@originalAlignment = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">alignment</span>
    <span class="vi">@slot = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nv">ls = </span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">fontSize</span><span class="p">)</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">ls</span> <span class="o">/</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">ls</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nv">font = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">font</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@target</span> <span class="k">instanceof</span> <span class="nx">TextMorph</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">alignment</span> <span class="o">!=</span> <span class="s">&#39;left&#39;</span><span class="p">))</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">setAlignmentToLeft</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span>
  </pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>CaretMorph event processing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processKeyPress: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>@inspectKeyEvent event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@keyDownEventUsed</span>
      <span class="vi">@keyDownEventUsed = </span><span class="kc">false</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">is</span> <span class="mi">40</span><span class="p">)</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">is</span> <span class="mi">40</span>
      <span class="nx">@insert</span> <span class="s">&quot;(&quot;</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">is</span> <span class="mi">37</span><span class="p">)</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">is</span> <span class="mi">37</span>
      <span class="nx">@insert</span> <span class="s">&quot;%&quot;</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="c1"># Opera doesn&#39;t support charCode</span>
      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
        <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
        <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="k">else</span>
        <span class="nx">@insert</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">),</span> <span class="nx">event</span><span class="p">.</span><span class="nx">shiftKey</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="c1"># all other browsers</span>
      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
        <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
        <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="k">else</span>
        <span class="nx">@insert</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">),</span> <span class="nx">event</span><span class="p">.</span><span class="nx">shiftKey</span></pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
  
  <span class="nv">processKeyDown: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>this.inspectKeyEvent(event);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shift = </span><span class="nx">event</span><span class="p">.</span><span class="nx">shiftKey</span>
    <span class="vi">@keyDownEventUsed = </span><span class="kc">false</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
      <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span></pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
      <span class="k">return</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
      <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span></pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
      <span class="k">return</span>
    <span class="k">switch</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="k">when</span> <span class="mi">37</span>
        <span class="nx">@goLeft</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">39</span>
        <span class="nx">@goRight</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">38</span>
        <span class="nx">@goUp</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">40</span>
        <span class="nx">@goDown</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">36</span>
        <span class="nx">@goHome</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">35</span>
        <span class="nx">@goEnd</span><span class="p">(</span><span class="nx">shift</span><span class="p">)</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">46</span>
        <span class="nx">@deleteRight</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">8</span>
        <span class="nx">@deleteLeft</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">13</span></pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>we can't check the class using instanceOf
because TextMorphs are instances of StringMorphs
but they want the enter to insert a carriage return.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;StringMorph&quot;</span>
          <span class="nx">@accept</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@insert</span> <span class="s">&quot;\n&quot;</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">27</span>
        <span class="nx">@cancel</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>this.inspectKeyEvent(event);
notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>CaretMorph navigation - simple version
gotoSlot: (newSlot) ->
 @setPosition @target.slotPosition(newSlot)
 @slot = Math.max(newSlot, 0)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gotoSlot: </span><span class="nf">(slot) -&gt;</span>
    <span class="nv">length = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">pos = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">slotPosition</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="vi">@slot = </span><span class="p">(</span><span class="k">if</span> <span class="nx">slot</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="k">if</span> <span class="nx">slot</span> <span class="o">&gt;</span> <span class="nx">length</span> <span class="k">then</span> <span class="nx">length</span> <span class="k">else</span> <span class="nx">slot</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">isScrollable</span>
      <span class="nv">right = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@viewPadding</span>
      <span class="nv">left = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@viewPadding</span>
      <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">right</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span>
        <span class="nv">pos.x = </span><span class="nx">right</span>
      <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">left</span>
        <span class="nv">left = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">(),</span> <span class="nx">left</span><span class="p">)</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">left</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span>
        <span class="nv">pos.x = </span><span class="nx">left</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">right</span> <span class="o">and</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">left</span>
        <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">right</span>
    <span class="nx">@show</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span>

    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">parent</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span> <span class="o">and</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">isScrollable</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">scrollCaretIntoView</span> <span class="nx">@</span>
  
  <span class="nv">goLeft: </span><span class="nf">(shift) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">goRight: </span><span class="nf">(shift, howMany) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span> <span class="o">+</span> <span class="p">(</span><span class="nx">howMany</span> <span class="o">||</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">goUp: </span><span class="nf">(shift) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">upFrom</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">goDown: </span><span class="nf">(shift) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">downFrom</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">goHome: </span><span class="nf">(shift) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">startOfLine</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">goEnd: </span><span class="nf">(shift) -&gt;</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">endOfLine</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@updateSelection</span> <span class="nx">shift</span>
  
  <span class="nv">gotoPos: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">slotAt</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
    <span class="nx">@show</span><span class="p">()</span>

  <span class="nv">updateSelection: </span><span class="nf">(shift) -&gt;</span>
    <span class="k">if</span> <span class="nx">shift</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">endMark</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">startMark</span>
        <span class="vi">@target.startMark = </span><span class="nx">@slot</span>
        <span class="vi">@target.endMark = </span><span class="nx">@slot</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">endMark</span> <span class="o">isnt</span> <span class="nx">@slot</span>
        <span class="vi">@target.endMark = </span><span class="nx">@slot</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>CaretMorph editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">accept: </span><span class="nf">-&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;accept&quot;</span><span class="p">,</span> <span class="kc">null</span>
  
  <span class="nv">cancel: </span><span class="nf">-&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nx">@undo</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span>
    <span class="nx">@escalateEvent</span> <span class="s">&#39;cancel&#39;</span><span class="p">,</span> <span class="kc">null</span>
    
  <span class="nv">undo: </span><span class="nf">-&gt;</span>
    <span class="vi">@target.text = </span><span class="nx">@originalContents</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="mi">0</span>
  
  <span class="nv">insert: </span><span class="nf">(aChar, shiftKey) -&gt;</span>
    <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="s">&quot;\t&quot;</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&#39;reactToEdit&#39;</span><span class="p">,</span> <span class="nx">@target</span>
      <span class="k">if</span> <span class="nx">shiftKey</span>
        <span class="k">return</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">backTab</span><span class="p">(</span><span class="nx">@target</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">tab</span><span class="p">(</span><span class="nx">@target</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">isNumeric</span> <span class="o">or</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">aChar</span><span class="p">))</span> <span class="o">or</span> <span class="nx">contains</span><span class="p">([</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">],</span> <span class="nx">aChar</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
        <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
      <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
      <span class="nv">text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">aChar</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
      <span class="vi">@target.text = </span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">@goRight</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">aChar</span><span class="p">.</span><span class="nx">length</span>
  
  <span class="nv">ctrl: </span><span class="nf">(aChar) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">aChar</span> <span class="o">is</span> <span class="mi">97</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">aChar</span> <span class="o">is</span> <span class="mi">65</span><span class="p">)</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">90</span>
      <span class="nx">@undo</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">123</span>
      <span class="nx">@insert</span> <span class="s">&quot;{&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">125</span>
      <span class="nx">@insert</span> <span class="s">&quot;}&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">91</span>
      <span class="nx">@insert</span> <span class="s">&quot;[&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">93</span>
      <span class="nx">@insert</span> <span class="s">&quot;]&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">64</span>
      <span class="nx">@insert</span> <span class="s">&quot;@&quot;</span>
  
  <span class="nv">cmd: </span><span class="nf">(aChar) -&gt;</span>
    <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">65</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">90</span>
      <span class="nx">@undo</span><span class="p">()</span>
  
  <span class="nv">deleteRight: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
      <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nv">text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@slot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="vi">@target.text = </span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
  
  <span class="nv">deleteLeft: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span>
      <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
    <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="vi">@target.text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@goLeft</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-268">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-268">&#182;</a>               </div>               <p>CaretMorph destroying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">alignment</span> <span class="o">isnt</span> <span class="nx">@originalAlignment</span>
      <span class="vi">@target.alignment = </span><span class="nx">@originalAlignment</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">super</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-269">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-269">&#182;</a>               </div>               <p>CaretMorph utilities:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">inspectKeyEvent: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-270">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-270">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@inform</span> <span class="s">&quot;Key pressed: &quot;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\n------------------------&quot;</span> <span class="o">+</span> <span class="s">&quot;\ncharCode: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\nkeyCode: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\naltKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">altKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\nctrlKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="o">+</span> <span class="s">&quot;\ncmdKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-271">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-271">&#182;</a>               </div>               <p>ColorPaletteMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ColorPaletteMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">targetSetter: </span><span class="s">&quot;color&quot;</span>
  <span class="nv">choice: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, sizePoint) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">sizePoint</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">ext = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="vi">@choice = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">]</span>
      <span class="nv">h = </span><span class="mi">360</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">y = </span><span class="mi">0</span>
      <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">ext</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
        <span class="nv">l = </span><span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="nx">y</span> <span class="o">/</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="nv">context.fillStyle = </span><span class="s">&quot;hsl(&quot;</span> <span class="o">+</span> <span class="nx">h</span> <span class="o">+</span> <span class="s">&quot;,100%,&quot;</span> <span class="o">+</span> <span class="nx">l</span> <span class="o">+</span> <span class="s">&quot;%)&quot;</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
  
  <span class="nv">mouseMove: </span><span class="nf">(pos) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">@getPixelColor</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">@getPixelColor</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">updateTarget: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span> <span class="k">instanceof</span> <span class="nx">Morph</span> <span class="o">and</span> <span class="nx">@choice</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Function</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="nx">@choice</span>
      <span class="k">else</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@choice</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-272">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-272">&#182;</a>               </div>               <p>ColorPaletteMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-273">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-273">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nx">c</span>
  </pre></div>             </td>           </tr>                               <tr id="section-274">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-274">&#182;</a>               </div>               <p>ColorPaletteMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;set target&quot;</span><span class="p">,</span> <span class="s">&quot;setTarget&quot;</span><span class="p">,</span> <span class="s">&quot;choose another morph\nwhose color property\n will be&quot;</span> <span class="o">+</span> <span class="s">&quot; controlled by this one&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setTarget: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@target = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span>
  
  <span class="nv">setTargetSetter: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">colorSetters</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target property:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@targetSetter = </span><span class="nx">each</span>
    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@targetSetter = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-275">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-275">&#182;</a>               </div>               <p>GrayPaletteMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GrayPaletteMorph</span> <span class="k">extends</span> <span class="nx">ColorPaletteMorph</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, sizePoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">@target</span><span class="p">,</span> <span class="nx">sizePoint</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">ext = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="vi">@choice = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
    <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
    <span class="nv">context.fillStyle = </span><span class="nx">gradient</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-276">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-276">&#182;</a>               </div>               <p>MenuMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MenuMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">title: </span><span class="kc">null</span>
  <span class="nv">environment: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">items: </span><span class="kc">null</span>
  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">world: </span><span class="kc">null</span>
  <span class="nv">isListContents: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(@target, @title = null, @environment = null, @fontSize = null) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-277">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-277">&#182;</a>               </div>               <p>Note that Morph does a updateRendering upon creation (TODO Why?), so we need
to initialise the items before calling super. We can't initialise it
outside the constructor because the array would be shared across instantiated
objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@items = </span><span class="p">[]</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@border = </span><span class="kc">null</span> <span class="c1"># the Box Morph constructor puts this to 2</span></pre></div>             </td>           </tr>                               <tr id="section-278">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-278">&#182;</a>               </div>               <p>important not to traverse all the children for stepping through, because
there could be a lot of entries for example in the inspector the number
of properties of an object - there could be a 100 of those and we don't
want to traverse them all. Setting step to null (as opposed to nop) means
that</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">addItem: </span><span class="nf">(labelString, action, hint, color) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-279">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-279">&#182;</a>               </div>               <p>labelString is normally a single-line string. But it can also be one
of the following:
    * a multi-line string (containing line breaks)
    * an icon (either a Morph or a Canvas)
    * a tuple of format: [icon, string]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">localize</span><span class="p">(</span><span class="nx">labelString</span> <span class="o">or</span> <span class="s">&quot;close&quot;</span><span class="p">),</span> <span class="nx">action</span> <span class="o">or</span> <span class="nx">nop</span><span class="p">,</span> <span class="nx">hint</span><span class="p">,</span> <span class="nx">color</span><span class="p">]</span>
  
  <span class="nv">addLine: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="o">or</span> <span class="mi">1</span><span class="p">]</span>
  
  <span class="nv">createLabel: </span><span class="nf">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nv">text = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">localize</span><span class="p">(</span><span class="nx">@title</span><span class="p">),</span>
      <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="nv">text.alignment = </span><span class="s">&quot;center&quot;</span>
    <span class="nv">text.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nv">text.backgroundColor = </span><span class="nx">@borderColor</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@label.color = </span><span class="nx">@borderColor</span>
    <span class="vi">@label.borderColor = </span><span class="nx">@borderColor</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">add</span> <span class="nx">text</span>
    <span class="vi">@label.text = </span><span class="nx">text</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">isLine = </span><span class="kc">false</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-280">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-280">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="k">unless</span> <span class="nx">@isListContents</span>
      <span class="vi">@edge = </span><span class="mi">5</span>
      <span class="vi">@border = </span><span class="mi">2</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">y = </span><span class="mi">2</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="k">unless</span> <span class="nx">@isListContents</span>
      <span class="k">if</span> <span class="nx">@title</span>
        <span class="nx">@createLabel</span><span class="p">()</span>
        <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="nx">@add</span> <span class="nx">@label</span>
        <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(tuple) =&gt;</span>
      <span class="nv">isLine = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span>
          <span class="nv">item = </span><span class="nx">tuple</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">isLine = </span><span class="kc">true</span>
        <span class="nv">item = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
        <span class="nv">item.color = </span><span class="nx">@borderColor</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-281">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-281">&#182;</a>               </div>               <p>bubble help hint</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">item = </span><span class="k">new</span> <span class="nx">MenuItemMorph</span><span class="p">(</span><span class="nx">@target</span><span class="p">,</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
          <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="nx">@environment</span><span class="p">,</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># color</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nx">@add</span> <span class="nx">item</span>
      <span class="nv">y = </span><span class="nx">y</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span></pre></div>             </td>           </tr>                               <tr id="section-282">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-282">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">@boundsIncludingChildren</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@adjustWidths</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  
  <span class="nv">maxWidth: </span><span class="nf">-&gt;</span>
    <span class="nv">w = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span>
      <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">scrollFrame</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
        <span class="nv">w = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">scrollFrame</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>    
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span><span class="p">)</span>
        <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span><span class="p">)</span>
          <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  </pre></div>             </td>           </tr>                               <tr id="section-283">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-283">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">@label</span>
    <span class="nx">w</span>
  
  <span class="nv">adjustWidths: </span><span class="nf">-&gt;</span>
    <span class="nv">w = </span><span class="nx">@maxWidth</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) =&gt;</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">w</span>
      <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span>
        <span class="nv">isSelected = </span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">image</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pressImage</span><span class="p">)</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">createBackgrounds</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">isSelected</span> <span class="k">then</span> <span class="nv">item.image = </span><span class="nx">item</span><span class="p">.</span><span class="nx">pressImage</span>          
      <span class="k">else</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">item</span> <span class="o">is</span> <span class="nx">@label</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">item</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  
  <span class="nv">unselectAllItems: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="nv">item.image = </span><span class="nx">item</span><span class="p">.</span><span class="nx">normalImage</span>  <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span></pre></div>             </td>           </tr>                               <tr id="section-284">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-284">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">popup: </span><span class="nf">(world, pos) -&gt;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span>
    <span class="nx">@keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
    <span class="nv">world.activeMenu = </span><span class="nx">@</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
  
  <span class="nv">popUpAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
  
  <span class="nv">popUpCenteredAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  <span class="nv">popUpCenteredInWorld: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-285">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-285">&#182;</a>               </div>               <p>BouncerMorph ////////////////////////////////////////////////////////
fishy constructor
I am a Demo of a stepping custom Morph
Bounces vertically or horizontally within the parent</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BouncerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">isStopped: </span><span class="kc">false</span>
  <span class="nv">type: </span><span class="kc">null</span>
  <span class="nv">direction: </span><span class="kc">null</span>
  <span class="nv">speed: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@type = &quot;vertical&quot;, @speed = 1) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@fps = </span><span class="mi">50</span></pre></div>             </td>           </tr>                               <tr id="section-286">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-286">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="vi">@direction = </span><span class="s">&quot;down&quot;</span>
    <span class="k">else</span>
      <span class="vi">@direction = </span><span class="s">&quot;right&quot;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-287">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-287">&#182;</a>               </div>               <p>BouncerMorph moving:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveUp: </span><span class="nf">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">@speed</span><span class="p">)</span>
  
  <span class="nv">moveDown: </span><span class="nf">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@speed</span><span class="p">)</span>
  
  <span class="nv">moveRight: </span><span class="nf">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">moveLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">@speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-288">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-288">&#182;</a>               </div>               <p>BouncerMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="nf">-&gt;</span>
    <span class="k">unless</span> <span class="nx">@isStopped</span>
      <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
        <span class="k">if</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;down&quot;</span>
          <span class="nx">@moveDown</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@moveUp</span><span class="p">()</span>
        <span class="vi">@direction = </span><span class="s">&quot;down&quot;</span>  <span class="k">if</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">top</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;up&quot;</span>
        <span class="vi">@direction = </span><span class="s">&quot;up&quot;</span>  <span class="k">if</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;down&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;horizontal&quot;</span>
        <span class="k">if</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
          <span class="nx">@moveRight</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@moveLeft</span><span class="p">()</span>
        <span class="vi">@direction = </span><span class="s">&quot;right&quot;</span>  <span class="k">if</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">left</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span>
        <span class="vi">@direction = </span><span class="s">&quot;left&quot;</span>  <span class="k">if</span> <span class="nx">@boundsIncludingChildren</span><span class="p">().</span><span class="nx">right</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-289">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-289">&#182;</a>               </div>               <p>HandleMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-290">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-290">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-291">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-291">&#182;</a>               </div>               <p>I am a resize / move handle that can be attached to any Morph</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">HandleMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">minExtent: </span><span class="kc">null</span>
  <span class="nv">inset: </span><span class="kc">null</span>
  <span class="nv">type: </span><span class="kc">null</span> <span class="c1"># &quot;resize&quot; or &quot;move&quot;</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, minX = 0, minY = 0, insetX, insetY, @type = &quot;resize&quot;) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-292">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-292">&#182;</a>               </div>               <p>if insetY is missing, it will be the same as insetX</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@minExtent = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">minX</span><span class="p">,</span> <span class="nx">minY</span><span class="p">)</span>
    <span class="vi">@inset = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">insetX</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">insetY</span> <span class="o">or</span> <span class="nx">insetX</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nv">size = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-293">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-293">&#182;</a>               </div>               <p>HandleMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="vi">@normalImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="vi">@highlightImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nx">@handleMorphRenderingHelper</span> <span class="nx">@normalImage</span><span class="p">,</span> <span class="nx">@color</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nx">@handleMorphRenderingHelper</span> <span class="nx">@highlightImage</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="k">if</span> <span class="nx">@target</span>
      <span class="nx">@setPosition</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">))</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  <span class="nv">handleMorphRenderingHelper: </span><span class="nf">(aCanvas, color, shadowColor) -&gt;</span>
    <span class="nv">context = </span><span class="nx">aCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.lineWidth = </span><span class="mi">1</span>
    <span class="nv">context.lineCap = </span><span class="s">&quot;round&quot;</span>
    <span class="nv">context.strokeStyle = </span><span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;move&quot;</span>
      <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@height</span><span class="p">()]</span> <span class="k">by</span> <span class="mi">6</span>
        <span class="nv">p11.y = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nv">p22.y = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

    <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@width</span><span class="p">()]</span> <span class="k">by</span> <span class="mi">6</span>
      <span class="nv">p11.x = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nv">p22.x = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

    <span class="nv">context.strokeStyle = </span><span class="nx">shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;move&quot;</span>
      <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">..</span><span class="nx">@height</span><span class="p">()]</span> <span class="k">by</span> <span class="mi">6</span>
        <span class="nv">p11.y = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nv">p22.y = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

    <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">..</span><span class="nx">@width</span><span class="p">()]</span> <span class="k">by</span> <span class="mi">6</span>
      <span class="nv">p11.x = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nv">p22.x = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-294">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-294">&#182;</a>               </div>               <p>HandleMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step = </span><span class="kc">null</span>
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nv">offset = </span><span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@target</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span>
        <span class="nv">newPos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;resize&quot;</span>
          <span class="nv">newExt = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">)).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
          <span class="nv">newExt = </span><span class="nx">newExt</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@minExtent</span><span class="p">)</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">newExt</span>
          <span class="nx">@setPosition</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">))</span>
        <span class="k">else</span> <span class="c1"># type === &#39;move&#39;</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">newPos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">extent</span><span class="p">()).</span><span class="nx">add</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="kc">null</span>
    
    <span class="k">unless</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">step</span>
      <span class="vi">@target.step = </span><span class="nx">noOperation</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-295">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-295">&#182;</a>               </div>               <p>HandleMorph dragging and dropping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rootForGrab: </span><span class="nf">-&gt;</span>
    <span class="nx">@</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-296">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-296">&#182;</a>               </div>               <p>HandleMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseLeave: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-297">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-297">&#182;</a>               </div>               <p>HandleMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-298">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-298">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-299">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-299">&#182;</a>               </div>               <p>HandleMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">attach: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="nf">-&gt;</span>
        <span class="vi">@isDraggable = </span><span class="kc">false</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@updateRendering</span><span class="p">()</span>
        <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-300">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-300">&#182;</a>               </div>               <p>ShadowMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ShadowMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>
  <span class="nv">constructor: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-301">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-301">&#182;</a>               </div>               <p>| FrameMorph //////////////////////////////////////////////////////////
| 
| I clip my submorphs at my bounds. Which potentially saves a lot of redrawing
| 
| and event handling.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">FrameMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="vi">@scrollFrame: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-302">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-302">&#182;</a>               </div>               <p>if this frame belongs to a scrollFrame, then
the @scrollFrame points to it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@scrollFrame = null) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>
    <span class="vi">@acceptsDrops = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@isDraggable = </span><span class="kc">false</span>
      <span class="vi">@noticesTransparentClick = </span><span class="kc">false</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>

  <span class="nv">setColor: </span><span class="nf">(aColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-303">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-303">&#182;</a>               </div>               <p>keep in synch the value of the container scrollFrame
if there is one. Note that the container srollFrame
is actually not painted.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@scrollFrame.color = </span><span class="nx">aColor</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">aColor</span><span class="p">)</span>

  <span class="nv">setAlphaScaled: </span><span class="nf">(alpha) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-304">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-304">&#182;</a>               </div>               <p>keep in synch the value of the container scrollFrame
if there is one. Note that the container srollFrame
is actually not painted.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@scrollFrame.alpha = </span><span class="nx">@calculateAlphaScaled</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
  
  <span class="nv">boundsIncludingChildren: </span><span class="nf">-&gt;</span>
    <span class="nv">shadow = </span><span class="nx">@getShadow</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">shadow</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@bounds</span>
  </pre></div>             </td>           </tr>                               <tr id="section-305">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-305">&#182;</a>               </div>               <p>This was in the original Morphic.js, but
it would cause the frame (or scrollframe) not to paint its
contents when "pic..." command is invoked.
fullImage: ->
 # use only for shadows
 @image</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">recursivelyBlit: </span><span class="nf">(aCanvas, clippingRectangle = @bounds) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@isVisible</span>
    </pre></div>             </td>           </tr>                               <tr id="section-306">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-306">&#182;</a>               </div>               <p>the part to be redrawn could be outside the frame entirely,
in which case we can stop going down the morphs inside the frame
since the whole point of the frame is to clip everything to a specific
rectangle.
So, check which part of the Frame should be redrawn:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dirtyPartOfFrame = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">clippingRectangle</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-307">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-307">&#182;</a>               </div>               <p>if there is no dirty part in the frame then do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="nx">dirtyPartOfFrame</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-308">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-308">&#182;</a>               </div>               <p>this draws the background of the frame itself, which could
contain an image or a pentrail</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@blit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">dirtyPartOfFrame</span>
    
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) =&gt;</span>
      <span class="k">if</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">clippingRectangle</span>
      <span class="k">else</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">dirtyPartOfFrame</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-309">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-309">&#182;</a>               </div>               <p>FrameMorph scrolling optimization:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">silentMoveBy</span> <span class="nx">delta</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-310">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-310">&#182;</a>               </div>               <p>FrameMorph scrolling support:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submorphBounds: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">result = </span><span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bounds</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">())</span>
    <span class="nx">result</span>
  
  <span class="nv">keepInScrollFrame: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@right</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">())</span>  
    <span class="k">if</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="mi">0</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@bottom</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">adjustBounds: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nv">subBounds = </span><span class="nx">@submorphBounds</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">subBounds</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span><span class="p">)</span>
      <span class="nv">newBounds = </span><span class="nx">subBounds</span><span class="p">.</span><span class="nx">expandBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">padding</span><span class="p">).</span><span class="nx">growBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">growth</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newBounds = </span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">unless</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">newBounds</span><span class="p">)</span>
      <span class="vi">@bounds = </span><span class="nx">newBounds</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@keepInScrollFrame</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(morph) =&gt;</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="k">instanceof</span> <span class="nx">TextMorph</span>
          <span class="nx">morph</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">@width</span><span class="p">()</span>
          <span class="nx">@setHeight</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">adjustScrollBars</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-311">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-311">&#182;</a>               </div>               <p>FrameMorph dragging &amp; dropping of contents:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reactToDropOf: </span><span class="nf">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  <span class="nv">reactToGrabOf: </span><span class="nf">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-312">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-312">&#182;</a>               </div>               <p>FrameMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-313">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-313">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.frame = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">frame</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-314">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-314">&#182;</a>               </div>               <p>FrameMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">keepAllSubmorphsWithin: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) =&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-315">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-315">&#182;</a>               </div>               <p>StringFieldMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">StringFieldMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span>

  <span class="nv">defaultContents: </span><span class="kc">null</span>
  <span class="nv">minWidth: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span>
  <span class="nv">isBold: </span><span class="kc">null</span>
  <span class="nv">isItalic: </span><span class="kc">null</span>
  <span class="nv">isNumeric: </span><span class="kc">null</span>
  <span class="nv">text: </span><span class="kc">null</span>
  <span class="nv">isEditable: </span><span class="kc">true</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">      @defaultContents = &quot;&quot;,</span>
<span class="nf">      @minWidth = 100,</span>
<span class="nf">      @fontSize = 12,</span>
<span class="nf">      @fontStyle = &quot;sans-serif&quot;,</span>
<span class="nf">      @isBold = false,</span>
<span class="nf">      @isItalic = false,</span>
<span class="nf">      @isNumeric = false</span>
<span class="nf">      ) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="nv">txt = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@text</span> <span class="k">then</span> <span class="nx">@string</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@defaultContents</span><span class="p">)</span>
    <span class="vi">@text = </span><span class="kc">null</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-316">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-316">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="vi">@text = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span><span class="nx">txt</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">,</span> <span class="nx">@fontStyle</span><span class="p">,</span> <span class="nx">@isBold</span><span class="p">,</span> <span class="nx">@isItalic</span><span class="p">,</span> <span class="nx">@isNumeric</span><span class="p">)</span>
    <span class="vi">@text.isNumeric = </span><span class="nx">@isNumeric</span> <span class="c1"># for whichever reason...</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="vi">@text.isEditable = </span><span class="nx">@isEditable</span>
    <span class="vi">@text.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">@minWidth</span><span class="p">),</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@text</span>
  
  <span class="nv">string: </span><span class="nf">-&gt;</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">text</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">(pos)-&gt;</span>
    <span class="k">if</span> <span class="nx">@isEditable</span>
      <span class="nx">@text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@escalateEvent</span> <span class="s">&#39;mouseClickLeft&#39;</span><span class="p">,</span> <span class="nx">pos</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-317">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-317">&#182;</a>               </div>               <p>StringFieldMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-318">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-318">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.text = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@text</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">text</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@text</span><span class="p">]</span>
    <span class="nx">c</span>
<span class="k">class</span> <span class="nx">SystemTestsRecorderAndPlayer</span>
  <span class="nv">eventQueue: </span><span class="p">[]</span>
  <span class="nv">recordingASystemTest: </span><span class="kc">false</span>
  <span class="nv">replayingASystemTest: </span><span class="kc">false</span>
  <span class="nv">lastRecordedEventTime: </span><span class="kc">null</span>
  <span class="nv">handMorph: </span><span class="kc">null</span>
  <span class="nv">systemInfo: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@worldMorph, @handMorph) -&gt;</span>

  <span class="nv">initialiseSystemInfo: </span><span class="nf">-&gt;</span>
    <span class="vi">@systemInfo = </span><span class="p">{}</span>
    <span class="vi">@systemInfo.zombieKernelTestHarnessVersionMajor = </span><span class="mi">0</span>
    <span class="vi">@systemInfo.zombieKernelTestHarnessVersionMinor = </span><span class="mi">1</span>
    <span class="vi">@systemInfo.zombieKernelTestHarnessVersionRelease = </span><span class="mi">0</span>
    <span class="vi">@systemInfo.userAgent = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span>
    <span class="vi">@systemInfo.screenWidth = </span><span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
    <span class="vi">@systemInfo.screenHeight = </span><span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
    <span class="vi">@systemInfo.screenColorDepth = </span><span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">colorDepth</span>
    <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span><span class="o">?</span>
      <span class="vi">@systemInfo.screenPixelRatio = </span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span>
    <span class="k">else</span>
      <span class="vi">@systemInfo.screenPixelRatio = </span><span class="nb">window</span><span class="p">.</span><span class="nx">devicePixelRatio</span>
    <span class="vi">@systemInfo.appCodeName = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appCodeName</span>
    <span class="vi">@systemInfo.appName = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span>
    <span class="vi">@systemInfo.appVersion = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appVersion</span>
    <span class="vi">@systemInfo.cookieEnabled = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">cookieEnabled</span>
    <span class="vi">@systemInfo.platform = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span>
    <span class="vi">@systemInfo.systemLanguage = </span><span class="nx">navigator</span><span class="p">.</span><span class="nx">systemLanguage</span>

  <span class="nv">startRecording: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-319">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-319">&#182;</a>               </div>               <p>clean up the world so we start from clean slate</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@worldMorph</span><span class="p">.</span><span class="nx">destroyAll</span><span class="p">()</span>
    <span class="vi">@eventQueue = </span><span class="p">[]</span>
    <span class="vi">@lastRecordedEventTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="vi">@recordingASystemTest = </span><span class="kc">true</span>
    <span class="vi">@replayingASystemTest = </span><span class="kc">false</span>

    <span class="nx">@initialiseSystemInfo</span><span class="p">()</span>
    <span class="nv">systemTestEvent = </span><span class="p">{}</span>
    <span class="nv">systemTestEvent.type = </span><span class="s">&quot;systemInfo&quot;</span>
    <span class="nv">systemTestEvent.time = </span><span class="mi">0</span>
    <span class="nv">systemTestEvent.systemInfo = </span><span class="nx">@systemInfo</span>
    <span class="nx">@eventQueue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">systemTestEvent</span>

  <span class="nv">stopRecording: </span><span class="nf">-&gt;</span>
    <span class="vi">@recordingASystemTest = </span><span class="kc">false</span>

  <span class="nv">startPlaying: </span><span class="nf">-&gt;</span>
    <span class="vi">@recordingASystemTest = </span><span class="kc">false</span>
    <span class="vi">@replayingASystemTest = </span><span class="kc">true</span>
    <span class="nx">@replayEvents</span><span class="p">()</span>

  <span class="nv">stopPlaying: </span><span class="nf">-&gt;</span>
    <span class="vi">@replayingASystemTest = </span><span class="kc">false</span>

  <span class="nv">addMouseMoveEvent: </span><span class="nf">(pageX, pageY) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@recordingASystemTest</span>
    <span class="nv">currentTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="nv">systemTestEvent = </span><span class="p">{}</span>
    <span class="nv">systemTestEvent.type = </span><span class="s">&quot;mouseMove&quot;</span>
    <span class="nv">systemTestEvent.mouseX = </span><span class="nx">pageX</span>
    <span class="nv">systemTestEvent.mouseY = </span><span class="nx">pageY</span>
    <span class="nv">systemTestEvent.time = </span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">@lastRecordedEventTime</span></pre></div>             </td>           </tr>                               <tr id="section-320">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-320">&#182;</a>               </div>               <p>systemTestEvent.button
systemTestEvent.ctrlKey
systemTestEvent.screenShotImageData</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@eventQueue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">systemTestEvent</span>
    <span class="vi">@lastRecordedEventTime = </span><span class="nx">currentTime</span>

  <span class="nv">addMouseDownEvent: </span><span class="nf">(button, ctrlKey) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@recordingASystemTest</span>
    <span class="nv">currentTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="nv">systemTestEvent = </span><span class="p">{}</span>
    <span class="nv">systemTestEvent.type = </span><span class="s">&quot;mouseDown&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-321">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-321">&#182;</a>               </div>               <p>systemTestEvent.mouseX = pageX
systemTestEvent.mouseY = pageY</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">systemTestEvent.time = </span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">@lastRecordedEventTime</span>
    <span class="nv">systemTestEvent.button = </span><span class="nx">button</span>
    <span class="nv">systemTestEvent.ctrlKey = </span><span class="nx">ctrlKey</span></pre></div>             </td>           </tr>                               <tr id="section-322">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-322">&#182;</a>               </div>               <p>systemTestEvent.screenShotImageData</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@eventQueue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">systemTestEvent</span>
    <span class="vi">@lastRecordedEventTime = </span><span class="nx">currentTime</span>

  <span class="nv">addMouseUpEvent: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@recordingASystemTest</span>
    <span class="nv">currentTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="nv">systemTestEvent = </span><span class="p">{}</span>
    <span class="nv">systemTestEvent.type = </span><span class="s">&quot;mouseUp&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-323">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-323">&#182;</a>               </div>               <p>systemTestEvent.mouseX = pageX
systemTestEvent.mouseY = pageY</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">systemTestEvent.time = </span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">@lastRecordedEventTime</span></pre></div>             </td>           </tr>                               <tr id="section-324">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-324">&#182;</a>               </div>               <p>systemTestEvent.button
systemTestEvent.ctrlKey
systemTestEvent.screenShotImageData</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@eventQueue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">systemTestEvent</span>
    <span class="vi">@lastRecordedEventTime = </span><span class="nx">currentTime</span>

  <span class="nv">takeScreenshot: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;taking screenshot&quot;</span>
    <span class="k">if</span> <span class="nx">@systemInfo</span> <span class="o">is</span> <span class="kc">null</span>
      <span class="nx">@initialiseSystemInfo</span><span class="p">()</span>
    <span class="nv">currentTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="nv">systemTestEvent = </span><span class="p">{}</span>
    <span class="nv">systemTestEvent.type = </span><span class="s">&quot;takeScreenshot&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-325">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-325">&#182;</a>               </div>               <p>systemTestEvent.mouseX = pageX
systemTestEvent.mouseY = pageY</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">systemTestEvent.time = </span><span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">@lastRecordedEventTime</span></pre></div>             </td>           </tr>                               <tr id="section-326">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-326">&#182;</a>               </div>               <p>systemTestEvent.button
systemTestEvent.ctrlKey</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">systemTestEvent.screenShotImageData = </span><span class="p">[]</span>
    <span class="nx">systemTestEvent</span><span class="p">.</span><span class="nx">screenShotImageData</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">@systemInfo</span><span class="p">,</span> <span class="nx">@worldMorph</span><span class="p">.</span><span class="nx">fullImageData</span><span class="p">()]</span>
    <span class="nx">@eventQueue</span><span class="p">.</span><span class="nx">push</span> <span class="nx">systemTestEvent</span>
    <span class="vi">@lastRecordedEventTime = </span><span class="nx">currentTime</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@recordingASystemTest</span>
      <span class="k">return</span> <span class="nx">systemTestEvent</span>

  <span class="nv">compareScreenshots: </span><span class="nf">(expected) -&gt;</span>
   <span class="nv">i = </span><span class="mi">0</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;expected length &quot;</span> <span class="o">+</span> <span class="nx">expected</span><span class="p">.</span><span class="nx">length</span>
   <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">expected</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;trying to match screenshot: &quot;</span> <span class="o">+</span> <span class="nx">i</span>
     <span class="nx">i</span><span class="o">++</span>
     <span class="k">if</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">@worldMorph</span><span class="p">.</span><span class="nx">fullImageData</span><span class="p">()</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;PASS - screenshot (&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s">&quot;) matched&quot;</span>
      <span class="k">return</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;FAIL - no screenshots like this one&quot;</span>

  <span class="nv">replayEvents: </span><span class="p">()</span> <span class="nf">-&gt;</span>
   <span class="nv">lastPlayedEventTime = </span><span class="mi">0</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;events: &quot;</span> <span class="o">+</span> <span class="nx">@eventQueue</span>
   <span class="k">for</span> <span class="nx">queuedEvent</span> <span class="k">in</span> <span class="nx">@eventQueue</span>
      <span class="nx">lastPlayedEventTime</span> <span class="o">+=</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">time</span>
      <span class="nx">@scheduleEvent</span><span class="p">(</span><span class="nx">queuedEvent</span><span class="p">,</span> <span class="nx">lastPlayedEventTime</span><span class="p">)</span>

  <span class="nv">scheduleEvent: </span><span class="nf">(queuedEvent, lastPlayedEventTime) -&gt;</span>
    <span class="k">if</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;mouseMove&#39;</span>
      <span class="nv">callback = </span><span class="o">=&gt;</span> <span class="nx">@handMorph</span><span class="p">.</span><span class="nx">processMouseMove</span><span class="p">(</span><span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">mouseX</span><span class="p">,</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">mouseY</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;mouseDown&#39;</span>
      <span class="nv">callback = </span><span class="o">=&gt;</span> <span class="nx">@handMorph</span><span class="p">.</span><span class="nx">processMouseDown</span><span class="p">(</span><span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">button</span><span class="p">,</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;mouseUp&#39;</span>
      <span class="nv">callback = </span><span class="o">=&gt;</span> <span class="nx">@handMorph</span><span class="p">.</span><span class="nx">processMouseUp</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;takeScreenshot&#39;</span>
      <span class="nv">callback = </span><span class="o">=&gt;</span> <span class="nx">@compareScreenshots</span><span class="p">(</span><span class="nx">queuedEvent</span><span class="p">.</span><span class="nx">screenShotImageData</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">return</span>

    <span class="nx">setTimeout</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">lastPlayedEventTime</span></pre></div>             </td>           </tr>                               <tr id="section-327">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-327">&#182;</a>               </div>               <p>console.log "scheduling " + queuedEvent.type + "event for " + lastPlayedEventTime
Point2 //////////////////////////////////////////////////////////////
like Point, but it tries not to create new objects like there is
no tomorrow. Any operation that returned a new point now directly
modifies the current point.
Note that the arguments passed to any of these functions are never
modified.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Point2</span>

  <span class="nv">x: </span><span class="kc">null</span>
  <span class="nv">y: </span><span class="kc">null</span>
   
  <span class="nv">constructor: </span><span class="nf">(@x = 0, @y = 0) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-328">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-328">&#182;</a>               </div>               <p>Point2 string representation: e.g. '12@68'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="nf">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@x</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;@&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@y</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  </pre></div>             </td>           </tr>                               <tr id="section-329">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-329">&#182;</a>               </div>               <p>Point2 copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="nf">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point2</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-330">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-330">&#182;</a>               </div>               <p>Point2 comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eq: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-331">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-331">&#182;</a>               </div>               <p>==</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">is</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">lt: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-332">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-332">&#182;</a>               </div>               <p>&lt;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&lt;</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&lt;</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">gt: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-333">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-333">&#182;</a>               </div>               <p>></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&gt;</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&gt;</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">ge: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-334">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-334">&#182;</a>               </div>               <blockquote>
  <p>=</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">le: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-335">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-335">&#182;</a>               </div>               <p>&lt;=</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&lt;=</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&lt;=</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">max: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-336">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-336">&#182;</a>               </div>               <p>new Point2(Math.max(@x, aPoint2.x), Math.max(@y, aPoint2.y))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@y</span><span class="p">,</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">min: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-337">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-337">&#182;</a>               </div>               <p>new Point2(Math.min(@x, aPoint2.x), Math.min(@y, aPoint2.y))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@y</span><span class="p">,</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-338">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-338">&#182;</a>               </div>               <p>Point2 conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">round: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-339">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-339">&#182;</a>               </div>               <p>new Point2(Math.round(@x), Math.round(@y))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span>
  
  <span class="nv">abs: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-340">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-340">&#182;</a>               </div>               <p>new Point2(Math.abs(@x), Math.abs(@y))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span>
  
  <span class="nv">neg: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-341">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-341">&#182;</a>               </div>               <p>new Point2(-@x, -@y)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="o">-</span><span class="nx">@x</span>
    <span class="vi">@y = </span><span class="o">-</span><span class="nx">@y</span>
  
  <span class="nv">mirror: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-342">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-342">&#182;</a>               </div>               <p>new Point2(@y, @x)
note that coffeescript would allow [@x,@y] = [@y,@x]
but we want to be faster here</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">tmpValueForSwappingXAndY = </span><span class="nx">@x</span>
    <span class="vi">@x = </span><span class="nx">@y</span>
    <span class="vi">@y = </span><span class="nx">tmpValueForSwappingXAndY</span> 
  
  <span class="nv">floor: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-343">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-343">&#182;</a>               </div>               <p>new Point2(Math.max(Math.floor(@x), 0), Math.max(Math.floor(@y), 0))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">ceil: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-344">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-344">&#182;</a>               </div>               <p>new Point2(Math.ceil(@x), Math.ceil(@y))</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-345">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-345">&#182;</a>               </div>               <p>Point2 arithmetic:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point2</span>
      <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">+</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span>
    <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">other</span>
    <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">+</span> <span class="nx">other</span>
  
  <span class="nv">subtract: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point2</span>
      <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span>
    <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">other</span>
    <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">other</span>
  
  <span class="nv">multiplyBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point2</span>
      <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">*</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">*</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span>
    <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">*</span> <span class="nx">other</span>
    <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">*</span> <span class="nx">other</span>
  
  <span class="nv">divideBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point2</span>
      <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span>
    <span class="vi">@x = </span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span>
    <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span>
  
  <span class="nv">floorDivideBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point2</span>
      <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
      <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="vi">@x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">)</span>
    <span class="vi">@y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-346">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-346">&#182;</a>               </div>               <p>Point2 polar coordinates:
distance from the origin</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">r: </span><span class="nf">-&gt;</span>
    <span class="nv">t = </span><span class="nx">@copy</span><span class="p">()</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">multiplyBy</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span> <span class="nx">t</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">degrees: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-347">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-347">&#182;</a>               </div>               <p>answer the angle I make with origin in degrees.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@x</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">90</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">270</span>
    <span class="nv">tan = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">@x</span>
    <span class="nv">theta = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">tan</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">))</span>
    <span class="mi">180</span> <span class="o">+</span> <span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
  
  <span class="nv">theta: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-348">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-348">&#182;</a>               </div>               <p>answer the angle I make with origin in radians.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@x</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span>
    <span class="nv">tan = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">@x</span>
    <span class="nv">theta = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">tan</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">theta</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span> <span class="o">+</span> <span class="nx">theta</span>
    <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="nx">theta</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-349">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-349">&#182;</a>               </div>               <p>Point2 functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-350">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-350">&#182;</a>               </div>               <p>this function is a bit fishy.
a cross product in 2d is probably not a vector
see https://github.com/jmoenig/morphic.js/issues/6
this function is not used</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">crossProduct: </span><span class="nf">(aPoint2) -&gt;</span>
    <span class="nx">@multiplyBy</span> <span class="nx">aPoint2</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">mirror</span><span class="p">()</span>
  
  <span class="nv">distanceTo: </span><span class="nf">(aPoint2) -&gt;</span>
    <span class="p">(</span><span class="nx">aPoint2</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@</span><span class="p">)).</span><span class="nx">r</span><span class="p">()</span>
  
  <span class="nv">rotate: </span><span class="nf">(direction, center) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-351">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-351">&#182;</a>               </div>               <p>direction must be 'right', 'left' or 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offset = </span><span class="nx">@copy</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
      <span class="vi">@x = </span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">center</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span>
    <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span>
      <span class="vi">@x = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">center</span><span class="p">.</span><span class="nx">x</span>
      <span class="vi">@y = </span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span>
      <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-352">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-352">&#182;</a>               </div>               <p>direction === 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">tmpPointForRotate = </span><span class="nx">center</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">subtract</span> <span class="nx">offset</span>
    <span class="vi">@x = </span><span class="nx">tmpPointForRotate</span><span class="p">.</span><span class="nx">x</span>
    <span class="vi">@y = </span><span class="nx">tmpPointForRotate</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">flip: </span><span class="nf">(direction, center) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-353">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-353">&#182;</a>               </div>               <p>direction must be 'vertical' or 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="vi">@y = </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">@y</span>
      <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-354">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-354">&#182;</a>               </div>               <p>direction === 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@x = </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">@x</span>
  
  <span class="nv">distanceAngle: </span><span class="nf">(dist, angle) -&gt;</span>
    <span class="nv">deg = </span><span class="nx">angle</span>
    <span class="k">if</span> <span class="nx">deg</span> <span class="o">&gt;</span> <span class="mi">270</span>
      <span class="nv">deg = </span><span class="nx">deg</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="k">else</span> <span class="nv">deg = </span><span class="nx">deg</span> <span class="o">+</span> <span class="mi">360</span>  <span class="k">if</span> <span class="nx">deg</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">270</span>
    <span class="k">if</span> <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="nx">deg</span> <span class="o">and</span> <span class="nx">deg</span> <span class="o">&lt;=</span> <span class="mi">90</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">radians</span><span class="p">(</span><span class="nx">deg</span><span class="p">))</span> <span class="o">*</span> <span class="nx">dist</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">dist</span> <span class="o">*</span> <span class="nx">dist</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">))</span>
      <span class="vi">@x = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@x</span>
      <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">y</span>
      <span class="k">return</span>
    <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">radians</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="nx">deg</span><span class="p">))</span> <span class="o">*</span> <span class="nx">dist</span>
    <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">dist</span> <span class="o">*</span> <span class="nx">dist</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">))</span>
    <span class="vi">@x = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@x</span>
    <span class="vi">@y = </span><span class="nx">@y</span> <span class="o">+</span> <span class="nx">y</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-355">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-355">&#182;</a>               </div>               <p>Point2 transforming:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scaleBy: </span><span class="nf">(scalePoint2) -&gt;</span>
    <span class="nx">@multiplyBy</span> <span class="nx">scalePoint2</span>
  
  <span class="nv">translateBy: </span><span class="nf">(deltaPoint2) -&gt;</span>
    <span class="nx">@add</span> <span class="nx">deltaPoint2</span>
  
  <span class="nv">rotateBy: </span><span class="nf">(angle, centerPoint2) -&gt;</span>
    <span class="nv">center = </span><span class="nx">centerPoint2</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">p = </span><span class="nx">@copy</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
    <span class="nv">r = </span><span class="nx">p</span><span class="p">.</span><span class="nx">r</span><span class="p">()</span>
    <span class="nv">theta = </span><span class="nx">angle</span> <span class="o">-</span> <span class="nx">p</span><span class="p">.</span><span class="nx">theta</span><span class="p">()</span>
    <span class="vi">@x = </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">))</span>
    <span class="vi">@y = </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-356">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-356">&#182;</a>               </div>               <p>Point2 conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">asArray: </span><span class="nf">-&gt;</span>
    <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-357">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-357">&#182;</a>               </div>               <p>creating Rectangle instances from Point2:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">corner: </span><span class="nf">(cornerPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-358">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-358">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">cornerPoint2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">cornerPoint2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">rectangle: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-359">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-359">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">org = </span><span class="nx">@copy</span><span class="p">().</span><span class="nx">min</span><span class="p">(</span><span class="nx">aPoint2</span><span class="p">)</span>
    <span class="nv">crn = </span><span class="nx">@copy</span><span class="p">().</span><span class="nx">max</span><span class="p">(</span><span class="nx">aPoint2</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">org</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">extent: </span><span class="nf">(aPoint2) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-360">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-360">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">crn = </span><span class="nx">@copy</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">aPoint2</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-361">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-361">&#182;</a>               </div>               <p>ScrollFrameMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-362">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-362">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ScrollFrameMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span>

  <span class="nv">autoScrollTrigger: </span><span class="kc">null</span>
  <span class="nv">hasVelocity: </span><span class="kc">true</span> <span class="c1"># dto.</span>
  <span class="nv">padding: </span><span class="mi">0</span> <span class="c1"># around the scrollable area</span>
  <span class="nv">growth: </span><span class="mi">0</span> <span class="c1"># pixels or Point to grow right/left when near edge</span>
  <span class="nv">isTextLineWrapping: </span><span class="kc">false</span>
  <span class="nv">isScrollingByDragging: </span><span class="kc">true</span>
  <span class="nv">scrollBarSize: </span><span class="kc">null</span>
  <span class="nv">contents: </span><span class="kc">null</span>
  <span class="nv">vBar: </span><span class="kc">null</span>
  <span class="nv">hBar: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(contents, scrollBarSize, sliderColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-363">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-363">&#182;</a>               </div>               <p>super() paints the scrollframe, which we don't want,
so we set 0 opacity here.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@alpha = </span><span class="mi">0</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@scrollBarSize = </span><span class="nx">scrollBarSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
    <span class="vi">@contents = </span><span class="nx">contents</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">FrameMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@contents</span></pre></div>             </td>           </tr>                               <tr id="section-364">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-364">&#182;</a>               </div>               <p>the scrollFrame is never going to paint itself,
but its values are going to mimick the values of the
contained frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">color</span>
    <span class="vi">@alpha = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">alpha</span></pre></div>             </td>           </tr>                               <tr id="section-365">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-365">&#182;</a>               </div>               <p>the scrollFrame is a container, it redirects most
commands to the "contained" frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@updateRendering = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">updateRendering</span></pre></div>             </td>           </tr>                               <tr id="section-366">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-366">&#182;</a>               </div>               <p>@setColor = @contents.setColor
@setAlphaScaled = @contents.setAlphaScaled</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@hBar = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">,</span> <span class="nx">sliderColor</span><span class="p">)</span>
    <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">@scrollBarSize</span>
    <span class="vi">@hBar.action = </span><span class="nf">(num) =&gt;</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
    <span class="vi">@hBar.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@add</span> <span class="nx">@hBar</span>

    <span class="vi">@vBar = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;vertical&quot;</span><span class="p">,</span> <span class="nx">sliderColor</span><span class="p">)</span>
    <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">@scrollBarSize</span>
    <span class="vi">@vBar.action = </span><span class="nf">(num) =&gt;</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">)</span>
    <span class="vi">@vBar.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@add</span> <span class="nx">@vBar</span>


  <span class="nv">setColor: </span><span class="nf">(aColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-367">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-367">&#182;</a>               </div>               <p>update the color of the scrollFrame - note
that we are never going to paint the scrollFrame
we are updating the color so that its value is the same as the
contained frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color = </span><span class="nx">aColor</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="nx">aColor</span><span class="p">)</span>

  <span class="nv">setAlphaScaled: </span><span class="nf">(alpha) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-368">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-368">&#182;</a>               </div>               <p>update the alpha of the scrollFrame - note
that we are never going to paint the scrollFrame
we are updating the alpha so that its value is the same as the
contained frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@alpha = </span><span class="nx">@calculateAlphaScaled</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setAlphaScaled</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>

  <span class="nv">adjustScrollBars: </span><span class="nf">-&gt;</span>
    <span class="nv">hWidth = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@scrollBarSize</span>
    <span class="nv">vHeight = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@scrollBarSize</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@width</span><span class="p">()</span> <span class="o">+</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">hWidth</span>  <span class="k">if</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">isnt</span> <span class="nx">hWidth</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
      <span class="vi">@hBar.start = </span><span class="mi">0</span>
      <span class="vi">@hBar.stop = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@width</span><span class="p">()</span>
      <span class="vi">@hBar.size = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">stop</span>
      <span class="vi">@hBar.value = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@scrollBarSize</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">vHeight</span>  <span class="k">if</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">isnt</span> <span class="nx">vHeight</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">())</span>
      <span class="vi">@vBar.start = </span><span class="mi">0</span>
      <span class="vi">@vBar.stop = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@height</span><span class="p">()</span>
      <span class="vi">@vBar.size = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">stop</span>
      <span class="vi">@vBar.value = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  <span class="nv">addContents: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">add</span> <span class="nx">aMorph</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
  
  <span class="nv">setContents: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-369">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-369">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@contents.children = </span><span class="p">[]</span>
    <span class="nx">aMorph</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@padding</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">@addContents</span> <span class="nx">aMorph</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">copy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@isTextLineWrapping</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-370">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-370">&#182;</a>               </div>               <p>ScrollFrameMorph scrolling by dragging:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scrollX: </span><span class="nf">(steps) -&gt;</span>
    <span class="nv">cl = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">l = </span><span class="nx">@left</span><span class="p">()</span>
    <span class="nv">cw = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span>
    <span class="nv">newX = </span><span class="nx">cl</span> <span class="o">+</span> <span class="nx">steps</span>
    <span class="nv">newX = </span><span class="nx">l</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">&gt;</span> <span class="nx">l</span>
    <span class="nv">newX = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">cw</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">+</span> <span class="nx">cw</span> <span class="o">&lt;</span> <span class="nx">r</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">newX</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">isnt</span> <span class="nx">cl</span>
  
  <span class="nv">scrollY: </span><span class="nf">(steps) -&gt;</span>
    <span class="nv">ct = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
    <span class="nv">t = </span><span class="nx">@top</span><span class="p">()</span>
    <span class="nv">ch = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span>
    <span class="nv">newY = </span><span class="nx">ct</span> <span class="o">+</span> <span class="nx">steps</span>
    <span class="nv">newY = </span><span class="nx">t</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">&gt;</span> <span class="nx">t</span>
    <span class="nv">newY = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">ch</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">+</span> <span class="nx">ch</span> <span class="o">&lt;</span> <span class="nx">b</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">newY</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">isnt</span> <span class="nx">ct</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@isScrollingByDragging</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nv">oldPos = </span><span class="nx">pos</span>
    <span class="nv">deltaX = </span><span class="mi">0</span>
    <span class="nv">deltaY = </span><span class="mi">0</span>
    <span class="nv">friction = </span><span class="mf">0.8</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span> <span class="o">and</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()))</span>
          <span class="nv">newPos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
          <span class="nv">deltaX = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">oldPos</span><span class="p">.</span><span class="nx">x</span>
          <span class="nx">@scrollX</span> <span class="nx">deltaX</span>  <span class="k">if</span> <span class="nx">deltaX</span> <span class="o">isnt</span> <span class="mi">0</span>
          <span class="nv">deltaY = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">oldPos</span><span class="p">.</span><span class="nx">y</span>
          <span class="nx">@scrollY</span> <span class="nx">deltaY</span>  <span class="k">if</span> <span class="nx">deltaY</span> <span class="o">isnt</span> <span class="mi">0</span>
          <span class="nv">oldPos = </span><span class="nx">newPos</span>
      <span class="k">else</span>
        <span class="k">unless</span> <span class="nx">@hasVelocity</span>
          <span class="vi">@step = </span><span class="nx">noOperation</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">deltaX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">deltaY</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="vi">@step = </span><span class="nx">noOperation</span>
          <span class="k">else</span>
            <span class="nv">deltaX = </span><span class="nx">deltaX</span> <span class="o">*</span> <span class="nx">friction</span>
            <span class="nx">@scrollX</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">deltaX</span><span class="p">)</span>
            <span class="nv">deltaY = </span><span class="nx">deltaY</span> <span class="o">*</span> <span class="nx">friction</span>
            <span class="nx">@scrollY</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">deltaY</span><span class="p">)</span>
      <span class="nx">@adjustScrollBars</span><span class="p">()</span>
  
  <span class="nv">startAutoScrolling: </span><span class="nf">-&gt;</span>
    <span class="nv">inset = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">world</span>
    <span class="nv">hand = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span>
    <span class="vi">@autoScrollTrigger = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">@autoScrollTrigger</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nv">pos = </span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
      <span class="nv">inner = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">insetBy</span><span class="p">(</span><span class="nx">inset</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">))</span> <span class="o">and</span>
        <span class="p">(</span><span class="o">not</span> <span class="p">(</span><span class="nx">inner</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)))</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">hand</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
          <span class="nx">@autoScroll</span> <span class="nx">pos</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="nx">noOperation</span>
        <span class="vi">@autoScrollTrigger = </span><span class="kc">null</span>
  
  <span class="nv">autoScroll: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@autoScrollTrigger</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="nv">inset = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="nv">area = </span><span class="nx">@topLeft</span><span class="p">().</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">inset</span><span class="p">))</span>
    <span class="nx">@scrollY</span> <span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="nx">@topLeft</span><span class="p">().</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">inset</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@scrollX</span> <span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">@top</span><span class="p">())).</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">inset</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@scrollX</span> <span class="o">-</span><span class="p">(</span><span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">)).</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">inset</span><span class="p">))</span>
    <span class="nx">@scrollY</span> <span class="o">-</span><span class="p">(</span><span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-371">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-371">&#182;</a>               </div>               <p>ScrollFrameMorph scrolling by editing text:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scrollCaretIntoView: </span><span class="nf">(morph) -&gt;</span>
    <span class="nv">txt = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">target</span>
    <span class="nv">offset = </span><span class="nx">txt</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">())</span>
    <span class="nv">ft = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@padding</span>
    <span class="nv">fb = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@padding</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">txt</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">@padding</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">ft</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">ft</span> <span class="o">-</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">ft</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">fb</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">fb</span> <span class="o">-</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">fb</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-372">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-372">&#182;</a>               </div>               <p>ScrollFrameMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseScroll: </span><span class="nf">(y, x) -&gt;</span>
    <span class="nx">@scrollY</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">mouseScrollAmount</span>  <span class="k">if</span> <span class="nx">y</span>
    <span class="nx">@scrollX</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">mouseScrollAmount</span>  <span class="k">if</span> <span class="nx">x</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span>
  
  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-373">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-373">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.contents = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@contents</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@contents</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">hBar</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@hBar</span><span class="p">]</span>
      <span class="nv">c.hBar = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@hBar</span><span class="p">])</span>
      <span class="nv">c.hBar.action = </span><span class="nf">(num) -&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">vBar</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@vBar</span><span class="p">]</span>
      <span class="nv">c.vBar = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@vBar</span><span class="p">])</span>
      <span class="nv">c.vBar.action = </span><span class="nf">(num) -&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">)</span>
    <span class="nx">c</span>
  
  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isTextLineWrapping</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;auto line wrap off...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleTextLineWrapping&quot;</span><span class="p">,</span> <span class="s">&quot;turn automatic\nline wrapping\noff&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;auto line wrap on...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleTextLineWrapping&quot;</span><span class="p">,</span> <span class="s">&quot;enable automatic\nline wrapping&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">toggleTextLineWrapping: </span><span class="nf">-&gt;</span>
    <span class="vi">@isTextLineWrapping = </span><span class="o">not</span> <span class="nx">@isTextLineWrapping</span></pre></div>             </td>           </tr>                               <tr id="section-374">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-374">&#182;</a>               </div>               <p>ColorPickerMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ColorPickerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">choice: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(defaultColor) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">defaultColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@buildSubmorphs</span><span class="p">()</span>
  
  <span class="nv">buildSubmorphs: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="vi">@feedback = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
    <span class="vi">@feedback.color = </span><span class="nx">@choice</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nv">cpal = </span><span class="k">new</span> <span class="nx">ColorPaletteMorph</span><span class="p">(</span><span class="nx">@feedback</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="mi">50</span><span class="p">))</span>
    <span class="nv">gpal = </span><span class="k">new</span> <span class="nx">GrayPaletteMorph</span><span class="p">(</span><span class="nx">@feedback</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nx">cpal</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
    <span class="nx">@add</span> <span class="nx">cpal</span>
    <span class="nx">gpal</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">cpal</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">gpal</span>
    <span class="nv">x = </span><span class="p">(</span><span class="nx">gpal</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">gpal</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@feedback</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nv">y = </span><span class="nx">gpal</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">gpal</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@feedback</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@feedback</span>
  
  <span class="nv">getChoice: </span><span class="nf">-&gt;</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">color</span>
  
  <span class="nv">rootForGrab: </span><span class="nf">-&gt;</span>
    <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-375">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-375">&#182;</a>               </div>               <p>InspectorMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">InspectorMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">currentProperty: </span><span class="kc">null</span>
  <span class="nv">showing: </span><span class="s">&quot;attributes&quot;</span>
  <span class="nv">markOwnershipOfProperties: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-376">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-376">&#182;</a>               </div>               <p>panes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">list: </span><span class="kc">null</span>
  <span class="nv">detail: </span><span class="kc">null</span>
  <span class="nv">work: </span><span class="kc">null</span>
  <span class="nv">buttonInspect: </span><span class="kc">null</span>
  <span class="nv">buttonClose: </span><span class="kc">null</span>
  <span class="nv">buttonSubset: </span><span class="kc">null</span>
  <span class="nv">buttonEdit: </span><span class="kc">null</span>
  <span class="nv">resizer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@target) -&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-377">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-377">&#182;</a>               </div>               <p>override inherited properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="vi">@isDraggable = </span><span class="kc">true</span>
    <span class="vi">@border = </span><span class="mi">1</span>
    <span class="vi">@edge = </span><span class="mi">5</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@target</span>
  
  <span class="nv">setTarget: </span><span class="nf">(target) -&gt;</span>
    <span class="vi">@target = </span><span class="nx">target</span>
    <span class="vi">@currentProperty = </span><span class="kc">null</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">buildPanes: </span><span class="nf">-&gt;</span>
    <span class="nv">attribs = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-378">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-378">&#182;</a>               </div>               <p>remove existing panes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-379">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-379">&#182;</a>               </div>               <p>keep work pane around</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@work</span></pre></div>             </td>           </tr>                               <tr id="section-380">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-380">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-381">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-381">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="vi">@label.fontSize = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span>
    <span class="vi">@label.isBold = </span><span class="kc">true</span>
    <span class="vi">@label.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@label</span>
    </pre></div>             </td>           </tr>                               <tr id="section-382">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-382">&#182;</a>               </div>               <p>properties list. Note that this picks up ALL properties
(enumerable such as strings and un-enumerable such as functions)
of the whole prototype chain.</p>

<p>a) some of these are DECLARED as part of the class that defines the object
  and are proprietary to the object. These are shown RED</p>

<p>b) some of these are proprietary to the object but are initialised by
  code higher in the prototype chain. These are shown GREEN</p>

<p>c) some of these are not proprietary, i.e. they belong to an object up
  the chain of prototypes. These are shown BLUE</p>

<p>todo: show the static methods and variables in yet another color.</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">@target</span></pre></div>             </td>           </tr>                               <tr id="section-383">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-383">&#182;</a>               </div>               <p>dummy condition, to be refined</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">attribs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">property</span>  <span class="k">if</span> <span class="nx">property</span>
    <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;attributes&quot;</span>
      <span class="nv">attribs = </span><span class="nx">attribs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="o">not</span> <span class="nx">isFunction</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
      <span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;methods&quot;</span>
      <span class="nv">attribs = </span><span class="nx">attribs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="nx">isFunction</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-384">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-384">&#182;</a>               </div>               <p>otherwise show all properties
label getter
format list
format element: [color, predicate(element]</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nv">staticProperties = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-385">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-385">&#182;</a>               </div>               <p>get rid of all the standar fuff properties that are in classes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">staticProperties = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="nx">prop</span> <span class="o">not</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;length&quot;</span><span class="p">,</span><span class="s">&quot;prototype&quot;</span><span class="p">,</span><span class="s">&quot;caller&quot;</span><span class="p">,</span><span class="s">&quot;__super__&quot;</span><span class="p">,</span><span class="s">&quot;arguments&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;attributes&quot;</span>
      <span class="nv">staticFunctions = </span><span class="p">[]</span>
      <span class="nv">staticAttributes = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="o">not</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;methods&quot;</span>
      <span class="nv">staticFunctions = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
      <span class="nv">staticAttributes = </span><span class="p">[]</span>
    <span class="k">else</span>
      <span class="nv">staticFunctions = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
      <span class="nv">staticAttributes = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(prop) =&gt;</span>
        <span class="nx">prop</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">staticFunctions</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-386">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-386">&#182;</a>               </div>               <p>alert "stat fun " + staticFunctions + " stat attr " + staticAttributes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">attribs = </span><span class="p">(</span><span class="nx">attribs</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">staticFunctions</span><span class="p">).</span><span class="nx">concat</span> <span class="nx">staticAttributes</span></pre></div>             </td>           </tr>                               <tr id="section-387">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-387">&#182;</a>               </div>               <p>alert " all attribs " + attribs</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-388">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-388">&#182;</a>               </div>               <p>caches the own methods of the object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span>
      <span class="nv">targetOwnMethods = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-389">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-389">&#182;</a>               </div>               <p>alert targetOwnMethods</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list = </span><span class="k">new</span> <span class="nx">ListMorph</span><span class="p">((</span><span class="k">if</span> <span class="nx">@target</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="k">then</span> <span class="nx">attribs</span> <span class="k">else</span> <span class="nx">attribs</span><span class="p">.</span><span class="nx">sort</span><span class="p">()),</span> <span class="kc">null</span><span class="p">,(</span>
      <span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span>
        <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-390">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-390">&#182;</a>               </div>               <p>give color criteria from the most general to the most specific</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
            <span class="nf">(element) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-391">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-391">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="kc">true</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nf">(element) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-392">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-392">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">element</span> <span class="k">in</span> <span class="nx">staticProperties</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nf">(element) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-393">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-393">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">hasOwnProperty</span> <span class="nx">element</span><span class="p">)</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="nf">(element) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-394">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-394">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="p">(</span><span class="nx">element</span> <span class="k">in</span> <span class="nx">targetOwnMethods</span><span class="p">)</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="k">else</span> <span class="kc">null</span>
    <span class="p">))</span>
    <span class="vi">@list.action = </span><span class="nf">(selected) =&gt;</span>
      <span class="nv">val = </span><span class="nx">@target</span><span class="p">[</span><span class="nx">selected</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-395">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-395">&#182;</a>               </div>               <p>this is for finding the static variables</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">val</span> <span class="o">is</span> <span class="kc">undefined</span>
        <span class="nv">val = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">selected</span><span class="p">]</span>
      <span class="vi">@currentProperty = </span><span class="nx">val</span>
      <span class="k">if</span> <span class="nx">val</span> <span class="o">is</span> <span class="kc">null</span>
        <span class="nv">txt = </span><span class="s">&quot;NULL&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
        <span class="nv">txt = </span><span class="nx">val</span>
      <span class="k">else</span>
        <span class="nv">txt = </span><span class="nx">val</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">cnts = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span>
      <span class="nv">cnts.isEditable = </span><span class="kc">true</span>
      <span class="nx">cnts</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
      <span class="nx">cnts</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
      <span class="nx">@detail</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">cnts</span></pre></div>             </td>           </tr>                               <tr id="section-396">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-396">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@list.vBar.alpha = </span><span class="mf">0.6</span></pre></div>             </td>           </tr>                               <tr id="section-397">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-397">&#182;</a>               </div>               <p>we know that the content of this list in this pane is not going to need the
step function, so we disable that from here by setting it to null, which
prevents the recursion to children. We could have disabled that from the
constructor of MenuMorph, but who knows, maybe someone might intend to use a MenuMorph
with some animated content? We know that in this specific case it won't need animation so
we set that here. Note that the ListMorph itself does require animation because of the
scrollbars, but the MenuMorph (which contains the actual list contents)
in this context doesn't.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list.listContents.step = </span><span class="kc">null</span>
    <span class="nx">@add</span> <span class="nx">@list</span></pre></div>             </td>           </tr>                               <tr id="section-398">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-398">&#182;</a>               </div>               <p>details pane</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@detail = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
    <span class="vi">@detail.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@detail.contents.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@detail.isTextLineWrapping = </span><span class="kc">true</span>
    <span class="vi">@detail.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@detail.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@detail.vBar.alpha = </span><span class="mf">0.6</span>
    <span class="nv">ctrl = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="nv">ctrl.isEditable = </span><span class="kc">true</span>
    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">ctrl</span>
    <span class="nx">@add</span> <span class="nx">@detail</span></pre></div>             </td>           </tr>                               <tr id="section-399">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-399">&#182;</a>               </div>               <p>work ('evaluation') pane
don't refresh the work pane if it already exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@work</span> <span class="o">is</span> <span class="kc">null</span>
      <span class="vi">@work = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
      <span class="vi">@work.acceptsDrops = </span><span class="kc">false</span>
      <span class="vi">@work.contents.acceptsDrops = </span><span class="kc">false</span>
      <span class="vi">@work.isTextLineWrapping = </span><span class="kc">true</span>
      <span class="vi">@work.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
      <span class="vi">@work.hBar.alpha = </span><span class="mf">0.6</span>
      <span class="vi">@work.vBar.alpha = </span><span class="mf">0.6</span>
      <span class="nv">ev = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="nv">ev.isEditable = </span><span class="kc">true</span>
      <span class="nx">ev</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
      <span class="nx">ev</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
      <span class="nx">@work</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">ev</span>
    <span class="nx">@add</span> <span class="nx">@work</span></pre></div>             </td>           </tr>                               <tr id="section-400">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-400">&#182;</a>               </div>               <p>properties button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonSubset = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonSubset.labelString = </span><span class="s">&quot;show...&quot;</span>
    <span class="vi">@buttonSubset.action = </span><span class="o">=&gt;</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;attributes&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;attributes&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-401">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-401">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;methods&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;methods&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-402">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-402">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;all&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-403">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-403">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span> <span class="k">then</span> <span class="s">&quot;un-mark ownership&quot;</span> <span class="k">else</span> <span class="s">&quot;mark ownership&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="o">=&gt;</span>
        <span class="vi">@markOwnershipOfProperties = </span><span class="o">not</span> <span class="nx">@markOwnershipOfProperties</span>
        <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="p">),</span> <span class="s">&quot;highlight\nownership of properties&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-404">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-404">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonSubset</span></pre></div>             </td>           </tr>                               <tr id="section-405">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-405">&#182;</a>               </div>               <p>inspect button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonInspect = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonInspect.labelString = </span><span class="s">&quot;inspect...&quot;</span>
    <span class="vi">@buttonInspect.action = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">@currentProperty</span><span class="p">)</span>
        <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;in new inspector...&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
          <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">@currentProperty</span><span class="p">)</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
          <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-406">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-406">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;here...&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nx">@setTarget</span> <span class="nx">@currentProperty</span></pre></div>             </td>           </tr>                               <tr id="section-407">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-407">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@inform</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@currentProperty</span> <span class="o">is</span> <span class="kc">null</span> <span class="k">then</span> <span class="s">&quot;null&quot;</span> <span class="k">else</span> <span class="k">typeof</span> <span class="nx">@currentProperty</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;\nis not inspectable&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-408">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-408">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonInspect</span></pre></div>             </td>           </tr>                               <tr id="section-409">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-409">&#182;</a>               </div>               <p>edit button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonEdit = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonEdit.labelString = </span><span class="s">&quot;edit...&quot;</span>
    <span class="vi">@buttonEdit.action = </span><span class="o">=&gt;</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;save&quot;</span><span class="p">,</span> <span class="s">&quot;save&quot;</span><span class="p">,</span> <span class="s">&quot;accept changes&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;add property...&quot;</span><span class="p">,</span> <span class="s">&quot;addProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;rename...&quot;</span><span class="p">,</span> <span class="s">&quot;renameProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;remove...&quot;</span><span class="p">,</span> <span class="s">&quot;removeProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-410">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-410">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonEdit</span></pre></div>             </td>           </tr>                               <tr id="section-411">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-411">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonClose = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonClose.labelString = </span><span class="s">&quot;close&quot;</span>
    <span class="vi">@buttonClose.action = </span><span class="o">=&gt;</span>
      <span class="nx">@destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-412">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-412">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonClose</span></pre></div>             </td>           </tr>                               <tr id="section-413">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-413">&#182;</a>               </div>               <p>resizer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@resizer = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-414">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-414">&#182;</a>               </div>               <p>update layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  <span class="nv">fixLayout: </span><span class="nf">-&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-415">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-415">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">w</span>
    <span class="k">if</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">@silentSetHeight</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">50</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@resizer</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-416">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-416">&#182;</a>               </div>               <p>list</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">listContents</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>
    <span class="nx">w</span> <span class="o">-=</span> <span class="nx">@edge</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">@edge</span><span class="p">)</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">h = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">y</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-417">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-417">&#182;</a>               </div>               <p>detail</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-418">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-418">&#182;</a>               </div>               <p>work</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nx">@work</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@work</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-419">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-419">&#182;</a>               </div>               <p>properties button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nx">@buttonSubset</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonSubset</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-420">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-420">&#182;</a>               </div>               <p>inspect button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">w = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">w</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-421">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-421">&#182;</a>               </div>               <p>edit button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-422">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-422">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-423">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-423">&#182;</a>               </div>               <p>InspectorMorph editing ops:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">save: </span><span class="nf">-&gt;</span>
    <span class="nv">txt = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nv">prop = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-424">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-424">&#182;</a>               </div>               <p>this.target[prop] = evaluate(txt);</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">evaluateString</span> <span class="s">&quot;this.&quot;</span> <span class="o">+</span> <span class="nx">prop</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="nx">txt</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span>
  
  <span class="nv">addProperty: </span><span class="nf">-&gt;</span>
    <span class="nx">@prompt</span> <span class="s">&quot;new property name:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(prop) =&gt;</span>
      <span class="k">if</span> <span class="nx">prop</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="nx">@buildPanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="p">),</span> <span class="nx">@</span><span class="p">,</span> <span class="s">&quot;property&quot;</span> <span class="c1"># Chrome cannot handle empty strings (others do)</span>
  
  <span class="nv">renameProperty: </span><span class="nf">-&gt;</span>
    <span class="nv">propertyName = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="nx">@prompt</span> <span class="s">&quot;property name:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(prop) =&gt;</span>
      <span class="k">try</span>
        <span class="k">delete</span> <span class="p">(</span><span class="nx">@target</span><span class="p">[</span><span class="nx">propertyName</span><span class="p">])</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@currentProperty</span>
      <span class="k">catch</span> <span class="nx">err</span>
        <span class="nx">@inform</span> <span class="nx">err</span>
      <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="p">),</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">propertyName</span>
  
  <span class="nv">removeProperty: </span><span class="nf">-&gt;</span>
    <span class="nv">prop = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="k">try</span>
      <span class="k">delete</span> <span class="p">(</span><span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-425">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-425">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentProperty = </span><span class="kc">null</span>
      <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-426">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-426">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Copyright</span> <span class="mi">2013</span> <span class="nx">Craig</span> <span class="nx">Campbell</span>
<span class="nx">coffeescript</span> <span class="nx">port</span> <span class="k">by</span> <span class="nx">Davide</span> <span class="nx">Della</span> <span class="nx">Casa</span>

<span class="nx">Licensed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">Apache</span> <span class="nx">License</span><span class="p">,</span> <span class="nx">Version</span> <span class="mf">2.0</span> <span class="p">(</span><span class="nx">the</span> <span class="s">&quot;License&quot;</span><span class="p">);</span>
<span class="nx">you</span> <span class="nx">may</span> <span class="o">not</span> <span class="nx">use</span> <span class="k">this</span> <span class="nx">file</span> <span class="nx">except</span> <span class="k">in</span> <span class="nx">compliance</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span>
<span class="nx">You</span> <span class="nx">may</span> <span class="nx">obtain</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">License</span> <span class="nx">at</span>

<span class="nx">http</span><span class="o">://</span><span class="nx">www</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">licenses</span><span class="o">/</span><span class="nx">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>

<span class="nx">Unless</span> <span class="nx">required</span> <span class="k">by</span> <span class="nx">applicable</span> <span class="nx">law</span> <span class="o">or</span> <span class="nx">agreed</span> <span class="nx">to</span> <span class="k">in</span> <span class="nx">writing</span><span class="p">,</span> <span class="nx">software</span>
<span class="nx">distributed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span> <span class="o">is</span> <span class="nx">distributed</span> <span class="kc">on</span> <span class="nx">an</span> <span class="s">&quot;AS IS&quot;</span> <span class="nx">BASIS</span><span class="p">,</span>
<span class="nx">WITHOUT</span> <span class="nx">WARRANTIES</span> <span class="nx">OR</span> <span class="nx">CONDITIONS</span> <span class="nx">OF</span> <span class="nx">ANY</span> <span class="nx">KIND</span><span class="p">,</span> <span class="nx">either</span> <span class="nx">express</span> <span class="o">or</span> <span class="nx">implied</span><span class="p">.</span>
<span class="nx">See</span> <span class="nx">the</span> <span class="nx">License</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specific</span> <span class="nx">language</span> <span class="nx">governing</span> <span class="nx">permissions</span> <span class="o">and</span>
<span class="nx">limitations</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span>

<span class="nx">Mousetrap</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">keyboard</span> <span class="nx">shortcut</span> <span class="nx">library</span> <span class="k">for</span> <span class="nx">Javascript</span> <span class="nx">with</span>
<span class="kc">no</span> <span class="nx">external</span> <span class="nx">dependencies</span>

<span class="nx">@version</span> <span class="mf">1.3</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">@url</span> <span class="nx">craig</span><span class="p">.</span><span class="o">is/</span><span class="nx">killing</span><span class="o">/</span><span class="nx">mice</span></pre></div>             </td>           </tr>                               <tr id="section-427">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-427">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-428">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-428">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">mapping</span> <span class="k">of</span> <span class="nx">special</span> <span class="nx">keycodes</span> <span class="nx">to</span> <span class="nx">their</span> <span class="nx">corresponding</span> <span class="nx">keys</span>

<span class="nx">everything</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">dictionary</span> <span class="nx">cannot</span> <span class="nx">use</span> <span class="nx">keypress</span> <span class="nx">events</span>
<span class="nx">so</span> <span class="nx">it</span> <span class="nx">has</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">here</span> <span class="nx">to</span> <span class="nx">map</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">correct</span> <span class="nx">keycodes</span> <span class="k">for</span>
<span class="nx">keyup</span><span class="o">/</span><span class="nx">keydown</span> <span class="nx">events</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-429">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-429">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_MAP =</span>
  <span class="mi">8</span><span class="o">:</span> <span class="s">&quot;backspace&quot;</span>
  <span class="mi">9</span><span class="o">:</span> <span class="s">&quot;tab&quot;</span>
  <span class="mi">13</span><span class="o">:</span> <span class="s">&quot;enter&quot;</span>
  <span class="mi">16</span><span class="o">:</span> <span class="s">&quot;shift&quot;</span>
  <span class="mi">17</span><span class="o">:</span> <span class="s">&quot;ctrl&quot;</span>
  <span class="mi">18</span><span class="o">:</span> <span class="s">&quot;alt&quot;</span>
  <span class="mi">20</span><span class="o">:</span> <span class="s">&quot;capslock&quot;</span>
  <span class="mi">27</span><span class="o">:</span> <span class="s">&quot;esc&quot;</span>
  <span class="mi">32</span><span class="o">:</span> <span class="s">&quot;space&quot;</span>
  <span class="mi">33</span><span class="o">:</span> <span class="s">&quot;pageup&quot;</span>
  <span class="mi">34</span><span class="o">:</span> <span class="s">&quot;pagedown&quot;</span>
  <span class="mi">35</span><span class="o">:</span> <span class="s">&quot;end&quot;</span>
  <span class="mi">36</span><span class="o">:</span> <span class="s">&quot;home&quot;</span>
  <span class="mi">37</span><span class="o">:</span> <span class="s">&quot;left&quot;</span>
  <span class="mi">38</span><span class="o">:</span> <span class="s">&quot;up&quot;</span>
  <span class="mi">39</span><span class="o">:</span> <span class="s">&quot;right&quot;</span>
  <span class="mi">40</span><span class="o">:</span> <span class="s">&quot;down&quot;</span>
  <span class="mi">45</span><span class="o">:</span> <span class="s">&quot;ins&quot;</span>
  <span class="mi">46</span><span class="o">:</span> <span class="s">&quot;del&quot;</span>
  <span class="mi">91</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span>
  <span class="mi">93</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span>
  <span class="mi">224</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-430">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-430">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">mapping</span> <span class="k">for</span> <span class="nx">special</span> <span class="nx">characters</span> <span class="nx">so</span> <span class="nx">they</span> <span class="nx">can</span> <span class="nx">support</span>

<span class="k">this</span> <span class="nx">dictionary</span> <span class="o">is</span> <span class="nx">only</span> <span class="nx">used</span> <span class="nx">incase</span> <span class="nx">you</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">bind</span> <span class="nx">a</span>
<span class="nx">keyup</span> <span class="o">or</span> <span class="nx">keydown</span> <span class="nx">event</span> <span class="nx">to</span> <span class="nx">one</span> <span class="k">of</span> <span class="nx">these</span> <span class="nx">keys</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-431">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-431">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_KEYCODE_MAP =</span>
  <span class="mi">106</span><span class="o">:</span> <span class="s">&quot;*&quot;</span>
  <span class="mi">107</span><span class="o">:</span> <span class="s">&quot;+&quot;</span>
  <span class="mi">109</span><span class="o">:</span> <span class="s">&quot;-&quot;</span>
  <span class="mi">110</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="mi">111</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="mi">186</span><span class="o">:</span> <span class="s">&quot;;&quot;</span>
  <span class="mi">187</span><span class="o">:</span> <span class="s">&quot;=&quot;</span>
  <span class="mi">188</span><span class="o">:</span> <span class="s">&quot;,&quot;</span>
  <span class="mi">189</span><span class="o">:</span> <span class="s">&quot;-&quot;</span>
  <span class="mi">190</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="mi">191</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="mi">192</span><span class="o">:</span> <span class="s">&quot;`&quot;</span>
  <span class="mi">219</span><span class="o">:</span> <span class="s">&quot;[&quot;</span>
  <span class="mi">220</span><span class="o">:</span> <span class="s">&quot;\\&quot;</span>
  <span class="mi">221</span><span class="o">:</span> <span class="s">&quot;]&quot;</span>
  <span class="mi">222</span><span class="o">:</span> <span class="s">&quot;&#39;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-432">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-432">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">this</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">mapping</span> <span class="k">of</span> <span class="nx">keys</span> <span class="nx">that</span> <span class="nx">require</span> <span class="nx">shift</span> <span class="kc">on</span> <span class="nx">a</span> <span class="nx">US</span> <span class="nx">keypad</span>
<span class="nx">back</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">non</span> <span class="nx">shift</span> <span class="nx">equivelents</span>

<span class="k">this</span> <span class="o">is</span> <span class="nx">so</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">keyup</span> <span class="nx">events</span> <span class="nx">with</span> <span class="nx">these</span> <span class="nx">keys</span>

<span class="nx">note</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">only</span> <span class="nx">work</span> <span class="nx">reliably</span> <span class="kc">on</span> <span class="nx">US</span> <span class="nx">keyboards</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-433">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-433">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_SHIFT_MAP =</span>
  <span class="s">&quot;~&quot;</span><span class="o">:</span> <span class="s">&quot;`&quot;</span>
  <span class="s">&quot;!&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span>
  <span class="s">&quot;@&quot;</span><span class="o">:</span> <span class="s">&quot;2&quot;</span>
  <span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span><span class="o">:</span> <span class="s">&quot;3&quot;</span>
  <span class="nv">$: </span><span class="s">&quot;4&quot;</span>
  <span class="s">&quot;%&quot;</span><span class="o">:</span> <span class="s">&quot;5&quot;</span>
  <span class="s">&quot;^&quot;</span><span class="o">:</span> <span class="s">&quot;6&quot;</span>
  <span class="s">&quot;&amp;&quot;</span><span class="o">:</span> <span class="s">&quot;7&quot;</span>
  <span class="s">&quot;*&quot;</span><span class="o">:</span> <span class="s">&quot;8&quot;</span>
  <span class="s">&quot;(&quot;</span><span class="o">:</span> <span class="s">&quot;9&quot;</span>
  <span class="s">&quot;)&quot;</span><span class="o">:</span> <span class="s">&quot;0&quot;</span>
  <span class="nv">_: </span><span class="s">&quot;-&quot;</span>
  <span class="s">&quot;+&quot;</span><span class="o">:</span> <span class="s">&quot;=&quot;</span>
  <span class="s">&quot;:&quot;</span><span class="o">:</span> <span class="s">&quot;;&quot;</span>
  <span class="s">&quot;\&quot;&quot;</span><span class="o">:</span> <span class="s">&quot;&#39;&quot;</span>
  <span class="s">&quot;&lt;&quot;</span><span class="o">:</span> <span class="s">&quot;,&quot;</span>
  <span class="s">&quot;&gt;&quot;</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="s">&quot;?&quot;</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="s">&quot;|&quot;</span><span class="o">:</span> <span class="s">&quot;\\&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-434">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-434">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">this</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">special</span> <span class="nx">strings</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">to</span> <span class="nx">map</span>
<span class="nx">to</span> <span class="nx">modifier</span> <span class="nx">keys</span> <span class="k">when</span> <span class="nx">you</span> <span class="nx">specify</span> <span class="nx">your</span> <span class="nx">keyboard</span> <span class="nx">shortcuts</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-435">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-435">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_SPECIAL_ALIASES =</span>
  <span class="nv">option: </span><span class="s">&quot;alt&quot;</span>
  <span class="nv">command: </span><span class="s">&quot;meta&quot;</span>
  <span class="k">return</span><span class="o">:</span> <span class="s">&quot;enter&quot;</span>
  <span class="nv">escape: </span><span class="s">&quot;esc&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-436">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-436">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">variable</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">flipped</span> <span class="nx">version</span> <span class="k">of</span> <span class="nx">_MAP</span> <span class="nx">from</span> <span class="nx">above</span>
<span class="nx">needed</span> <span class="nx">to</span> <span class="nx">check</span> <span class="k">if</span> <span class="nx">we</span> <span class="nx">should</span> <span class="nx">use</span> <span class="nx">keypress</span> <span class="o">or</span> <span class="o">not</span> <span class="k">when</span> <span class="kc">no</span> <span class="nx">action</span>
<span class="o">is</span> <span class="nx">specified</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="o">|</span><span class="kc">undefined</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-437">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-437">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_REVERSE_MAP = </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-438">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-438">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">callbacks</span> <span class="nx">setup</span> <span class="nx">via</span> <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">bind</span><span class="p">()</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-439">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-439">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_callbacks = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-440">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-440">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">direct</span> <span class="nx">map</span> <span class="k">of</span> <span class="nx">string</span> <span class="nx">combinations</span> <span class="nx">to</span> <span class="nx">callbacks</span> <span class="nx">used</span> <span class="k">for</span> <span class="nx">trigger</span><span class="p">()</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-441">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-441">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_directMap = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-442">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-442">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">keeps</span> <span class="nx">track</span> <span class="k">of</span> <span class="nx">what</span> <span class="nx">level</span> <span class="nx">each</span> <span class="nx">sequence</span> <span class="o">is</span> <span class="nx">at</span> <span class="nx">since</span> <span class="nx">multiple</span>
<span class="nx">sequences</span> <span class="nx">can</span> <span class="nx">start</span> <span class="nx">out</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">sequence</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-443">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-443">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_sequenceLevels = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-444">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-444">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">variable</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">setTimeout</span> <span class="nx">call</span>

<span class="nx">@type</span> <span class="p">{</span><span class="kc">null</span><span class="o">|</span><span class="nx">number</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-445">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-445">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetTimer = </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-446">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-446">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">temporary</span> <span class="nx">state</span> <span class="nx">where</span> <span class="nx">we</span> <span class="nx">will</span> <span class="nx">ignore</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">keyup</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">|</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-447">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-447">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ignoreNextKeyup = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-448">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-448">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">are</span> <span class="nx">we</span> <span class="nx">currently</span> <span class="nx">inside</span> <span class="k">of</span> <span class="nx">a</span> <span class="nx">sequence</span><span class="o">?</span>
<span class="nx">type</span> <span class="k">of</span> <span class="nx">action</span> <span class="p">(</span><span class="s">&quot;keyup&quot;</span> <span class="o">or</span> <span class="s">&quot;keydown&quot;</span> <span class="o">or</span> <span class="s">&quot;keypress&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="kc">false</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">|</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-449">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-449">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_sequenceType = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-450">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-450">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">loop</span> <span class="nx">through</span> <span class="nx">the</span> <span class="nx">f</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">f1</span> <span class="nx">to</span> <span class="nx">f19</span> <span class="o">and</span> <span class="nx">add</span> <span class="nx">them</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">map</span>
<span class="nx">programatically</span></pre></div>             </td>           </tr>                               <tr id="section-451">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-451">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">i = </span><span class="mi">1</span>
<span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">20</span>
  <span class="nx">_MAP</span><span class="p">[</span><span class="mi">111</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;f&quot;</span> <span class="o">+</span> <span class="nx">i</span>
  <span class="o">++</span><span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-452">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-452">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">loop</span> <span class="nx">through</span> <span class="nx">to</span> <span class="nx">map</span> <span class="nx">numbers</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">numeric</span> <span class="nx">keypad</span></pre></div>             </td>           </tr>                               <tr id="section-453">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-453">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">i = </span><span class="mi">0</span>
<span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">9</span>
  <span class="nx">_MAP</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">96</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span>
  <span class="o">++</span><span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-454">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-454">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">cross</span> <span class="nx">browser</span> <span class="nx">add</span> <span class="nx">event</span> <span class="nx">method</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Element</span><span class="o">|</span><span class="nx">HTMLDocument</span><span class="p">}</span> <span class="nx">object</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">type</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Function</span><span class="p">}</span> <span class="nx">callback</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-455">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-455">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_addEvent = </span><span class="nf">(object, type, callback) -&gt;</span>
  <span class="k">if</span> <span class="nx">object</span><span class="p">.</span><span class="nx">addEventListener</span>
    <span class="nx">object</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span>
    <span class="k">return</span>
  <span class="nx">object</span><span class="p">.</span><span class="nx">attachEvent</span> <span class="s">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-456">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-456">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">takes</span> <span class="nx">the</span> <span class="nx">event</span> <span class="o">and</span> <span class="nx">returns</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">character</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@</span><span class="k">return</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-457">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-457">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_characterFromEvent = </span><span class="nf">(e) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-458">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-458">&#182;</a>               </div>               <p>for keypress events we should return the character as is</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="s">&quot;keypress&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-459">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-459">&#182;</a>               </div>               <p>for non keypress events the special maps are needed</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">_KEYCODE_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">_KEYCODE_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-460">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-460">&#182;</a>               </div>               <p>if it is not in the special map</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-461">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-461">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">checks</span> <span class="k">if</span> <span class="nx">two</span> <span class="nx">arrays</span> <span class="nx">are</span> <span class="nx">equal</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers1</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers2</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nx">boolean</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-462">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-462">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_modifiersMatch = </span><span class="nf">(modifiers1, modifiers2) -&gt;</span>
  <span class="nx">modifiers1</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="nx">modifiers2</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-463">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-463">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">resets</span> <span class="nx">all</span> <span class="nx">sequence</span> <span class="nx">counters</span> <span class="nx">except</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">ones</span> <span class="nx">passed</span> <span class="k">in</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span> <span class="nx">doNotReset</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-464">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-464">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetSequences = </span><span class="nf">(doNotReset, maxLevel) -&gt;</span>
  <span class="nv">doNotReset = </span><span class="nx">doNotReset</span> <span class="o">or</span> <span class="p">{}</span>
  <span class="nv">activeSequences = </span><span class="kc">false</span>
  <span class="nv">key = </span><span class="kc">undefined</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">_sequenceLevels</span>
    <span class="k">if</span> <span class="nx">doNotReset</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">and</span> <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">maxLevel</span>
      <span class="nv">activeSequences = </span><span class="kc">true</span>
      <span class="k">continue</span>
    <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nv">_sequenceType = </span><span class="kc">false</span>  <span class="k">unless</span> <span class="nx">activeSequences</span></pre></div>             </td>           </tr>                               <tr id="section-465">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-465">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">finds</span> <span class="nx">all</span> <span class="nx">callbacks</span> <span class="nx">that</span> <span class="nx">match</span> <span class="nx">based</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">keycode</span><span class="p">,</span> <span class="nx">modifiers</span><span class="p">,</span>
<span class="o">and</span> <span class="nx">action</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">character</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="o">|</span><span class="nb">Object</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">=</span><span class="p">}</span> <span class="nx">remove</span> <span class="o">-</span> <span class="nx">should</span> <span class="nx">we</span> <span class="nx">remove</span> <span class="nx">any</span> <span class="nx">matches</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="o">=</span><span class="p">}</span> <span class="nx">combination</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-466">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-466">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_getMatches = </span><span class="nf">(character, modifiers, e, remove, combination) -&gt;</span>
  <span class="nv">i = </span><span class="kc">undefined</span>
  <span class="nv">callback = </span><span class="kc">undefined</span>
  <span class="nv">matches = </span><span class="p">[]</span>
  <span class="nv">action = </span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span>
  </pre></div>             </td>           </tr>                               <tr id="section-467">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-467">&#182;</a>               </div>               <p>if there are no events related to this keycode</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="p">[]</span>  <span class="k">unless</span> <span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-468">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-468">&#182;</a>               </div>               <p>if a modifier key is coming up on its own we should allow it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">modifiers = </span><span class="p">[</span><span class="nx">character</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">action</span> <span class="o">is</span> <span class="s">&quot;keyup&quot;</span> <span class="o">and</span> <span class="nx">_isModifier</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-469">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-469">&#182;</a>               </div>               <p>loop through all callbacks for the key that was pressed
and see if any of them match</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">].</span><span class="nx">length</span><span class="p">]</span>
    <span class="nv">callback = </span><span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span>
    </pre></div>             </td>           </tr>                               <tr id="section-470">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-470">&#182;</a>               </div>               <p>if this is a sequence but it is not at the right level
then move onto the next match</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">continue</span>  <span class="k">if</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">seq</span> <span class="o">and</span> <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">callback</span><span class="p">.</span><span class="nx">seq</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">level</span>
    </pre></div>             </td>           </tr>                               <tr id="section-471">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-471">&#182;</a>               </div>               <p>if the action we are looking for doesn't match the action we got
then we should keep going</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">continue</span>  <span class="k">unless</span> <span class="nx">action</span> <span class="o">is</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">action</span>
    </pre></div>             </td>           </tr>                               <tr id="section-472">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-472">&#182;</a>               </div>               <p>if this is a keypress event and the meta key and control key
are not pressed that means that we need to only look at the
character, otherwise check the modifiers as well</p>

<p>chrome will not fire a keypress if meta or control is down
safari will fire a keypress if meta or meta+shift is down
firefox will fire a keypress if meta or control is down</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">action</span> <span class="o">is</span> <span class="s">&quot;keypress&quot;</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">)</span> <span class="o">or</span> <span class="nx">_modifiersMatch</span><span class="p">(</span><span class="nx">modifiers</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">modifiers</span><span class="p">)</span>
      </pre></div>             </td>           </tr>                               <tr id="section-473">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-473">&#182;</a>               </div>               <p>remove is used so if you change your mind and call bind a
second time with a new function the first one is overwritten</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">].</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">remove</span> <span class="o">and</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">combo</span> <span class="o">is</span> <span class="nx">combination</span>
      <span class="nx">matches</span><span class="p">.</span><span class="nx">push</span> <span class="nx">callback</span>
  <span class="nx">matches</span></pre></div>             </td>           </tr>                               <tr id="section-474">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-474">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">takes</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">event</span> <span class="o">and</span> <span class="nx">figures</span> <span class="nx">out</span> <span class="nx">what</span> <span class="nx">the</span> <span class="nx">modifiers</span> <span class="nx">are</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-475">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-475">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_eventModifiers = </span><span class="nf">(e) -&gt;</span>
  <span class="nv">modifiers = </span><span class="p">[]</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;shift&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;alt&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;ctrl&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;meta&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span>
  <span class="nx">modifiers</span></pre></div>             </td>           </tr>                               <tr id="section-476">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-476">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">actually</span> <span class="nx">calls</span> <span class="nx">the</span> <span class="nx">callback</span> <span class="nx">function</span>

<span class="k">if</span> <span class="nx">your</span> <span class="nx">callback</span> <span class="nx">function</span> <span class="nx">returns</span> <span class="kc">false</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">jquery</span>
<span class="nx">convention</span> <span class="o">-</span> <span class="nx">prevent</span> <span class="nx">default</span> <span class="o">and</span> <span class="nx">stop</span> <span class="nx">propogation</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Function</span><span class="p">}</span> <span class="nx">callback</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-477">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-477">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_fireCallback = </span><span class="nf">(callback, e, combo) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-478">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-478">&#182;</a>               </div>               <p>if this event should not happen stop here</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span>  <span class="k">if</span> <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">stopCallback</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">or</span> <span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">,</span> <span class="nx">combo</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">combo</span><span class="p">)</span> <span class="o">is</span> <span class="kc">false</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span>
    <span class="nv">e.returnValue = </span><span class="kc">false</span>
    <span class="nv">e.cancelBubble = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-479">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-479">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">handles</span> <span class="nx">a</span> <span class="nx">character</span> <span class="nx">key</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">character</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-480">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-480">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_handleCharacter = </span><span class="nf">(character, e) -&gt;</span>
  <span class="nv">callbacks = </span><span class="nx">_getMatches</span><span class="p">(</span><span class="nx">character</span><span class="p">,</span> <span class="nx">_eventModifiers</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">e</span><span class="p">)</span>
  <span class="nv">i = </span><span class="kc">undefined</span>
  <span class="nv">doNotReset = </span><span class="p">{}</span>
  <span class="nv">maxLevel = </span><span class="mi">0</span>
  <span class="nv">processedSequenceCallback = </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-481">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-481">&#182;</a>               </div>               <p>loop through matching callbacks for this key event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span>
    </pre></div>             </td>           </tr>                               <tr id="section-482">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-482">&#182;</a>               </div>               <p>fire for all sequence callbacks
this is because if for example you have multiple sequences
bound such as "g i" and "g t" they both need to fire the
callback for matching g cause otherwise you can only ever
match the first one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">seq</span>
      <span class="nv">processedSequenceCallback = </span><span class="kc">true</span>
      </pre></div>             </td>           </tr>                               <tr id="section-483">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-483">&#182;</a>               </div>               <p>as we loop through keep track of the max
any sequence at a lower level will be discarded</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">maxLevel = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">maxLevel</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">level</span><span class="p">)</span>
      </pre></div>             </td>           </tr>                               <tr id="section-484">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-484">&#182;</a>               </div>               <p>keep a list of which sequences were matches for later</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">doNotReset</span><span class="p">[</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">seq</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nx">_fireCallback</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">combo</span>
      <span class="k">continue</span>
    </pre></div>             </td>           </tr>                               <tr id="section-485">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-485">&#182;</a>               </div>               <p>if there were no sequence matches but we are still here
that means this is a regular match so we should fire that</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_fireCallback</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">combo</span>  <span class="k">if</span> <span class="o">not</span> <span class="nx">processedSequenceCallback</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_sequenceType</span>
    <span class="o">++</span><span class="nx">i</span>
  </pre></div>             </td>           </tr>                               <tr id="section-486">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-486">&#182;</a>               </div>               <p>if you are inside of a sequence and the key you are pressing
is not a modifier key then we should reset all sequences
that were not matched by this key event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_resetSequences</span> <span class="nx">doNotReset</span><span class="p">,</span> <span class="nx">maxLevel</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="nx">_sequenceType</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_isModifier</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-487">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-487">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">handles</span> <span class="nx">a</span> <span class="nx">keydown</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-488">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-488">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_handleKey = </span><span class="nf">(e) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-489">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-489">&#182;</a>               </div>               <p>normalize e.which for key events
@see http://stackoverflow.com/questions/4285627/javascript-keycode-vs-charcode-utter-confusion</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">e.which = </span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">isnt</span> <span class="s">&quot;number&quot;</span>
  <span class="nv">character = </span><span class="nx">_characterFromEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-490">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-490">&#182;</a>               </div>               <p>no character found then stop</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span>  <span class="k">unless</span> <span class="nx">character</span>
  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="s">&quot;keyup&quot;</span> <span class="o">and</span> <span class="nx">_ignoreNextKeyup</span> <span class="o">is</span> <span class="nx">character</span>
    <span class="nv">_ignoreNextKeyup = </span><span class="kc">false</span>
    <span class="k">return</span>
  <span class="nx">_handleCharacter</span> <span class="nx">character</span><span class="p">,</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-491">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-491">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">determines</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">keycode</span> <span class="nx">specified</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">modifier</span> <span class="nx">key</span> <span class="o">or</span> <span class="o">not</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">key</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nx">boolean</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-492">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-492">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_isModifier = </span><span class="nf">(key) -&gt;</span>
  <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;shift&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;ctrl&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;alt&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;meta&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-493">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-493">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">called</span> <span class="nx">to</span> <span class="nx">set</span> <span class="nx">a</span> <span class="mi">1</span> <span class="nx">second</span> <span class="nx">timeout</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">sequence</span>

<span class="k">this</span> <span class="o">is</span> <span class="nx">so</span> <span class="nx">after</span> <span class="nx">each</span> <span class="nx">key</span> <span class="nx">press</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">sequence</span> <span class="nx">you</span> <span class="nx">have</span> <span class="mi">1</span> <span class="nx">second</span>
<span class="nx">to</span> <span class="nx">press</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">key</span> <span class="nx">before</span> <span class="nx">you</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">start</span> <span class="nx">over</span>

<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-494">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-494">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetSequenceTimer = </span><span class="nf">-&gt;</span>
  <span class="nx">clearTimeout</span> <span class="nx">_resetTimer</span>
  <span class="nv">_resetTimer = </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">_resetSequences</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-495">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-495">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">reverses</span> <span class="nx">the</span> <span class="nx">map</span> <span class="nx">lookup</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">we</span> <span class="nx">can</span> <span class="nx">look</span> <span class="k">for</span> <span class="nx">specific</span> <span class="nx">keys</span>
<span class="nx">to</span> <span class="nx">see</span> <span class="nx">what</span> <span class="nx">can</span> <span class="o">and</span> <span class="nx">can</span><span class="s">&#39;t use keypress</span>

<span class="s">@return {Object}</span>

<span class="s">#DIVIDER</span>
<span class="s">_getReverseMap = -&gt;</span>
<span class="s">  unless _REVERSE_MAP</span>
<span class="s">    _REVERSE_MAP = {}</span>
<span class="s">    for key of _MAP</span>
<span class="s">      </span>

<span class="s">#DIVIDER</span>
<span class="s">      continue  if key &gt; 95 and key &lt; 112</span>
<span class="s">      _REVERSE_MAP[_MAP[key]] = key  if _MAP.hasOwnProperty(key)</span>
<span class="s">  _REVERSE_MAP</span>


<span class="s">#DIVIDER</span>
<span class="s">picks the best action based on the key combination</span>

<span class="s">@param {string} key - character for key</span>
<span class="s">@param {Array} modifiers</span>
<span class="s">@param {string=} action passed in</span>

<span class="s">#DIVIDER</span>
<span class="s">_pickBestAction = (key, modifiers, action) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = (if _getReverseMap()[key] then &quot;keydown&quot; else &quot;keypress&quot;)  unless action</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = &quot;keydown&quot;  if action is &quot;keypress&quot; and modifiers.length</span>
<span class="s">  action</span>


<span class="s">#DIVIDER</span>
<span class="s">binds a key sequence to an event</span>

<span class="s">@param {string} combo - combo specified in bind call</span>
<span class="s">@param {Array} keys</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string=} action</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindSequence = (combo, keys, callback, action) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _sequenceLevels[combo] = 0</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = _pickBestAction(keys[0], [])  unless action</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  callback to increase the sequence level for this sequence and reset</span>
<span class="s">  all other sequences that were active</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  _increaseSequence = -&gt;</span>
<span class="s">    _sequenceType = action</span>
<span class="s">    ++_sequenceLevels[combo]</span>
<span class="s">    _resetSequenceTimer()</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  wraps the specified callback inside of another function in order</span>
<span class="s">  to reset all sequence counters as soon as this sequence is done</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbackAndReset = (e) -&gt;</span>
<span class="s">    _fireCallback callback, e, combo</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    _ignoreNextKeyup = _characterFromEvent(e)  if action isnt &quot;keyup&quot;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    setTimeout _resetSequences, 10</span>

<span class="s">  i = undefined</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  i = 0</span>
<span class="s">  while i &lt; keys.length</span>
<span class="s">    _bindSingle keys[i], (if i &lt; keys.length - 1 then _increaseSequence else _callbackAndReset), action, combo, i</span>
<span class="s">    ++i</span>


<span class="s">#DIVIDER</span>
<span class="s">binds a single keyboard combination</span>

<span class="s">@param {string} combination</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string=} action</span>
<span class="s">@param {string=} sequenceName - name of sequence if part of sequence</span>
<span class="s">@param {number=} level - what part of the sequence the command is</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindSingle = (combination, callback, action, sequenceName, level) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _directMap[combination + &quot;:&quot; + action] = callback</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  combination = combination.replace(/\s+/g, &quot; &quot;)</span>
<span class="s">  sequence = combination.split(&quot; &quot;)</span>
<span class="s">  i = undefined</span>
<span class="s">  key = undefined</span>
<span class="s">  keys = undefined</span>
<span class="s">  modifiers = []</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  if sequence.length &gt; 1</span>
<span class="s">    _bindSequence combination, sequence, callback, action</span>
<span class="s">    return</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  keys = (if combination is &quot;+&quot; then [&quot;+&quot;] else combination.split(&quot;+&quot;))</span>
<span class="s">  i = 0</span>
<span class="s">  while i &lt; keys.length</span>
<span class="s">    key = keys[i]</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    key = _SPECIAL_ALIASES[key]  if _SPECIAL_ALIASES[key]</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    if action and action isnt &quot;keypress&quot; and _SHIFT_MAP[key]</span>
<span class="s">      key = _SHIFT_MAP[key]</span>
<span class="s">      modifiers.push &quot;shift&quot;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    modifiers.push key  if _isModifier(key)</span>
<span class="s">    ++i</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = _pickBestAction(key, modifiers, action)</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbacks[key] = []  unless _callbacks[key]</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _getMatches key, modifiers,</span>
<span class="s">    type: action</span>
<span class="s">  , not sequenceName, combination</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbacks[key][(if sequenceName then &quot;unshift&quot; else &quot;push&quot;)]</span>
<span class="s">    callback: callback</span>
<span class="s">    modifiers: modifiers</span>
<span class="s">    action: action</span>
<span class="s">    seq: sequenceName</span>
<span class="s">    level: level</span>
<span class="s">    combo: combination</span>



<span class="s">#DIVIDER</span>
<span class="s">binds multiple combinations to the same callback</span>

<span class="s">@param {Array} combinations</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string|undefined} action</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindMultiple = (combinations, callback, action) -&gt;</span>
<span class="s">  i = 0</span>

<span class="s">  while i &lt; combinations.length</span>
<span class="s">    _bindSingle combinations[i], callback, action</span>
<span class="s">    ++i</span>



<span class="s">#DIVIDER</span>
<span class="s">_addEvent document, &quot;keypress&quot;, _handleKey</span>
<span class="s">_addEvent document, &quot;keydown&quot;, _handleKey</span>
<span class="s">_addEvent document, &quot;keyup&quot;, _handleKey</span>
<span class="s">Mousetrap =</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  binds an event to mousetrap</span>
<span class="s">  </span>
<span class="s">  can be a single key, a combination of keys separated with +,</span>
<span class="s">  an array of keys, or a sequence of keys separated by spaces</span>
<span class="s">  </span>
<span class="s">  be sure to list the modifier keys first to make sure that the</span>
<span class="s">  correct key ends up getting bound (the last key in the pattern)</span>
<span class="s">  </span>
<span class="s">  @param {string|Array} keys</span>
<span class="s">  @param {Function} callback</span>
<span class="s">  @param {string=} action - &#39;</span><span class="nx">keypress</span><span class="s">&#39;, &#39;</span><span class="nx">keydown</span><span class="s">&#39;, or &#39;</span><span class="nx">keyup</span><span class="s">&#39;</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  bind: (keys, callback, action) -&gt;</span>
<span class="s">    keys = (if keys instanceof Array then keys else [keys])</span>
<span class="s">    _bindMultiple keys, callback, action</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  unbinds an event to mousetrap</span>
<span class="s">  </span>
<span class="s">  the unbinding sets the callback function of the specified key combo</span>
<span class="s">  to an empty function and deletes the corresponding key in the</span>
<span class="s">  _directMap dict.</span>
<span class="s">  </span>
<span class="s">  TODO: actually remove this from the _callbacks dictionary instead</span>
<span class="s">  of binding an empty function</span>
<span class="s">  </span>
<span class="s">  the keycombo+action has to be exactly the same as</span>
<span class="s">  it was defined in the bind method</span>
<span class="s">  </span>
<span class="s">  @param {string|Array} keys</span>
<span class="s">  @param {string} action</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  unbind: (keys, action) -&gt;</span>
<span class="s">    Mousetrap.bind keys, (-&gt;</span>
<span class="s">    ), action</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  triggers an event that has already been bound</span>
<span class="s">  </span>
<span class="s">  @param {string} keys</span>
<span class="s">  @param {string=} action</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  trigger: (keys, action) -&gt;</span>
<span class="s">    _directMap[keys + &quot;:&quot; + action] {}, keys  if _directMap[keys + &quot;:&quot; + action]</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  resets the library back to its initial state.  this is useful</span>
<span class="s">  if you want to clear out the current keyboard shortcuts and bind</span>
<span class="s">  new ones - for example if you switch to another page</span>
<span class="s">  </span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  reset: -&gt;</span>
<span class="s">    _callbacks = {}</span>
<span class="s">    _directMap = {}</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  should we stop this event before firing off callbacks</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @param {Element} element</span>
<span class="s">  @return {boolean}</span>

<span class="s">#DIVIDER</span>
<span class="s">  stopCallback: (e, element) -&gt;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    return false  if (&quot; &quot; + element.className + &quot; &quot;).indexOf(&quot; mousetrap &quot;) &gt; -1</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    element.tagName is &quot;INPUT&quot; or element.tagName is &quot;SELECT&quot; or element.tagName is &quot;TEXTAREA&quot; or (element.contentEditable and element.contentEditable is &quot;true&quot;)</span>

<span class="s">window.Mousetrap = Mousetrap</span>

<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>

<span class="s">class PenMorph extends Morph</span>
<span class="s">  </span>
<span class="s">  heading: 0</span>
<span class="s">  penSize: null</span>
<span class="s">  isWarped: false # internal optimization</span>
<span class="s">  isDown: true</span>
<span class="s">  wantsRedraw: false # internal optimization</span>
<span class="s">  penPoint: &#39;</span><span class="nx">tip</span><span class="s">&#39; # or &#39;</span><span class="nx">center</span><span class="s">&#39;</span>
<span class="s">  </span>
<span class="s">  constructor: () -&gt;</span>
<span class="s">    @penSize = WorldMorph.MorphicPreferences.handleSize * 4</span>
<span class="s">    super()</span>
<span class="s">    @setExtent new Point(@penSize, @penSize)</span>

<span class="s">#DIVIDER</span>
<span class="s">    @penSize = 1</span>

<span class="s">#DIVIDER</span>

<span class="s">  @staticVariable: 1</span>
<span class="s">  @staticFunction: -&gt; 3.14</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">  changed: -&gt;</span>
<span class="s">    if @isWarped is false</span>
<span class="s">      w = @root()</span>
<span class="s">      w.broken.push @visibleBounds().spread()  if w instanceof WorldMorph</span>
<span class="s">      @parent.childChanged @  if @parent</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  updateRendering: (facing) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    direction = facing or @heading</span>
<span class="s">    if @isWarped</span>
<span class="s">      @wantsRedraw = true</span>
<span class="s">      return</span>
<span class="s">    @image = newCanvas(@extent())</span>
<span class="s">    context = @image.getContext(&quot;2d&quot;)</span>
<span class="s">    len = @width() / 2</span>
<span class="s">    start = @center().subtract(@bounds.origin)</span>

<span class="s">    if @penPoint is &quot;tip&quot;</span>
<span class="s">      dest = start.distanceAngle(len * 0.75, direction - 180)</span>
<span class="s">      left = start.distanceAngle(len, direction + 195)</span>
<span class="s">      right = start.distanceAngle(len, direction - 195)</span>
<span class="s">    else # &#39;</span><span class="nx">middle</span><span class="s">&#39;</span>
<span class="s">      dest = start.distanceAngle(len * 0.75, direction)</span>
<span class="s">      left = start.distanceAngle(len * 0.33, direction + 230)</span>
<span class="s">      right = start.distanceAngle(len * 0.33, direction - 230)</span>

<span class="s">    context.fillStyle = @color.toString()</span>
<span class="s">    context.beginPath()</span>

<span class="s">    context.moveTo start.x, start.y</span>
<span class="s">    context.lineTo left.x, left.y</span>
<span class="s">    context.lineTo dest.x, dest.y</span>
<span class="s">    context.lineTo right.x, right.y</span>

<span class="s">    context.closePath()</span>
<span class="s">    context.strokeStyle = &quot;white&quot;</span>
<span class="s">    context.lineWidth = 3</span>
<span class="s">    context.stroke()</span>
<span class="s">    context.strokeStyle = &quot;black&quot;</span>
<span class="s">    context.lineWidth = 1</span>
<span class="s">    context.stroke()</span>
<span class="s">    context.fill()</span>
<span class="s">    @wantsRedraw = false</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  setHeading: (degrees) -&gt;</span>
<span class="s">    @heading = parseFloat(degrees) % 360</span>
<span class="s">    @updateRendering()</span>
<span class="s">    @changed()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  drawLine: (start, dest) -&gt;</span>
<span class="s">    context = @parent.penTrails().getContext(&quot;2d&quot;)</span>
<span class="s">    from = start.subtract(@parent.bounds.origin)</span>
<span class="s">    to = dest.subtract(@parent.bounds.origin)</span>
<span class="s">    if @isDown</span>
<span class="s">      context.lineWidth = @penSize</span>
<span class="s">      context.strokeStyle = @color.toString()</span>
<span class="s">      context.lineCap = &quot;round&quot;</span>
<span class="s">      context.lineJoin = &quot;round&quot;</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.moveTo from.x, from.y</span>
<span class="s">      context.lineTo to.x, to.y</span>
<span class="s">      context.stroke()</span>
<span class="s">      if @isWarped is false</span>
<span class="s">        @world().broken.push start.rectangle(dest).expandBy(Math.max(@penSize / 2, 1)).intersect(@parent.visibleBounds()).spread()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  turn: (degrees) -&gt;</span>
<span class="s">    @setHeading @heading + parseFloat(degrees)</span>
<span class="s">  </span>
<span class="s">  forward: (steps) -&gt;</span>
<span class="s">    start = @center()</span>
<span class="s">    dist = parseFloat(steps)</span>
<span class="s">    if dist &gt;= 0</span>
<span class="s">      dest = @position().distanceAngle(dist, @heading)</span>
<span class="s">    else</span>
<span class="s">      dest = @position().distanceAngle(Math.abs(dist), (@heading - 180))</span>
<span class="s">    @setPosition dest</span>
<span class="s">    @drawLine start, @center()</span>
<span class="s">  </span>
<span class="s">  down: -&gt;</span>
<span class="s">    @isDown = true</span>
<span class="s">  </span>
<span class="s">  up: -&gt;</span>
<span class="s">    @isDown = false</span>
<span class="s">  </span>
<span class="s">  clear: -&gt;</span>
<span class="s">    @parent.updateRendering()</span>
<span class="s">    @parent.changed()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  startWarp: -&gt;</span>
<span class="s">    @wantsRedraw = false</span>
<span class="s">    @isWarped = true</span>
<span class="s">  </span>
<span class="s">  endWarp: -&gt;</span>
<span class="s">    @isWarped = false</span>
<span class="s">    if @wantsRedraw</span>
<span class="s">      @updateRendering()</span>
<span class="s">      @wantsRedraw = false</span>
<span class="s">    @parent.changed()</span>
<span class="s">  </span>
<span class="s">  warp: (fun) -&gt;</span>
<span class="s">    @startWarp()</span>
<span class="s">    fun.call @</span>
<span class="s">    @endWarp()</span>
<span class="s">  </span>
<span class="s">  warpOp: (selector, argsArray) -&gt;</span>
<span class="s">    @startWarp()</span>
<span class="s">    @[selector].apply @, argsArray</span>
<span class="s">    @endWarp()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  warpSierpinski: (length, min) -&gt;</span>
<span class="s">    @warpOp &quot;sierpinski&quot;, [length, min]</span>
<span class="s">  </span>
<span class="s">  sierpinski: (length, min) -&gt;</span>
<span class="s">    if length &gt; min</span>
<span class="s">      for i in [0...3]</span>
<span class="s">        @sierpinski length * 0.5, min</span>
<span class="s">        @turn 120</span>
<span class="s">        @forward length</span>
<span class="s">  </span>
<span class="s">  warpTree: (level, length, angle) -&gt;</span>
<span class="s">    @warpOp &quot;tree&quot;, [level, length, angle]</span>
<span class="s">  </span>
<span class="s">  tree: (level, length, angle) -&gt;</span>
<span class="s">    if level &gt; 0</span>
<span class="s">      @penSize = level</span>
<span class="s">      @forward length</span>
<span class="s">      @turn angle</span>
<span class="s">      @tree level - 1, length * 0.75, angle</span>
<span class="s">      @turn angle * -2</span>
<span class="s">      @tree level - 1, length * 0.75, angle</span>
<span class="s">      @turn angle</span>
<span class="s">      @forward -length</span>

<span class="s">#DIVIDER</span>

<span class="s">class Point</span>

<span class="s">  x: null</span>
<span class="s">  y: null</span>
<span class="s">   </span>
<span class="s">  constructor: (@x = 0, @y = 0) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  toString: -&gt;</span>
<span class="s">    Math.round(@x.toString()) + &quot;@&quot; + Math.round(@y.toString())</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  copy: -&gt;</span>
<span class="s">    new Point(@x, @y)</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  eq: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @x is aPoint.x and @y is aPoint.y</span>
<span class="s">  </span>
<span class="s">  lt: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @x &lt; aPoint.x and @y &lt; aPoint.y</span>
<span class="s">  </span>
<span class="s">  gt: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @x &gt; aPoint.x and @y &gt; aPoint.y</span>
<span class="s">  </span>
<span class="s">  ge: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @x &gt;= aPoint.x and @y &gt;= aPoint.y</span>
<span class="s">  </span>
<span class="s">  le: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @x &lt;= aPoint.x and @y &lt;= aPoint.y</span>
<span class="s">  </span>
<span class="s">  max: (aPoint) -&gt;</span>
<span class="s">    new Point(Math.max(@x, aPoint.x), Math.max(@y, aPoint.y))</span>
<span class="s">  </span>
<span class="s">  min: (aPoint) -&gt;</span>
<span class="s">    new Point(Math.min(@x, aPoint.x), Math.min(@y, aPoint.y))</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  round: -&gt;</span>
<span class="s">    new Point(Math.round(@x), Math.round(@y))</span>
<span class="s">  </span>
<span class="s">  abs: -&gt;</span>
<span class="s">    new Point(Math.abs(@x), Math.abs(@y))</span>
<span class="s">  </span>
<span class="s">  neg: -&gt;</span>
<span class="s">    new Point(-@x, -@y)</span>
<span class="s">  </span>
<span class="s">  mirror: -&gt;</span>
<span class="s">    new Point(@y, @x)</span>
<span class="s">  </span>
<span class="s">  floor: -&gt;</span>
<span class="s">    new Point(Math.max(Math.floor(@x), 0), Math.max(Math.floor(@y), 0))</span>
<span class="s">  </span>
<span class="s">  ceil: -&gt;</span>
<span class="s">    new Point(Math.ceil(@x), Math.ceil(@y))</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  add: (other) -&gt;</span>
<span class="s">    return new Point(@x + other.x, @y + other.y)  if other instanceof Point</span>
<span class="s">    new Point(@x + other, @y + other)</span>
<span class="s">  </span>
<span class="s">  subtract: (other) -&gt;</span>
<span class="s">    return new Point(@x - other.x, @y - other.y)  if other instanceof Point</span>
<span class="s">    new Point(@x - other, @y - other)</span>
<span class="s">  </span>
<span class="s">  multiplyBy: (other) -&gt;</span>
<span class="s">    return new Point(@x * other.x, @y * other.y)  if other instanceof Point</span>
<span class="s">    new Point(@x * other, @y * other)</span>
<span class="s">  </span>
<span class="s">  divideBy: (other) -&gt;</span>
<span class="s">    return new Point(@x / other.x, @y / other.y)  if other instanceof Point</span>
<span class="s">    new Point(@x / other, @y / other)</span>
<span class="s">  </span>
<span class="s">  floorDivideBy: (other) -&gt;</span>
<span class="s">    if other instanceof Point</span>
<span class="s">      return new Point(Math.floor(@x / other.x), Math.floor(@y / other.y))</span>
<span class="s">    new Point(Math.floor(@x / other), Math.floor(@y / other))</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  r: -&gt;</span>
<span class="s">    t = (@multiplyBy(@))</span>
<span class="s">    Math.sqrt t.x + t.y</span>
<span class="s">  </span>
<span class="s">  degrees: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    if @x is 0</span>
<span class="s">      return 90  if @y &gt;= 0</span>
<span class="s">      return 270</span>
<span class="s">    tan = @y / @x</span>
<span class="s">    theta = Math.atan(tan)</span>
<span class="s">    if @x &gt;= 0</span>
<span class="s">      return degrees(theta)  if @y &gt;= 0</span>
<span class="s">      return 360 + (degrees(theta))</span>
<span class="s">    180 + degrees(theta)</span>
<span class="s">  </span>
<span class="s">  theta: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    if @x is 0</span>
<span class="s">      return radians(90)  if @y &gt;= 0</span>
<span class="s">      return radians(270)</span>
<span class="s">    tan = @y / @x</span>
<span class="s">    theta = Math.atan(tan)</span>
<span class="s">    if @x &gt;= 0</span>
<span class="s">      return theta  if @y &gt;= 0</span>
<span class="s">      return radians(360) + theta</span>
<span class="s">    radians(180) + theta</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  crossProduct: (aPoint) -&gt;</span>
<span class="s">    @multiplyBy aPoint.mirror()</span>
<span class="s">  </span>
<span class="s">  distanceTo: (aPoint) -&gt;</span>
<span class="s">    (aPoint.subtract(@)).r()</span>
<span class="s">  </span>
<span class="s">  rotate: (direction, center) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    offset = @subtract(center)</span>
<span class="s">    return new Point(-offset.y, offset.y).add(center)  if direction is &quot;right&quot;</span>
<span class="s">    return new Point(offset.y, -offset.y).add(center)  if direction is &quot;left&quot;</span>

<span class="s">#DIVIDER</span>
<span class="s">    center.subtract offset</span>
<span class="s">  </span>
<span class="s">  flip: (direction, center) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    return new Point(@x, center.y * 2 - @y)  if direction is &quot;vertical&quot;</span>

<span class="s">#DIVIDER</span>
<span class="s">    new Point(center.x * 2 - @x, @y)</span>
<span class="s">  </span>
<span class="s">  distanceAngle: (dist, angle) -&gt;</span>
<span class="s">    deg = angle</span>
<span class="s">    if deg &gt; 270</span>
<span class="s">      deg = deg - 360</span>
<span class="s">    else deg = deg + 360  if deg &lt; -270</span>
<span class="s">    if -90 &lt;= deg and deg &lt;= 90</span>
<span class="s">      x = Math.sin(radians(deg)) * dist</span>
<span class="s">      y = Math.sqrt((dist * dist) - (x * x))</span>
<span class="s">      return new Point(x + @x, @y - y)</span>
<span class="s">    x = Math.sin(radians(180 - deg)) * dist</span>
<span class="s">    y = Math.sqrt((dist * dist) - (x * x))</span>
<span class="s">    new Point(x + @x, @y + y)</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  scaleBy: (scalePoint) -&gt;</span>
<span class="s">    @multiplyBy scalePoint</span>
<span class="s">  </span>
<span class="s">  translateBy: (deltaPoint) -&gt;</span>
<span class="s">    @add deltaPoint</span>
<span class="s">  </span>
<span class="s">  rotateBy: (angle, centerPoint) -&gt;</span>
<span class="s">    center = centerPoint or new Point(0, 0)</span>
<span class="s">    p = @subtract(center)</span>
<span class="s">    r = p.r()</span>
<span class="s">    theta = angle - p.theta()</span>
<span class="s">    new Point(center.x + (r * Math.cos(theta)), center.y - (r * Math.sin(theta)))</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  asArray: -&gt;</span>
<span class="s">    [@x, @y]</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  corner: (cornerPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    new Rectangle(@x, @y, cornerPoint.x, cornerPoint.y)</span>
<span class="s">  </span>
<span class="s">  rectangle: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    org = @min(aPoint)</span>
<span class="s">    crn = @max(aPoint)</span>
<span class="s">    new Rectangle(org.x, org.y, crn.x, crn.y)</span>
<span class="s">  </span>
<span class="s">  extent: (aPoint) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    crn = @add(aPoint)</span>
<span class="s">    new Rectangle(@x, @y, crn.x, crn.y)</span>

<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>

<span class="s">class CircleBoxMorph extends Morph</span>

<span class="s">  orientation: null</span>
<span class="s">  autoOrient: true</span>

<span class="s">  constructor: (@orientation = &quot;vertical&quot;) -&gt;</span>
<span class="s">    super()</span>
<span class="s">    @setExtent new Point(20, 100)</span>
<span class="s">  </span>
<span class="s">  autoOrientation: -&gt;</span>
<span class="s">    if @height() &gt; @width()</span>
<span class="s">      @orientation = &quot;vertical&quot;</span>
<span class="s">    else</span>
<span class="s">      @orientation = &quot;horizontal&quot;</span>
<span class="s">  </span>
<span class="s">  updateRendering: -&gt;</span>
<span class="s">    @autoOrientation()  if @autoOrient</span>
<span class="s">    @image = newCanvas(@extent())</span>
<span class="s">    context = @image.getContext(&quot;2d&quot;)</span>
<span class="s">    if @orientation is &quot;vertical&quot;</span>
<span class="s">      radius = @width() / 2</span>
<span class="s">      x = @center().x</span>
<span class="s">      center1 = new Point(x, @top() + radius)</span>
<span class="s">      center2 = new Point(x, @bottom() - radius)</span>
<span class="s">      rect = @bounds.origin.add(</span>
<span class="s">        new Point(0, radius)).corner(@bounds.corner.subtract(new Point(0, radius)))</span>
<span class="s">    else</span>
<span class="s">      radius = @height() / 2</span>
<span class="s">      y = @center().y</span>
<span class="s">      center1 = new Point(@left() + radius, y)</span>
<span class="s">      center2 = new Point(@right() - radius, y)</span>
<span class="s">      rect = @bounds.origin.add(</span>
<span class="s">        new Point(radius, 0)).corner(@bounds.corner.subtract(new Point(radius, 0)))</span>
<span class="s">    points = [center1.subtract(@bounds.origin), center2.subtract(@bounds.origin)]</span>
<span class="s">    points.forEach (center) =&gt;</span>
<span class="s">      context.fillStyle = @color.toString()</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.arc center.x, center.y, radius, 0, 2 * Math.PI, false</span>
<span class="s">      context.closePath()</span>
<span class="s">      context.fill()</span>
<span class="s">    rect = rect.translateBy(@bounds.origin.neg())</span>
<span class="s">    ext = rect.extent()</span>
<span class="s">    if ext.x &gt; 0 and ext.y &gt; 0</span>
<span class="s">      context.fillRect rect.origin.x, rect.origin.y, rect.width(), rect.height()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  developersMenu: -&gt;</span>
<span class="s">    menu = super()</span>
<span class="s">    menu.addLine()</span>
<span class="s">    if @orientation is &quot;vertical&quot;</span>
<span class="s">      menu.addItem &quot;horizontal...&quot;, &quot;toggleOrientation&quot;, &quot;toggle the\norientation&quot;</span>
<span class="s">    else</span>
<span class="s">      menu.addItem &quot;vertical...&quot;, &quot;toggleOrientation&quot;, &quot;toggle the\norientation&quot;</span>
<span class="s">    menu</span>
<span class="s">  </span>
<span class="s">  toggleOrientation: -&gt;</span>
<span class="s">    center = @center()</span>
<span class="s">    @changed()</span>
<span class="s">    if @orientation is &quot;vertical&quot;</span>
<span class="s">      @orientation = &quot;horizontal&quot;</span>
<span class="s">    else</span>
<span class="s">      @orientation = &quot;vertical&quot;</span>
<span class="s">    @silentSetExtent new Point(@height(), @width())</span>
<span class="s">    @setCenter center</span>
<span class="s">    @updateRendering()</span>
<span class="s">    @changed()</span>

<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>

<span class="s">modules = {} # keep track of additional loaded modules</span>

<span class="s">useBlurredShadows = getBlurredShadowSupport() # check for Chrome-bug</span>

<span class="s">standardSettings =</span>
<span class="s">  minimumFontHeight: getMinimumFontHeight() # browser settings</span>
<span class="s">  globalFontFamily: &quot;&quot;</span>
<span class="s">  menuFontName: &quot;sans-serif&quot;</span>
<span class="s">  menuFontSize: 12</span>
<span class="s">  bubbleHelpFontSize: 10</span>
<span class="s">  prompterFontName: &quot;sans-serif&quot;</span>
<span class="s">  prompterFontSize: 12</span>
<span class="s">  prompterSliderSize: 10</span>
<span class="s">  handleSize: 15</span>
<span class="s">  scrollBarSize: 12</span>
<span class="s">  mouseScrollAmount: 40</span>
<span class="s">  useSliderForInput: false</span>
<span class="s">  useVirtualKeyboard: true</span>
<span class="s">  rasterizeSVGs: false</span>

<span class="s">touchScreenSettings =</span>
<span class="s">  minimumFontHeight: standardSettings.minimumFontHeight</span>
<span class="s">  globalFontFamily: &quot;&quot;</span>
<span class="s">  menuFontName: &quot;sans-serif&quot;</span>
<span class="s">  menuFontSize: 24</span>
<span class="s">  bubbleHelpFontSize: 18</span>
<span class="s">  prompterFontName: &quot;sans-serif&quot;</span>
<span class="s">  prompterFontSize: 24</span>
<span class="s">  prompterSliderSize: 20</span>
<span class="s">  handleSize: 26</span>
<span class="s">  scrollBarSize: 24</span>
<span class="s">  mouseScrollAmount: 40</span>
<span class="s">  useSliderForInput: true</span>
<span class="s">  useVirtualKeyboard: true</span>
<span class="s">  rasterizeSVGs: false</span>


<span class="s">#DIVIDER</span>

<span class="s">class Rectangle</span>

<span class="s">  origin: null</span>
<span class="s">  corner: null</span>
<span class="s">  </span>
<span class="s">  constructor: (left, top, right, bottom) -&gt;</span>
<span class="s">    </span>
<span class="s">    @origin = new Point((left or 0), (top or 0))</span>
<span class="s">    @corner = new Point((right or 0), (bottom or 0))</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  toString: -&gt;</span>
<span class="s">    &quot;[&quot; + @origin.toString() + &quot; | &quot; + @extent().toString() + &quot;]&quot;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  copy: -&gt;</span>
<span class="s">    new Rectangle(@left(), @top(), @right(), @bottom())</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  setTo: (left, top, right, bottom) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @origin = new Point(</span>
<span class="s">      left or ((if (left is 0) then 0 else @left())),</span>
<span class="s">      top or ((if (top is 0) then 0 else @top())))</span>
<span class="s">    @corner = new Point(</span>
<span class="s">      right or ((if (right is 0) then 0 else @right())),</span>
<span class="s">      bottom or ((if (bottom is 0) then 0 else @bottom())))</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  area: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    w = @width()</span>
<span class="s">    return 0  if w &lt; 0</span>
<span class="s">    Math.max w * @height(), 0</span>
<span class="s">  </span>
<span class="s">  bottom: -&gt;</span>
<span class="s">    @corner.y</span>
<span class="s">  </span>
<span class="s">  bottomCenter: -&gt;</span>
<span class="s">    new Point(@center().x, @bottom())</span>
<span class="s">  </span>
<span class="s">  bottomLeft: -&gt;</span>
<span class="s">    new Point(@origin.x, @corner.y)</span>
<span class="s">  </span>
<span class="s">  bottomRight: -&gt;</span>
<span class="s">    @corner.copy()</span>
<span class="s">  </span>
<span class="s">  boundingBox: -&gt;</span>
<span class="s">    @</span>
<span class="s">  </span>
<span class="s">  center: -&gt;</span>
<span class="s">    @origin.add @corner.subtract(@origin).floorDivideBy(2)</span>
<span class="s">  </span>
<span class="s">  corners: -&gt;</span>
<span class="s">    [@origin, @bottomLeft(), @corner, @topRight()]</span>
<span class="s">  </span>
<span class="s">  extent: -&gt;</span>
<span class="s">    @corner.subtract @origin</span>
<span class="s">  </span>
<span class="s">  isEmpty: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    theExtent = @corner.subtract @origin</span>
<span class="s">    theExtent.x = 0 or theExtent.y = 0</span>

<span class="s">  isNotEmpty: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    theExtent = @corner.subtract @origin</span>
<span class="s">    theExtent.x &gt; 0 and theExtent.y &gt; 0</span>
<span class="s">  </span>
<span class="s">  height: -&gt;</span>
<span class="s">    @corner.y - @origin.y</span>
<span class="s">  </span>
<span class="s">  left: -&gt;</span>
<span class="s">    @origin.x</span>
<span class="s">  </span>
<span class="s">  leftCenter: -&gt;</span>
<span class="s">    new Point(@left(), @center().y)</span>
<span class="s">  </span>
<span class="s">  right: -&gt;</span>
<span class="s">    @corner.x</span>
<span class="s">  </span>
<span class="s">  rightCenter: -&gt;</span>
<span class="s">    new Point(@right(), @center().y)</span>
<span class="s">  </span>
<span class="s">  top: -&gt;</span>
<span class="s">    @origin.y</span>
<span class="s">  </span>
<span class="s">  topCenter: -&gt;</span>
<span class="s">    new Point(@center().x, @top())</span>
<span class="s">  </span>
<span class="s">  topLeft: -&gt;</span>
<span class="s">    @origin</span>
<span class="s">  </span>
<span class="s">  topRight: -&gt;</span>
<span class="s">    new Point(@corner.x, @origin.y)</span>
<span class="s">  </span>
<span class="s">  width: -&gt;</span>
<span class="s">    @corner.x - @origin.x</span>
<span class="s">  </span>
<span class="s">  position: -&gt;</span>
<span class="s">    @origin</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  eq: (aRect) -&gt;</span>
<span class="s">    @origin.eq(aRect.origin) and @corner.eq(aRect.corner)</span>
<span class="s">  </span>
<span class="s">  abs: -&gt;</span>
<span class="s">    newOrigin = @origin.abs()</span>
<span class="s">    newCorner = @corner.max(newOrigin)</span>
<span class="s">    newOrigin.corner newCorner</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  insetBy: (delta) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    result = new Rectangle()</span>
<span class="s">    result.origin = @origin.add(delta)</span>
<span class="s">    result.corner = @corner.subtract(delta)</span>
<span class="s">    result</span>
<span class="s">  </span>
<span class="s">  expandBy: (delta) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    result = new Rectangle()</span>
<span class="s">    result.origin = @origin.subtract(delta)</span>
<span class="s">    result.corner = @corner.add(delta)</span>
<span class="s">    result</span>
<span class="s">  </span>
<span class="s">  growBy: (delta) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    result = new Rectangle()</span>
<span class="s">    result.origin = @origin.copy()</span>
<span class="s">    result.corner = @corner.add(delta)</span>
<span class="s">    result</span>
<span class="s">  </span>
<span class="s">  intersect: (aRect) -&gt;</span>
<span class="s">    result = new Rectangle()</span>
<span class="s">    result.origin = @origin.max(aRect.origin)</span>
<span class="s">    result.corner = @corner.min(aRect.corner)</span>
<span class="s">    result</span>
<span class="s">  </span>
<span class="s">  merge: (aRect) -&gt;</span>
<span class="s">    result = new Rectangle()</span>
<span class="s">    result.origin = @origin.min(aRect.origin)</span>
<span class="s">    result.corner = @corner.max(aRect.corner)</span>
<span class="s">    result</span>
<span class="s">  </span>
<span class="s">  round: -&gt;</span>
<span class="s">    @origin.round().corner @corner.round()</span>
<span class="s">  </span>
<span class="s">  spread: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    @origin.floor().corner @corner.ceil()</span>
<span class="s">  </span>
<span class="s">  amountToTranslateWithin: (aRect) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    dx = aRect.right() - @right()  if @right() &gt; aRect.right()</span>
<span class="s">    dy = aRect.bottom() - @bottom()  if @bottom() &gt; aRect.bottom()</span>
<span class="s">    dx = aRect.left() - @right()  if (@left() + dx) &lt; aRect.left()</span>
<span class="s">    dy = aRect.top() - @top()  if (@top() + dy) &lt; aRect.top()</span>
<span class="s">    new Point(dx, dy)</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  containsPoint: (aPoint) -&gt;</span>
<span class="s">    @origin.le(aPoint) and aPoint.lt(@corner)</span>
<span class="s">  </span>
<span class="s">  containsRectangle: (aRect) -&gt;</span>
<span class="s">    aRect.origin.gt(@origin) and aRect.corner.lt(@corner)</span>
<span class="s">  </span>
<span class="s">  intersects: (aRect) -&gt;</span>
<span class="s">    ro = aRect.origin</span>
<span class="s">    rc = aRect.corner</span>
<span class="s">    (rc.x &gt;= @origin.x) and</span>
<span class="s">      (rc.y &gt;= @origin.y) and</span>
<span class="s">      (ro.x &lt;= @corner.x) and</span>
<span class="s">      (ro.y &lt;= @corner.y)</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  scaleBy: (scale) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    o = @origin.multiplyBy(scale)</span>
<span class="s">    c = @corner.multiplyBy(scale)</span>
<span class="s">    new Rectangle(o.x, o.y, c.x, c.y)</span>
<span class="s">  </span>
<span class="s">  translateBy: (factor) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    o = @origin.add(factor)</span>
<span class="s">    c = @corner.add(factor)</span>
<span class="s">    new Rectangle(o.x, o.y, c.x, c.y)</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  asArray: -&gt;</span>
<span class="s">    [@left(), @top(), @right(), @bottom()]</span>
<span class="s">  </span>
<span class="s">  asArray_xywh: -&gt;</span>
<span class="s">    [@left(), @top(), @width(), @height()]</span>

<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>

<span class="s">class SliderButtonMorph extends CircleBoxMorph</span>


<span class="s">#DIVIDER</span>
<span class="s">  highlightColor: new Color(90, 90, 140)</span>

<span class="s">#DIVIDER</span>
<span class="s">  pressColor: new Color(80, 80, 160)</span>
<span class="s">  is3D: true</span>
<span class="s">  hasMiddleDip: true</span>

<span class="s">  constructor: (orientation) -&gt;</span>
<span class="s">    @color = new Color(80, 80, 80)</span>
<span class="s">    super orientation</span>
<span class="s">  </span>
<span class="s">  autoOrientation: -&gt;</span>
<span class="s">      noOperation</span>
<span class="s">  </span>
<span class="s">  updateRendering: -&gt;</span>
<span class="s">    colorBak = @color.copy()</span>
<span class="s">    super()</span>
<span class="s">    @drawEdges()  if @is3D</span>
<span class="s">    @normalImage = @image</span>
<span class="s">    @color = @highlightColor.copy()</span>
<span class="s">    super()</span>
<span class="s">    @drawEdges()  if @is3D</span>
<span class="s">    @highlightImage = @image</span>
<span class="s">    @color = @pressColor.copy()</span>
<span class="s">    super()</span>
<span class="s">    @drawEdges()  if @is3D</span>
<span class="s">    @pressImage = @image</span>
<span class="s">    @color = colorBak</span>
<span class="s">    @image = @normalImage</span>
<span class="s">  </span>
<span class="s">  drawEdges: -&gt;</span>
<span class="s">    context = @image.getContext(&quot;2d&quot;)</span>
<span class="s">    w = @width()</span>
<span class="s">    h = @height()</span>
<span class="s">    context.lineJoin = &quot;round&quot;</span>
<span class="s">    context.lineCap = &quot;round&quot;</span>
<span class="s">    if @orientation is &quot;vertical&quot;</span>
<span class="s">      context.lineWidth = w / 3</span>
<span class="s">      gradient = context.createLinearGradient(0, 0, context.lineWidth, 0)</span>
<span class="s">      gradient.addColorStop 0, &quot;white&quot;</span>
<span class="s">      gradient.addColorStop 1, @color.toString()</span>
<span class="s">      context.strokeStyle = gradient</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.moveTo context.lineWidth * 0.5, w / 2</span>
<span class="s">      context.lineTo context.lineWidth * 0.5, h - w / 2</span>
<span class="s">      context.stroke()</span>
<span class="s">      gradient = context.createLinearGradient(w - context.lineWidth, 0, w, 0)</span>
<span class="s">      gradient.addColorStop 0, @color.toString()</span>
<span class="s">      gradient.addColorStop 1, &quot;black&quot;</span>
<span class="s">      context.strokeStyle = gradient</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.moveTo w - context.lineWidth * 0.5, w / 2</span>
<span class="s">      context.lineTo w - context.lineWidth * 0.5, h - w / 2</span>
<span class="s">      context.stroke()</span>
<span class="s">      if @hasMiddleDip</span>
<span class="s">        gradient = context.createLinearGradient(</span>
<span class="s">          context.lineWidth, 0, w - context.lineWidth, 0)</span>
<span class="s">        radius = w / 4</span>
<span class="s">        gradient.addColorStop 0, &quot;black&quot;</span>
<span class="s">        gradient.addColorStop 0.35, @color.toString()</span>
<span class="s">        gradient.addColorStop 0.65, @color.toString()</span>
<span class="s">        gradient.addColorStop 1, &quot;white&quot;</span>
<span class="s">        context.fillStyle = gradient</span>
<span class="s">        context.beginPath()</span>
<span class="s">        context.arc w / 2, h / 2, radius, radians(0), radians(360), false</span>
<span class="s">        context.closePath()</span>
<span class="s">        context.fill()</span>
<span class="s">    else if @orientation is &quot;horizontal&quot;</span>
<span class="s">      context.lineWidth = h / 3</span>
<span class="s">      gradient = context.createLinearGradient(0, 0, 0, context.lineWidth)</span>
<span class="s">      gradient.addColorStop 0, &quot;white&quot;</span>
<span class="s">      gradient.addColorStop 1, @color.toString()</span>
<span class="s">      context.strokeStyle = gradient</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.moveTo h / 2, context.lineWidth * 0.5</span>
<span class="s">      context.lineTo w - h / 2, context.lineWidth * 0.5</span>
<span class="s">      context.stroke()</span>
<span class="s">      gradient = context.createLinearGradient(0, h - context.lineWidth, 0, h)</span>
<span class="s">      gradient.addColorStop 0, @color.toString()</span>
<span class="s">      gradient.addColorStop 1, &quot;black&quot;</span>
<span class="s">      context.strokeStyle = gradient</span>
<span class="s">      context.beginPath()</span>
<span class="s">      context.moveTo h / 2, h - context.lineWidth * 0.5</span>
<span class="s">      context.lineTo w - h / 2, h - context.lineWidth * 0.5</span>
<span class="s">      context.stroke()</span>
<span class="s">      if @hasMiddleDip</span>
<span class="s">        gradient = context.createLinearGradient(</span>
<span class="s">          0, context.lineWidth, 0, h - context.lineWidth)</span>
<span class="s">        radius = h / 4</span>
<span class="s">        gradient.addColorStop 0, &quot;black&quot;</span>
<span class="s">        gradient.addColorStop 0.35, @color.toString()</span>
<span class="s">        gradient.addColorStop 0.65, @color.toString()</span>
<span class="s">        gradient.addColorStop 1, &quot;white&quot;</span>
<span class="s">        context.fillStyle = gradient</span>
<span class="s">        context.beginPath()</span>
<span class="s">        context.arc @width() / 2, @height() / 2, radius, radians(0), radians(360), false</span>
<span class="s">        context.closePath()</span>
<span class="s">        context.fill()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  mouseEnter: -&gt;</span>
<span class="s">    @image = @highlightImage</span>
<span class="s">    @changed()</span>
<span class="s">  </span>
<span class="s">  mouseLeave: -&gt;</span>
<span class="s">    @image = @normalImage</span>
<span class="s">    @changed()</span>
<span class="s">  </span>
<span class="s">  mouseDownLeft: (pos) -&gt;</span>
<span class="s">    @image = @pressImage</span>
<span class="s">    @changed()</span>
<span class="s">    @escalateEvent &quot;mouseDownLeft&quot;, pos</span>
<span class="s">  </span>
<span class="s">  mouseClickLeft: -&gt;</span>
<span class="s">    @image = @highlightImage</span>
<span class="s">    @changed()</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  mouseMove: -&gt;</span>
<span class="s">      noOperation</span>

<span class="s">#DIVIDER</span>


<span class="s">#DIVIDER</span>

<span class="s">class TriggerMorph extends Morph</span>

<span class="s">  target: null</span>
<span class="s">  action: null</span>
<span class="s">  environment: null</span>
<span class="s">  label: null</span>
<span class="s">  labelString: null</span>
<span class="s">  labelColor: null</span>
<span class="s">  hint: null</span>
<span class="s">  fontSize: null</span>
<span class="s">  fontStyle: null</span>

<span class="s">#DIVIDER</span>
<span class="s">  highlightColor: new Color(192, 192, 192)</span>
<span class="s">  highlightImage: null</span>

<span class="s">#DIVIDER</span>
<span class="s">  pressColor: new Color(128, 128, 128)</span>
<span class="s">  normalImage: null</span>
<span class="s">  pressImage: null</span>

<span class="s">  constructor: (@target = null, @action = null, @labelString = null,</span>
<span class="s">    fontSize, fontStyle, @environment = null, @hint = null, labelColor) -&gt;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    @fontSize = fontSize or WorldMorph.MorphicPreferences.menuFontSize</span>
<span class="s">    @fontStyle = fontStyle or &quot;sans-serif&quot;</span>
<span class="s">    @labelColor = labelColor or new Color(0, 0, 0)</span>

<span class="s">#DIVIDER</span>
<span class="s">    super()</span>

<span class="s">#DIVIDER</span>
<span class="s">    @color = new Color(255, 255, 255)</span>
<span class="s">    @updateRendering()</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  updateRendering: -&gt;</span>
<span class="s">    @createBackgrounds()</span>
<span class="s">    @createLabel()  if @labelString isnt null</span>
<span class="s">  </span>
<span class="s">  createBackgrounds: -&gt;</span>
<span class="s">    ext = @extent()</span>
<span class="s">    @normalImage = newCanvas(ext)</span>
<span class="s">    context = @normalImage.getContext(&quot;2d&quot;)</span>
<span class="s">    context.fillStyle = @color.toString()</span>
<span class="s">    context.fillRect 0, 0, ext.x, ext.y</span>
<span class="s">    @highlightImage = newCanvas(ext)</span>
<span class="s">    context = @highlightImage.getContext(&quot;2d&quot;)</span>
<span class="s">    context.fillStyle = @highlightColor.toString()</span>
<span class="s">    context.fillRect 0, 0, ext.x, ext.y</span>
<span class="s">    @pressImage = newCanvas(ext)</span>
<span class="s">    context = @pressImage.getContext(&quot;2d&quot;)</span>
<span class="s">    context.fillStyle = @pressColor.toString()</span>
<span class="s">    context.fillRect 0, 0, ext.x, ext.y</span>
<span class="s">    @image = @normalImage</span>
<span class="s">  </span>
<span class="s">  createLabel: -&gt;</span>
<span class="s">    @label.destroy()  if @label isnt null</span>

<span class="s">#DIVIDER</span>
<span class="s">    @label = new StringMorph(</span>
<span class="s">      @labelString, @fontSize, @fontStyle, false, false, false, null, null, @labelColor)</span>
<span class="s">    @label.setPosition @center().subtract(@label.extent().floorDivideBy(2))</span>
<span class="s">    @add @label</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  copyRecordingReferences: (dict) -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    c = super dict</span>
<span class="s">    c.label = (dict[@label])  if c.label and dict[@label]</span>
<span class="s">    c</span>
<span class="s">  </span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  trigger: -&gt;</span>

<span class="s">#DIVIDER</span>
<span class="s">    if typeof @target is &quot;function&quot;</span>
<span class="s">      if typeof @action is &quot;function&quot;</span>
<span class="s">        @target.call @environment, @action.call()</span>
<span class="s">      else</span>
<span class="s">        @target.call @environment, @action</span>
<span class="s">    else</span>
<span class="s">      if typeof @action is &quot;function&quot;</span>
<span class="s">        @action.call @target</span>
<span class="s">      else # assume it&#39;</span><span class="nx">s</span> <span class="nx">a</span> <span class="nb">String</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@action</span><span class="p">]()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-496">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-496">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@bubbleHelp</span> <span class="nx">@hint</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseLeave: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@pressImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@trigger</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-497">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-497">&#182;</a>               </div>               <p>pull out the numeric keypad from here cause keypress should
be able to detect the keys from the character</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bubbleHelp: </span><span class="nf">(contents) -&gt;</span>
    <span class="vi">@fps = </span><span class="mi">2</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nx">@popUpbubbleHelp</span> <span class="nx">contents</span>  <span class="k">if</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">())</span>
      <span class="vi">@fps = </span><span class="mi">0</span>
      <span class="k">delete</span> <span class="nx">@step</span>
  
  <span class="nv">popUpbubbleHelp: </span><span class="nf">(contents) -&gt;</span>
    <span class="k">new</span> <span class="nx">SpeechBubbleMorph</span><span class="p">(</span>
      <span class="nx">localize</span><span class="p">(</span><span class="nx">contents</span><span class="p">),</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">popUp</span> <span class="nx">@world</span><span class="p">(),</span>
      <span class="nx">@rightCenter</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-498">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-498">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-499">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-499">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-500">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-500">&#182;</a>               </div>               <p>if no action was picked in we should try to pick the one
that we think would work best for this key</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">WorldMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span></pre></div>             </td>           </tr>                               <tr id="section-501">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-501">&#182;</a>               </div>               <p>modifier keys don't work as expected with keypress,
switch to keydown</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@MorphicPreferences: </span><span class="nx">standardSettings</span>
  <span class="vi">@currentTime: </span><span class="kc">null</span>
  <span class="vi">@showRedraws: </span><span class="kc">false</span>
  <span class="nv">systemTestsRecorderAndPlayer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(aCanvas, fillPage) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="c1"># (130, 130, 130)</span>
    <span class="vi">@alpha = </span><span class="mi">1</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="vi">@isVisible = </span><span class="kc">true</span>
    <span class="vi">@isDraggable = </span><span class="kc">false</span>
    <span class="vi">@currentKey = </span><span class="kc">null</span> <span class="c1"># currently pressed key code</span>
    <span class="vi">@worldCanvas = </span><span class="nx">aCanvas</span></pre></div>             </td>           </tr>                               <tr id="section-502">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-502">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@useFillPage = </span><span class="nx">fillPage</span>
    <span class="vi">@useFillPage = </span><span class="kc">true</span>  <span class="k">if</span> <span class="nx">@useFillPage</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    <span class="vi">@isDevMode = </span><span class="kc">false</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
    <span class="vi">@hand = </span><span class="k">new</span> <span class="nx">HandMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="vi">@keyboardReceiver = </span><span class="kc">null</span>
    <span class="vi">@lastEditedText = </span><span class="kc">null</span>
    <span class="vi">@caret = </span><span class="kc">null</span>
    <span class="vi">@activeMenu = </span><span class="kc">null</span>
    <span class="vi">@activeHandle = </span><span class="kc">null</span>
    <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@initEventListeners</span><span class="p">()</span>
    <span class="vi">@systemTestsRecorderAndPlayer = </span><span class="k">new</span> <span class="nx">SystemTestsRecorderAndPlayer</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">@hand</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-503">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-503">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">brokenFor: </span><span class="nf">(aMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-504">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-504">&#182;</a>               </div>               <p>start off by adding a sequence level record for this combination
and setting the level to 0</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">()</span>
    <span class="nx">@broken</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(rect) -&gt;</span>
      <span class="nx">rect</span><span class="p">.</span><span class="nx">intersects</span> <span class="nx">fb</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-505">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-505">&#182;</a>               </div>               <p>if there is no action pick the best one for the first key
in the sequence</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">recursivelyBlit: </span><span class="nf">(aCanvas, aRect) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-506">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-506">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span></pre></div>             </td>           </tr>                               <tr id="section-507">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-507">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@hand</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span>
  
  <span class="nv">updateBroken: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-508">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-508">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@broken</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(rect) =&gt;</span>
      <span class="nx">@recursivelyBlit</span> <span class="nx">@worldCanvas</span><span class="p">,</span> <span class="nx">rect</span>  <span class="k">if</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">()</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
  
  <span class="nv">doOneCycle: </span><span class="nf">-&gt;</span>
    <span class="nv">WorldMorph.currentTime = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="nx">@runChildrensStepFunction</span><span class="p">()</span>
    <span class="nx">@updateBroken</span><span class="p">()</span>
  
  <span class="nv">fillPage: </span><span class="nf">-&gt;</span>
    <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
    <span class="nv">clientHeight = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
    <span class="nv">clientWidth = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.left = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.x = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.top = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.y = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-509">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-509">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientHeight = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span></pre></div>             </td>           </tr>                               <tr id="section-510">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-510">&#182;</a>               </div>               <p>we should ignore the next key up if the action is key down
or keypress.  this is so if you finish a sequence and
release the key the final key will not trigger a keyup</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientWidth = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">isnt</span> <span class="nx">clientWidth</span>
      <span class="vi">@worldCanvas.width = </span><span class="nx">clientWidth</span>
      <span class="nx">@setWidth</span> <span class="nx">clientWidth</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">isnt</span> <span class="nx">clientHeight</span>
      <span class="vi">@worldCanvas.height = </span><span class="nx">clientHeight</span>
      <span class="nx">@setHeight</span> <span class="nx">clientHeight</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) =&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span>
  
  
  </pre></div>             </td>           </tr>                               <tr id="section-511">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-511">&#182;</a>               </div>               <p>weird race condition if a sequence ends with the key
another sequence begins with</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getGlobalPixelColor: </span><span class="nf">(point) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-512">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-512">&#182;</a>               </div>               <p>loop through keys one at a time and bind the appropriate callback
function.  for any key leading up to the final one it should
increase the sequence. after the final, it should reset all sequences</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dta = </span><span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">dta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-513">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-513">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initVirtualKeyboard: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@virtualKeyboard</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@virtualKeyboard</span>
      <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="k">return</span>  <span class="k">unless</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span>
    <span class="vi">@virtualKeyboard = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)</span>
    <span class="vi">@virtualKeyboard.type = </span><span class="s">&quot;text&quot;</span>
    <span class="vi">@virtualKeyboard.style.color = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@virtualKeyboard.style.backgroundColor = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@virtualKeyboard.style.border = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@virtualKeyboard.style.outline = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@virtualKeyboard.style.position = </span><span class="s">&quot;absolute&quot;</span>
    <span class="vi">@virtualKeyboard.style.top = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.left = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.width = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.height = </span><span class="s">&quot;0px&quot;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@virtualKeyboard</span>

    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-514">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-514">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>

      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-515">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-515">&#182;</a>               </div>               <p>store a direct mapped reference for use with Mousetrap.trigger</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>  </pre></div>             </td>           </tr>                               <tr id="section-516">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-516">&#182;</a>               </div>               <p>make sure multiple spaces in a row become a single space</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-517">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-517">&#182;</a>               </div>               <p>if this pattern is a sequence of keys then run through this method
to reprocess each pattern one key at a time</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-518">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-518">&#182;</a>               </div>               <p>take the keys from this pattern and figure out what the actual
pattern is all about</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>  
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
  
  <span class="nv">initEventListeners: </span><span class="nf">-&gt;</span>
    <span class="nv">canvas = </span><span class="nx">@worldCanvas</span>
    <span class="k">if</span> <span class="nx">@useFillPage</span>
      <span class="nx">@fillPage</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseDown</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchstart&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchStart</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseUp</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchend&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchEnd</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseMove</span>  <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchmove&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchMove</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;contextmenu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-519">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-519">&#182;</a>               </div>               <p>normalize key names</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-520">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-520">&#182;</a>               </div>               <p>if this is not a keypress event then we should
be smart about using shift keys
this will only work for US keyboards however</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-521">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-521">&#182;</a>               </div>               <p>if this key is a modifier then add it to the list of modifiers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-522">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-522">&#182;</a>               </div>               <p>depending on what the key combination is
we will try to pick the best event for it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-523">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-523">&#182;</a>               </div>               <p>make sure to initialize array if this is the first time
a callback is added for this key</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-524">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-524">&#182;</a>               </div>               <p>remove an existing match if there is one</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-525">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-525">&#182;</a>               </div>               <p>add this call back to the array
if it is a sequence put it at the beginning
if not put it at the end</p>

<p>this is important because the way these are processed expects
the sequence ones to come first</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>    
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-526">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-526">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousewheel&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-527">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-527">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;DOMMouseScroll&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-528">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-528">&#182;</a>               </div>               <p>start!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;copy&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="k">if</span> <span class="nx">@caret</span>
        <span class="nv">selectedText = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
          <span class="nv">setStatus = </span><span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span> <span class="nx">selectedText</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span>
          <span class="nv">event.returnValue = </span><span class="kc">false</span>
          <span class="nv">setStatus = </span><span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">setData</span> <span class="s">&quot;Text&quot;</span><span class="p">,</span> <span class="nx">selectedText</span>

    <span class="p">),</span> <span class="kc">false</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;paste&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="k">if</span> <span class="nx">@caret</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span></pre></div>             </td>           </tr>                               <tr id="section-529">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-529">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">text = </span><span class="nx">event</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;text/plain&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-530">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-530">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span></pre></div>             </td>           </tr>                               <tr id="section-531">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-531">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">text = </span><span class="nb">window</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;Text&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-532">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-532">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-533">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-533">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="p">(</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">@caret</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">text</span><span class="p">)),</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="kc">false</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;binding wit mousetrap&quot;</span>
    <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">bind</span> <span class="p">[</span><span class="s">&quot;command+k&quot;</span><span class="p">,</span> <span class="s">&quot;ctrl+k&quot;</span><span class="p">],</span> <span class="nf">(e) =&gt;</span>
      <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">()</span>
      <span class="kc">false</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;dragover&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;drop&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) =&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processDrop</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">=&gt;</span>
      <span class="nx">@fillPage</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@useFillPage</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">onbeforeunload = </span><span class="nf">(evt) -&gt;</span>
      <span class="nv">e = </span><span class="nx">evt</span> <span class="o">or</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span>
      <span class="nv">msg = </span><span class="s">&quot;Are you sure you want to leave?&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-534">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-534">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">e.returnValue = </span><span class="nx">msg</span>  <span class="k">if</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-535">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-535">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">msg</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseDownRight: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickRight: </span><span class="nf">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">wantsDropOf: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-536">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-536">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@acceptsDrops</span>
  
  <span class="nv">droppedImage: </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>

  <span class="nv">droppedSVG: </span><span class="nf">-&gt;</span>
    <span class="kc">null</span>  </pre></div>             </td>           </tr>                               <tr id="section-537">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-537">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">nextTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">next = </span><span class="nx">@nextEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">next</span>
      <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
      <span class="nx">next</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
      <span class="nx">next</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">previousTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">prev = </span><span class="nx">@previousEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">prev</span>
      <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
      <span class="nx">prev</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
      <span class="nx">prev</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">testsList: </span><span class="p">()</span> <span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-538">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-538">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">)).</span><span class="nx">filter</span> <span class="nf">(i) -&gt;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;SystemTest_&quot;</span><span class="p">)</span>
      <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;SystemTest_&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

  <span class="nv">runSystemTests: </span><span class="p">()</span> <span class="nf">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@testsList</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@testsList</span><span class="p">()</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nb">window</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="vi">@systemTestsRecorderAndPlayer.eventQueue = </span><span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">testData</span></pre></div>             </td>           </tr>                               <tr id="section-539">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-539">&#182;</a>               </div>               <p>if the element has the class "mousetrap" then no need to stop</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-540">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-540">&#182;</a>               </div>               <p>stop for input, select, and textarea</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@destroyAll</span><span class="p">()</span>
      <span class="nx">@systemTestsRecorderAndPlayer</span><span class="p">.</span><span class="nx">startPlaying</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-541">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-541">&#182;</a>               </div>               <p>PenMorph ////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">contextMenu: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span>
        <span class="nx">@</span><span class="p">,</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;Morphic&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;demo...&quot;</span><span class="p">,</span> <span class="s">&quot;userCreateMorph&quot;</span><span class="p">,</span> <span class="s">&quot;sample morphs&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide all...&quot;</span><span class="p">,</span> <span class="s">&quot;hideAll&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;delete all...&quot;</span><span class="p">,</span> <span class="s">&quot;destroyAll&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show all...&quot;</span><span class="p">,</span> <span class="s">&quot;showAllHiddens&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect...&quot;</span><span class="p">,</span> <span class="s">&quot;inspect&quot;</span><span class="p">,</span> <span class="s">&quot;open a window on\nall properties&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;restore display&quot;</span><span class="p">,</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span> <span class="s">&quot;redraw the\nscreen once&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;fill page...&quot;</span><span class="p">,</span> <span class="s">&quot;fillPage&quot;</span><span class="p">,</span> <span class="s">&quot;let the World automatically\nadjust to browser resizings&quot;</span>
      <span class="k">if</span> <span class="nx">useBlurredShadows</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sharp shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;sharp drop shadows\nuse for old browsers&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;blurred shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;blurry shades,\n use for new browsers&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
        <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncolor:&quot;</span><span class="p">,</span> <span class="nx">@setColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@color</span>
      <span class="p">),</span> <span class="s">&quot;choose the World&#39;s\nbackground color&quot;</span>
      <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;touch screen settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;bigger menu fonts\nand sliders&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;standard settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;smaller menu fonts\nand sliders&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;run system tests&quot;</span><span class="p">,</span>  <span class="s">&quot;runSystemTests&quot;</span><span class="p">,</span> <span class="s">&quot;runs all the system tests&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;user mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span><span class="p">,</span> <span class="s">&quot;disable developers&#39;\ncontext menus&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;development mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;about morphic.js...&quot;</span><span class="p">,</span> <span class="s">&quot;about&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">userCreateMorph: </span><span class="nf">-&gt;</span>
    <span class="nv">create = </span><span class="nf">(aMorph) =&gt;</span>
      <span class="nv">aMorph.isDraggable = </span><span class="kc">true</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">pickUp</span> <span class="nx">@</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;make a morph&quot;</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;rectangle&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;box&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;circle box&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">CircleBoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;slider&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;frame&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">FrameMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;scroll frame&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
      <span class="nv">newMorph.contents.acceptsDrops = </span><span class="kc">true</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;handle&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;Ich weiß nicht, was soll es bedeuten, dass ich so &quot;</span> <span class="o">+</span>
        <span class="s">&quot;traurig bin, ein Märchen aus uralten Zeiten, das &quot;</span> <span class="o">+</span>
        <span class="s">&quot;kommt mir nicht aus dem Sinn. Die Luft ist kühl &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und es dunkelt, und ruhig fließt der Rhein; der &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Gipfel des Berges funkelt im Abendsonnenschein. &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Die schönste Jungfrau sitzet dort oben wunderbar, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;ihr gold&#39;nes Geschmeide blitzet, sie kämmt ihr &quot;</span> <span class="o">+</span>
        <span class="s">&quot;goldenes Haar, sie kämmt es mit goldenem Kamme, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und singt ein Lied dabei; das hat eine wundersame, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;gewalt&#39;ge Melodei. Den Schiffer im kleinen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Schiffe, ergreift es mit wildem Weh; er schaut &quot;</span> <span class="o">+</span>
        <span class="s">&quot;nicht die Felsenriffe, er schaut nur hinauf in &quot;</span> <span class="o">+</span>
        <span class="s">&quot;die Höh&#39;. Ich glaube, die Wellen verschlingen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;am Ende Schiffer und Kahn, und das hat mit ihrem &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Singen, die Loreley getan.&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nv">newMorph.maxWidth = </span><span class="mi">300</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;speech bubble&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">SpeechBubbleMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;gray scale palette&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">GrayPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color palette&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color picker&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPickerMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sensor demo&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MouseSensorMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nv">newMorph.edge = </span><span class="mi">35</span>
      <span class="nv">newMorph.border = </span><span class="mi">15</span>
      <span class="nv">newMorph.borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nv">newMorph.alpha = </span><span class="mf">0.2</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;animation demo&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">foo = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
      <span class="nv">foo.alpha = </span><span class="mf">0.9</span>
      <span class="nv">foo.speed = </span><span class="mi">3</span>
      <span class="nv">bar = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nv">bar.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">bar.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">bar.alpha = </span><span class="mf">0.9</span>
      <span class="nv">bar.speed = </span><span class="mi">5</span>
      <span class="nv">baz = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
      <span class="nv">baz.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">baz.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">baz.speed = </span><span class="mi">3</span>
      <span class="nv">garply = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">garply.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">garply.direction = </span><span class="s">&quot;up&quot;</span>
      <span class="nv">garply.speed = </span><span class="mi">8</span>
      <span class="nv">fred = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">fred.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">fred.direction = </span><span class="s">&quot;down&quot;</span>
      <span class="nv">fred.speed = </span><span class="mi">4</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">garply</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">baz</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">fred</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">bar</span>
      <span class="nx">create</span> <span class="nx">foo</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pen&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">PenMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;view all...&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MorphsListMorph</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="k">if</span> <span class="nx">@customMorphs</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">@customMorphs</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(morph) -&gt;</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nf">-&gt;</span>
          <span class="nx">create</span> <span class="nx">morph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@</span>
  
  <span class="nv">toggleDevMode: </span><span class="nf">-&gt;</span>
    <span class="vi">@isDevMode = </span><span class="o">not</span> <span class="nx">@isDevMode</span>
  
  <span class="nv">hideAll: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  <span class="nv">showAllHiddens: </span><span class="nf">-&gt;</span>
    <span class="nx">@forAllChildren</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>  <span class="k">unless</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span>
  
  <span class="nv">about: </span><span class="nf">-&gt;</span>
    <span class="nv">versions = </span><span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">module</span> <span class="k">of</span> <span class="nx">modules</span>
      <span class="k">if</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span>
        <span class="nx">versions</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">module</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">modules</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">versions</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
      <span class="nv">versions = </span><span class="s">&quot;\n\nmodules:\n\n&quot;</span> <span class="o">+</span> <span class="s">&quot;morphic (&quot;</span> <span class="o">+</span> <span class="nx">morphicVersion</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="nx">versions</span>  
    <span class="nx">@inform</span> <span class="s">&quot;morphic.js\n\n&quot;</span> <span class="o">+</span>
      <span class="s">&quot;a lively Web GUI\ninspired by Squeak\n&quot;</span> <span class="o">+</span>
      <span class="nx">morphicVersion</span> <span class="o">+</span>
      <span class="s">&quot;\n\original from Jens Mönig&#39;s (jens@moenig.org) morphic.js\n&quot;</span> <span class="o">+</span>
      <span class="s">&quot;\n\nported and extended by Davide Della Casa\n&quot;</span> <span class="o">+</span>
      <span class="nx">versions</span>
  
  <span class="nv">edit: </span><span class="nf">(aStringOrTextMorph) -&gt;</span>
    <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">isEditable</span>
    <span class="nx">@caret</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@caret</span>
    <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@lastEditedText</span>
    <span class="vi">@caret = </span><span class="k">new</span> <span class="nx">CaretMorph</span><span class="p">(</span><span class="nx">aStringOrTextMorph</span><span class="p">)</span>
    <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@caret</span>
    <span class="vi">@keyboardReceiver = </span><span class="nx">@caret</span>
    <span class="nx">@initVirtualKeyboard</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span>
      <span class="vi">@virtualKeyboard.style.top = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="vi">@virtualKeyboard.style.left = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useSliderForInput</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">parentThatIsA</span><span class="p">(</span><span class="nx">MenuMorph</span><span class="p">)</span>
        <span class="nx">@slide</span> <span class="nx">aStringOrTextMorph</span>
  
  <span class="nv">slide: </span><span class="nf">(aStringOrTextMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-542">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-542">&#182;</a>               </div>               <p>I am a simple LOGO-wise turtle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">val = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
    <span class="nv">val = </span><span class="mi">0</span>  <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
    <span class="nv">slider = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="nx">val</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
    <span class="nv">slider.alpha = </span><span class="mi">1</span>
    <span class="nv">slider.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">)</span>
    <span class="nv">slider.button.color = </span><span class="nx">menu</span><span class="p">.</span><span class="nx">borderColor</span>
    <span class="nv">slider.button.highlightColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">highlightColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">100</span>
    <span class="nv">slider.button.pressColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">pressColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">150</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nv">aStringOrTextMorph.text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">escalateEvent</span><span class="p">(</span>
          <span class="s">&#39;reactToSliderEdit&#39;</span><span class="p">,</span>
          <span class="nx">aStringOrTextMorph</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-543">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-543">&#182;</a>               </div>               <p>todo we need to change the size two times, for getting the right size
of the arrow and of the line. Probably should make the two distinct</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slider</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popup</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
  
  <span class="nv">stopEditing: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@caret</span>
      <span class="vi">@lastEditedText = </span><span class="nx">@caret</span><span class="p">.</span><span class="nx">target</span>
      <span class="nx">@caret</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="vi">@caret = </span><span class="kc">null</span>
      <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToEdit&quot;</span><span class="p">,</span> <span class="nx">@lastEditedText</span>
    <span class="vi">@keyboardReceiver = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@virtualKeyboard</span>
      <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">blur</span><span class="p">()</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@virtualKeyboard</span>
      <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
  
  <span class="nv">toggleBlurredShadows: </span><span class="nf">-&gt;</span>
    <span class="nv">useBlurredShadows = </span><span class="o">not</span> <span class="nx">useBlurredShadows</span>
  
  <span class="nv">togglePreferences: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">touchScreenSettings</span>
    <span class="k">else</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">standardSettings</span></pre></div>             </td>           </tr>                               <tr id="section-544">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-544">&#182;</a>               </div>               <p>alert @morphMethod() # works
doesn't work cause coffeescript doesn't support static inheritance
alert @morphStaticMethod()</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-545">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-545">&#182;</a>               </div>               <p>PenMorph updating - optimized for warping, i.e atomic recursion</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SliderMorph</span> <span class="k">extends</span> <span class="nx">CircleBoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">action: </span><span class="kc">null</span>
  <span class="nv">start: </span><span class="kc">null</span>
  <span class="nv">stop: </span><span class="kc">null</span>
  <span class="nv">value: </span><span class="kc">null</span>
  <span class="nv">size: </span><span class="kc">null</span>
  <span class="nv">offset: </span><span class="kc">null</span>
  <span class="nv">button: </span><span class="kc">null</span>
  <span class="nv">step: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@start = 1, @stop = 100, @value = 50, @size = 10, orientation, color) -&gt;</span>
    <span class="vi">@button = </span><span class="k">new</span> <span class="nx">SliderButtonMorph</span><span class="p">()</span>
    <span class="vi">@button.isDraggable = </span><span class="kc">false</span>
    <span class="vi">@button.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="vi">@button.highlightColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@button.pressColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="k">super</span> <span class="nx">orientation</span> <span class="c1"># if null, then a vertical one will be created</span>
    <span class="nx">@add</span> <span class="nx">@button</span>
    <span class="vi">@alpha = </span><span class="mf">0.3</span>
    <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-546">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-546">&#182;</a>               </div>               <p>PenMorph display:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">autoOrientation: </span><span class="nf">-&gt;</span>
      <span class="nx">noOperation</span>
  
  <span class="nv">rangeSize: </span><span class="nf">-&gt;</span>
    <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span>
  
  <span class="nv">ratio: </span><span class="nf">-&gt;</span>
    <span class="nx">@size</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>
  
  <span class="nv">unitSize: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
    <span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>
  
  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@button.orientation = </span><span class="nx">@orientation</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">bw = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
      <span class="nv">bh = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@ratio</span><span class="p">()))</span>
      <span class="nx">@button</span><span class="p">.</span><span class="nx">silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nx">bh</span><span class="p">)</span>
      <span class="nv">posX = </span><span class="mi">1</span>
      <span class="nv">posY = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">@value</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@unitSize</span><span class="p">()),</span>
        <span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="k">else</span>
      <span class="nv">bh = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
      <span class="nv">bw = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bh</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@ratio</span><span class="p">()))</span>
      <span class="nx">@button</span><span class="p">.</span><span class="nx">silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nx">bh</span><span class="p">)</span>
      <span class="nv">posY = </span><span class="mi">1</span>
      <span class="nv">posX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">@value</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@unitSize</span><span class="p">()),</span>
        <span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">posX</span><span class="p">,</span> <span class="nx">posY</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  <span class="nv">updateValue: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">relPos = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">relPos = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">relPos</span> <span class="o">/</span> <span class="nx">@unitSize</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">updateTarget: </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">@action</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@action</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
        <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@target</span><span class="p">,</span> <span class="nx">@value</span>
      <span class="k">else</span> <span class="c1"># assume it&#39;s a String</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@action</span><span class="p">]</span> <span class="nx">@value</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-547">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-547">&#182;</a>               </div>               <p>my orientation can be overridden with the "facing" parameter to
   implement Scratch-style rotation styles</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-548">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-548">&#182;</a>               </div>               <p>PenMorph access:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nv">c.button = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@button</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">button</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@button</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-549">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-549">&#182;</a>               </div>               <p>PenMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show value...&quot;</span><span class="p">,</span> <span class="s">&quot;showValue&quot;</span><span class="p">,</span> <span class="s">&quot;display a dialog box\nshowing the selected number&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;floor...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfloor:&quot;</span><span class="p">,</span>
        <span class="nx">@setStart</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the minimum value\nwhich can be selected&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;ceiling...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nceiling:&quot;</span><span class="p">,</span>
        <span class="nx">@setStop</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@stop</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">,</span>
        <span class="nx">@size</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the maximum value\nwhich can be selected&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;button size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nbutton size:&quot;</span><span class="p">,</span>
        <span class="nx">@setSize</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@size</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the range\ncovered by\nthe slider button&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;set target&quot;</span><span class="p">,</span> <span class="s">&quot;setTarget&quot;</span><span class="p">,</span> <span class="s">&quot;select another morph\nwhose numerical property\nwill be &quot;</span> <span class="o">+</span> <span class="s">&quot;controlled by this one&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">showValue: </span><span class="nf">-&gt;</span>
    <span class="nx">@inform</span> <span class="nx">@value</span>
  
  <span class="nv">userSetStart: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-550">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-550">&#182;</a>               </div>               <p>PenMorph turtle ops:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">@stop</span><span class="p">)</span>
  
  <span class="nv">setStart: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-551">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-551">&#182;</a>               </div>               <p>PenMorph optimization for atomic recursion:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newStart = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newStart</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setStop: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-552">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-552">&#182;</a>               </div>               <p>PenMorph demo ops:
try these with WARP eg.: this.warp(function () {tree(12, 120, 20)})</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newStop = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newStop</span><span class="p">,</span> <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">)</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newStop</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@stop</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSize: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-553">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-553">&#182;</a>               </div>               <p>Points //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@size = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@size = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span>  <span class="k">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setTarget: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@setTargetSetter</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-554">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-554">&#182;</a>               </div>               <p>Point string representation: e.g. '12@68'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@target = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span>
  
  <span class="nv">setTargetSetter: </span><span class="nf">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">numericalSetters</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target property:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) =&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@action = </span><span class="nx">each</span></pre></div>             </td>           </tr>                               <tr id="section-555">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-555">&#182;</a>               </div>               <p>Point copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@action = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span>
  
  <span class="nv">numericalSetters: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-556">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-556">&#182;</a>               </div>               <p>Point comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;setStart&quot;</span><span class="p">,</span> <span class="s">&quot;setStop&quot;</span><span class="p">,</span> <span class="s">&quot;setSize&quot;</span>
    <span class="nx">list</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-557">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-557">&#182;</a>               </div>               <p>==</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">unless</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
      <span class="vi">@offset = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">()</span> <span class="c1"># return null;</span>
    <span class="k">else</span>
      <span class="vi">@offset = </span><span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-558">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-558">&#182;</a>               </div>               <p>&lt;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span>
        <span class="nv">mousePos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
        <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
          <span class="nv">newX = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span>
          <span class="nv">newY = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
            <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@offset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
            <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">()),</span> <span class="nx">@top</span><span class="p">())</span>
        <span class="k">else</span>
          <span class="nv">newY = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span>
          <span class="nv">newX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
            <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
            <span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">()),</span> <span class="nx">@left</span><span class="p">())</span>
        <span class="nx">@button</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">newX</span><span class="p">,</span> <span class="nx">newY</span><span class="p">)</span>
        <span class="nx">@updateValue</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-559">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-559">&#182;</a>               </div>               <p>></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-560">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-560">&#182;</a>               </div>               <blockquote>
  <p>=</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MenuItemMorph</span> <span class="k">extends</span> <span class="nx">TriggerMorph</span></pre></div>             </td>           </tr>                               <tr id="section-561">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-561">&#182;</a>               </div>               <p>&lt;=</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(target, action, labelString, fontSize, fontStyle, environment, hint, color) -&gt;</span>
    <span class="k">super</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">labelString</span><span class="p">,</span> <span class="nx">fontSize</span><span class="p">,</span> <span class="nx">fontStyle</span><span class="p">,</span> <span class="nx">environment</span><span class="p">,</span> <span class="nx">hint</span><span class="p">,</span> <span class="nx">color</span>
  
  <span class="nv">createLabel: </span><span class="nf">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span>

    <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">@labelString</span><span class="p">)</span>
      <span class="vi">@label = </span><span class="nx">@createLabelString</span><span class="p">(</span><span class="nx">@labelString</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@labelString</span> <span class="k">instanceof</span> <span class="nb">Array</span>      </pre></div>             </td>           </tr>                               <tr id="section-562">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-562">&#182;</a>               </div>               <p>Point conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@label = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
      <span class="vi">@label.alpha = </span><span class="mi">0</span> <span class="c1"># transparent</span>
      <span class="nx">@label</span><span class="p">.</span><span class="nx">add</span> <span class="nv">icon = </span><span class="nx">@createIcon</span><span class="p">(</span><span class="nx">@labelString</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nx">@label</span><span class="p">.</span><span class="nx">add</span> <span class="nv">lbl = </span><span class="nx">@createLabelString</span><span class="p">(</span><span class="nx">@labelString</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="nx">lbl</span><span class="p">.</span><span class="nx">setCenter</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">center</span><span class="p">()</span>
      <span class="nx">lbl</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
      <span class="vi">@label.bounds = </span><span class="p">(</span><span class="nx">icon</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">lbl</span><span class="p">.</span><span class="nx">bounds</span><span class="p">))</span>
      <span class="nx">@label</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="k">else</span> <span class="c1"># assume it&#39;s either a Morph or a Canvas</span>
      <span class="vi">@label = </span><span class="nx">@createIcon</span><span class="p">(</span><span class="nx">@labelString</span><span class="p">)</span>
  
    <span class="nx">@silentSetExtent</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">np = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="vi">@label.bounds = </span><span class="nx">np</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="nx">@label</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nx">@add</span> <span class="nx">@label</span>
  
  <span class="nv">createIcon: </span><span class="nf">(source) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-563">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-563">&#182;</a>               </div>               <p>Point arithmetic:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">icon = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
    <span class="nv">icon.image = </span><span class="p">(</span><span class="k">if</span> <span class="nx">source</span> <span class="k">instanceof</span> <span class="nx">Morph</span> <span class="k">then</span> <span class="nx">source</span><span class="p">.</span><span class="nx">fullImage</span><span class="p">()</span> <span class="k">else</span> <span class="nx">source</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-564">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-564">&#182;</a>               </div>               <p>Point polar coordinates:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">source</span> <span class="k">instanceof</span> <span class="nx">Morph</span> <span class="o">and</span> <span class="nx">source</span><span class="p">.</span><span class="nx">getShadow</span><span class="p">()</span>
      <span class="nv">src = </span><span class="nx">icon</span><span class="p">.</span><span class="nx">image</span>
      <span class="nv">icon.image = </span><span class="nx">newCanvas</span><span class="p">(</span>
        <span class="nx">source</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">().</span><span class="nx">extent</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span>
          <span class="nx">@shadowBlur</span> <span class="o">*</span> <span class="p">((</span><span class="k">if</span> <span class="nx">useBlurredShadows</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span><span class="p">))))</span>
      <span class="nx">icon</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">drawImage</span> <span class="nx">src</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="nx">icon</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">width</span>
    <span class="nx">icon</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">height</span>
    <span class="nx">icon</span>

  <span class="nv">createLabelString: </span><span class="nf">(string) -&gt;</span>
    <span class="nv">lbl = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">,</span> <span class="nx">@fontStyle</span><span class="p">)</span>
    <span class="nx">lbl</span><span class="p">.</span><span class="nx">setColor</span> <span class="nx">@labelColor</span>
    <span class="nx">lbl</span>  </pre></div>             </td>           </tr>                               <tr id="section-565">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-565">&#182;</a>               </div>               <p>answer the angle I make with origin in degrees.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="nf">-&gt;</span>
    <span class="k">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="vi">@image = </span><span class="nx">@highlightImage</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@bubbleHelp</span> <span class="nx">@hint</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseLeave: </span><span class="nf">-&gt;</span>
    <span class="k">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="vi">@image = </span><span class="nx">@normalImage</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">unselectAllItems</span><span class="p">()</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseDownLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
    <span class="vi">@image = </span><span class="nx">@pressImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseMove: </span><span class="nf">-&gt;</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseMove&quot;</span>  <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">-&gt;</span>
    <span class="k">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="nx">@root</span><span class="p">().</span><span class="nv">activeMenu = </span><span class="kc">null</span>
    <span class="nx">@trigger</span><span class="p">()</span>
  
  <span class="nv">isListItem: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">isListContents</span>  <span class="k">if</span> <span class="nx">@parent</span>
    <span class="kc">false</span>
  
  <span class="nv">isSelectedListItem: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="nx">@image</span> <span class="o">is</span> <span class="nx">@pressImage</span>  <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
    <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-566">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-566">&#182;</a>               </div>               <p>answer the angle I make with origin in radians.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-567">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-567">&#182;</a>               </div>               <p>Point functions:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SpeechBubbleMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">isPointingRight: </span><span class="kc">true</span> <span class="c1"># orientation of text</span>
  <span class="nv">contents: </span><span class="kc">null</span>
  <span class="nv">padding: </span><span class="kc">null</span> <span class="c1"># additional vertical pixels</span>
  <span class="nv">isThought: </span><span class="kc">null</span> <span class="c1"># draw &quot;think&quot; bubble</span>
  <span class="nv">isClickable: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">    @contents=&quot;&quot;,</span>
<span class="nf">    color,</span>
<span class="nf">    edge,</span>
<span class="nf">    border,</span>
<span class="nf">    borderColor,</span>
<span class="nf">    @padding = 0,</span>
<span class="nf">    @isThought = false) -&gt;</span>
      <span class="k">super</span> <span class="nx">edge</span> <span class="o">or</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">border</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)),</span> <span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-568">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-568">&#182;</a>               </div>               <p>direction must be 'right', 'left' or 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">popUp: </span><span class="nf">(world, pos, isClickable) -&gt;</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span>
    <span class="nx">@keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">temporaries</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@</span>
    <span class="k">if</span> <span class="nx">isClickable</span>
      <span class="vi">@mouseEnter = </span><span class="nf">-&gt;</span>
        <span class="nx">@destroy</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="vi">@isClickable = </span><span class="kc">false</span>
    
  
  </pre></div>             </td>           </tr>                               <tr id="section-569">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-569">&#182;</a>               </div>               <p>direction === 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">updateRendering: </span><span class="nf">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-570">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-570">&#182;</a>               </div>               <p>direction must be 'vertical' or 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@contentsMorph</span>
    <span class="k">if</span> <span class="nx">@contents</span> <span class="k">instanceof</span> <span class="nx">Morph</span>
      <span class="vi">@contentsMorph = </span><span class="nx">@contents</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">@contents</span><span class="p">)</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span>
        <span class="nx">@contents</span><span class="p">,</span>
        <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">bubbleHelpFontSize</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="kc">true</span><span class="p">,</span>
        <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@contents</span> <span class="k">instanceof</span> <span class="nx">HTMLCanvasElement</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
      <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span>
      <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span>
      <span class="vi">@contentsMorph.image = </span><span class="nx">@contents</span>
    <span class="k">else</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span>
        <span class="nx">@contents</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">bubbleHelpFontSize</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="kc">true</span><span class="p">,</span>
        <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@contentsMorph</span></pre></div>             </td>           </tr>                               <tr id="section-571">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-571">&#182;</a>               </div>               <p>direction === 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@silentSetWidth</span> <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@padding</span> <span class="k">then</span> <span class="nx">@padding</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">else</span> <span class="nx">@edge</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nx">@silentSetHeight</span> <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span> <span class="o">+</span> <span class="nx">@border</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">@padding</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-572">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-572">&#182;</a>               </div>               <p>Point transforming:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-573">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-573">&#182;</a>               </div>               <p>Point conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span>
      <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@padding</span> <span class="o">or</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@border</span> <span class="o">+</span> <span class="nx">@padding</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
  
  <span class="nv">outlinePath: </span><span class="nf">(context, radius, inset) -&gt;</span>
    <span class="nv">circle = </span><span class="nf">(x, y, r) -&gt;</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
    <span class="nv">offset = </span><span class="nx">radius</span> <span class="o">+</span> <span class="nx">inset</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-574">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-574">&#182;</a>               </div>               <p>creating Rectangle instances from Points:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-575">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-575">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-576">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-576">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span>
    <span class="k">unless</span> <span class="nx">@isThought</span> <span class="c1"># draw speech bubble hook</span>
      <span class="k">if</span> <span class="nx">@isPointingRight</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">radius</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">inset</span>
      <span class="k">else</span> <span class="c1"># pointing left</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">inset</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span></pre></div>             </td>           </tr>                               <tr id="section-577">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-577">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">),</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="nx">@isThought</span></pre></div>             </td>           </tr>                               <tr id="section-578">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-578">&#182;</a>               </div>               <p>CircleBoxMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">offset</span></pre></div>             </td>           </tr>                               <tr id="section-579">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-579">&#182;</a>               </div>               <p>I can be used for sliders</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@isPointingRight</span></pre></div>             </td>           </tr>                               <tr id="section-580">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-580">&#182;</a>               </div>               <p>CircleBoxMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-581">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-581">&#182;</a>               </div>               <p>Global settings /////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">3.2</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-582">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-582">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">2.8</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">rad</span>
      <span class="k">else</span> <span class="c1"># pointing left</span></pre></div>             </td>           </tr>                               <tr id="section-583">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-583">&#182;</a>               </div>               <p>global window, HTMLCanvasElement, getMinimumFontHeight, FileReader, Audio,
FileList, getBlurredShadowSupport</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-584">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-584">&#182;</a>               </div>               <p>Rectangles //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">3.2</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-585">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-585">&#182;</a>               </div>               <p>Rectangle string representation: e.g. '[0@0 | 160@80]'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">2.8</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-586">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-586">&#182;</a>               </div>               <p>Rectangle copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shadowImage: </span><span class="nf">(off_, color) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-587">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-587">&#182;</a>               </div>               <p>Rectangle accessing - setting:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="kc">undefined</span>
    <span class="nv">img = </span><span class="kc">undefined</span>
    <span class="nv">outline = </span><span class="kc">undefined</span>
    <span class="nv">sha = </span><span class="kc">undefined</span>
    <span class="nv">ctx = </span><span class="kc">undefined</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">@image</span>
    <span class="nv">outline = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">outline</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">outline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;source-atop&quot;</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">sha</span>

  <span class="nv">shadowImageBlurred: </span><span class="nf">(off_, color) -&gt;</span>
    <span class="nv">fb = </span><span class="kc">undefined</span>
    <span class="nv">img = </span><span class="kc">undefined</span>
    <span class="nv">sha = </span><span class="kc">undefined</span>
    <span class="nv">ctx = </span><span class="kc">undefined</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">blur = </span><span class="nx">@shadowBlur</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">blur</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nv">img = </span><span class="nx">@image</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">ctx.shadowBlur = </span><span class="nx">blur</span>
    <span class="nv">ctx.shadowColor = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowBlur = </span><span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">sha</span></pre></div>             </td>           </tr>                               <tr id="section-588">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-588">&#182;</a>               </div>               <p>note: all inputs are optional and can be omitted</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fixLayout: </span><span class="nf">-&gt;</span>
    <span class="nx">@removeShadow</span><span class="p">()</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span></pre></div>             </td>           </tr>                               <tr id="section-589">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-589">&#182;</a>               </div>               <p>Rectangle accessing - getting:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ListMorph</span> <span class="k">extends</span> <span class="nx">ScrollFrameMorph</span>
  
  <span class="nv">elements: </span><span class="kc">null</span>
  <span class="nv">labelGetter: </span><span class="kc">null</span>
  <span class="nv">format: </span><span class="kc">null</span>
  <span class="nv">listContents: </span><span class="kc">null</span>
  <span class="nv">selected: </span><span class="kc">null</span>
  <span class="nv">action: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@elements = [], labelGetter, @format = []) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-590">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-590">&#182;</a>               </div>               <p>requires width() and height() to be defined</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@contents.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@vBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@labelGetter = </span><span class="nx">labelGetter</span> <span class="o">or</span> <span class="nf">(element) -&gt;</span>
        <span class="k">return</span> <span class="nx">element</span>  <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">toSource</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="nx">toSource</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">@buildListContents</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-591">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-591">&#182;</a>               </div>               <p>The subtract method creates a new Point</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">buildListContents: </span><span class="nf">-&gt;</span>
    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@listContents</span>
    <span class="vi">@listContents = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@select</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
    <span class="vi">@elements = </span><span class="p">[</span><span class="s">&quot;(empty)&quot;</span><span class="p">]</span>  <span class="k">if</span> <span class="o">!</span><span class="nx">@elements</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@elements</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(element) =&gt;</span>
      <span class="nv">color = </span><span class="kc">null</span>
      <span class="nx">@format</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(pair) -&gt;</span>
        <span class="nv">color = </span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-592">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-592">&#182;</a>               </div>               <p>The subtract method creates a new Point</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">@labelGetter</span><span class="p">(</span><span class="nx">element</span><span class="p">),</span> <span class="nx">element</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">color</span></pre></div>             </td>           </tr>                               <tr id="section-593">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-593">&#182;</a>               </div>               <p>Rectangle comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
    <span class="vi">@listContents.isListContents = </span><span class="kc">true</span>
    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">updateRendering</span><span class="p">()</span>
    <span class="nx">@addContents</span> <span class="nx">@listContents</span>
  
  <span class="nv">select: </span><span class="nf">(item) -&gt;</span>
    <span class="vi">@selected = </span><span class="nx">item</span>
    <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">item</span>  <span class="k">if</span> <span class="nx">@action</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">lb = </span><span class="nx">@listContents</span><span class="p">.</span><span class="nx">bounds</span>
    <span class="nv">nb = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">corner</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">and</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">and</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
<span class="nv">morphicVersion = </span><span class="s">&quot;2012-October-22&quot;</span>

</pre></div>             </td>           </tr>                               <tr id="section-594">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-594">&#182;</a>               </div>               <p>Rectangle functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-595">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-595">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-596">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-596">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-597">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-597">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-598">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-598">&#182;</a>               </div>               <p>round me by applying floor() to my origin and ceil() to my corner</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-599">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-599">&#182;</a>               </div>               <p>Answer a Point, delta, such that self + delta is forced within
   aRectangle. when all of me cannot be made to fit, prefer to keep
   my topLeft inside. Taken from Squeak.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-600">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-600">&#182;</a>               </div>               <p>Rectangle testing:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-601">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-601">&#182;</a>               </div>               <p>Rectangle transforming:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-602">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-602">&#182;</a>               </div>               <p>scale can be either a Point or a scalar</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-603">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-603">&#182;</a>               </div>               <p>factor can be either a Point or a scalar</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-604">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-604">&#182;</a>               </div>               <p>Rectangle converting:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-605">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-605">&#182;</a>               </div>               <p>SliderButtonMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-606">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-606">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-607">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-607">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-608">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-608">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-609">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-609">&#182;</a>               </div>               <p>SliderButtonMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-610">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-610">&#182;</a>               </div>               <p>prevent my parent from getting picked up</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-611">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-611">&#182;</a>               </div>               <p>TriggerMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-612">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-612">&#182;</a>               </div>               <p>I provide basic button functionality</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-613">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-613">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-614">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-614">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-615">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-615">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-616">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-616">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-617">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-617">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-618">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-618">&#182;</a>               </div>               <p>TriggerMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-619">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-619">&#182;</a>               </div>               <p>bold
italic
numeric
shadow offset
shadow color</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-620">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-620">&#182;</a>               </div>               <p>TriggerMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-621">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-621">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-622">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-622">&#182;</a>               </div>               <p>TriggerMorph action:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-623">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-623">&#182;</a>               </div>               <p>if target is a function, use it as callback:
execute target as callback function with action as argument
in the environment as optionally specified.
Note: if action is also a function, instead of becoming
the argument itself it will be called to answer the argument.
for selections, Yes/No Choices etc:</p>

<p>else (if target is not a function):</p>

<pre><code>if action is a function:
execute the action with target as environment (can be null)
for lambdafied (inline) actions

else if action is a String:
treat it as function property of target and execute it
for selector-like actions
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-624">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-624">&#182;</a>               </div>               <p>TriggerMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-625">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-625">&#182;</a>               </div>               <p>TriggerMorph bubble help:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-626">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-626">&#182;</a>               </div>               <p>WorldMorph //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-627">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-627">&#182;</a>               </div>               <p>these comments below needed to figure our dependencies between classes
REQUIRES globalFunctions
REQUIRES globalSettings</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-628">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-628">&#182;</a>               </div>               <p>I represent the <canvas> element</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-629">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-629">&#182;</a>               </div>               <p>these variables shouldn't be static to the WorldMorph, because
in pure theory you could have multiple worlds in the same
page with different settings
(but anyways, it was global before, so it's not any worse than before)</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-630">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-630">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-631">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-631">&#182;</a>               </div>               <p>World Morph display:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-632">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-632">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-633">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-633">&#182;</a>               </div>               <p>all fullDraws result into actual blittings of images done
by the blit function.
The blit function is defined in Morph and is not overriden by
any morph.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-634">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-634">&#182;</a>               </div>               <p>invokes the Morph's recursivelyBlit, which has only two implementations:
the default one by Morph which just invokes the blit of all children
and the interesting one in FrameMorph which </p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-635">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-635">&#182;</a>               </div>               <p>the mouse cursor is always drawn on top of everything
and it'd not attached to the WorldMorph.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-636">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-636">&#182;</a>               </div>               <p>console.log "number of broken rectangles: " + @broken.length</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-637">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-637">&#182;</a>               </div>               <p>scrolled down b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-638">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-638">&#182;</a>               </div>               <p>scrolled left b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-639">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-639">&#182;</a>               </div>               <p>WorldMorph global pixel access:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-640">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-640">&#182;</a>               </div>               <p>answer the color at the given point.</p>

<p>Note: for some strange reason this method works fine if the page is
opened via HTTP, but <em>not</em>, if it is opened from a local uri
(e.g. from a directory), in which case it's always null.</p>

<p>This behavior is consistent throughout several browsers. I have no
clue what's behind this, apparently the imageData attribute of
canvas context only gets filled with meaningful data if transferred
via HTTP ???</p>

<p>This is somewhat of a showstopper for color detection in a planned
offline version of Snap.</p>

<p>The issue has also been discussed at: (join lines before pasting)
http://stackoverflow.com/questions/4069400/
canvas-getimagedata-doesnt-work-when-running-locally-on-windows-
security-excep</p>

<p>The suggestion solution appears to work, since the settings are
applied globally.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-641">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-641">&#182;</a>               </div>               <p>WorldMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-642">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-642">&#182;</a>               </div>               <p>remember the keyCode in the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-643">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-643">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-644">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-644">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-645">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-645">&#182;</a>               </div>               <p>flush the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-646">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-646">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-647">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-647">&#182;</a>               </div>               <p>suppress context menu for Mac-Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-648">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-648">&#182;</a>               </div>               <p>remember the keyCode in the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-649">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-649">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-650">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-650">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-651">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-651">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-652">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-652">&#182;</a>               </div>               <p>flush the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-653">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-653">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-654">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-654">&#182;</a>               </div>               <p>Safari, Chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-655">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-655">&#182;</a>               </div>               <p>Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-656">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-656">&#182;</a>               </div>               <p>snippets of clipboard-handling code taken from
http://codebits.glennjones.net/editing/setclipboarddata.htm
Note that this works only in Chrome. Firefox and Safari need a piece of
text to be selected in order to even trigger the copy event. Chrome does
enable clipboard access instead even if nothing is selected.
There are a couple of solutions to this - one is to keep a hidden textfield that
handles all copy/paste operations.
Another one is to not use a clipboard, but rather an internal string as
local memory. So the OS clipboard wouldn't be used, but at least there would
be some copy/paste working. Also one would need to intercept the copy/paste
key combinations manually instead of from the copy/paste events.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-657">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-657">&#182;</a>               </div>               <p>Look for access to data if types array is missing</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-658">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-658">&#182;</a>               </div>               <p>url = event.clipboardData.getData("text/uri-list")
html = event.clipboardData.getData("text/html")
custom = event.clipboardData.getData("text/xcustom")
IE event is attached to the window object</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-659">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-659">&#182;</a>               </div>               <p>The schema is fixed</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-660">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-660">&#182;</a>               </div>               <p>url = window.clipboardData.getData("URL")</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-661">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-661">&#182;</a>               </div>               <p>Needs a few msec to excute paste</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-662">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-662">&#182;</a>               </div>               <p>For IE and Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-663">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-663">&#182;</a>               </div>               <p>For Safari / chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-664">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-664">&#182;</a>               </div>               <p>allow handle drops if any drops are allowed</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-665">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-665">&#182;</a>               </div>               <p>WorldMorph text field tabbing:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-666">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-666">&#182;</a>               </div>               <p>Check which objects have the right name start</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-667">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-667">&#182;</a>               </div>               <p>the Zombie kernel safari pop-up is painted weird, needs a refresh
for some unknown reason</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-668">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-668">&#182;</a>               </div>               <p>start from clean slate</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-669">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-669">&#182;</a>               </div>               <p>WorldMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-670">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-670">&#182;</a>               </div>               <p>display a slider for numeric text entries</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-671">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-671">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-672">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-672">&#182;</a>               </div>               <p>SliderMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-673">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-673">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-674">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-674">&#182;</a>               </div>               <p>this.updateRendering();</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-675">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-675">&#182;</a>               </div>               <p>SliderMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-676">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-676">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-677">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-677">&#182;</a>               </div>               <p>SliderMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-678">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-678">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-679">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-679">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-680">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-680">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-681">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-681">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-682">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-682">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-683">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-683">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-684">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-684">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-685">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-685">&#182;</a>               </div>               <p>SliderMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-686">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-686">&#182;</a>               </div>               <p>this is to create the "drag the slider" effect
basically if the mouse is pressing within the boundaries
then in the next step you remember to check again where the mouse
is and update the scrollbar. As soon as the mouse is unpressed
then the step function is set to null to save cycles.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-687">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-687">&#182;</a>               </div>               <p>MenuItemMorph ///////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-688">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-688">&#182;</a>               </div>               <p>I automatically determine my bounds</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-689">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-689">&#182;</a>               </div>               <p>labelString can also be a Morph or a Canvas or a tuple: [icon, string]</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-690">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-690">&#182;</a>               </div>               <p>assume its pattern is: [icon, string] </p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-691">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-691">&#182;</a>               </div>               <p>source can be either a Morph or an HTMLCanvasElement</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-692">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-692">&#182;</a>               </div>               <p>adjust shadow dimensions</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-693">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-693">&#182;</a>               </div>               <p>MenuItemMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-694">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-694">&#182;</a>               </div>               <p>SpeechBubbleMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-695">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-695">&#182;</a>               </div>               <p>I am a comic-style speech bubble that can display either a string,
a Morph, a Canvas or a toString() representation of anything else.
If I am invoked using popUp() I behave like a tool tip.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-696">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-696">&#182;</a>               </div>               <p>SpeechBubbleMorph invoking:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-697">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-697">&#182;</a>               </div>               <p>SpeechBubbleMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-698">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-698">&#182;</a>               </div>               <p>re-build my contents</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-699">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-699">&#182;</a>               </div>               <p>adjust my layout</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-700">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-700">&#182;</a>               </div>               <p>draw my outline</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-701">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-701">&#182;</a>               </div>               <p>position my contents</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-702">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-702">&#182;</a>               </div>               <p>top left:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-703">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-703">&#182;</a>               </div>               <p>top right:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-704">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-704">&#182;</a>               </div>               <p>bottom right:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-705">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-705">&#182;</a>               </div>               <p>bottom left:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-706">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-706">&#182;</a>               </div>               <p>close large bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-707">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-707">&#182;</a>               </div>               <p>draw thought bubbles:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-708">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-708">&#182;</a>               </div>               <p>tip bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-709">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-709">&#182;</a>               </div>               <p>middle bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-710">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-710">&#182;</a>               </div>               <p>top bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-711">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-711">&#182;</a>               </div>               <p>tip bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-712">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-712">&#182;</a>               </div>               <p>middle bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-713">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-713">&#182;</a>               </div>               <p>top bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-714">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-714">&#182;</a>               </div>               <p>SpeechBubbleMorph shadow</p>

<p>only take the 'plain' image, so the box rounding and the
   shadow doesn't become conflicted by embedded scrolling panes</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-715">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-715">&#182;</a>               </div>               <p>fallback for Windows Chrome-Shadow bug</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-716">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-716">&#182;</a>               </div>               <p>SpeechBubbleMorph resizing</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-717">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-717">&#182;</a>               </div>               <p>ListMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-718">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-718">&#182;</a>               </div>               <p>passing a format is optional. If the format parameter is specified
   it has to be of the following pattern:</p>

<pre><code>   [
       [&lt;color&gt;, &lt;single-argument predicate&gt;],
       ...
   ]
</code></pre>

<p>multiple color conditions can be passed in such a format list, the
   last predicate to evaluate true when given the list element sets
   the given color. If no condition is met, the default color (black)
   will be assigned.</p>

<p>An example of how to use fomats can be found in the InspectorMorph's
   "markOwnProperties" mechanism.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-719">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-719">&#182;</a>               </div>               <p>it's important to leave the step as the default noOperation
instead of null because the scrollbars (inherited from scrollframe)
need the step function to react to mouse drag.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-720">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-720">&#182;</a>               </div>               <p>label string
action
hint</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-721">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-721">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 