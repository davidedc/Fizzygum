<!DOCTYPE html>  <html> <head>   <title>morphee-coffee.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               morphee-coffee.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Rectangles //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Rectangle</span>

  <span class="nv">origin: </span><span class="kc">null</span>
  <span class="nv">corner: </span><span class="kc">null</span>
  
  <span class="nv">constructor: </span><span class="nf">(left, top, right, bottom) -&gt;</span>
    
    <span class="vi">@origin = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">((</span><span class="nx">left</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="nx">top</span> <span class="o">or</span> <span class="mi">0</span><span class="p">))</span>
    <span class="vi">@corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">((</span><span class="nx">right</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">or</span> <span class="mi">0</span><span class="p">))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Rectangle string representation: e.g. '[0@0 | 160@80]'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; | &quot;</span> <span class="o">+</span> <span class="nx">@extent</span><span class="p">().</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Rectangle copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">(),</span> <span class="nx">@right</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">())</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Rectangle accessing - setting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setTo: </span><span class="nf">(left, top, right, bottom) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>note: all inputs are optional and can be omitted</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@origin = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">left</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@left</span><span class="p">())),</span>
      <span class="nx">top</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">top</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@top</span><span class="p">())))</span>
    <span class="vi">@corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">right</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">right</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@right</span><span class="p">())),</span>
      <span class="nx">bottom</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@bottom</span><span class="p">())))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Rectangle accessing - getting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">area: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>requires width() and height() to be defined</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>  <span class="k">if</span> <span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">w</span> <span class="o">*</span> <span class="nx">@height</span><span class="p">(),</span> <span class="mi">0</span>
  
  <span class="nv">bottom: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">bottomCenter: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@center</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@bottom</span><span class="p">())</span>
  
  <span class="nv">bottomLeft: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@origin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">bottomRight: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
  
  <span class="nv">boundingBox: </span><span class="o">-&gt;</span>
    <span class="nx">@</span>
  
  <span class="nv">center: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@origin</span><span class="p">).</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  
  <span class="nv">corners: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">@origin</span><span class="p">,</span> <span class="nx">@bottomLeft</span><span class="p">(),</span> <span class="nx">@corner</span><span class="p">,</span> <span class="nx">@topRight</span><span class="p">()]</span>
  
  <span class="nv">extent: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">subtract</span> <span class="nx">@origin</span>
  
  <span class="nv">height: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">left: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">leftCenter: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@center</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">right: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">rightCenter: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">(),</span> <span class="nx">@center</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">top: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">topCenter: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@center</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">())</span>
  
  <span class="nv">topLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span>
  
  <span class="nv">topRight: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@corner</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">width: </span><span class="o">-&gt;</span>
    <span class="nx">@corner</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">position: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Rectangle comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eq: </span><span class="nf">(aRect) -&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">corner</span><span class="p">)</span>
  
  <span class="nv">abs: </span><span class="o">-&gt;</span>
    <span class="nv">newOrigin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">abs</span><span class="p">()</span>
    <span class="nv">newCorner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newOrigin</span><span class="p">)</span>
    <span class="nx">newOrigin</span><span class="p">.</span><span class="nx">corner</span> <span class="nx">newCorner</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Rectangle functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">insetBy: </span><span class="nf">(delta) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
    <span class="nv">result.origin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nv">result.corner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">result</span>
  
  <span class="nv">expandBy: </span><span class="nf">(delta) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
    <span class="nv">result.origin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nv">result.corner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">result</span>
  
  <span class="nv">growBy: </span><span class="nf">(delta) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>delta can be either a Point or a Number</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
    <span class="nv">result.origin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">result.corner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">result</span>
  
  <span class="nv">intersect: </span><span class="nf">(aRect) -&gt;</span>
    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
    <span class="nv">result.origin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">result.corner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">corner</span><span class="p">)</span>
    <span class="nx">result</span>
  
  <span class="nv">merge: </span><span class="nf">(aRect) -&gt;</span>
    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
    <span class="nv">result.origin = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">result.corner = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aRect</span><span class="p">.</span><span class="nx">corner</span><span class="p">)</span>
    <span class="nx">result</span>
  
  <span class="nv">round: </span><span class="o">-&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">round</span><span class="p">().</span><span class="nx">corner</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">round</span><span class="p">()</span>
  
  <span class="nv">spread: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>round me by applying floor() to my origin and ceil() to my corner</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@origin</span><span class="p">.</span><span class="nx">floor</span><span class="p">().</span><span class="nx">corner</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">ceil</span><span class="p">()</span>
  
  <span class="nv">amountToTranslateWithin: </span><span class="nf">(aRect) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Answer a Point, delta, such that self + delta is forced within
   aRectangle. when all of me cannot be made to fit, prefer to keep
   my topLeft inside. Taken from Squeak.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dx = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@right</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@right</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">aRect</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="nv">dy = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@bottom</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">aRect</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
    <span class="nv">dx = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@right</span><span class="p">()</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">aRect</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">dy = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">()</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">aRect</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Rectangle testing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">containsPoint: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@origin</span><span class="p">.</span><span class="nx">le</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span> <span class="o">and</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="nx">@corner</span><span class="p">)</span>
  
  <span class="nv">containsRectangle: </span><span class="nf">(aRect) -&gt;</span>
    <span class="nx">aRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="nx">@origin</span><span class="p">)</span> <span class="o">and</span> <span class="nx">aRect</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="nx">@corner</span><span class="p">)</span>
  
  <span class="nv">intersects: </span><span class="nf">(aRect) -&gt;</span>
    <span class="nv">ro = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">origin</span>
    <span class="nv">rc = </span><span class="nx">aRect</span><span class="p">.</span><span class="nx">corner</span>
    <span class="p">(</span><span class="nx">rc</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span>
      <span class="p">(</span><span class="nx">rc</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;=</span> <span class="nx">@origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">and</span>
      <span class="p">(</span><span class="nx">ro</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span>
      <span class="p">(</span><span class="nx">ro</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">@corner</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Rectangle transforming:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scaleBy: </span><span class="nf">(scale) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>scale can be either a Point or a scalar</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">o = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">multiplyBy</span><span class="p">(</span><span class="nx">scale</span><span class="p">)</span>
    <span class="nv">c = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">multiplyBy</span><span class="p">(</span><span class="nx">scale</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">translateBy: </span><span class="nf">(factor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>factor can be either a Point or a scalar</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">o = </span><span class="nx">@origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">factor</span><span class="p">)</span>
    <span class="nv">c = </span><span class="nx">@corner</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">factor</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Rectangle converting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">asArray: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">(),</span> <span class="nx">@right</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">()]</span>
  
  <span class="nv">asArray_xywh: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">(),</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()]</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Global Functions ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">nop = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>returns the function that does nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="o">-&gt;</span>    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>this is the function that does nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kc">null</span>

<span class="nv">noOperation = </span><span class="o">-&gt;</span>
    <span class="kc">null</span>

<span class="nv">isFunction = </span><span class="nf">(functionToCheck) -&gt;</span>
  <span class="k">typeof</span><span class="p">(</span><span class="nx">functionToCheck</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>

<span class="nv">localize = </span><span class="nf">(string) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>override this function with custom localizations</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">string</span>

<span class="nv">isNil = </span><span class="nf">(thing) -&gt;</span>
  <span class="nx">thing</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span> <span class="o">or</span> <span class="nx">thing</span> <span class="o">is</span> <span class="kc">null</span>

<span class="nv">contains = </span><span class="nf">(list, element) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>answer true if element is a member of list</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">list</span><span class="p">.</span><span class="nx">some</span> <span class="nf">(any) -&gt;</span>
    <span class="nx">any</span> <span class="o">is</span> <span class="nx">element</span>

<span class="nv">detect = </span><span class="nf">(list, predicate) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>answer the first element of list for which predicate evaluates
true, otherwise answer null</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">size = </span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">size</span>
    <span class="k">return</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">predicate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
    <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="kc">null</span>

<span class="nv">isString = </span><span class="nf">(target) -&gt;</span>
  <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="o">or</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nb">String</span>

<span class="nv">isObject = </span><span class="nf">(target) -&gt;</span>
  <span class="nx">target</span> <span class="o">isnt</span> <span class="kc">null</span> <span class="o">and</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span> <span class="o">or</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span>

<span class="nv">radians = </span><span class="nf">(degrees) -&gt;</span>
  <span class="nx">degrees</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span>

<span class="nv">degrees = </span><span class="nf">(radians) -&gt;</span>
  <span class="nx">radians</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span>

<span class="nv">fontHeight = </span><span class="nf">(height) -&gt;</span>
  <span class="nv">minHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">height</span><span class="p">,</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">minimumFontHeight</span><span class="p">)</span>
  <span class="nx">minHeight</span> <span class="o">*</span> <span class="mf">1.2</span> <span class="c1"># assuming 1/5 font size for ascenders</span>

<span class="nv">newCanvas = </span><span class="nf">(extentPoint) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>answer a new empty instance of Canvas, don't display anywhere</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ext = </span><span class="nx">extentPoint</span> <span class="o">or</span>
    <span class="nv">x: </span><span class="mi">0</span>
    <span class="nv">y: </span><span class="mi">0</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">ext</span><span class="p">.</span><span class="nx">x</span>
  <span class="nv">canvas.height = </span><span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
  <span class="nx">canvas</span>

<span class="nv">getMinimumFontHeight = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>answer the height of the smallest font renderable in pixels</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">str = </span><span class="s">&quot;I&quot;</span>
  <span class="nv">size = </span><span class="mi">50</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">size</span>
  <span class="nv">canvas.height = </span><span class="nx">size</span>
  <span class="nv">ctx = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.font = </span><span class="s">&quot;1px serif&quot;</span>
  <span class="nv">maxX = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">width</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;black&quot;</span>
  <span class="nv">ctx.textBaseline = </span><span class="s">&quot;bottom&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span>
  <span class="nv">y = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">size</span>
    <span class="nv">x = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">maxX</span>
      <span class="nv">data = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="mi">0</span>

<span class="nv">getBlurredShadowSupport = </span><span class="o">-&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>check for Chrome issue 90001
http://code.google.com/p/chromium/issues/detail?id=90001</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">source = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">source.width = </span><span class="mi">10</span>
  <span class="nv">source.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">source</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;rgb(255, 0, 0)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="nv">target = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">target.width = </span><span class="mi">10</span>
  <span class="nv">target.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">target</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.shadowBlur = </span><span class="mi">10</span>
  <span class="nv">ctx.shadowColor = </span><span class="s">&quot;rgba(0, 0, 255, 1)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">source</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="k">if</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span><span class="p">)</span>

<span class="nv">getDocumentPositionOf = </span><span class="nf">(aDOMelement) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>answer the absolute coordinates of a DOM element in the document</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">aDOMelement</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="nv">x: </span><span class="mi">0</span>
      <span class="nv">y: </span><span class="mi">0</span>
    <span class="p">)</span>
  <span class="nv">pos =</span>
    <span class="nv">x: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nv">y: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetTop</span>
  <span class="nv">offsetParent = </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="k">while</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetTop</span>
    <span class="k">if</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">and</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollLeft</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollTop</span>
    <span class="nv">offsetParent = </span><span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="nx">pos</span>

<span class="nv">clone = </span><span class="nf">(target) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>answer a new instance of target's type</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
    <span class="nv">Clone = </span><span class="o">-&gt;</span>

    <span class="nv">Clone:: = </span><span class="nx">target</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Clone</span><span class="p">()</span>
  <span class="nx">target</span>

<span class="nv">copy = </span><span class="nf">(target) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>answer a shallow copy of target</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">target</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="s">&quot;object&quot;</span>
  <span class="nv">value = </span><span class="nx">target</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="nx">value</span>
  <span class="k">if</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">and</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">isnt</span> <span class="nb">Object</span>
    <span class="nv">c = </span><span class="nx">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="o">::</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nv">c = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="nx">unless</span> <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  <span class="nx">c</span>

<span class="nv">getMinimumFontHeight = </span><span class="o">-&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>answer the height of the smallest font renderable in pixels</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">str = </span><span class="s">&quot;I&quot;</span>
  <span class="nv">size = </span><span class="mi">50</span>
  <span class="nv">canvas = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">canvas.width = </span><span class="nx">size</span>
  <span class="nv">canvas.height = </span><span class="nx">size</span>
  <span class="nv">ctx = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.font = </span><span class="s">&quot;1px serif&quot;</span>
  <span class="nv">maxX = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">width</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;black&quot;</span>
  <span class="nv">ctx.textBaseline = </span><span class="s">&quot;bottom&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span>
  <span class="nv">y = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">size</span>
    <span class="nv">x = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">maxX</span>
      <span class="nv">data = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">size</span> <span class="o">-</span> <span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="mi">0</span>


<span class="nv">getBlurredShadowSupport = </span><span class="o">-&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>check for Chrome issue 90001
http://code.google.com/p/chromium/issues/detail?id=90001</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">source = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">source.width = </span><span class="mi">10</span>
  <span class="nv">source.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">source</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.fillStyle = </span><span class="s">&quot;rgb(255, 0, 0)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  <span class="nv">target = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">target.width = </span><span class="mi">10</span>
  <span class="nv">target.height = </span><span class="mi">10</span>
  <span class="nv">ctx = </span><span class="nx">target</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
  <span class="nv">ctx.shadowBlur = </span><span class="mi">10</span>
  <span class="nv">ctx.shadowColor = </span><span class="s">&quot;rgba(0, 0, 255, 1)&quot;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">source</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="p">(</span><span class="k">if</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span><span class="p">)</span>

<span class="nv">getDocumentPositionOf = </span><span class="nf">(aDOMelement) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>answer the absolute coordinates of a DOM element in the document</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">aDOMelement</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="nv">x: </span><span class="mi">0</span>
      <span class="nv">y: </span><span class="mi">0</span>
    <span class="p">)</span>
  <span class="nv">pos =</span>
    <span class="nv">x: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nv">y: </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetTop</span>

  <span class="nv">offsetParent = </span><span class="nx">aDOMelement</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="k">while</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetLeft</span>
    <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetTop</span>
    <span class="k">if</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">and</span> <span class="nx">offsetParent</span> <span class="o">isnt</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollLeft</span>
      <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">offsetParent</span><span class="p">.</span><span class="nx">scrollTop</span>
    <span class="nv">offsetParent = </span><span class="nx">offsetParent</span><span class="p">.</span><span class="nx">offsetParent</span>
  <span class="nx">pos</span>

<span class="nv">clone = </span><span class="nf">(target) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>answer a new instance of target's type</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
    <span class="nv">Clone = </span><span class="o">-&gt;</span>

    <span class="nv">Clone:: = </span><span class="nx">target</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Clone</span><span class="p">()</span>
  <span class="nx">target</span>

<span class="nv">copy = </span><span class="nf">(target) -&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>answer a shallow copy of target</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">target</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="s">&quot;object&quot;</span>
  <span class="nv">value = </span><span class="nx">target</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="nx">value</span>
  <span class="k">if</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">and</span> <span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">isnt</span> <span class="nb">Object</span>
    <span class="nv">c = </span><span class="nx">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">constructor</span><span class="o">::</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nv">c = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">target</span>
      <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="nx">unless</span> <span class="nx">c</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  <span class="nx">c</span>
<span class="k">class</span> <span class="nx">MorphicNode</span>

  <span class="nv">parent: </span><span class="kc">null</span>
  <span class="nv">children: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@parent = null, @children = []) -&gt;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>MorphicNode string representation: e.g. 'a MorphicNode[3]'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="s">&quot;a MorphicNode&quot;</span> <span class="o">+</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>MorphicNode accessing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">addChild: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">push</span> <span class="nx">aMorphicNode</span>
    <span class="nv">aMorphicNode.parent = </span><span class="nx">@</span>
  
  <span class="nv">addChildFirst: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">splice</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">aMorphicNode</span>
    <span class="nv">aMorphicNode.parent = </span><span class="nx">@</span>
  
  <span class="nv">removeChild: </span><span class="nf">(aMorphicNode) -&gt;</span>
    <span class="nv">idx = </span><span class="nx">@children</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">aMorphicNode</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>MorphicNode functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">root: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">root</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">@</span>
  
  <span class="nv">depth: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="mi">0</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">depth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
  
  <span class="nv">allChildren: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>includes myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="p">[</span><span class="nx">@</span><span class="p">]</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">forAllChildren: </span><span class="nf">(aFunction) -&gt;</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">forAllChildren</span> <span class="nx">aFunction</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">aFunction</span><span class="p">.</span><span class="nx">call</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@</span>
  
  <span class="nv">allLeafs: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="p">[]</span>
    <span class="nx">@allChildren</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(element) -&gt;</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span> <span class="nx">element</span>  <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">allParents: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>includes myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="p">[</span><span class="nx">@</span><span class="p">]</span>
    <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">allParents</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">result</span>
  
  <span class="nv">siblings: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">[]</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">filter</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">child</span> <span class="o">isnt</span> <span class="nx">@</span>
  
  <span class="nv">parentThatIsA: </span><span class="nf">(constructor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>including myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">constructor</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">parentThatIsA</span> <span class="nx">constructor</span>
  
  <span class="nv">parentThatIsAnyOf: </span><span class="nf">(constructors) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>including myself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">yup = </span><span class="kc">false</span>
    <span class="nx">constructors</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">@constructor</span> <span class="o">is</span> <span class="nx">each</span>
        <span class="nv">yup = </span><span class="kc">true</span>
        <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">yup</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@parent</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">parentThatIsAnyOf</span> <span class="nx">constructors</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Morph //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Morph</span> <span class="k">extends</span> <span class="nx">MorphicNode</span>
  </pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Just some tests here ////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">propertyUpTheChain: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
  <span class="nv">morphMethod: </span><span class="o">-&gt;</span>
    <span class="mf">3.14</span>
  <span class="vi">@morphStaticMethod: </span><span class="o">-&gt;</span>
    <span class="mf">3.14</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>End of tests here ////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isMorph: </span><span class="kc">true</span>
  <span class="nv">bounds: </span><span class="kc">null</span>
  <span class="nv">color: </span><span class="kc">null</span>
  <span class="nv">texture: </span><span class="kc">null</span> <span class="c1"># optional url of a fill-image</span>
  <span class="nv">cachedTexture: </span><span class="kc">null</span> <span class="c1"># internal cache of actual bg image</span>
  <span class="nv">lastTime: </span><span class="kc">null</span>
  <span class="nv">alpha: </span><span class="mi">1</span>
  <span class="nv">isVisible: </span><span class="kc">true</span>
  <span class="nv">isDraggable: </span><span class="kc">false</span>
  <span class="nv">isTemplate: </span><span class="kc">false</span>
  <span class="nv">acceptsDrops: </span><span class="kc">false</span>
  <span class="nv">noticesTransparentClick: </span><span class="kc">false</span>
  <span class="nv">fps: </span><span class="mi">0</span>
  <span class="nv">customContextMenu: </span><span class="kc">null</span>
  <span class="nv">trackChanges: </span><span class="kc">true</span>
  <span class="nv">shadowBlur: </span><span class="mi">4</span>
  <span class="nv">image: </span><span class="kc">null</span>
  
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="vi">@lastTime = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>damage list housekeeping</p>

<p>the trackChanges property of the Morph prototype is a Boolean switch
that determines whether the World's damage list ('broken' rectangles)
tracks changes. By default the switch is always on. If set to false
changes are not stored. This can be very useful for housekeeping of
the damage list in situations where a large number of (sub-) morphs
are changed more or less at once. Instead of keeping track of every
single submorph's changes tremendous performance improvements can be
achieved by setting the trackChanges flag to false before propagating
the layout changes, setting it to true again and then storing the full
bounds of the surrounding morph. An an example refer to the</p>

<pre><code>fixLayout()
</code></pre>

<p>method of InspectorMorph, or the</p>

<pre><code>startLayout()
endLayout()
</code></pre>

<p>methods of SyntaxElementMorph in the Snap application.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Morph string representation: e.g. 'a Morph 2 [20@45 | 130@250]'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="s">&quot;a &quot;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
      <span class="s">&quot; &quot;</span> <span class="o">+</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span>
      <span class="s">&quot; &quot;</span> <span class="o">+</span>
      <span class="nx">@bounds</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Morph deleting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Morph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">runChildrensStepFunction: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>step is the function that this Morph wants to run at each step.
If the Morph wants to do nothing and let no-one of the children do nothing,
then step is set to null.
If the morph wants to do nothing but the children might want to do something,
then step is set to the function that does nothing (i.e. a function noOperation that
only returns null) </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@step</span>
    <span class="nv">current = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="nv">elapsed = </span><span class="nx">current</span> <span class="o">-</span> <span class="nx">@lastTime</span>
    <span class="k">if</span> <span class="nx">@fps</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">leftover = </span><span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="nx">@fps</span><span class="p">)</span> <span class="o">-</span> <span class="nx">elapsed</span>
    <span class="k">else</span>
      <span class="nv">leftover = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">leftover</span> <span class="o">&lt;</span> <span class="mi">1</span>
      <span class="vi">@lastTime = </span><span class="nx">current</span>
      <span class="nx">@step</span><span class="p">()</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">runChildrensStepFunction</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>leaving this function as step means that the morph want to do nothing
but the children <em>are</em> traversed and their step function is invoked.
If a Morph wants to do nothing and wants to prevent the children to be
traversed, then this function should be set to null.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="nx">noOperation</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Morph accessing - geometry getting:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">left: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
  
  <span class="nv">right: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
  
  <span class="nv">top: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
  
  <span class="nv">bottom: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
  
  <span class="nv">center: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">center</span><span class="p">()</span>
  
  <span class="nv">bottomCenter: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomCenter</span><span class="p">()</span>
  
  <span class="nv">bottomLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">()</span>
  
  <span class="nv">bottomRight: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">()</span>
  
  <span class="nv">boundingBox: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span>
  
  <span class="nv">corners: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">corners</span><span class="p">()</span>
  
  <span class="nv">leftCenter: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">leftCenter</span><span class="p">()</span>
  
  <span class="nv">rightCenter: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">rightCenter</span><span class="p">()</span>
  
  <span class="nv">topCenter: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topCenter</span><span class="p">()</span>
  
  <span class="nv">topLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topLeft</span><span class="p">()</span>
  
  <span class="nv">topRight: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">topRight</span><span class="p">()</span>
  
  <span class="nv">position: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
  
  <span class="nv">extent: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">extent</span><span class="p">()</span>
  
  <span class="nv">width: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
  
  <span class="nv">height: </span><span class="o">-&gt;</span>
    <span class="nx">@bounds</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
  
  <span class="nv">fullBounds: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@bounds</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">fullBoundsNoShadow: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>answer my full bounds but ignore any shadow</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result = </span><span class="nx">@bounds</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">child</span> <span class="o">not</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">)</span>
        <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  <span class="nv">visibleBounds: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>answer which part of me is not clipped by a Frame</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">visible = </span><span class="nx">@bounds</span>
    <span class="nv">frames = </span><span class="nx">@allParents</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(p) -&gt;</span>
      <span class="nx">p</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span>
    <span class="p">)</span>
    <span class="nx">frames</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(f) -&gt;</span>
      <span class="nv">visible = </span><span class="nx">visible</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">visible</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Morph accessing - simple changes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">moveBy</span> <span class="nx">delta</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">silentMoveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">silentMoveBy</span> <span class="nx">delta</span>
  
  
  <span class="nv">setPosition: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">delta = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@topLeft</span><span class="p">())</span>
    <span class="nx">@moveBy</span> <span class="nx">delta</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">y</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">silentSetPosition: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">delta = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@topLeft</span><span class="p">())</span>
    <span class="nx">@silentMoveBy</span> <span class="nx">delta</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">delta</span><span class="p">.</span><span class="nx">y</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">setLeft: </span><span class="nf">(x) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">())</span>
  
  <span class="nv">setRight: </span><span class="nf">(x) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">())</span>
  
  <span class="nv">setTop: </span><span class="nf">(y) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">setBottom: </span><span class="nf">(y) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">y</span> <span class="o">-</span> <span class="nx">@height</span><span class="p">())</span>
  
  <span class="nv">setCenter: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  <span class="nv">setFullCenter: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@setPosition</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>make sure I am completely within another Morph's bounds</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">keepWithin: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">leftOff = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">leftOff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">leftOff</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">rightOff = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">rightOff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">rightOff</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nv">topOff = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">topOff</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">topOff</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">bottomOff = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">bottomOff</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">bottomOff</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Morph accessing - dimensional changes requiring a complete redraw</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">unless</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@silentSetExtent</span> <span class="nx">aPoint</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">silentSetExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">ext = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">round</span><span class="p">()</span>
    <span class="nv">newWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">newHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">ext</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">newWidth</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">newHeight</span><span class="p">)</span>
  
  <span class="nv">setWidth: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">width</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@height</span><span class="p">())</span>
  
  <span class="nv">silentSetWidth: </span><span class="nf">(width) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>do not drawNew() just yet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">width</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w</span><span class="p">),</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">setHeight: </span><span class="nf">(height) -&gt;</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">height</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">silentSetHeight: </span><span class="nf">(height) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>do not drawNew() just yet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">h = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">height</span> <span class="o">or</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">h</span><span class="p">))</span>
  
  <span class="nv">setColor: </span><span class="nf">(aColor) -&gt;</span>
    <span class="k">if</span> <span class="nx">aColor</span>
      <span class="nx">unless</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">aColor</span><span class="p">)</span>
        <span class="vi">@color = </span><span class="nx">aColor</span>
        <span class="nx">@changed</span><span class="p">()</span>
        <span class="nx">@drawNew</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Morph displaying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>initialize my surface property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@cachedTexture</span>
      <span class="nx">@drawCachedTexture</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">@drawTexture</span> <span class="nx">@texture</span>  <span class="k">if</span> <span class="nx">@texture</span>
  
  <span class="nv">drawTexture: </span><span class="nf">(url) -&gt;</span>
    <span class="vi">@cachedTexture = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
    <span class="vi">@cachedTexture.onload = </span><span class="o">=&gt;</span>
      <span class="nx">@drawCachedTexture</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@cachedTexture.src = @texture = </span><span class="nx">url</span> <span class="c1"># make absolute</span>
  
  <span class="nv">drawCachedTexture: </span><span class="o">-&gt;</span>
    <span class="nv">bg = </span><span class="nx">@cachedTexture</span>
    <span class="nv">cols = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@image</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
    <span class="nv">lines = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@image</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">y = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">lines</span>
      <span class="nv">x = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">cols</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">bg</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">width</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">bg</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
        <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Morph.prototype.drawCachedTexture = function () {
   var context = this.image.getContext('2d'),
       pattern = context.createPattern(this.cachedTexture, 'repeat');
context.fillStyle = pattern;
   context.fillRect(0, 0, this.image.width, this.image.height);
   this.changed();
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawOn: </span><span class="nf">(aCanvas, aRect) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@isVisible</span>
    <span class="nv">rectangle = </span><span class="nx">aRect</span> <span class="o">or</span> <span class="nx">@bounds</span><span class="p">()</span>
    <span class="nv">area = </span><span class="nx">rectangle</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">).</span><span class="nx">round</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">gt</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
      <span class="nv">delta = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">neg</span><span class="p">()</span>
      <span class="nv">src = </span><span class="nx">area</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">).</span><span class="nx">round</span><span class="p">()</span>
      <span class="nv">context = </span><span class="nx">aCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
      <span class="nv">context.globalAlpha = </span><span class="nx">@alpha</span>
      <span class="nv">sl = </span><span class="nx">src</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nv">st = </span><span class="nx">src</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">@image</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">sl</span><span class="p">)</span>
      <span class="nv">h = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span> <span class="nx">@image</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">st</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">1</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">@image</span><span class="p">,</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">left</span><span class="p">()),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">top</span><span class="p">()),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">w</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">h</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">area</span><span class="p">.</span><span class="nx">left</span><span class="p">()),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">area</span><span class="p">.</span><span class="nx">top</span><span class="p">()),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">w</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>"for debugging purposes:"</p>

<pre><code>try {
    context.drawImage(
        this.image,
        src.left(),
        src.top(),
        w,
        h,
        area.left(),
        area.top(),
        w,
        h
    );
} catch (err) {
    alert('internal error\n\n' + err
        + '\n ---'
        + '\n canvas: ' + aCanvas
        + '\n canvas.width: ' + aCanvas.width
        + '\n canvas.height: ' + aCanvas.height
        + '\n ---'
        + '\n image: ' + this.image
        + '\n image.width: ' + this.image.width
        + '\n image.height: ' + this.image.height
        + '\n ---'
        + '\n w: ' + w
        + '\n h: ' + h
        + '\n sl: ' + sl
        + '\n st: ' + st
        + '\n area.left: ' + area.left()
        + '\n area.top ' + area.top()
        );
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fullDrawOn: </span><span class="nf">(aCanvas, aRect) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@isVisible</span>
    <span class="nv">rectangle = </span><span class="nx">aRect</span> <span class="o">or</span> <span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nx">@drawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">rectangle</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">fullDrawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">rectangle</span>
  
  
  <span class="nv">hide: </span><span class="o">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="kc">false</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  
  <span class="nv">show: </span><span class="o">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
  
  
  <span class="nv">toggleVisibility: </span><span class="o">-&gt;</span>
    <span class="vi">@isVisible = </span><span class="p">(</span><span class="o">not</span> <span class="nx">@isVisible</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">toggleVisibility</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Morph full image:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fullImageClassic: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>why doesn't this work for all Morphs?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nx">@fullDrawOn</span> <span class="nx">img</span><span class="p">,</span> <span class="nx">fb</span>
    <span class="nv">img.globalAlpha = </span><span class="nx">@alpha</span>
    <span class="nx">img</span>
  
  <span class="nv">fullImage: </span><span class="o">-&gt;</span>
    <span class="nv">img = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nv">ctx = </span><span class="nx">img</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nx">@allChildren</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(morph) -&gt;</span>
      <span class="k">if</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">isVisible</span>
        <span class="nv">ctx.globalAlpha = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">alpha</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">image</span><span class="p">,</span>
          <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
          <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">img</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Morph shadow:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shadowImage: </span><span class="nf">(off_, color) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>fallback for Windows Chrome-Shadow bug</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">extent</span><span class="p">()</span>
    <span class="nv">img = </span><span class="nx">@fullImage</span><span class="p">()</span>
    <span class="nv">outline = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">outline</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">outline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;source-atop&quot;</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">sha</span>
  
  <span class="nv">shadowImageBlurred: </span><span class="nf">(off_, color) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">blur = </span><span class="nx">@shadowBlur</span>
    <span class="nv">clr = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">blur</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nv">img = </span><span class="nx">@fullImage</span><span class="p">()</span>
    <span class="nv">sha = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">sha</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">ctx.shadowBlur = </span><span class="nx">blur</span>
    <span class="nv">ctx.shadowColor = </span><span class="nx">clr</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">ctx.shadowOffsetX = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowOffsetY = </span><span class="mi">0</span>
    <span class="nv">ctx.shadowBlur = </span><span class="mi">0</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;destination-out&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">blur</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">sha</span>
  
  <span class="nv">shadow: </span><span class="nf">(off_, a, color) -&gt;</span>
    <span class="nv">shadow = </span><span class="k">new</span> <span class="nx">ShadowMorph</span><span class="p">()</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">alpha = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.2</span><span class="p">))</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nx">shadow</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@shadowBlur</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">useBlurredShadows</span>
      <span class="nv">shadow.image = </span><span class="nx">@shadowImageBlurred</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
      <span class="nv">shadow.alpha = </span><span class="nx">alpha</span>
      <span class="nx">shadow</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@shadowBlur</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">shadow.image = </span><span class="nx">@shadowImage</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
      <span class="nv">shadow.alpha = </span><span class="nx">alpha</span>
      <span class="nx">shadow</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">)</span>
    <span class="nx">shadow</span>
  
  <span class="nv">addShadow: </span><span class="nf">(off_, a, color) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">off_</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="nv">alpha = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.2</span><span class="p">))</span>
    <span class="nv">shadow = </span><span class="nx">@shadow</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
    <span class="nx">@addBack</span> <span class="nx">shadow</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
    <span class="nx">shadow</span>
  
  <span class="nv">getShadow: </span><span class="o">-&gt;</span>
    <span class="nv">shadows = </span><span class="nx">@children</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nf">(child) -&gt;</span>
      <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nx">shadows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">shadows</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span>
    <span class="kc">null</span>
  
  <span class="nv">removeShadow: </span><span class="o">-&gt;</span>
    <span class="nv">shadow = </span><span class="nx">@getShadow</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">shadow</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@removeChild</span> <span class="nx">shadow</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Morph pen trails:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">penTrails: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>answer my pen trails canvas. default is to answer my image</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@image</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Morph updating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">changed: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@trackChanges</span>
      <span class="nv">w = </span><span class="nx">@root</span><span class="p">()</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@visibleBounds</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">w</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">childChanged</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">fullChanged: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@trackChanges</span>
      <span class="nv">w = </span><span class="nx">@root</span><span class="p">()</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">w</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
  
  <span class="nv">childChanged: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>react to a  change in one of my children,
default is to just pass this message on upwards
override this method for Morphs that need to adjust accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">childChanged</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Morph accessing - structure:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">world: </span><span class="o">-&gt;</span>
    <span class="nv">root = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">root</span>  <span class="k">if</span> <span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">world</span>  <span class="k">if</span> <span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">HandMorph</span>
    <span class="kc">null</span>
  
  <span class="nv">add: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">owner = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="nx">owner</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">owner</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@addChild</span> <span class="nx">aMorph</span>
  
  <span class="nv">addBack: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">owner = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="nx">owner</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">owner</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@addChildFirst</span> <span class="nx">aMorph</span>
  
  <span class="nv">topMorphSuchThat: </span><span class="nf">(predicate) -&gt;</span>
    <span class="k">if</span> <span class="nx">predicate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
      <span class="nv">next = </span><span class="nx">detect</span><span class="p">(</span><span class="nx">@children</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">(),</span> <span class="nx">predicate</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">topMorphSuchThat</span><span class="p">(</span><span class="nx">predicate</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">next</span>
      <span class="k">return</span> <span class="nx">@</span>
    <span class="kc">null</span>
  
  <span class="nv">morphAt: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@allChildren</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nv">result = </span><span class="nx">m</span>  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">result</span> <span class="o">is</span> <span class="kc">null</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">result</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>alternative -  more elegant and possibly more
performant - solution for morphAt.
Has some issues, commented out for now</p>

<p>Morph.prototype.morphAt = function (aPoint) {
return this.topMorphSuchThat(function (m) {
    return m.fullBounds().containsPoint(aPoint);
});
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">overlappedMorphs: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>exclude the World</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nv">allParents = </span><span class="nx">@allParents</span><span class="p">()</span>
    <span class="nv">allChildren = </span><span class="nx">@allChildren</span><span class="p">()</span>
    <span class="nv">morphs = </span><span class="nx">world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">()</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">filter</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span>
        <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@</span> <span class="o">and</span>
        <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">world</span> <span class="o">and</span>
        <span class="o">not</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">allParents</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="o">and</span>
        <span class="o">not</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">allChildren</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="o">and</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">().</span><span class="nx">intersects</span><span class="p">(</span><span class="nx">fb</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Morph pixel access:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getPixelColor: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">point = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">data = </span><span class="nx">context</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  
  <span class="nv">isTransparentAt: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">if</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">false</span>  <span class="k">if</span> <span class="nx">@texture</span>
      <span class="nv">point = </span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
      <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
      <span class="nv">data = </span><span class="nx">context</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Morph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="o">-&gt;</span>
    <span class="nv">c = </span><span class="nx">copy</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="nv">c.parent = </span><span class="kc">null</span>
    <span class="nv">c.children = </span><span class="p">[]</span>
    <span class="nv">c.bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">c</span>
  
  <span class="nv">fullCopy: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Produce a copy of me with my entire tree of submorphs. Morphs
mentioned more than once are all directed to a single new copy.
Other properties are also <em>shallow</em> copied, so you must override
to deep copy Arrays and (complex) Objects</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dict = </span><span class="p">{}</span>
    <span class="nv">c = </span><span class="nx">@copyRecordingReferences</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">forAllChildren</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">updateReferences</span> <span class="nx">dict</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">c</span>
  
  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Recursively copy this entire composite morph, recording the
correspondence between old and new morphs in the given dictionary.
This dictionary will be used to update intra-composite references
in the copy. See updateReferences().
Note: This default implementation copies ONLY morphs in the
submorph hierarchy. If a morph stores morphs in other properties
that it wants to copy, then it should override this method to do so.
The same goes for morphs that contain other complex data that
should be copied when the morph is duplicated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="nx">@copy</span><span class="p">()</span>
    <span class="nx">dict</span><span class="p">[</span><span class="nx">@</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">m</span><span class="p">.</span><span class="nx">copyRecordingReferences</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">c</span>
  
  <span class="nv">updateReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Update intra-morph references within a composite morph that has
been copied. For example, if a button refers to morph X in the
orginal composite then the copy of that button in the new composite
should refer to the copy of X in new composite, not the original X.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">@</span>
      <span class="nx">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">property</span><span class="p">.</span><span class="nx">isMorph</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Morph dragging and dropping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rootForGrab: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
    <span class="k">return</span> <span class="nx">@parent</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">or</span>
      <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span> <span class="o">or</span>
      <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span> <span class="o">or</span>
      <span class="nx">@isDraggable</span> <span class="o">is</span> <span class="kc">true</span>
        <span class="k">return</span> <span class="nx">@</span>  
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>
  
  <span class="nv">wantsDropOf: </span><span class="nf">(aMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>default is to answer the general flag - change for my heirs</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">HandleMorph</span><span class="p">)</span> <span class="o">or</span>
      <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">MenuMorph</span><span class="p">)</span> <span class="o">or</span>
      <span class="p">(</span><span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">InspectorMorph</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>  
    <span class="nx">@acceptsDrops</span>
  
  <span class="nv">pickUp: </span><span class="nf">(wrrld) -&gt;</span>
    <span class="nv">world = </span><span class="nx">wrrld</span> <span class="o">or</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">grab</span> <span class="nx">@</span>
  
  <span class="nv">isPickedUp: </span><span class="o">-&gt;</span>
    <span class="nx">@parentThatIsA</span><span class="p">(</span><span class="nx">HandMorph</span><span class="p">)</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">situation: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>answer a dictionary specifying where I am right now, so
I can slide back to it if I'm dropped somewhere else</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@parent</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="nv">origin: </span><span class="nx">@parent</span>
        <span class="nv">position: </span><span class="nx">@position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">position</span><span class="p">())</span>
      <span class="p">)</span>
    <span class="kc">null</span>
  
  <span class="nv">slideBackTo: </span><span class="nf">(situation, inSteps) -&gt;</span>
    <span class="nv">steps = </span><span class="nx">inSteps</span> <span class="o">or</span> <span class="mi">5</span>
    <span class="nv">pos = </span><span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">situation</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span>
    <span class="nv">xStep = </span><span class="o">-</span><span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span>
    <span class="nv">yStep = </span><span class="o">-</span><span class="p">(</span><span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">steps</span>
    <span class="nv">stepCount = </span><span class="mi">0</span>
    <span class="nv">oldStep = </span><span class="nx">@step</span>
    <span class="nv">oldFps = </span><span class="nx">@fps</span>
    <span class="vi">@fps = </span><span class="mi">0</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">@silentMoveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">xStep</span><span class="p">,</span> <span class="nx">yStep</span><span class="p">)</span>
      <span class="nx">@fullChanged</span><span class="p">()</span>
      <span class="nx">stepCount</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">stepCount</span> <span class="o">is</span> <span class="nx">steps</span>
        <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
        <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">reactToDropOf</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">situation</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">reactToDropOf</span>
        <span class="vi">@step = </span><span class="nx">oldStep</span>
        <span class="vi">@fps = </span><span class="nx">oldFps</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Morph utilities:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resize: </span><span class="o">-&gt;</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nv">activeHandle = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
  
  <span class="nv">move: </span><span class="o">-&gt;</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nv">activeHandle = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">)</span>
  
  <span class="nv">hint: </span><span class="nf">(msg) -&gt;</span>
    <span class="nv">text = </span><span class="nx">msg</span>
    <span class="k">if</span> <span class="nx">msg</span>
      <span class="nv">text = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="s">&quot;NULL&quot;</span>
    <span class="nv">m = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span>
    <span class="nv">m.isDraggable = </span><span class="kc">true</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">popUpCenteredAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">inform: </span><span class="nf">(msg) -&gt;</span>
    <span class="nv">text = </span><span class="nx">msg</span>
    <span class="k">if</span> <span class="nx">msg</span>
      <span class="nv">text = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="s">&quot;NULL&quot;</span>
    <span class="nv">m = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span>
    <span class="nv">m.isDraggable = </span><span class="kc">true</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">popUpCenteredAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">prompt: </span><span class="nf">(msg, callback, environment, defaultContents, width, floorNum,</span>
<span class="nf">    ceilingNum, isRounded) -&gt;</span>
    <span class="nv">isNumeric = </span><span class="kc">true</span>  <span class="k">if</span> <span class="nx">ceilingNum</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">callback</span> <span class="o">or</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">environment</span> <span class="o">or</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">entryField = </span><span class="k">new</span> <span class="nx">StringFieldMorph</span><span class="p">(</span>
      <span class="nx">defaultContents</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
      <span class="nx">width</span> <span class="o">or</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterFontSize</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterFontName</span><span class="p">,</span>
      <span class="kc">false</span><span class="p">,</span>
      <span class="kc">false</span><span class="p">,</span>
      <span class="nx">isNumeric</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">entryField</span>
    <span class="k">if</span> <span class="nx">ceilingNum</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useSliderForInput</span>
      <span class="nv">slider = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span>
        <span class="nx">floorNum</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">ceilingNum</span><span class="p">,</span>
        <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">defaultContents</span><span class="p">),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">ceilingNum</span> <span class="o">-</span> <span class="nx">floorNum</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
        <span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
      <span class="nv">slider.alpha = </span><span class="mi">1</span>
      <span class="nv">slider.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">)</span>
      <span class="nv">slider.button.color = </span><span class="nx">menu</span><span class="p">.</span><span class="nx">borderColor</span>
      <span class="nv">slider.button.highlightColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">highlightColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">100</span>
      <span class="nv">slider.button.pressColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">pressColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">150</span>
      <span class="nx">slider</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">prompterSliderSize</span>
      <span class="k">if</span> <span class="nx">isRounded</span>
        <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nv">entryField.text.text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nv">entryField.text.text = </span><span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
          <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slider</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span> <span class="mi">2</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">entryField</span><span class="p">.</span><span class="nx">string</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">menu.isDraggable = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">entryField</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">pickColor: </span><span class="nf">(msg, callback, environment, defaultContents) -&gt;</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">callback</span> <span class="o">or</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">environment</span> <span class="o">or</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">colorPicker = </span><span class="k">new</span> <span class="nx">ColorPickerMorph</span><span class="p">(</span><span class="nx">defaultContents</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">colorPicker</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span> <span class="mi">2</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">colorPicker</span><span class="p">.</span><span class="nx">getChoice</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">menu.isDraggable = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
  
  <span class="nv">inspect: </span><span class="nf">(anotherObject) -&gt;</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="nv">inspectee = </span><span class="nx">@</span>
    <span class="nv">inspectee = </span><span class="nx">anotherObject</span>  <span class="k">if</span> <span class="nx">anotherObject</span>
    <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">inspectee</span><span class="p">)</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
    <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Morph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">contextMenu: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@customContextMenu</span>  <span class="k">if</span> <span class="nx">@customContextMenu</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">world</span> <span class="o">and</span> <span class="nx">world</span><span class="p">.</span><span class="nx">isDevMode</span>
      <span class="k">return</span> <span class="nx">@developersMenu</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span> <span class="o">is</span> <span class="nx">world</span>
      <span class="k">return</span> <span class="nx">@hierarchyMenu</span><span class="p">()</span>
    <span class="nx">@userMenu</span><span class="p">()</span> <span class="o">or</span> <span class="p">(</span><span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">userMenu</span><span class="p">())</span>
  
  <span class="nv">hierarchyMenu: </span><span class="o">-&gt;</span>
    <span class="nv">parents = </span><span class="nx">@allParents</span><span class="p">()</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">parents</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(each) -&gt;</span>
      <span class="k">if</span> <span class="nx">each</span><span class="p">.</span><span class="nx">developersMenu</span> <span class="o">and</span> <span class="p">(</span><span class="nx">each</span> <span class="o">isnt</span> <span class="nx">world</span><span class="p">)</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">-&gt;</span>
          <span class="nx">each</span><span class="p">.</span><span class="nx">developersMenu</span><span class="p">().</span><span class="nx">popUpAtHand</span> <span class="nx">world</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span>
  
  <span class="nv">developersMenu: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>'name' is not an official property of a function, hence:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="nv">userMenu = </span><span class="nx">@userMenu</span><span class="p">()</span> <span class="o">or</span> <span class="p">(</span><span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">userMenu</span><span class="p">())</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span>
      <span class="nx">@</span><span class="p">,</span>
      <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nx">userMenu</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;user features...&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="nx">userMenu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">world</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncolor:&quot;</span><span class="p">,</span> <span class="nx">@setColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@color</span>
    <span class="p">),</span> <span class="s">&quot;choose another color \nfor this morph&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;transparency...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nalpha\nvalue:&quot;</span><span class="p">,</span>
        <span class="nx">@setAlphaScaled</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="p">(</span><span class="nx">@alpha</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this morph&#39;s\nalpha value&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;resize...&quot;</span><span class="p">,</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="s">&quot;show a handle\nwhich can be dragged\nto change this morph&#39;s&quot;</span> <span class="o">+</span> <span class="s">&quot; extent&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;duplicate&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@fullCopy</span><span class="p">().</span><span class="nx">pickUp</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="p">),</span> <span class="s">&quot;make a copy\nand pick it up&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pick up&quot;</span><span class="p">,</span> <span class="s">&quot;pickUp&quot;</span><span class="p">,</span> <span class="s">&quot;disattach and put \ninto the hand&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;attach...&quot;</span><span class="p">,</span> <span class="s">&quot;attach&quot;</span><span class="p">,</span> <span class="s">&quot;stick this morph\nto another one&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move...&quot;</span><span class="p">,</span> <span class="s">&quot;move&quot;</span><span class="p">,</span> <span class="s">&quot;show a handle\nwhich can be dragged\nto move this morph&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect...&quot;</span><span class="p">,</span> <span class="s">&quot;inspect&quot;</span><span class="p">,</span> <span class="s">&quot;open a window\non all properties&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isDraggable</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;lock&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsDraggable&quot;</span><span class="p">,</span> <span class="s">&quot;make this morph\nunmovable&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;unlock&quot;</span><span class="p">,</span> <span class="s">&quot;toggleIsDraggable&quot;</span><span class="p">,</span> <span class="s">&quot;make this morph\nmovable&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide&quot;</span><span class="p">,</span> <span class="s">&quot;hide&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;delete&quot;</span><span class="p">,</span> <span class="s">&quot;destroy&quot;</span>
    <span class="nx">unless</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;World...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
        <span class="nx">world</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">().</span><span class="nx">popUpAtHand</span> <span class="nx">world</span>
      <span class="p">),</span> <span class="s">&quot;show the\nWorld&#39;s menu&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">userMenu: </span><span class="o">-&gt;</span>
    <span class="kc">null</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Morph menu actions</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setAlphaScaled: </span><span class="nf">(alpha) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">alpha</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="nv">unscaled = </span><span class="nx">alpha</span> <span class="o">/</span> <span class="mi">100</span>
      <span class="vi">@alpha = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">unscaled</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newAlpha = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
      <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newAlpha</span><span class="p">)</span>
        <span class="nv">unscaled = </span><span class="nx">newAlpha</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="vi">@alpha = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">unscaled</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">attach: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose new parent:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="nx">each</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
        <span class="vi">@isDraggable = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  <span class="nv">toggleIsDraggable: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isDraggable = </span><span class="o">not</span> <span class="nx">@isDraggable</span>
  
  <span class="nv">colorSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span>
  
  <span class="nv">numericalSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;setLeft&quot;</span><span class="p">,</span> <span class="s">&quot;setTop&quot;</span><span class="p">,</span> <span class="s">&quot;setWidth&quot;</span><span class="p">,</span> <span class="s">&quot;setHeight&quot;</span><span class="p">,</span> <span class="s">&quot;setAlphaScaled&quot;</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Morph entry field tabbing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">allEntryFields: </span><span class="o">-&gt;</span>
    <span class="nx">@allChildren</span><span class="p">().</span><span class="nx">filter</span> <span class="nf">(each) -&gt;</span>
      <span class="nx">each</span><span class="p">.</span><span class="nx">isEditable</span>
  
  
  <span class="nv">nextEntryField: </span><span class="nf">(current) -&gt;</span>
    <span class="nv">fields = </span><span class="nx">@allEntryFields</span><span class="p">()</span>
    <span class="nv">idx = </span><span class="nx">fields</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
      <span class="nx">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
  <span class="nv">previousEntryField: </span><span class="nf">(current) -&gt;</span>
    <span class="nv">fields = </span><span class="nx">@allEntryFields</span><span class="p">()</span>
    <span class="nv">idx = </span><span class="nx">fields</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">idx</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">fields</span><span class="p">[</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
  
  <span class="nv">tab: </span><span class="nf">(editField) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>the <tab> key was pressed in one of my edit fields.
invoke my "nextTab()" function if it exists, else
propagate it up my owner chain.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@nextTab</span>
      <span class="nx">@nextTab</span> <span class="nx">editField</span>
    <span class="k">else</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">tab</span> <span class="nx">editField</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">backTab: </span><span class="nf">(editField) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>the <back tab> key was pressed in one of my edit fields.
invoke my "previousTab()" function if it exists, else
propagate it up my owner chain.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@previousTab</span>
      <span class="nx">@previousTab</span> <span class="nx">editField</span>
    <span class="k">else</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">backTab</span> <span class="nx">editField</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>the following are examples of what the navigation methods should
look like. Insert these at the World level for fallback, and at lower
levels in the Morphic tree (e.g. dialog boxes) for a more fine-grained
control over the tabbing cycle.</p>

<p>Morph.prototype.nextTab = function (editField) {
var    next = this.nextEntryField(editField);
editField.clearSelection();
next.selectAll();
next.edit();
};</p>

<p>Morph.prototype.previousTab = function (editField) {
var    prev = this.previousEntryField(editField);
editField.clearSelection();
prev.selectAll();
prev.edit();
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Morph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">escalateEvent: </span><span class="nf">(functionName, arg) -&gt;</span>
    <span class="nv">handler = </span><span class="nx">@parent</span>
    <span class="nv">handler = </span><span class="nx">handler</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">while</span> <span class="o">not</span> <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span> <span class="o">and</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">parent</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span> <span class="nx">arg</span>  <span class="k">if</span> <span class="nx">handler</span><span class="p">[</span><span class="nx">functionName</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Morph eval:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">evaluateString: </span><span class="nf">(code) -&gt;</span>
    <span class="k">try</span>
      <span class="nv">result = </span><span class="nb">eval</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span>
    <span class="nx">result</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>Morph collision detection:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isTouching: </span><span class="nf">(otherMorph) -&gt;</span>
    <span class="nv">oImg = </span><span class="nx">@overlappingImage</span><span class="p">(</span><span class="nx">otherMorph</span><span class="p">)</span>
    <span class="nv">data = </span><span class="nx">oImg</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">oImg</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">oImg</span><span class="p">.</span><span class="nx">height</span><span class="p">).</span><span class="nx">data</span>
    <span class="nx">detect</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nf">(each) -&gt;</span>
      <span class="nx">each</span> <span class="o">isnt</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">overlappingImage: </span><span class="nf">(otherMorph) -&gt;</span>
    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nv">otherFb = </span><span class="nx">otherMorph</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">()</span>
    <span class="nv">oRect = </span><span class="nx">fb</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">)</span>
    <span class="nv">oImg = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nv">ctx = </span><span class="nx">oImg</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">@fullImage</span><span class="p">(),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">ctx.globalCompositeOperation = </span><span class="s">&quot;source-in&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">otherMorph</span><span class="p">.</span><span class="nx">fullImage</span><span class="p">(),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">otherFb</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">oRect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">oImg</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>ShadowMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ShadowMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>BoxMorph ////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>I can have an optionally rounded border</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BoxMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">edge: </span><span class="kc">null</span>
  <span class="nv">border: </span><span class="kc">null</span>
  <span class="nv">borderColor: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@edge = 4, border, borderColor) -&gt;</span>
    <span class="vi">@border = </span><span class="nx">border</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">2</span><span class="p">))</span>
    <span class="vi">@borderColor = </span><span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>BoxMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@edge</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">@border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">super</span><span class="p">()</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@outlinePath</span> <span class="nx">context</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@edge</span> <span class="o">-</span> <span class="nx">@border</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@border</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@border</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">context.lineWidth = </span><span class="nx">@border</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">@borderColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">@outlinePath</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@border</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
  
  <span class="nv">outlinePath: </span><span class="nf">(context, radius, inset) -&gt;</span>
    <span class="nv">offset = </span><span class="nx">radius</span> <span class="o">+</span> <span class="nx">inset</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>top left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>top right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>bottom right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>bottom left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">),</span> <span class="kc">false</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>BoxMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;border width...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nborder\nwidth:&quot;</span><span class="p">,</span>
        <span class="nx">@setBorderWidth</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@border</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the border&#39;s\nline size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;border color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nborder color:&quot;</span><span class="p">,</span> <span class="nx">@setBorderColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@borderColor</span>
    <span class="p">),</span> <span class="s">&quot;set the border&#39;s\nline color&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;corner size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncorner\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setCornerSize</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@edge</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the corner&#39;s\nradius&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setBorderWidth: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@border = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@border = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setBorderColor: </span><span class="nf">(color) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">color</span>
      <span class="vi">@borderColor = </span><span class="nx">color</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setCornerSize: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@edge = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@edge = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">colorSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;borderColor&quot;</span><span class="p">]</span>
  
  <span class="nv">numericalSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;setBorderWidth&quot;</span><span class="p">,</span> <span class="s">&quot;setCornerSize&quot;</span>
    <span class="nx">list</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>SpeechBubbleMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>I am a comic-style speech bubble that can display either a string,
a Morph, a Canvas or a toString() representation of anything else.
If I am invoked using popUp() I behave like a tool tip.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SpeechBubbleMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">isPointingRight: </span><span class="kc">true</span> <span class="c1"># orientation of text</span>
  <span class="nv">contents: </span><span class="kc">null</span>
  <span class="nv">padding: </span><span class="kc">null</span> <span class="c1"># additional vertical pixels</span>
  <span class="nv">isThought: </span><span class="kc">null</span> <span class="c1"># draw &quot;think&quot; bubble</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">    @contents=&quot;&quot;,</span>
<span class="nf">    color,</span>
<span class="nf">    edge,</span>
<span class="nf">    border,</span>
<span class="nf">    borderColor,</span>
<span class="nf">    @padding = 0,</span>
<span class="nf">    @isThought = false) -&gt;</span>
      <span class="k">super</span> <span class="nx">edge</span> <span class="o">or</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">border</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">border</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)),</span> <span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">230</span><span class="p">)</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>SpeechBubbleMorph invoking:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">popUp: </span><span class="nf">(world, pos) -&gt;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span>
    <span class="nx">@keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">temporaries</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@</span>
    <span class="vi">@mouseEnter = </span><span class="o">-&gt;</span>
      <span class="nx">@destroy</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>SpeechBubbleMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>re-build my contents</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@contentsMorph</span>
    <span class="k">if</span> <span class="nx">@contents</span> <span class="k">instanceof</span> <span class="nx">Morph</span>
      <span class="vi">@contentsMorph = </span><span class="nx">@contents</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">@contents</span><span class="p">)</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span>
        <span class="nx">@contents</span><span class="p">,</span>
        <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">bubbleHelpFontSize</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="kc">true</span><span class="p">,</span>
        <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@contents</span> <span class="k">instanceof</span> <span class="nx">HTMLCanvasElement</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
      <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span>
      <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span>
      <span class="vi">@contentsMorph.image = </span><span class="nx">@contents</span>
    <span class="k">else</span>
      <span class="vi">@contentsMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span>
        <span class="nx">@contents</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">bubbleHelpFontSize</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="kc">true</span><span class="p">,</span>
        <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@contentsMorph</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>adjust my layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@silentSetWidth</span> <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@padding</span> <span class="k">then</span> <span class="nx">@padding</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">else</span> <span class="nx">@edge</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nx">@silentSetHeight</span> <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span> <span class="o">+</span> <span class="nx">@border</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">@padding</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>draw my outline</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>position my contents</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@contentsMorph</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span>
      <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@padding</span> <span class="o">or</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@border</span> <span class="o">+</span> <span class="nx">@padding</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
  
  <span class="nv">outlinePath: </span><span class="nf">(context, radius, inset) -&gt;</span>
    <span class="nv">circle = </span><span class="nf">(x, y, r) -&gt;</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
    <span class="nv">offset = </span><span class="nx">radius</span> <span class="o">+</span> <span class="nx">inset</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>top left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>top right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>bottom right:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="kc">false</span>
    <span class="nx">unless</span> <span class="nx">@isThought</span> <span class="c1"># draw speech bubble hook</span>
      <span class="k">if</span> <span class="nx">@isPointingRight</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">offset</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">radius</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">inset</span>
      <span class="k">else</span> <span class="c1"># pointing left</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">inset</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>bottom left:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">),</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="nx">@isThought</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>close large bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">offset</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>draw thought bubbles:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@isPointingRight</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>tip bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>middle bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">3.2</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>top bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">2.8</span>
        <span class="nx">circle</span> <span class="nx">rad</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">rad</span>
      <span class="k">else</span> <span class="c1"># pointing left</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>tip bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>middle bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">3.2</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">inset</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>top bubble:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">rad = </span><span class="nx">radius</span> <span class="o">/</span> <span class="mf">2.8</span>
        <span class="nx">circle</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">rad</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">rad</span> <span class="o">-</span> <span class="nx">inset</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">rad</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Global settings /////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>global window, HTMLCanvasElement, getMinimumFontHeight, FileReader, Audio,
FileList, getBlurredShadowSupport</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">modules = </span><span class="p">{}</span> <span class="c1"># keep track of additional loaded modules</span>

<span class="nv">useBlurredShadows = </span><span class="nx">getBlurredShadowSupport</span><span class="p">()</span> <span class="c1"># check for Chrome-bug</span>

<span class="nv">standardSettings =</span>
  <span class="nv">minimumFontHeight: </span><span class="nx">getMinimumFontHeight</span><span class="p">()</span> <span class="c1"># browser settings</span>
  <span class="nv">globalFontFamily: </span><span class="s">&quot;&quot;</span>
  <span class="nv">menuFontName: </span><span class="s">&quot;sans-serif&quot;</span>
  <span class="nv">menuFontSize: </span><span class="mi">12</span>
  <span class="nv">bubbleHelpFontSize: </span><span class="mi">10</span>
  <span class="nv">prompterFontName: </span><span class="s">&quot;sans-serif&quot;</span>
  <span class="nv">prompterFontSize: </span><span class="mi">12</span>
  <span class="nv">prompterSliderSize: </span><span class="mi">10</span>
  <span class="nv">handleSize: </span><span class="mi">15</span>
  <span class="nv">scrollBarSize: </span><span class="mi">12</span>
  <span class="nv">mouseScrollAmount: </span><span class="mi">40</span>
  <span class="nv">useSliderForInput: </span><span class="kc">false</span>
  <span class="nv">useVirtualKeyboard: </span><span class="kc">true</span>

<span class="nv">touchScreenSettings =</span>
  <span class="nv">minimumFontHeight: </span><span class="nx">standardSettings</span><span class="p">.</span><span class="nx">minimumFontHeight</span>
  <span class="nv">globalFontFamily: </span><span class="s">&quot;&quot;</span>
  <span class="nv">menuFontName: </span><span class="s">&quot;sans-serif&quot;</span>
  <span class="nv">menuFontSize: </span><span class="mi">24</span>
  <span class="nv">bubbleHelpFontSize: </span><span class="mi">18</span>
  <span class="nv">prompterFontName: </span><span class="s">&quot;sans-serif&quot;</span>
  <span class="nv">prompterFontSize: </span><span class="mi">24</span>
  <span class="nv">prompterSliderSize: </span><span class="mi">20</span>
  <span class="nv">handleSize: </span><span class="mi">26</span>
  <span class="nv">scrollBarSize: </span><span class="mi">24</span>
  <span class="nv">mouseScrollAmount: </span><span class="mi">40</span>
  <span class="nv">useSliderForInput: </span><span class="kc">true</span>
  <span class="nv">useVirtualKeyboard: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>FrameMorph //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>I clip my submorphs at my bounds</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">FrameMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="vi">@scrollFrame: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@scrollFrame = null) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="vi">@acceptsDrops = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@isDraggable = </span><span class="kc">false</span>
      <span class="vi">@noticesTransparentClick = </span><span class="kc">false</span>
      <span class="vi">@alpha = </span><span class="mi">0</span>
  
  <span class="nv">fullBounds: </span><span class="o">-&gt;</span>
    <span class="nv">shadow = </span><span class="nx">@getShadow</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">shadow</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@bounds</span>
  
  <span class="nv">fullImage: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>use only for shadows</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@image</span>
  
  <span class="nv">fullDrawOn: </span><span class="nf">(aCanvas, aRect) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@isVisible</span>
    <span class="nv">boundsRectangle = </span><span class="nx">aRect</span> <span class="o">or</span> <span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nx">@drawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">boundsRectangle</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">fullDrawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">boundsRectangle</span>
      <span class="k">else</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">fullDrawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">boundsRectangle</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>FrameMorph scrolling optimization:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">silentMoveBy</span> <span class="nx">delta</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>FrameMorph scrolling support:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submorphBounds: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">result = </span><span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bounds</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">())</span>
    <span class="nx">result</span>
  
  <span class="nv">keepInScrollFrame: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@right</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">())</span>  
    <span class="k">if</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="mi">0</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@bottom</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">adjustBounds: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nv">subBounds = </span><span class="nx">@submorphBounds</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">subBounds</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span><span class="p">)</span>
      <span class="nv">newBounds = </span><span class="nx">subBounds</span><span class="p">.</span><span class="nx">expandBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">padding</span><span class="p">).</span><span class="nx">growBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">growth</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newBounds = </span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">unless</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">newBounds</span><span class="p">)</span>
      <span class="vi">@bounds = </span><span class="nx">newBounds</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@keepInScrollFrame</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">morph</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="k">instanceof</span> <span class="nx">TextMorph</span>
          <span class="nx">morph</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">@width</span><span class="p">()</span>
          <span class="nx">@setHeight</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">adjustScrollBars</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>FrameMorph dragging &amp; dropping of contents:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reactToDropOf: </span><span class="o">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  <span class="nv">reactToGrabOf: </span><span class="o">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>FrameMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.frame = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">frame</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>FrameMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">keepAllSubmorphsWithin: </span><span class="o">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>WorldMorph //////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions
REQUIRES globalSettings</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>I represent the <canvas> element</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">WorldMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>this variable shouldn't be static to the World, because
in pure theory you could have multiple worlds in the same
page with different settings
(but anyways, it was global before, so it's not any worse than before)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@MorphicPreferences = </span><span class="nx">standardSettings</span>

  <span class="nv">constructor: </span><span class="nf">(aCanvas, fillPage) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="c1"># (130, 130, 130)</span>
    <span class="vi">@alpha = </span><span class="mi">1</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">aCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="vi">@isVisible = </span><span class="kc">true</span>
    <span class="vi">@isDraggable = </span><span class="kc">false</span>
    <span class="vi">@currentKey = </span><span class="kc">null</span> <span class="c1"># currently pressed key code</span>
    <span class="vi">@worldCanvas = </span><span class="nx">aCanvas</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@useFillPage = </span><span class="nx">fillPage</span>
    <span class="vi">@useFillPage = </span><span class="kc">true</span>  <span class="k">if</span> <span class="nx">@useFillPage</span> <span class="o">is</span> <span class="o">`</span><span class="kc">undefined</span><span class="o">`</span>
    <span class="vi">@isDevMode = </span><span class="kc">false</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
    <span class="vi">@hand = </span><span class="k">new</span> <span class="nx">HandMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="vi">@keyboardReceiver = </span><span class="kc">null</span>
    <span class="vi">@lastEditedText = </span><span class="kc">null</span>
    <span class="vi">@cursor = </span><span class="kc">null</span>
    <span class="vi">@activeMenu = </span><span class="kc">null</span>
    <span class="vi">@activeHandle = </span><span class="kc">null</span>
    <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@initEventListeners</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>World Morph display:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">brokenFor: </span><span class="nf">(aMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">()</span>
    <span class="nx">@broken</span><span class="p">.</span><span class="nx">filter</span> <span class="nf">(rect) -&gt;</span>
      <span class="nx">rect</span><span class="p">.</span><span class="nx">intersects</span> <span class="nx">fb</span>
  
  
  <span class="nv">fullDrawOn: </span><span class="nf">(aCanvas, aRect) -&gt;</span>
    <span class="k">super</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>the mouse cursor is always drawn on top of everything
and it'd not attached to the WorldMorph.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@hand</span><span class="p">.</span><span class="nx">fullDrawOn</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">aRect</span>
  
  <span class="nv">updateBroken: </span><span class="o">-&gt;</span>
    <span class="nx">@broken</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@fullDrawOn</span> <span class="nx">@worldCanvas</span><span class="p">,</span> <span class="nx">rect</span>  <span class="k">if</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">gt</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="vi">@broken = </span><span class="p">[]</span>
  
  <span class="nv">doOneCycle: </span><span class="o">-&gt;</span>
    <span class="nx">@runChildrensStepFunction</span><span class="p">()</span>
    <span class="nx">@updateBroken</span><span class="p">()</span>
  
  <span class="nv">fillPage: </span><span class="o">-&gt;</span>
    <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
    <span class="nv">clientHeight = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>
    <span class="nv">clientWidth = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.left = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.x = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@worldCanvas.style.position = </span><span class="s">&quot;absolute&quot;</span>
      <span class="vi">@worldCanvas.style.top = </span><span class="s">&quot;0px&quot;</span>
      <span class="nv">pos.y = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>scrolled down b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientHeight = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>scrolled left b/c of viewport scaling</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">clientWidth = </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span>  <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">isnt</span> <span class="nx">clientWidth</span>
      <span class="vi">@worldCanvas.width = </span><span class="nx">clientWidth</span>
      <span class="nx">@setWidth</span> <span class="nx">clientWidth</span>
    <span class="k">if</span> <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">isnt</span> <span class="nx">clientHeight</span>
      <span class="vi">@worldCanvas.height = </span><span class="nx">clientHeight</span>
      <span class="nx">@setHeight</span> <span class="nx">clientHeight</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">reactToWorldResize</span>
  
  
  </pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>WorldMorph global pixel access:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getGlobalPixelColor: </span><span class="nf">(point) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>answer the color at the given point.</p>

<p>Note: for some strange reason this method works fine if the page is
opened via HTTP, but <em>not</em>, if it is opened from a local uri
(e.g. from a directory), in which case it's always null.</p>

<p>This behavior is consistent throughout several browsers. I have no
clue what's behind this, apparently the imageData attribute of
canvas context only gets filled with meaningful data if transferred
via HTTP ???</p>

<p>This is somewhat of a showstopper for color detection in a planned
offline version of Snap.</p>

<p>The issue has also been discussed at: (join lines before pasting)
http://stackoverflow.com/questions/4069400/
canvas-getimagedata-doesnt-work-when-running-locally-on-windows-
security-excep</p>

<p>The suggestion solution appears to work, since the settings are
applied globally.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dta = </span><span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">data</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">dta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">dta</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>WorldMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initVirtualKeyboard: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@virtualKeyboard</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@virtualKeyboard</span>
      <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="k">return</span>  <span class="nx">unless</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span>
    <span class="vi">@virtualKeyboard = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)</span>
    <span class="vi">@virtualKeyboard.type = </span><span class="s">&quot;text&quot;</span>
    <span class="vi">@virtualKeyboard.style.color = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@virtualKeyboard.style.backgroundColor = </span><span class="s">&quot;transparent&quot;</span>
    <span class="vi">@virtualKeyboard.style.border = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@virtualKeyboard.style.outline = </span><span class="s">&quot;none&quot;</span>
    <span class="vi">@virtualKeyboard.style.position = </span><span class="s">&quot;absolute&quot;</span>
    <span class="vi">@virtualKeyboard.style.top = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.left = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.width = </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@virtualKeyboard.style.height = </span><span class="s">&quot;0px&quot;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@virtualKeyboard</span>
    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>remember the keyCode in the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>  </pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>flush the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>  
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
  
  <span class="nv">initEventListeners: </span><span class="o">-&gt;</span>
    <span class="nv">canvas = </span><span class="nx">@worldCanvas</span>
    <span class="k">if</span> <span class="nx">@useFillPage</span>
      <span class="nx">@fillPage</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseDown</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchstart&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchStart</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseUp</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchend&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchEnd</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseMove</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;touchmove&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processTouchMove</span> <span class="nx">event</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;contextmenu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>suppress context menu for Mac-Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>remember the keyCode in the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyDown</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>supress backspace override</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0008&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Backspace&quot;</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>supress tab override and make sure tab gets
received by all browsers</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;U+0009&quot;</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyIdentifier</span> <span class="o">is</span> <span class="s">&quot;Tab&quot;</span>
        <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keyup&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>flush the world's currentKey property</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentKey = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>dispatch to keyboard receiver</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
        <span class="k">if</span> <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span>
          <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyUp</span> <span class="nx">event</span>    
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;keypress&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@keyboardReceiver</span><span class="p">.</span><span class="nx">processKeyPress</span> <span class="nx">event</span>  <span class="k">if</span> <span class="nx">@keyboardReceiver</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>Safari, Chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;mousewheel&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;DOMMouseScroll&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processMouseScroll</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;dragover&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nf">(event) -&gt;</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;drop&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@hand</span><span class="p">.</span><span class="nx">processDrop</span> <span class="nx">event</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">=&gt;</span>
      <span class="nx">@fillPage</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@useFillPage</span>
    <span class="p">),</span> <span class="kc">false</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">onbeforeunload = </span><span class="nf">(evt) -&gt;</span>
      <span class="nv">e = </span><span class="nx">evt</span> <span class="o">or</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span>
      <span class="nv">msg = </span><span class="s">&quot;Are you sure you want to leave?&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>For IE and Firefox</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">e.returnValue = </span><span class="nx">msg</span>  <span class="k">if</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>For Safari / chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">msg</span>
  
  <span class="nv">mouseDownLeft: </span><span class="o">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseDownRight: </span><span class="o">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">mouseClickRight: </span><span class="o">-&gt;</span>
    <span class="nx">noOperation</span>
  
  <span class="nv">wantsDropOf: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>allow handle drops if any drops are allowed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@acceptsDrops</span>
  
  <span class="nv">droppedImage: </span><span class="o">-&gt;</span>
    <span class="kc">null</span>
  </pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>WorldMorph text field tabbing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">nextTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">next = </span><span class="nx">@nextEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">next</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
    <span class="nx">next</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  <span class="nv">previousTab: </span><span class="nf">(editField) -&gt;</span>
    <span class="nv">prev = </span><span class="nx">@previousEntryField</span><span class="p">(</span><span class="nx">editField</span><span class="p">)</span>
    <span class="nx">editField</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">prev</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
    <span class="nx">prev</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>WorldMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">contextMenu: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span>
        <span class="nx">@</span><span class="p">,</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;Morphic&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;demo...&quot;</span><span class="p">,</span> <span class="s">&quot;userCreateMorph&quot;</span><span class="p">,</span> <span class="s">&quot;sample morphs&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide all...&quot;</span><span class="p">,</span> <span class="s">&quot;hideAll&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show all...&quot;</span><span class="p">,</span> <span class="s">&quot;showAllHiddens&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect...&quot;</span><span class="p">,</span> <span class="s">&quot;inspect&quot;</span><span class="p">,</span> <span class="s">&quot;open a window on\nall properties&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;restore display&quot;</span><span class="p">,</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span> <span class="s">&quot;redraw the\nscreen once&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;fill page...&quot;</span><span class="p">,</span> <span class="s">&quot;fillPage&quot;</span><span class="p">,</span> <span class="s">&quot;let the World automatically\nadjust to browser resizings&quot;</span>
      <span class="k">if</span> <span class="nx">useBlurredShadows</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sharp shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;sharp drop shadows\nuse for old browsers&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;blurred shadows...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleBlurredShadows&quot;</span><span class="p">,</span> <span class="s">&quot;blurry shades,\n use for new browsers&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
        <span class="nx">@pickColor</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\ncolor:&quot;</span><span class="p">,</span> <span class="nx">@setColor</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@color</span>
      <span class="p">),</span> <span class="s">&quot;choose the World&#39;s\nbackground color&quot;</span>
      <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;touch screen settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;bigger menu fonts\nand sliders&quot;</span>
      <span class="k">else</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;standard settings&quot;</span><span class="p">,</span> <span class="s">&quot;togglePreferences&quot;</span><span class="p">,</span> <span class="s">&quot;smaller menu fonts\nand sliders&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isDevMode</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;user mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span><span class="p">,</span> <span class="s">&quot;disable developers&#39;\ncontext menus&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;development mode...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleDevMode&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;about morphic.js...&quot;</span><span class="p">,</span> <span class="s">&quot;about&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">userCreateMorph: </span><span class="o">-&gt;</span>
    <span class="nv">create = </span><span class="p">(</span><span class="nx">aMorph</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">aMorph.isDraggable = </span><span class="kc">true</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">pickUp</span> <span class="nx">@</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;make a morph&quot;</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;rectangle&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;box&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;circle box&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">CircleBoxMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;slider&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;frame&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">FrameMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;scroll frame&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
      <span class="nv">newMorph.contents.acceptsDrops = </span><span class="kc">true</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;handle&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;Ich weiß nicht, was soll es bedeuten, dass ich so &quot;</span> <span class="o">+</span>
        <span class="s">&quot;traurig bin, ein Märchen aus uralten Zeiten, das &quot;</span> <span class="o">+</span>
        <span class="s">&quot;kommt mir nicht aus dem Sinn. Die Luft ist kühl &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und es dunkelt, und ruhig fließt der Rhein; der &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Gipfel des Berges funkelt im Abendsonnenschein. &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Die schönste Jungfrau sitzet dort oben wunderbar, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;ihr gold&#39;nes Geschmeide blitzet, sie kämmt ihr &quot;</span> <span class="o">+</span>
        <span class="s">&quot;goldenes Haar, sie kämmt es mit goldenem Kamme, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;und singt ein Lied dabei; das hat eine wundersame, &quot;</span> <span class="o">+</span>
        <span class="s">&quot;gewalt&#39;ge Melodei. Den Schiffer im kleinen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Schiffe, ergreift es mit wildem Weh; er schaut &quot;</span> <span class="o">+</span>
        <span class="s">&quot;nicht die Felsenriffe, er schaut nur hinauf in &quot;</span> <span class="o">+</span>
        <span class="s">&quot;die Höh&#39;. Ich glaube, die Wellen verschlingen &quot;</span> <span class="o">+</span>
        <span class="s">&quot;am Ende Schiffer und Kahn, und das hat mit ihrem &quot;</span> <span class="o">+</span>
        <span class="s">&quot;Singen, die Loreley getan.&quot;</span><span class="p">)</span>
      <span class="nv">newMorph.isEditable = </span><span class="kc">true</span>
      <span class="nv">newMorph.maxWidth = </span><span class="mi">300</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;speech bubble&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">SpeechBubbleMorph</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;gray scale palette&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">GrayPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color palette&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPaletteMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;color picker&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">ColorPickerMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sensor demo&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MouseSensorMorph</span><span class="p">()</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nv">newMorph.edge = </span><span class="mi">35</span>
      <span class="nv">newMorph.border = </span><span class="mi">15</span>
      <span class="nv">newMorph.borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nv">newMorph.alpha = </span><span class="mf">0.2</span>
      <span class="nx">newMorph</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;animation demo&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">foo = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
      <span class="nv">foo.alpha = </span><span class="mf">0.9</span>
      <span class="nv">foo.speed = </span><span class="mi">3</span>
      <span class="nv">bar = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
      <span class="nv">bar.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">bar.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">bar.alpha = </span><span class="mf">0.9</span>
      <span class="nv">bar.speed = </span><span class="mi">5</span>
      <span class="nv">baz = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">baz</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
      <span class="nv">baz.type = </span><span class="s">&quot;horizontal&quot;</span>
      <span class="nv">baz.direction = </span><span class="s">&quot;right&quot;</span>
      <span class="nv">baz.speed = </span><span class="mi">3</span>
      <span class="nv">garply = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">garply</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">garply.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">garply.direction = </span><span class="s">&quot;up&quot;</span>
      <span class="nv">garply.speed = </span><span class="mi">8</span>
      <span class="nv">fred = </span><span class="k">new</span> <span class="nx">BouncerMorph</span><span class="p">()</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setColor</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
      <span class="nx">fred</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
      <span class="nv">fred.type = </span><span class="s">&quot;vertical&quot;</span>
      <span class="nv">fred.direction = </span><span class="s">&quot;down&quot;</span>
      <span class="nv">fred.speed = </span><span class="mi">4</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">garply</span>
      <span class="nx">bar</span><span class="p">.</span><span class="nx">add</span> <span class="nx">baz</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">fred</span>
      <span class="nx">foo</span><span class="p">.</span><span class="nx">add</span> <span class="nx">bar</span>
      <span class="nx">create</span> <span class="nx">foo</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;pen&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">create</span> <span class="k">new</span> <span class="nx">PenMorph</span><span class="p">()</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;view all...&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">newMorph = </span><span class="k">new</span> <span class="nx">MorphsListMorph</span><span class="p">()</span>
      <span class="nx">create</span> <span class="nx">newMorph</span>
    
    <span class="k">if</span> <span class="nx">@customMorphs</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">@customMorphs</span><span class="p">().</span><span class="nx">forEach</span> <span class="nf">(morph) -&gt;</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="o">-&gt;</span>
          <span class="nx">create</span> <span class="nx">morph</span>
    
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@</span>
  
  <span class="nv">toggleDevMode: </span><span class="o">-&gt;</span>
    <span class="vi">@isDevMode = </span><span class="o">not</span> <span class="nx">@isDevMode</span>
  
  <span class="nv">hideAll: </span><span class="o">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  <span class="nv">showAllHiddens: </span><span class="o">-&gt;</span>
    <span class="nx">@forAllChildren</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isVisible</span>
  
  <span class="nv">about: </span><span class="o">-&gt;</span>
    <span class="nv">versions = </span><span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">module</span> <span class="k">of</span> <span class="nx">modules</span>
      <span class="k">if</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span>
        <span class="nx">versions</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="nx">module</span> <span class="o">+</span> <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">modules</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">versions</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
      <span class="nv">versions = </span><span class="s">&quot;\n\nmodules:\n\n&quot;</span> <span class="o">+</span> <span class="s">&quot;morphic (&quot;</span> <span class="o">+</span> <span class="nx">morphicVersion</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span> <span class="o">+</span> <span class="nx">versions</span>  
    <span class="nx">@inform</span> <span class="s">&quot;morphic.js\n\n&quot;</span> <span class="o">+</span>
      <span class="s">&quot;a lively Web GUI\ninspired by Squeak\n&quot;</span> <span class="o">+</span>
      <span class="nx">morphicVersion</span> <span class="o">+</span>
      <span class="s">&quot;\n\original from Jens Mönig&#39;s (jens@moenig.org) morphic.js\n&quot;</span> <span class="o">+</span>
      <span class="s">&quot;\n\nported and extended by Davide Della Casa\n&quot;</span> <span class="o">+</span>
      <span class="nx">versions</span>
  
  <span class="nv">edit: </span><span class="nf">(aStringOrTextMorph) -&gt;</span>
    <span class="nv">pos = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@worldCanvas</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">isEditable</span>
    <span class="nx">@cursor</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@cursor</span>
    <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@lastEditedText</span>
    <span class="vi">@cursor = </span><span class="k">new</span> <span class="nx">CursorMorph</span><span class="p">(</span><span class="nx">aStringOrTextMorph</span><span class="p">)</span>
    <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@cursor</span>
    <span class="vi">@keyboardReceiver = </span><span class="nx">@cursor</span>
    <span class="nx">@initVirtualKeyboard</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useVirtualKeyboard</span>
      <span class="vi">@virtualKeyboard.style.top = </span><span class="nx">@cursor</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="vi">@virtualKeyboard.style.left = </span><span class="nx">@cursor</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s">&quot;px&quot;</span>
      <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">useSliderForInput</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">parentThatIsA</span><span class="p">(</span><span class="nx">MenuMorph</span><span class="p">)</span>
        <span class="nx">@slide</span> <span class="nx">aStringOrTextMorph</span>
  
  <span class="nv">slide: </span><span class="nf">(aStringOrTextMorph) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>display a slider for numeric text entries</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">val = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
    <span class="nv">val = </span><span class="mi">0</span>  <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
    <span class="nv">slider = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="nx">val</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
    <span class="nv">slider.alpha = </span><span class="mi">1</span>
    <span class="nv">slider.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">225</span><span class="p">)</span>
    <span class="nv">slider.button.color = </span><span class="nx">menu</span><span class="p">.</span><span class="nx">borderColor</span>
    <span class="nv">slider.button.highlightColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">highlightColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">100</span>
    <span class="nv">slider.button.pressColor = </span><span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">button</span><span class="p">.</span><span class="nx">pressColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">+=</span> <span class="mi">150</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetHeight</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="nx">slider</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nv">slider.action = </span><span class="nf">(num) -&gt;</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nv">aStringOrTextMorph.text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
      <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">menu</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slider</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popup</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">aStringOrTextMorph</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
  
  <span class="nv">stopEditing: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@cursor</span>
      <span class="vi">@lastEditedText = </span><span class="nx">@cursor</span><span class="p">.</span><span class="nx">target</span>
      <span class="nx">@cursor</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="nx">@lastEditedText</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToEdit&quot;</span><span class="p">,</span> <span class="nx">@lastEditedText</span>
    <span class="vi">@keyboardReceiver = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@virtualKeyboard</span>
      <span class="nx">@virtualKeyboard</span><span class="p">.</span><span class="nx">blur</span><span class="p">()</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">@virtualKeyboard</span>
      <span class="vi">@virtualKeyboard = </span><span class="kc">null</span>
    <span class="nx">@worldCanvas</span><span class="p">.</span><span class="nx">focus</span><span class="p">()</span>
  
  <span class="nv">toggleBlurredShadows: </span><span class="o">-&gt;</span>
    <span class="nv">useBlurredShadows = </span><span class="o">not</span> <span class="nx">useBlurredShadows</span>
  
  <span class="nv">togglePreferences: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span> <span class="o">is</span> <span class="nx">standardSettings</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">touchScreenSettings</span>
    <span class="k">else</span>
      <span class="nv">WorldMorph.MorphicPreferences = </span><span class="nx">standardSettings</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>ScrollFrameMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ScrollFrameMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span>

  <span class="nv">autoScrollTrigger: </span><span class="kc">null</span>
  <span class="nv">hasVelocity: </span><span class="kc">true</span> <span class="c1"># dto.</span>
  <span class="nv">padding: </span><span class="mi">0</span> <span class="c1"># around the scrollable area</span>
  <span class="nv">growth: </span><span class="mi">0</span> <span class="c1"># pixels or Point to grow right/left when near edge</span>
  <span class="nv">isTextLineWrapping: </span><span class="kc">false</span>
  <span class="nv">isScrollingByDragging: </span><span class="kc">true</span>
  <span class="nv">scrollBarSize: </span><span class="kc">null</span>
  <span class="nv">contents: </span><span class="kc">null</span>
  <span class="nv">vBar: </span><span class="kc">null</span>
  <span class="nv">hBar: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(contents, scrollBarSize, sliderColor) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@scrollBarSize = </span><span class="nx">scrollBarSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
    <span class="vi">@contents = </span><span class="nx">contents</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">FrameMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@contents</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@hBar = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;horizontal&quot;</span><span class="p">,</span> <span class="nx">sliderColor</span><span class="p">)</span>
    <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">@scrollBarSize</span>
    <span class="vi">@hBar.action = </span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
    <span class="vi">@hBar.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@add</span> <span class="nx">@hBar</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@vBar = </span><span class="k">new</span> <span class="nx">SliderMorph</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&quot;vertical&quot;</span><span class="p">,</span> <span class="nx">sliderColor</span><span class="p">)</span>
    <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">@scrollBarSize</span>
    <span class="vi">@vBar.action = </span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">)</span>
    <span class="vi">@vBar.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@add</span> <span class="nx">@vBar</span>
  
  <span class="nv">adjustScrollBars: </span><span class="o">-&gt;</span>
    <span class="nv">hWidth = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@scrollBarSize</span>
    <span class="nv">vHeight = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@scrollBarSize</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@width</span><span class="p">()</span> <span class="o">+</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">hWidth</span>  <span class="k">if</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">isnt</span> <span class="nx">hWidth</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
      <span class="vi">@hBar.start = </span><span class="mi">0</span>
      <span class="vi">@hBar.stop = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@width</span><span class="p">()</span>
      <span class="vi">@hBar.size = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@hBar</span><span class="p">.</span><span class="nx">stop</span>
      <span class="vi">@hBar.value = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@hBar</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@scrollBarSize</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">vHeight</span>  <span class="k">if</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">isnt</span> <span class="nx">vHeight</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">@top</span><span class="p">())</span>
      <span class="vi">@vBar.start = </span><span class="mi">0</span>
      <span class="vi">@vBar.stop = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@height</span><span class="p">()</span>
      <span class="vi">@vBar.size = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@vBar</span><span class="p">.</span><span class="nx">stop</span>
      <span class="vi">@vBar.value = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@vBar</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
  
  <span class="nv">addContents: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">add</span> <span class="nx">aMorph</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
  
  <span class="nv">setContents: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@contents.children = </span><span class="p">[]</span>
    <span class="nx">aMorph</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nx">@addContents</span> <span class="nx">aMorph</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@position</span><span class="p">().</span><span class="nx">copy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@isTextLineWrapping</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">adjustBounds</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>ScrollFrameMorph scrolling by dragging:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scrollX: </span><span class="nf">(steps) -&gt;</span>
    <span class="nv">cl = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">l = </span><span class="nx">@left</span><span class="p">()</span>
    <span class="nv">cw = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span>
    <span class="nv">newX = </span><span class="nx">cl</span> <span class="o">+</span> <span class="nx">steps</span>
    <span class="nv">newX = </span><span class="nx">l</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">&gt;</span> <span class="nx">l</span>
    <span class="nv">newX = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">cw</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">+</span> <span class="nx">cw</span> <span class="o">&lt;</span> <span class="nx">r</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">newX</span>  <span class="k">if</span> <span class="nx">newX</span> <span class="o">isnt</span> <span class="nx">cl</span>
  
  <span class="nv">scrollY: </span><span class="nf">(steps) -&gt;</span>
    <span class="nv">ct = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
    <span class="nv">t = </span><span class="nx">@top</span><span class="p">()</span>
    <span class="nv">ch = </span><span class="nx">@contents</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span>
    <span class="nv">newY = </span><span class="nx">ct</span> <span class="o">+</span> <span class="nx">steps</span>
    <span class="nv">newY = </span><span class="nx">t</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">&gt;</span> <span class="nx">t</span>
    <span class="nv">newY = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">ch</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">+</span> <span class="nx">ch</span> <span class="o">&lt;</span> <span class="nx">b</span>
    <span class="nx">@contents</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">newY</span>  <span class="k">if</span> <span class="nx">newY</span> <span class="o">isnt</span> <span class="nx">ct</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@isScrollingByDragging</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nv">oldPos = </span><span class="nx">pos</span>
    <span class="nv">deltaX = </span><span class="mi">0</span>
    <span class="nv">deltaY = </span><span class="mi">0</span>
    <span class="nv">friction = </span><span class="mf">0.8</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()))</span>
          <span class="nv">newPos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
          <span class="nv">deltaX = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">oldPos</span><span class="p">.</span><span class="nx">x</span>
          <span class="nx">@scrollX</span> <span class="nx">deltaX</span>  <span class="k">if</span> <span class="nx">deltaX</span> <span class="o">isnt</span> <span class="mi">0</span>
          <span class="nv">deltaY = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">oldPos</span><span class="p">.</span><span class="nx">y</span>
          <span class="nx">@scrollY</span> <span class="nx">deltaY</span>  <span class="k">if</span> <span class="nx">deltaY</span> <span class="o">isnt</span> <span class="mi">0</span>
          <span class="nv">oldPos = </span><span class="nx">newPos</span>
      <span class="k">else</span>
        <span class="nx">unless</span> <span class="nx">@hasVelocity</span>
          <span class="vi">@step = </span><span class="nx">noOperation</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">deltaX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">deltaY</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="vi">@step = </span><span class="nx">noOperation</span>
          <span class="k">else</span>
            <span class="nv">deltaX = </span><span class="nx">deltaX</span> <span class="o">*</span> <span class="nx">friction</span>
            <span class="nx">@scrollX</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">deltaX</span><span class="p">)</span>
            <span class="nv">deltaY = </span><span class="nx">deltaY</span> <span class="o">*</span> <span class="nx">friction</span>
            <span class="nx">@scrollY</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">deltaY</span><span class="p">)</span>
      <span class="nx">@adjustScrollBars</span><span class="p">()</span>
  
  <span class="nv">startAutoScrolling: </span><span class="o">-&gt;</span>
    <span class="nv">inset = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">world</span>
    <span class="nv">hand = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span>
    <span class="vi">@autoScrollTrigger = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">@autoScrollTrigger</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nv">pos = </span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
      <span class="nv">inner = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">insetBy</span><span class="p">(</span><span class="nx">inset</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">))</span> <span class="o">and</span>
        <span class="p">(</span><span class="o">not</span> <span class="p">(</span><span class="nx">inner</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)))</span> <span class="o">and</span>
        <span class="p">(</span><span class="nx">hand</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="nx">@autoScroll</span> <span class="nx">pos</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="nx">noOperation</span>
        <span class="vi">@autoScrollTrigger = </span><span class="kc">null</span>
  
  <span class="nv">autoScroll: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@autoScrollTrigger</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="nv">inset = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="nv">area = </span><span class="nx">@topLeft</span><span class="p">().</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">inset</span><span class="p">))</span>
    <span class="nx">@scrollY</span> <span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="nx">@topLeft</span><span class="p">().</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">inset</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@scrollX</span> <span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">,</span> <span class="nx">@top</span><span class="p">())).</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">inset</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nx">@scrollX</span> <span class="o">-</span><span class="p">(</span><span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nv">area = </span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">(),</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">inset</span><span class="p">)).</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">inset</span><span class="p">))</span>
    <span class="nx">@scrollY</span> <span class="o">-</span><span class="p">(</span><span class="nx">inset</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>  <span class="k">if</span> <span class="nx">area</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>ScrollFrameMorph scrolling by editing text:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scrollCursorIntoView: </span><span class="nf">(morph, padding) -&gt;</span>
    <span class="nv">ft = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">padding</span>
    <span class="nv">fb = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">padding</span>
    <span class="k">if</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">ft</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">ft</span> <span class="o">-</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">setTop</span> <span class="nx">ft</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">fb</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">fb</span> <span class="o">-</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">fb</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>ScrollFrameMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseScroll: </span><span class="nf">(y, x) -&gt;</span>
    <span class="nx">@scrollY</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">mouseScrollAmount</span>  <span class="k">if</span> <span class="nx">y</span>
    <span class="nx">@scrollX</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">mouseScrollAmount</span>  <span class="k">if</span> <span class="nx">x</span>
    <span class="nx">@adjustScrollBars</span><span class="p">()</span>
  
  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.contents = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@contents</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@contents</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">hBar</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@hBar</span><span class="p">]</span>
      <span class="nv">c.hBar = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@hBar</span><span class="p">])</span>
      <span class="nv">c.hBar.action = </span><span class="nf">(num) -&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">vBar</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@vBar</span><span class="p">]</span>
      <span class="nv">c.vBar = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@vBar</span><span class="p">])</span>
      <span class="nv">c.vBar.action = </span><span class="nf">(num) -&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">x</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">num</span><span class="p">)</span>
    <span class="nx">c</span>
  
  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isTextLineWrapping</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;auto line wrap off...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleTextLineWrapping&quot;</span><span class="p">,</span> <span class="s">&quot;turn automatic\nline wrapping\noff&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;auto line wrap on...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleTextLineWrapping&quot;</span><span class="p">,</span> <span class="s">&quot;enable automatic\nline wrapping&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">toggleTextLineWrapping: </span><span class="o">-&gt;</span>
    <span class="vi">@isTextLineWrapping = </span><span class="o">not</span> <span class="nx">@isTextLineWrapping</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>BlinkerMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>can be used for text cursors</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BlinkerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>
  <span class="nv">constructor: </span><span class="nf">(@fps = 2) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>BlinkerMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="o">-&gt;</span>
    <span class="nx">@toggleVisibility</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>CursorMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>I am a String/Text editing widget</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">CursorMorph</span> <span class="k">extends</span> <span class="nx">BlinkerMorph</span>

  <span class="nv">keyDownEventUsed: </span><span class="kc">false</span>
  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">originalContents: </span><span class="kc">null</span>
  <span class="nv">slot: </span><span class="kc">null</span>
  <span class="nv">viewPadding: </span><span class="mi">1</span>

  <span class="nv">constructor: </span><span class="nf">(@target) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@originalContents = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
    <span class="vi">@slot = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nv">ls = </span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">fontSize</span><span class="p">)</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">ls</span> <span class="o">/</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">ls</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nv">font = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">font</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span>
  </pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>CursorMorph event processing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processKeyPress: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>this.inspectKeyEvent(event);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@keyDownEventUsed</span>
      <span class="vi">@keyDownEventUsed = </span><span class="kc">false</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">is</span> <span class="mi">40</span><span class="p">)</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">is</span> <span class="mi">40</span>
      <span class="nx">@insert</span> <span class="s">&quot;(&quot;</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">is</span> <span class="mi">37</span><span class="p">)</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">is</span> <span class="mi">37</span>
      <span class="nx">@insert</span> <span class="s">&quot;%&quot;</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nv">navigation = </span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="c1"># Opera doesn&#39;t support charCode</span>
      <span class="nx">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">navigation</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
          <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
          <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
        <span class="k">else</span>
          <span class="nx">@insert</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span> <span class="c1"># all other browsers</span>
      <span class="nx">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">navigation</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
          <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
          <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
        <span class="k">else</span>
          <span class="nx">@insert</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
  
  <span class="nv">processKeyDown: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>this.inspectKeyEvent(event);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@keyDownEventUsed = </span><span class="kc">false</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
      <span class="nx">@ctrl</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span></pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
      <span class="k">return</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span>
      <span class="nx">@cmd</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span></pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
      <span class="k">return</span>
    <span class="k">switch</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span>
      <span class="k">when</span> <span class="mi">37</span>
        <span class="nx">@goLeft</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">39</span>
        <span class="nx">@goRight</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">38</span>
        <span class="nx">@goUp</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">40</span>
        <span class="nx">@goDown</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">36</span>
        <span class="nx">@goHome</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">35</span>
        <span class="nx">@goEnd</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">46</span>
        <span class="nx">@deleteRight</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">8</span>
        <span class="nx">@deleteLeft</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">13</span>
        <span class="k">if</span> <span class="nx">@target</span> <span class="k">instanceof</span> <span class="nx">StringMorph</span>
          <span class="nx">@accept</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@insert</span> <span class="s">&quot;\n&quot;</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">when</span> <span class="mi">27</span>
        <span class="nx">@cancel</span><span class="p">()</span>
        <span class="vi">@keyDownEventUsed = </span><span class="kc">true</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>this.inspectKeyEvent(event);
notify target's parent of key event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@target</span><span class="p">.</span><span class="nx">escalateEvent</span> <span class="s">&quot;reactToKeystroke&quot;</span><span class="p">,</span> <span class="nx">event</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>CursorMorph navigation - simple version
gotoSlot: (newSlot) ->
 @setPosition @target.slotPosition(newSlot)
 @slot = Math.max(newSlot, 0)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gotoSlot: </span><span class="nf">(slot) -&gt;</span>
    <span class="nv">length = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span>
    <span class="nv">pos = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">slotPosition</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="vi">@slot = </span><span class="p">(</span><span class="k">if</span> <span class="nx">slot</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="k">if</span> <span class="nx">slot</span> <span class="o">&gt;</span> <span class="nx">length</span> <span class="k">then</span> <span class="nx">length</span> <span class="k">else</span> <span class="nx">slot</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">@parent</span>
      <span class="nv">right = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@viewPadding</span>
      <span class="nv">left = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@viewPadding</span>
      <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">right</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span>
        <span class="nv">pos.x = </span><span class="nx">right</span>
      <span class="k">if</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">left</span>
        <span class="nv">left = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">(),</span> <span class="nx">left</span><span class="p">)</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setLeft</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">left</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span>
        <span class="nv">pos.x = </span><span class="nx">left</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">right</span> <span class="o">and</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">left</span>
        <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">right</span>
    <span class="nx">@show</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="o">and</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">parent</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">scrollCursorIntoView</span> <span class="nx">@</span><span class="p">,</span> <span class="mi">6</span>
  
  <span class="nv">goLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span> <span class="o">-</span> <span class="mi">1</span>
  
  <span class="nv">goRight: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@slot</span> <span class="o">+</span> <span class="mi">1</span>
  
  <span class="nv">goUp: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">upFrom</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
  
  <span class="nv">goDown: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">downFrom</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
  
  <span class="nv">goHome: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">startOfLine</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
  
  <span class="nv">goEnd: </span><span class="o">-&gt;</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">()</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">endOfLine</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
  
  <span class="nv">gotoPos: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">slotAt</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
    <span class="nx">@show</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>CursorMorph editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">accept: </span><span class="o">-&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;accept&quot;</span><span class="p">,</span> <span class="kc">null</span>
  
  <span class="nv">cancel: </span><span class="o">-&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span>
    <span class="vi">@target.text = </span><span class="nx">@originalContents</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;cancel&quot;</span><span class="p">,</span> <span class="kc">null</span>
  
  <span class="nv">insert: </span><span class="nf">(aChar) -&gt;</span>
    <span class="k">return</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">tab</span><span class="p">(</span><span class="nx">@target</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="s">&quot;\t&quot;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">isNumeric</span> <span class="o">or</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">aChar</span><span class="p">))</span> <span class="o">or</span> <span class="nx">contains</span><span class="p">([</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">],</span> <span class="nx">aChar</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
        <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
      <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
      <span class="nv">text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">aChar</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
      <span class="vi">@target.text = </span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">@goRight</span><span class="p">()</span>
  
  <span class="nv">ctrl: </span><span class="nf">(aChar) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">aChar</span> <span class="o">is</span> <span class="mi">97</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">aChar</span> <span class="o">is</span> <span class="mi">65</span><span class="p">)</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">123</span>
      <span class="nx">@insert</span> <span class="s">&quot;{&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">125</span>
      <span class="nx">@insert</span> <span class="s">&quot;}&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">91</span>
      <span class="nx">@insert</span> <span class="s">&quot;[&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">93</span>
      <span class="nx">@insert</span> <span class="s">&quot;]&quot;</span>
  
  <span class="nv">cmd: </span><span class="nf">(aChar) -&gt;</span>
    <span class="k">if</span> <span class="nx">aChar</span> <span class="o">is</span> <span class="mi">65</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">()</span>
  
  <span class="nv">deleteRight: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
      <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nv">text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">@slot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="vi">@target.text = </span><span class="nx">text</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
  
  <span class="nv">deleteLeft: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selection</span><span class="p">()</span>
      <span class="nx">@gotoSlot</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">selectionStartSlot</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">deleteSelection</span><span class="p">()</span>
    <span class="nv">text = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">text</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="vi">@target.text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@slot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">@slot</span><span class="p">)</span>
    <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@goLeft</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>CursorMorph utilities:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">inspectKeyEvent: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@inform</span> <span class="s">&quot;Key pressed: &quot;</span> <span class="o">+</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\n------------------------&quot;</span> <span class="o">+</span> <span class="s">&quot;\ncharCode: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">charCode</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\nkeyCode: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\naltKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">altKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\nctrlKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>  <span class="o">+</span> <span class="s">&quot;\ncmdKey: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>Colors //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Color</span>

  <span class="nv">a: </span><span class="kc">null</span>
  <span class="nv">r: </span><span class="kc">null</span>
  <span class="nv">g: </span><span class="kc">null</span>
  <span class="nv">b: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@r = 0, @g = 0, @b = 0, a) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>all values are optional, just (r, g, b) is fine</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@a = </span><span class="nx">a</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>Color string representation: e.g. 'rgba(255,165,0,1)'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="s">&quot;rgba(&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@r</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@g</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@b</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">@a</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>Color copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">@r</span><span class="p">,</span> <span class="nx">@g</span><span class="p">,</span> <span class="nx">@b</span><span class="p">,</span> <span class="nx">@a</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <p>Color comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eq: </span><span class="nf">(aColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <p>==</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">aColor</span> <span class="o">and</span> <span class="nx">@r</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">r</span> <span class="o">and</span> <span class="nx">@g</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">g</span> <span class="o">and</span> <span class="nx">@b</span> <span class="o">is</span> <span class="nx">aColor</span><span class="p">.</span><span class="nx">b</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>Color conversion (hsv):</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">hsv: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rr = </span><span class="nx">@r</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">gg = </span><span class="nx">@g</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">bb = </span><span class="nx">@b</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="nv">max = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span> <span class="nx">gg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">)</span>
    <span class="nv">min = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">rr</span><span class="p">,</span> <span class="nx">gg</span><span class="p">,</span> <span class="nx">bb</span><span class="p">)</span>
    <span class="nv">h = </span><span class="nx">max</span>
    <span class="nv">s = </span><span class="nx">max</span>
    <span class="nv">v = </span><span class="nx">max</span>
    <span class="nv">d = </span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span>
    <span class="nv">s = </span><span class="p">(</span><span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">d</span> <span class="o">/</span> <span class="nx">max</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">max</span> <span class="o">is</span> <span class="nx">min</span>
      <span class="nv">h = </span><span class="mi">0</span>
    <span class="k">else</span>
      <span class="k">switch</span> <span class="nx">max</span>
        <span class="k">when</span> <span class="nx">rr</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">gg</span> <span class="o">-</span> <span class="nx">bb</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">gg</span> <span class="o">&lt;</span> <span class="nx">bb</span> <span class="k">then</span> <span class="mi">6</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">when</span> <span class="nx">gg</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">bb</span> <span class="o">-</span> <span class="nx">rr</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">when</span> <span class="nx">bb</span>
          <span class="nv">h = </span><span class="p">(</span><span class="nx">rr</span> <span class="o">-</span> <span class="nx">gg</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">4</span>
      <span class="nx">h</span> <span class="o">/=</span> <span class="mi">6</span>
    <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span>
  
  <span class="nv">set_hsv: </span><span class="nf">(h, s, v) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>ignore alpha, h, s and v are to be within [0, 1]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">i = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
    <span class="nv">f = </span><span class="nx">h</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="nx">i</span>
    <span class="nv">p = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">q = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">t = </span><span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">f</span><span class="p">)</span> <span class="o">*</span> <span class="nx">s</span><span class="p">)</span>
    <span class="k">switch</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">6</span>
      <span class="k">when</span> <span class="mi">0</span>
        <span class="vi">@r = </span><span class="nx">v</span>
        <span class="vi">@g = </span><span class="nx">t</span>
        <span class="vi">@b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">1</span>
        <span class="vi">@r = </span><span class="nx">q</span>
        <span class="vi">@g = </span><span class="nx">v</span>
        <span class="vi">@b = </span><span class="nx">p</span>
      <span class="k">when</span> <span class="mi">2</span>
        <span class="vi">@r = </span><span class="nx">p</span>
        <span class="vi">@g = </span><span class="nx">v</span>
        <span class="vi">@b = </span><span class="nx">t</span>
      <span class="k">when</span> <span class="mi">3</span>
        <span class="vi">@r = </span><span class="nx">p</span>
        <span class="vi">@g = </span><span class="nx">q</span>
        <span class="vi">@b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">4</span>
        <span class="vi">@r = </span><span class="nx">t</span>
        <span class="vi">@g = </span><span class="nx">p</span>
        <span class="vi">@b = </span><span class="nx">v</span>
      <span class="k">when</span> <span class="mi">5</span>
        <span class="vi">@r = </span><span class="nx">v</span>
        <span class="vi">@g = </span><span class="nx">p</span>
        <span class="vi">@b = </span><span class="nx">q</span>
    <span class="nx">@r</span> <span class="o">*=</span> <span class="mi">255</span>
    <span class="nx">@g</span> <span class="o">*=</span> <span class="mi">255</span>
    <span class="nx">@b</span> <span class="o">*=</span> <span class="mi">255</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>Color mixing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mixed: </span><span class="nf">(proportion, otherColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>answer a copy of this color mixed with another color, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">frac1 = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">proportion</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">frac2 = </span><span class="mi">1</span> <span class="o">-</span> <span class="nx">frac1</span>
    <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span>
      <span class="nx">@r</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">,</span>
      <span class="nx">@g</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">g</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">,</span>
      <span class="nx">@b</span> <span class="o">*</span> <span class="nx">frac1</span> <span class="o">+</span> <span class="nx">otherColor</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">frac2</span><span class="p">)</span>
  
  <span class="nv">darker: </span><span class="nf">(percent) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p>return an rgb-interpolated darker copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fract = </span><span class="mf">0.8333</span>
    <span class="nv">fract = </span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="k">if</span> <span class="nx">percent</span>
    <span class="nx">@mixed</span> <span class="nx">fract</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">lighter: </span><span class="nf">(percent) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>return an rgb-interpolated lighter copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fract = </span><span class="mf">0.8333</span>
    <span class="nv">fract = </span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="k">if</span> <span class="nx">percent</span>
    <span class="nx">@mixed</span> <span class="nx">fract</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
  
  <span class="nv">dansDarker: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>return an hsv-interpolated darker copy of me, ignore alpha</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hsv = </span><span class="nx">@hsv</span><span class="p">()</span>
    <span class="nv">result = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="nv">vv = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">hsv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">set_hsv</span> <span class="nx">hsv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">hsv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">vv</span>
    <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>TriggerMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>I provide basic button functionality</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">TriggerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">action: </span><span class="kc">null</span>
  <span class="nv">environment: </span><span class="kc">null</span>
  <span class="nv">labelString: </span><span class="kc">null</span>
  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">hint: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">highlightColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pressColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
  <span class="nv">labelColor: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, @action = null, @labelString = null,</span>
<span class="nf">    fontSize, fontStyle, @environment = null, @hint = null, labelColor) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@fontSize = </span><span class="nx">fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span>
    <span class="vi">@fontStyle = </span><span class="nx">fontStyle</span> <span class="o">or</span> <span class="s">&quot;sans-serif&quot;</span>
    <span class="vi">@labelColor = </span><span class="nx">labelColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>TriggerMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nx">@createBackgrounds</span><span class="p">()</span>
    <span class="nx">@createLabel</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@labelString</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">createBackgrounds: </span><span class="o">-&gt;</span>
    <span class="nv">ext = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="vi">@normalImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@normalImage</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
    <span class="vi">@highlightImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@highlightImage</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@highlightColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
    <span class="vi">@pressImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@pressImage</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@pressColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
  
  <span class="nv">createLabel: </span><span class="o">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>bold
italic
numeric
shadow offset
shadow color</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span>
      <span class="nx">@labelString</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">,</span> <span class="nx">@fontStyle</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@labelColor</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@label</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nx">@add</span> <span class="nx">@label</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>TriggerMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.label = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@label</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">label</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@label</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>TriggerMorph action:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">trigger: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>if target is a function, use it as callback:
execute target as callback function with action as argument
in the environment as optionally specified.
Note: if action is also a function, instead of becoming
the argument itself it will be called to answer the argument.
for selections, Yes/No Choices etc:</p>

<p>else (if target is not a function):</p>

<pre><code>if action is a function:
execute the action with target as environment (can be null)
for lambdafied (inline) actions

else if action is a String:
treat it as function property of target and execute it
for selector-like actions
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@target</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@action</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@environment</span><span class="p">,</span> <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@environment</span><span class="p">,</span> <span class="nx">@action</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@action</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
        <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@target</span>
      <span class="k">else</span> <span class="c1"># assume it&#39;s a String</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@action</span><span class="p">]()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>TriggerMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@bubbleHelp</span> <span class="nx">@hint</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseLeave: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseDownLeft: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@pressImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@trigger</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>TriggerMorph bubble help:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bubbleHelp: </span><span class="nf">(contents) -&gt;</span>
    <span class="vi">@fps = </span><span class="mi">2</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="nx">@popUpbubbleHelp</span> <span class="nx">contents</span>  <span class="k">if</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">())</span>
      <span class="vi">@fps = </span><span class="mi">0</span>
      <span class="k">delete</span> <span class="nx">@step</span>
  
  <span class="nv">popUpbubbleHelp: </span><span class="nf">(contents) -&gt;</span>
    <span class="k">new</span> <span class="nx">SpeechBubbleMorph</span><span class="p">(</span>
      <span class="nx">localize</span><span class="p">(</span><span class="nx">contents</span><span class="p">),</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">popUp</span> <span class="nx">@world</span><span class="p">(),</span>
      <span class="nx">@rightCenter</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>MenuItemMorph ///////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>I automatically determine my bounds</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MenuItemMorph</span> <span class="k">extends</span> <span class="nx">TriggerMorph</span>

  <span class="nv">constructor: </span><span class="nf">(target, action, labelString, fontSize, fontStyle, environment, hint, color) -&gt;</span>
    <span class="k">super</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">labelString</span><span class="p">,</span> <span class="nx">fontSize</span><span class="p">,</span> <span class="nx">fontStyle</span><span class="p">,</span> <span class="nx">environment</span><span class="p">,</span> <span class="nx">hint</span><span class="p">,</span> <span class="nx">color</span>
  
  <span class="nv">createLabel: </span><span class="o">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>bold
italic
numeric
shadow offset
shadow color</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span>
      <span class="nx">@labelString</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">,</span> <span class="nx">@fontStyle</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@labelColor</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">np = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="vi">@label.bounds = </span><span class="nx">np</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="nx">@label</span><span class="p">.</span><span class="nx">extent</span><span class="p">())</span>
    <span class="nx">@add</span> <span class="nx">@label</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>MenuItemMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="vi">@image = </span><span class="nx">@highlightImage</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@bubbleHelp</span> <span class="nx">@hint</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseLeave: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="vi">@image = </span><span class="nx">@normalImage</span>
      <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@world</span><span class="p">().</span><span class="nx">hand</span><span class="p">.</span><span class="nx">destroyTemporaries</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@hint</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">unselectAllItems</span><span class="p">()</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseDownLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
    <span class="vi">@image = </span><span class="nx">@pressImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseMove: </span><span class="o">-&gt;</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseMove&quot;</span>  <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@isListItem</span><span class="p">()</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="nx">@root</span><span class="p">().</span><span class="nv">activeMenu = </span><span class="kc">null</span>
    <span class="nx">@trigger</span><span class="p">()</span>
  
  <span class="nv">isListItem: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">isListContents</span>  <span class="k">if</span> <span class="nx">@parent</span>
    <span class="kc">false</span>
  
  <span class="nv">isSelectedListItem: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@image</span> <span class="o">is</span> <span class="nx">@pressImage</span>  <span class="k">if</span> <span class="nx">@isListItem</span><span class="p">()</span>
    <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>CircleBoxMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>I can be used for sliders</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">CircleBoxMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">orientation: </span><span class="kc">null</span>
  <span class="nv">autoOrient: </span><span class="kc">true</span>

  <span class="nv">constructor: </span><span class="nf">(@orientation = &quot;vertical&quot;) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
  
  <span class="nv">autoOrientation: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@width</span><span class="p">()</span>
      <span class="vi">@orientation = </span><span class="s">&quot;vertical&quot;</span>
    <span class="k">else</span>
      <span class="vi">@orientation = </span><span class="s">&quot;horizontal&quot;</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nx">@autoOrientation</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@autoOrient</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">radius = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nv">x = </span><span class="nx">@center</span><span class="p">().</span><span class="nx">x</span>
      <span class="nv">center1 = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">)</span>
      <span class="nv">center2 = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span>
      <span class="nv">rect = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)).</span><span class="nx">corner</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)))</span>
    <span class="k">else</span>
      <span class="nv">radius = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nv">y = </span><span class="nx">@center</span><span class="p">().</span><span class="nx">y</span>
      <span class="nv">center1 = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nv">center2 = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nv">rect = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">corner</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">corner</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="nv">points = </span><span class="p">[</span><span class="nx">center1</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">),</span> <span class="nx">center2</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)]</span>
    <span class="nx">points</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">center</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">,</span> <span class="kc">false</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nv">rect = </span><span class="nx">rect</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">neg</span><span class="p">())</span>
    <span class="nv">ext = </span><span class="nx">rect</span><span class="p">.</span><span class="nx">extent</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>CircleBoxMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;horizontal...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleOrientation&quot;</span><span class="p">,</span> <span class="s">&quot;toggle the\norientation&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;vertical...&quot;</span><span class="p">,</span> <span class="s">&quot;toggleOrientation&quot;</span><span class="p">,</span> <span class="s">&quot;toggle the\norientation&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">toggleOrientation: </span><span class="o">-&gt;</span>
    <span class="nv">center = </span><span class="nx">@center</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="vi">@orientation = </span><span class="s">&quot;horizontal&quot;</span>
    <span class="k">else</span>
      <span class="vi">@orientation = </span><span class="s">&quot;vertical&quot;</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@height</span><span class="p">(),</span> <span class="nx">@width</span><span class="p">())</span>
    <span class="nx">@setCenter</span> <span class="nx">center</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>SliderMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SliderMorph</span> <span class="k">extends</span> <span class="nx">CircleBoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">action: </span><span class="kc">null</span>
  <span class="nv">start: </span><span class="kc">null</span>
  <span class="nv">stop: </span><span class="kc">null</span>
  <span class="nv">value: </span><span class="kc">null</span>
  <span class="nv">size: </span><span class="kc">null</span>
  <span class="nv">offset: </span><span class="kc">null</span>
  <span class="nv">button: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@start = 1, @stop = 100, @value = 50, @size = 10, orientation, color) -&gt;</span>
    <span class="vi">@button = </span><span class="k">new</span> <span class="nx">SliderButtonMorph</span><span class="p">()</span>
    <span class="vi">@button.isDraggable = </span><span class="kc">false</span>
    <span class="vi">@button.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="vi">@button.highlightColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@button.pressColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="k">super</span> <span class="nx">orientation</span> <span class="c1"># if null, then a vertical one will be created</span>
    <span class="nx">@add</span> <span class="nx">@button</span>
    <span class="vi">@alpha = </span><span class="mf">0.3</span>
    <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="vi">@step = </span><span class="kc">null</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>this.drawNew();</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">autoOrientation: </span><span class="o">-&gt;</span>
      <span class="nx">noOperation</span>
  
  <span class="nv">rangeSize: </span><span class="o">-&gt;</span>
    <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span>
  
  <span class="nv">ratio: </span><span class="o">-&gt;</span>
    <span class="nx">@size</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>
  
  <span class="nv">unitSize: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
    <span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="o">/</span> <span class="nx">@rangeSize</span><span class="p">()</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@button.orientation = </span><span class="nx">@orientation</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">bw = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
      <span class="nv">bh = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@ratio</span><span class="p">()))</span>
      <span class="nx">@button</span><span class="p">.</span><span class="nx">silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nx">bh</span><span class="p">)</span>
      <span class="nv">posX = </span><span class="mi">1</span>
      <span class="nv">posY = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">@value</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@unitSize</span><span class="p">()),</span>
        <span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="k">else</span>
      <span class="nv">bh = </span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>
      <span class="nv">bw = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bh</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">*</span> <span class="nx">@ratio</span><span class="p">()))</span>
      <span class="nx">@button</span><span class="p">.</span><span class="nx">silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">bw</span><span class="p">,</span> <span class="nx">bh</span><span class="p">)</span>
      <span class="nv">posY = </span><span class="mi">1</span>
      <span class="nv">posX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">@value</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span> <span class="o">*</span> <span class="nx">@unitSize</span><span class="p">()),</span>
        <span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">posX</span><span class="p">,</span> <span class="nx">posY</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@button</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  <span class="nv">updateValue: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">relPos = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nv">relPos = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">relPos</span> <span class="o">/</span> <span class="nx">@unitSize</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">updateTarget: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@action</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@action</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
        <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@target</span><span class="p">,</span> <span class="nx">@value</span>
      <span class="k">else</span> <span class="c1"># assume it&#39;s a String</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@action</span><span class="p">]</span> <span class="nx">@value</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>SliderMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nv">c.button = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@button</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">button</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@button</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>SliderMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show value...&quot;</span><span class="p">,</span> <span class="s">&quot;showValue&quot;</span><span class="p">,</span> <span class="s">&quot;display a dialog box\nshowing the selected number&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;floor...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfloor:&quot;</span><span class="p">,</span>
        <span class="nx">@setStart</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@start</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the minimum value\nwhich can be selected&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;ceiling...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nceiling:&quot;</span><span class="p">,</span>
        <span class="nx">@setStop</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@stop</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">,</span>
        <span class="nx">@size</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the maximum value\nwhich can be selected&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;button size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nbutton size:&quot;</span><span class="p">,</span>
        <span class="nx">@setSize</span><span class="p">,</span>
        <span class="nx">@</span><span class="p">,</span>
        <span class="nx">@size</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">,</span>
        <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set the range\ncovered by\nthe slider button&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;set target&quot;</span><span class="p">,</span> <span class="s">&quot;setTarget&quot;</span><span class="p">,</span> <span class="s">&quot;select another morph\nwhose numerical property\nwill be &quot;</span> <span class="o">+</span> <span class="s">&quot;controlled by this one&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">showValue: </span><span class="o">-&gt;</span>
    <span class="nx">@inform</span> <span class="nx">@value</span>
  
  <span class="nv">userSetStart: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-268">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-268">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">@stop</span><span class="p">)</span>
  
  <span class="nv">setStart: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-269">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-269">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newStart = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newStart</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newStart</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setStop: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-270">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-270">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newStop = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newStop</span><span class="p">,</span> <span class="nx">@start</span> <span class="o">+</span> <span class="nx">@size</span><span class="p">)</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newStop</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@stop</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSize: </span><span class="nf">(num) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-271">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-271">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">num</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@size = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
      <span class="vi">@size = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@start</span><span class="p">)</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="vi">@value = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@value</span><span class="p">,</span> <span class="nx">@stop</span> <span class="o">-</span> <span class="nx">@size</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setTarget: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@setTargetSetter</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-272">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-272">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@target = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  <span class="nv">setTargetSetter: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">numericalSetters</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target property:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@action = </span><span class="nx">each</span></pre></div>             </td>           </tr>                               <tr id="section-273">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-273">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@action = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  <span class="nv">numericalSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-274">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-274">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;setStart&quot;</span><span class="p">,</span> <span class="s">&quot;setStop&quot;</span><span class="p">,</span> <span class="s">&quot;setSize&quot;</span>
    <span class="nx">list</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-275">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-275">&#182;</a>               </div>               <p>SliderMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="nx">unless</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
      <span class="vi">@offset = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">()</span> <span class="c1"># return null;</span>
    <span class="k">else</span>
      <span class="vi">@offset = </span><span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-276">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-276">&#182;</a>               </div>               <p>this is to create the "drag the slider" effect
basically if the mouse is pressing within the boundaries
then in the next step you remember to check again where the mouse
is and update the scrollbar. As soon as the mouse is unpressed
then the step function is set to null to save cycles.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span>
        <span class="nv">mousePos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span>
        <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
          <span class="nv">newX = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">x</span>
          <span class="nv">newY = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
            <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@offset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
            <span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">height</span><span class="p">()),</span> <span class="nx">@top</span><span class="p">())</span>
        <span class="k">else</span>
          <span class="nv">newY = </span><span class="nx">@button</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span>
          <span class="nv">newX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
            <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@offset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
            <span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@button</span><span class="p">.</span><span class="nx">width</span><span class="p">()),</span> <span class="nx">@left</span><span class="p">())</span>
        <span class="nx">@button</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">newX</span><span class="p">,</span> <span class="nx">newY</span><span class="p">)</span>
        <span class="nx">@updateValue</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-277">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-277">&#182;</a>               </div>               <p>ColorPickerMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ColorPickerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">choice: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(defaultColor) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">defaultColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@buildSubmorphs</span><span class="p">()</span>
  
  <span class="nv">buildSubmorphs: </span><span class="o">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="vi">@feedback = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
    <span class="vi">@feedback.color = </span><span class="nx">@choice</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nv">cpal = </span><span class="k">new</span> <span class="nx">ColorPaletteMorph</span><span class="p">(</span><span class="nx">@feedback</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="mi">50</span><span class="p">))</span>
    <span class="nv">gpal = </span><span class="k">new</span> <span class="nx">GrayPaletteMorph</span><span class="p">(</span><span class="nx">@feedback</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nx">cpal</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
    <span class="nx">@add</span> <span class="nx">cpal</span>
    <span class="nx">gpal</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">cpal</span><span class="p">.</span><span class="nx">bottomLeft</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">gpal</span>
    <span class="nv">x = </span><span class="p">(</span><span class="nx">gpal</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">gpal</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@feedback</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nv">y = </span><span class="nx">gpal</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">gpal</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@feedback</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@add</span> <span class="nx">@feedback</span>
  
  <span class="nv">getChoice: </span><span class="o">-&gt;</span>
    <span class="nx">@feedback</span><span class="p">.</span><span class="nx">color</span>
  
  <span class="nv">rootForGrab: </span><span class="o">-&gt;</span>
    <span class="nx">@</span>
<span class="nv">morphicVersion = </span><span class="s">&quot;2012-October-22&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-278">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-278">&#182;</a>               </div>               <p>ListMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ListMorph</span> <span class="k">extends</span> <span class="nx">ScrollFrameMorph</span>
  
  <span class="nv">elements: </span><span class="kc">null</span>
  <span class="nv">labelGetter: </span><span class="kc">null</span>
  <span class="nv">format: </span><span class="kc">null</span>
  <span class="nv">listContents: </span><span class="kc">null</span>
  <span class="nv">selected: </span><span class="kc">null</span>
  <span class="nv">action: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@elements = [], labelGetter, @format = []) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-279">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-279">&#182;</a>               </div>               <p>passing a format is optional. If the format parameter is specified
   it has to be of the following pattern:</p>

<pre><code>   [
       [&lt;color&gt;, &lt;single-argument predicate&gt;],
       ...
   ]
</code></pre>

<p>multiple color conditions can be passed in such a format list, the
   last predicate to evaluate true when given the list element sets
   the given color. If no condition is met, the default color (black)
   will be assigned.</p>

<p>An example of how to use fomats can be found in the InspectorMorph's
   "markOwnProperties" mechanism.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@contents.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@vBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@labelGetter = </span><span class="nx">labelGetter</span> <span class="o">or</span> <span class="nf">(element) -&gt;</span>
        <span class="k">return</span> <span class="nx">element</span>  <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">toSource</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="nx">toSource</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">@buildListContents</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-280">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-280">&#182;</a>               </div>               <p>it's important to leave the step as the default noOperation
instead of null because the scrollbars (inherited from scrollframe)
need the step function to react to mouse drag.</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">buildListContents: </span><span class="o">-&gt;</span>
    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@listContents</span>
    <span class="vi">@listContents = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@select</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
    <span class="vi">@elements = </span><span class="p">[</span><span class="s">&quot;(empty)&quot;</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">@elements</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="nx">@elements</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">color = </span><span class="kc">null</span>
      <span class="nx">@format</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(pair) -&gt;</span>
        <span class="nv">color = </span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-281">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-281">&#182;</a>               </div>               <p>label string
action
hint</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">@labelGetter</span><span class="p">(</span><span class="nx">element</span><span class="p">),</span> <span class="nx">element</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">color</span></pre></div>             </td>           </tr>                               <tr id="section-282">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-282">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@contents</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
    <span class="vi">@listContents.isListContents = </span><span class="kc">true</span>
    <span class="nx">@listContents</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@addContents</span> <span class="nx">@listContents</span>
  
  <span class="nv">select: </span><span class="nf">(item) -&gt;</span>
    <span class="vi">@selected = </span><span class="nx">item</span>
    <span class="nx">@action</span><span class="p">.</span><span class="nx">call</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">item</span>  <span class="k">if</span> <span class="nx">@action</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nv">lb = </span><span class="nx">@listContents</span><span class="p">.</span><span class="nx">bounds</span>
    <span class="nv">nb = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">corner</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">and</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setRight</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">and</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">lb</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
      <span class="nx">@listContents</span><span class="p">.</span><span class="nx">setBottom</span> <span class="nx">nb</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
    <span class="k">super</span> <span class="nx">aPoint</span></pre></div>             </td>           </tr>                               <tr id="section-283">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-283">&#182;</a>               </div>               <p>HandMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-284">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-284">&#182;</a>               </div>               <p>The mouse cursor. Note that it's not a child of the WorldMorph, this Morph
is never added to any other morph. [TODO] Find out why and write explanation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">HandMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">world: </span><span class="kc">null</span>
  <span class="nv">mouseButton: </span><span class="kc">null</span>
  <span class="nv">mouseDownMorph: </span><span class="kc">null</span>
  <span class="nv">morphToGrab: </span><span class="kc">null</span>
  <span class="nv">grabOrigin: </span><span class="kc">null</span>
  <span class="nv">mouseOverList: </span><span class="kc">null</span>
  <span class="nv">temporaries: </span><span class="kc">null</span>
  <span class="nv">touchHoldTimeout: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@world) -&gt;</span>
    <span class="vi">@mouseOverList = </span><span class="p">[]</span>
    <span class="vi">@temporaries = </span><span class="p">[]</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="k">new</span> <span class="nx">Rectangle</span><span class="p">()</span>
  
  <span class="nv">changed: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@world</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nv">b = </span><span class="nx">@fullBounds</span><span class="p">()</span>
      <span class="nx">@world</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">b</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">eq</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">())</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-285">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-285">&#182;</a>               </div>               <p>HandMorph navigation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">morphAtPointer: </span><span class="o">-&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">result = </span><span class="nx">m</span>  <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">visibleBounds</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span> <span class="o">and</span>
        <span class="nx">result</span> <span class="o">is</span> <span class="kc">null</span> <span class="o">and</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">noticesTransparentClick</span> <span class="o">or</span>
        <span class="p">(</span><span class="o">not</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isTransparentAt</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)))</span> <span class="o">and</span> <span class="p">(</span><span class="nx">m</span> <span class="o">not</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-286">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-286">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">result</span>  <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@world</span>
  </pre></div>             </td>           </tr>                               <tr id="section-287">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-287">&#182;</a>               </div>               <p>alternative -  more elegant and possibly more
performant - solution for morphAtPointer.
Has some issues, commented out for now</p>

<p>HandMorph.prototype.morphAtPointer = function () {
var myself = this;
return this.world.topMorphSuchThat(function (m) {
    return m.visibleBounds().containsPoint(myself.bounds.origin) &amp;&amp;
        m.isVisible &amp;&amp;
        (m.noticesTransparentClick ||
            (! m.isTransparentAt(myself.bounds.origin))) &amp;&amp;
        (! (m instanceof ShadowMorph));
});
};</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">allMorphsAtPointer: </span><span class="o">-&gt;</span>
    <span class="nv">morphs = </span><span class="nx">@world</span><span class="p">.</span><span class="nx">allChildren</span><span class="p">()</span>
    <span class="nx">morphs</span><span class="p">.</span><span class="nx">filter</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">and</span> <span class="nx">m</span><span class="p">.</span><span class="nx">visibleBounds</span><span class="p">().</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
  
  
  </pre></div>             </td>           </tr>                               <tr id="section-288">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-288">&#182;</a>               </div>               <p>HandMorph dragging and dropping:</p>

<p>drag 'n' drop events, method(arg) -> receiver:</p>

<pre><code>prepareToBeGrabbed(handMorph) -&gt; grabTarget
reactToGrabOf(grabbedMorph) -&gt; oldParent
wantsDropOf(morphToDrop) -&gt;  newParent
justDropped(handMorph) -&gt; droppedMorph
reactToDropOf(droppedMorph, handMorph) -&gt; newParent
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">dropTargetFor: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">target = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">target = </span><span class="nx">target</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">target</span><span class="p">.</span><span class="nx">wantsDropOf</span><span class="p">(</span><span class="nx">aMorph</span><span class="p">)</span>
    <span class="nx">target</span>
  
  <span class="nv">grab: </span><span class="nf">(aMorph) -&gt;</span>
    <span class="nv">oldParent = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">aMorph</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">@world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>
      <span class="vi">@grabOrigin = </span><span class="nx">aMorph</span><span class="p">.</span><span class="nx">situation</span><span class="p">()</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">addShadow</span><span class="p">()</span>
      <span class="nx">aMorph</span><span class="p">.</span><span class="nx">prepareToBeGrabbed</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">aMorph</span><span class="p">.</span><span class="nx">prepareToBeGrabbed</span>
      <span class="nx">@add</span> <span class="nx">aMorph</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">oldParent</span><span class="p">.</span><span class="nx">reactToGrabOf</span> <span class="nx">aMorph</span>  <span class="k">if</span> <span class="nx">oldParent</span> <span class="o">and</span> <span class="nx">oldParent</span><span class="p">.</span><span class="nx">reactToGrabOf</span>
  
  <span class="nv">drop: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nv">morphToDrop = </span><span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">target = </span><span class="nx">@dropTargetFor</span><span class="p">(</span><span class="nx">morphToDrop</span><span class="p">)</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">target</span><span class="p">.</span><span class="nx">add</span> <span class="nx">morphToDrop</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">removeShadow</span><span class="p">()</span>
      <span class="vi">@children = </span><span class="p">[]</span>
      <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">()</span>
      <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">justDropped</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">morphToDrop</span><span class="p">.</span><span class="nx">justDropped</span>
      <span class="nx">target</span><span class="p">.</span><span class="nx">reactToDropOf</span> <span class="nx">morphToDrop</span><span class="p">,</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">target</span><span class="p">.</span><span class="nx">reactToDropOf</span>
      <span class="vi">@dragOrigin = </span><span class="kc">null</span>
  </pre></div>             </td>           </tr>                               <tr id="section-289">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-289">&#182;</a>               </div>               <p>HandMorph event dispatching:</p>

<p>mouse events:</p>

<pre><code>mouseDownLeft
mouseDownRight
mouseClickLeft
mouseClickRight
mouseEnter
mouseLeave
mouseEnterDragging
mouseLeaveDragging
mouseMove
mouseScroll
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processMouseDown: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">@destroyTemporaries</span><span class="p">()</span>
    <span class="vi">@morphToGrab = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nx">@drop</span><span class="p">()</span>
      <span class="vi">@mouseButton = </span><span class="kc">null</span>
    <span class="k">else</span>
      <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span>
        <span class="nx">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">allParents</span><span class="p">(),</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">)</span>
          <span class="nx">@world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="o">isnt</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span>
          <span class="nx">@world</span><span class="p">.</span><span class="nx">activeHandle</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>    
      <span class="k">if</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">cursor</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="o">isnt</span> <span class="nx">@world</span><span class="p">.</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">target</span>  
          <span class="nx">@world</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">()</span>  
      <span class="vi">@morphToGrab = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseMove</span>
      <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">button</span> <span class="o">is</span> <span class="mi">2</span> <span class="o">or</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span>
        <span class="vi">@mouseButton = </span><span class="s">&quot;right&quot;</span>
        <span class="nv">actualClick = </span><span class="s">&quot;mouseDownRight&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickRight&quot;</span>
      <span class="k">else</span>
        <span class="vi">@mouseButton = </span><span class="s">&quot;left&quot;</span>
        <span class="nv">actualClick = </span><span class="s">&quot;mouseDownLeft&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickLeft&quot;</span>
      <span class="vi">@mouseDownMorph = </span><span class="nx">morph</span>
      <span class="vi">@mouseDownMorph = </span><span class="nx">@mouseDownMorph</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">@mouseDownMorph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span>
      <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">morph</span><span class="p">[</span><span class="nx">actualClick</span><span class="p">]</span>
      <span class="nx">morph</span><span class="p">[</span><span class="nx">actualClick</span><span class="p">]</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
  
  <span class="nv">processTouchStart: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-290">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-290">&#182;</a>               </div>               <p>simulate mouseRightClick</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@touchHoldTimeout = </span><span class="nx">setInterval</span><span class="p">(</span><span class="o">=&gt;</span>
        <span class="nx">@processMouseDown</span> <span class="nv">button: </span><span class="mi">2</span>
        <span class="nx">@processMouseUp</span> <span class="nv">button: </span><span class="mi">2</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
      <span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
      <span class="nx">@processMouseMove</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># update my position</span>
      <span class="nx">@processMouseDown</span> <span class="nv">button: </span><span class="mi">0</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
  
  <span class="nv">processTouchMove: </span><span class="nf">(event) -&gt;</span>
    <span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="nv">touch = </span><span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@processMouseMove</span> <span class="nx">touch</span>
      <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
  
  <span class="nv">processTouchEnd: </span><span class="nf">(event) -&gt;</span>
    <span class="nx">clearInterval</span> <span class="nx">@touchHoldTimeout</span>
    <span class="nx">@processMouseUp</span> <span class="nv">button: </span><span class="mi">0</span>
  
  <span class="nv">processMouseUp: </span><span class="o">-&gt;</span>
    <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nx">@destroyTemporaries</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">0</span>
      <span class="nx">@drop</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">@mouseButton</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickLeft&quot;</span>
      <span class="k">else</span>
        <span class="nv">expectedClick = </span><span class="s">&quot;mouseClickRight&quot;</span>
        <span class="k">if</span> <span class="nx">@mouseButton</span>
          <span class="nv">context = </span><span class="nx">morph</span>
          <span class="nv">contextMenu = </span><span class="nx">context</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">()</span>
          <span class="k">while</span> <span class="p">(</span><span class="o">not</span> <span class="nx">contextMenu</span><span class="p">)</span> <span class="o">and</span> <span class="nx">context</span><span class="p">.</span><span class="nx">parent</span>
            <span class="nv">context = </span><span class="nx">context</span><span class="p">.</span><span class="nx">parent</span>
            <span class="nv">contextMenu = </span><span class="nx">context</span><span class="p">.</span><span class="nx">contextMenu</span><span class="p">()</span>
          <span class="nx">contextMenu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span>  <span class="k">if</span> <span class="nx">contextMenu</span>
      <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">morph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span>
      <span class="nx">morph</span><span class="p">[</span><span class="nx">expectedClick</span><span class="p">]</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span>
    <span class="vi">@mouseButton = </span><span class="kc">null</span>
  
  <span class="nv">processMouseScroll: </span><span class="nf">(event) -&gt;</span>
    <span class="nv">morph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">morph = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">parent</span>  <span class="k">while</span> <span class="nx">morph</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseScroll</span>
    <span class="nx">morph</span><span class="p">.</span><span class="nx">mouseScroll</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span> <span class="o">/</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s">&quot;wheelDeltaY&quot;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDeltaY</span> <span class="o">/</span> <span class="mi">120</span> <span class="k">else</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">/</span> <span class="mi">120</span><span class="p">)),</span> <span class="nx">event</span><span class="p">.</span><span class="nx">wheelDeltaX</span> <span class="o">/</span> <span class="mi">120</span> <span class="o">or</span> <span class="mi">0</span>  <span class="k">if</span> <span class="nx">morph</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-291">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-291">&#182;</a>               </div>               <p>drop event:</p>

<pre><code>   droppedImage
   droppedAudio
   droppedText
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">processDrop: </span><span class="nf">(event) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-292">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-292">&#182;</a>               </div>               <p>find out whether an external image or audio file was dropped
   onto the world canvas, turn it into an offscreen canvas or audio
   element and dispatch the</p>

<pre><code>   droppedImage(canvas, name)
   droppedAudio(audio, name)
</code></pre>

<p>events to interested Morphs at the mouse pointer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">files = </span><span class="p">(</span><span class="k">if</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="nx">FileList</span> <span class="k">then</span> <span class="nx">event</span> <span class="k">else</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">files</span><span class="p">))</span>
    <span class="nv">txt = </span><span class="p">(</span><span class="k">if</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span> <span class="k">then</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s">&quot;Text/HTML&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nv">targetDrop = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
    <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-293">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-293">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">readImage = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">pic = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span>
      <span class="nv">pic.onload = </span><span class="o">-&gt;</span>
        <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">pic</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">pic</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">drawImage</span> <span class="nx">pic</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span> <span class="nx">canvas</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span></pre></div>             </td>           </tr>                               <tr id="section-294">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-294">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nv">pic.src = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-295">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-295">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsDataURL</span> <span class="nx">aFile</span></pre></div>             </td>           </tr>                               <tr id="section-296">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-296">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">readAudio = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">snd = </span><span class="k">new</span> <span class="nx">Audio</span><span class="p">()</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedAudio</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nv">snd.src = </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedAudio</span> <span class="nx">snd</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsDataURL</span> <span class="nx">aFile</span>
    
    <span class="nv">readText = </span><span class="nf">(aFile) -&gt;</span>
      <span class="nv">frd = </span><span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedText</span>
      <span class="nv">frd.onloadend = </span><span class="nf">(e) -&gt;</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedText</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">,</span> <span class="nx">aFile</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">frd</span><span class="p">.</span><span class="nx">readAsText</span> <span class="nx">aFile</span>
    
    <span class="nv">parseImgURL = </span><span class="nf">(html) -&gt;</span>
      <span class="nv">url = </span><span class="s">&quot;&quot;</span>
      <span class="nv">start = </span><span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;&lt;img src=\&quot;&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">start</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">start</span> <span class="o">+=</span> <span class="mi">10</span>
      <span class="nv">i = </span><span class="nx">start</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">html</span><span class="p">.</span><span class="nx">length</span>
        <span class="nv">c = </span><span class="nx">html</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="nx">url</span>  <span class="k">if</span> <span class="nx">c</span> <span class="o">is</span> <span class="s">&quot;\&quot;&quot;</span>
        <span class="nv">url = </span><span class="nx">url</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="kc">null</span>
    
    <span class="k">if</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span>
        <span class="nv">file = </span><span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">readImage</span> <span class="nx">file</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;audio&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">readAudio</span> <span class="nx">file</span>
        <span class="k">else</span> <span class="nx">readText</span> <span class="nx">file</span>  <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">txt</span>
      <span class="nv">targetDrop = </span><span class="nx">targetDrop</span><span class="p">.</span><span class="nx">parent</span>  <span class="nx">until</span> <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span>
      <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">img.onload = </span><span class="o">-&gt;</span>
        <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">).</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="nx">targetDrop</span><span class="p">.</span><span class="nx">droppedImage</span> <span class="nx">canvas</span>
      <span class="nv">src = </span><span class="nx">parseImgURL</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span>
      <span class="nv">img.src = </span><span class="nx">src</span>  <span class="k">if</span> <span class="nx">src</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-297">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-297">&#182;</a>               </div>               <p>HandMorph tools</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroyTemporaries: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-298">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-298">&#182;</a>               </div>               <p>temporaries are just an array of morphs which will be deleted upon
the next mouse click, or whenever another temporary Morph decides
that it needs to remove them. The primary purpose of temporaries is
to display tools tips of speech bubble help.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@temporaries</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(morph) -&gt;</span>
      <span class="nx">morph</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    <span class="vi">@temporaries = </span><span class="p">[]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-299">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-299">&#182;</a>               </div>               <p>HandMorph dragging optimization</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span>
    <span class="k">super</span> <span class="nx">delta</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
  
  <span class="nv">processMouseMove: </span><span class="nf">(event) -&gt;</span>
    <span class="nv">posInDocument = </span><span class="nx">getDocumentPositionOf</span><span class="p">(</span><span class="nx">@world</span><span class="p">.</span><span class="nx">worldCanvas</span><span class="p">)</span>
    <span class="nv">pos = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">posInDocument</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">posInDocument</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span></pre></div>             </td>           </tr>                               <tr id="section-300">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-300">&#182;</a>               </div>               <p>determine the new mouse-over-list:
mouseOverNew = this.allMorphsAtPointer();</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">mouseOverNew = </span><span class="nx">@morphAtPointer</span><span class="p">().</span><span class="nx">allParents</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">@mouseButton</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
      <span class="nv">topMorph = </span><span class="nx">@morphAtPointer</span><span class="p">()</span>
      <span class="nv">morph = </span><span class="nx">topMorph</span><span class="p">.</span><span class="nx">rootForGrab</span><span class="p">()</span>
      <span class="nx">topMorph</span><span class="p">.</span><span class="nx">mouseMove</span> <span class="nx">pos</span>  <span class="k">if</span> <span class="nx">topMorph</span><span class="p">.</span><span class="nx">mouseMove</span></pre></div>             </td>           </tr>                               <tr id="section-301">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-301">&#182;</a>               </div>               <p>if a morph is marked for grabbing, just grab it</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@morphToGrab</span>
        <span class="k">if</span> <span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">isDraggable</span>
          <span class="nv">morph = </span><span class="nx">@morphToGrab</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">isTemplate</span>
          <span class="nv">morph = </span><span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">fullCopy</span><span class="p">()</span>
          <span class="nv">morph.isTemplate = </span><span class="kc">false</span>
          <span class="nv">morph.isDraggable = </span><span class="kc">true</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
          <span class="vi">@grabOrigin = </span><span class="nx">@morphToGrab</span><span class="p">.</span><span class="nx">situation</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-302">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-302">&#182;</a>               </div>               <p>if the mouse has left its fullBounds, center it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">fb = </span><span class="nx">morph</span><span class="p">.</span><span class="nx">fullBounds</span><span class="p">()</span>
        <span class="nx">unless</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
          <span class="vi">@bounds.origin = </span><span class="nx">fb</span><span class="p">.</span><span class="nx">center</span><span class="p">()</span>
          <span class="nx">@grab</span> <span class="nx">morph</span>
          <span class="nx">@setPosition</span> <span class="nx">pos</span>
    </pre></div>             </td>           </tr>                               <tr id="section-303">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-303">&#182;</a>               </div>               <p>original, more cautious code for grabbing Morphs,
retained in case of needing    to fall back:</p>

<pre><code>if (morph === this.morphToGrab) {
    if (morph.isDraggable) {
        this.grab(morph);
    } else if (morph.isTemplate) {
        morph = morph.fullCopy();
        morph.isTemplate = false;
        morph.isDraggable = true;
        this.grab(morph);
    }
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@mouseOverList</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(old) -&gt;</span>
      <span class="nx">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">mouseOverNew</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span>
        <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeave</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeave</span>
        <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeaveDragging</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">old</span><span class="p">.</span><span class="nx">mouseLeaveDragging</span> <span class="o">and</span> <span class="nx">@mouseButton</span></pre></div>             </td>           </tr>                               <tr id="section-304">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-304">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">mouseOverNew</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">newMorph</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">unless</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">@mouseOverList</span><span class="p">,</span> <span class="nx">newMorph</span><span class="p">)</span>
        <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnter</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnter</span>
        <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnterDragging</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">newMorph</span><span class="p">.</span><span class="nx">mouseEnterDragging</span> <span class="o">and</span> <span class="nx">@mouseButton</span></pre></div>             </td>           </tr>                               <tr id="section-305">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-305">&#182;</a>               </div>               <p>autoScrolling support:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
          <span class="k">if</span> <span class="nx">newMorph</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
              <span class="k">if</span> <span class="o">!</span><span class="nx">newMorph</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">insetBy</span><span class="p">(</span>
                <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="p">).</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
                  <span class="nx">newMorph</span><span class="p">.</span><span class="nx">startAutoScrolling</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-306">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-306">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@mouseOverList = </span><span class="nx">mouseOverNew</span></pre></div>             </td>           </tr>                               <tr id="section-307">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-307">&#182;</a>               </div>               <p>Points //////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Point</span>

  <span class="nv">x: </span><span class="kc">null</span>
  <span class="nv">y: </span><span class="kc">null</span>
   
  <span class="nv">constructor: </span><span class="nf">(@x = 0, @y = 0) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-308">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-308">&#182;</a>               </div>               <p>Point string representation: e.g. '12@68'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@x</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;@&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@y</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  </pre></div>             </td>           </tr>                               <tr id="section-309">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-309">&#182;</a>               </div>               <p>Point copying:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copy: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-310">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-310">&#182;</a>               </div>               <p>Point comparison:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eq: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-311">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-311">&#182;</a>               </div>               <p>==</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">is</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">lt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-312">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-312">&#182;</a>               </div>               <p>&lt;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&lt;</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&lt;</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">gt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-313">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-313">&#182;</a>               </div>               <p>></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&gt;</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&gt;</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">ge: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-314">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-314">&#182;</a>               </div>               <blockquote>
  <p>=</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">le: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-315">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-315">&#182;</a>               </div>               <p>&lt;=</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@x</span> <span class="o">&lt;=</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">&lt;=</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">max: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@y</span><span class="p">,</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>
  
  <span class="nv">min: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@y</span><span class="p">,</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-316">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-316">&#182;</a>               </div>               <p>Point conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">round: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">@y</span><span class="p">))</span>
  
  <span class="nv">abs: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@y</span><span class="p">))</span>
  
  <span class="nv">neg: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">@x</span><span class="p">,</span> <span class="o">-</span><span class="nx">@y</span><span class="p">)</span>
  
  <span class="nv">mirror: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@y</span><span class="p">,</span> <span class="nx">@x</span><span class="p">)</span>
  
  <span class="nv">floor: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
  
  <span class="nv">ceil: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">@x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">@y</span><span class="p">))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-317">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-317">&#182;</a>               </div>               <p>Point arithmetic:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add: </span><span class="nf">(other) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">+</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">+</span> <span class="nx">other</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">+</span> <span class="nx">other</span><span class="p">)</span>
  
  <span class="nv">subtract: </span><span class="nf">(other) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">-</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">other</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">-</span> <span class="nx">other</span><span class="p">)</span>
  
  <span class="nv">multiplyBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">*</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">*</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">*</span> <span class="nx">other</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">*</span> <span class="nx">other</span><span class="p">)</span>
  
  <span class="nv">divideBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">)</span>
  
  <span class="nv">floorDivideBy: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">Point</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@x</span> <span class="o">/</span> <span class="nx">other</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">other</span><span class="p">))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-318">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-318">&#182;</a>               </div>               <p>Point polar coordinates:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">r: </span><span class="o">-&gt;</span>
    <span class="nv">t = </span><span class="p">(</span><span class="nx">@multiplyBy</span><span class="p">(</span><span class="nx">@</span><span class="p">))</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span> <span class="nx">t</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span>
  
  <span class="nv">degrees: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-319">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-319">&#182;</a>               </div>               <p>answer the angle I make with origin in degrees.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@x</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">90</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">270</span>
    <span class="nv">tan = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">@x</span>
    <span class="nv">theta = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">tan</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="mi">360</span> <span class="o">+</span> <span class="p">(</span><span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">))</span>
    <span class="mi">180</span> <span class="o">+</span> <span class="nx">degrees</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
  
  <span class="nv">theta: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-320">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-320">&#182;</a>               </div>               <p>answer the angle I make with origin in radians.
   Right is 0, down is 90</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@x</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span>
    <span class="nv">tan = </span><span class="nx">@y</span> <span class="o">/</span> <span class="nx">@x</span>
    <span class="nv">theta = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">tan</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@x</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">theta</span>  <span class="k">if</span> <span class="nx">@y</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span> <span class="o">+</span> <span class="nx">theta</span>
    <span class="nx">radians</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="nx">theta</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-321">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-321">&#182;</a>               </div>               <p>Point functions:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">crossProduct: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="nx">@multiplyBy</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">mirror</span><span class="p">()</span>
  
  <span class="nv">distanceTo: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="p">(</span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@</span><span class="p">)).</span><span class="nx">r</span><span class="p">()</span>
  
  <span class="nv">rotate: </span><span class="nf">(direction, center) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-322">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-322">&#182;</a>               </div>               <p>direction must be 'right', 'left' or 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offset = </span><span class="nx">@subtract</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-323">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-323">&#182;</a>               </div>               <p>direction === 'pi'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">center</span><span class="p">.</span><span class="nx">subtract</span> <span class="nx">offset</span>
  
  <span class="nv">flip: </span><span class="nf">(direction, center) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-324">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-324">&#182;</a>               </div>               <p>direction must be 'vertical' or 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">@y</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">direction</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-325">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-325">&#182;</a>               </div>               <p>direction === 'horizontal'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">)</span>
  
  <span class="nv">distanceAngle: </span><span class="nf">(dist, angle) -&gt;</span>
    <span class="nv">deg = </span><span class="nx">angle</span>
    <span class="k">if</span> <span class="nx">deg</span> <span class="o">&gt;</span> <span class="mi">270</span>
      <span class="nv">deg = </span><span class="nx">deg</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="k">else</span> <span class="nv">deg = </span><span class="nx">deg</span> <span class="o">+</span> <span class="mi">360</span>  <span class="k">if</span> <span class="nx">deg</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">270</span>
    <span class="k">if</span> <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="nx">deg</span> <span class="o">and</span> <span class="nx">deg</span> <span class="o">&lt;=</span> <span class="mi">90</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">radians</span><span class="p">(</span><span class="nx">deg</span><span class="p">))</span> <span class="o">*</span> <span class="nx">dist</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">dist</span> <span class="o">*</span> <span class="nx">dist</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">))</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">-</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">radians</span><span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="nx">deg</span><span class="p">))</span> <span class="o">*</span> <span class="nx">dist</span>
    <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">dist</span> <span class="o">*</span> <span class="nx">dist</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">))</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span> <span class="o">+</span> <span class="nx">y</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-326">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-326">&#182;</a>               </div>               <p>Point transforming:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scaleBy: </span><span class="nf">(scalePoint) -&gt;</span>
    <span class="nx">@multiplyBy</span> <span class="nx">scalePoint</span>
  
  <span class="nv">translateBy: </span><span class="nf">(deltaPoint) -&gt;</span>
    <span class="nx">@add</span> <span class="nx">deltaPoint</span>
  
  <span class="nv">rotateBy: </span><span class="nf">(angle, centerPoint) -&gt;</span>
    <span class="nv">center = </span><span class="nx">centerPoint</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">p = </span><span class="nx">@subtract</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
    <span class="nv">r = </span><span class="nx">p</span><span class="p">.</span><span class="nx">r</span><span class="p">()</span>
    <span class="nv">theta = </span><span class="nx">angle</span> <span class="o">-</span> <span class="nx">p</span><span class="p">.</span><span class="nx">theta</span><span class="p">()</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)),</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)))</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-327">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-327">&#182;</a>               </div>               <p>Point conversion:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">asArray: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-328">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-328">&#182;</a>               </div>               <p>creating Rectangle instances from Points:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">corner: </span><span class="nf">(cornerPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-329">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-329">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">cornerPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">cornerPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">rectangle: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-330">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-330">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">org = </span><span class="nx">@min</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
    <span class="nv">crn = </span><span class="nx">@max</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">org</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">extent: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-331">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-331">&#182;</a>               </div>               <p>answer a new Rectangle</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">crn = </span><span class="nx">@add</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Rectangle</span><span class="p">(</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">crn</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-332">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-332">&#182;</a>               </div>               <p>StringFieldMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">StringFieldMorph</span> <span class="k">extends</span> <span class="nx">FrameMorph</span>

  <span class="nv">defaultContents: </span><span class="kc">null</span>
  <span class="nv">minWidth: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span>
  <span class="nv">isBold: </span><span class="kc">null</span>
  <span class="nv">isItalic: </span><span class="kc">null</span>
  <span class="nv">isNumeric: </span><span class="kc">null</span>
  <span class="nv">text: </span><span class="kc">null</span>
  <span class="nv">isEditable: </span><span class="kc">true</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">      @defaultContents = &quot;&quot;,</span>
<span class="nf">      @minWidth = 100,</span>
<span class="nf">      @fontSize = 12,</span>
<span class="nf">      @fontStyle = &quot;sans-serif&quot;,</span>
<span class="nf">      @isBold = false,</span>
<span class="nf">      @isItalic = false,</span>
<span class="nf">      @isNumeric = false</span>
<span class="nf">      ) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nv">txt = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@text</span> <span class="k">then</span> <span class="nx">@string</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@defaultContents</span><span class="p">)</span>
    <span class="vi">@text = </span><span class="kc">null</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-333">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-333">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="vi">@text = </span><span class="k">new</span> <span class="nx">StringMorph</span><span class="p">(</span><span class="nx">txt</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">,</span> <span class="nx">@fontStyle</span><span class="p">,</span> <span class="nx">@isBold</span><span class="p">,</span> <span class="nx">@isItalic</span><span class="p">,</span> <span class="nx">@isNumeric</span><span class="p">)</span>
    <span class="vi">@text.isNumeric = </span><span class="nx">@isNumeric</span> <span class="c1"># for whichever reason...</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="vi">@text.isEditable = </span><span class="nx">@isEditable</span>
    <span class="vi">@text.isDraggable = </span><span class="kc">false</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">@minWidth</span><span class="p">),</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@text</span>
  
  <span class="nv">string: </span><span class="o">-&gt;</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">text</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">edit</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@isEditable</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-334">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-334">&#182;</a>               </div>               <p>StringFieldMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-335">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-335">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.text = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@text</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">text</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@text</span><span class="p">]</span>
    <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-336">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-336">&#182;</a>               </div>               <p>BouncerMorph ////////////////////////////////////////////////////////
fishy constructor
I am a Demo of a stepping custom Morph</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BouncerMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">isStopped: </span><span class="kc">false</span>
  <span class="nv">type: </span><span class="kc">null</span>
  <span class="nv">direction: </span><span class="kc">null</span>
  <span class="nv">speed: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@type = &quot;vertical&quot;, @speed = 1) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@fps = </span><span class="mi">50</span></pre></div>             </td>           </tr>                               <tr id="section-337">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-337">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="vi">@direction = </span><span class="s">&quot;down&quot;</span>
    <span class="k">else</span>
      <span class="vi">@direction = </span><span class="s">&quot;right&quot;</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-338">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-338">&#182;</a>               </div>               <p>BouncerMorph moving:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveUp: </span><span class="o">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">@speed</span><span class="p">)</span>
  
  <span class="nv">moveDown: </span><span class="o">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@speed</span><span class="p">)</span>
  
  <span class="nv">moveRight: </span><span class="o">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">moveLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="nx">@speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-339">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-339">&#182;</a>               </div>               <p>BouncerMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@isStopped</span>
      <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
        <span class="k">if</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;down&quot;</span>
          <span class="nx">@moveDown</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@moveUp</span><span class="p">()</span>
        <span class="vi">@direction = </span><span class="s">&quot;down&quot;</span>  <span class="k">if</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">top</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;up&quot;</span>
        <span class="vi">@direction = </span><span class="s">&quot;up&quot;</span>  <span class="k">if</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;down&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;horizontal&quot;</span>
        <span class="k">if</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
          <span class="nx">@moveRight</span><span class="p">()</span>
        <span class="k">else</span>
          <span class="nx">@moveLeft</span><span class="p">()</span>
        <span class="vi">@direction = </span><span class="s">&quot;right&quot;</span>  <span class="k">if</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">left</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;left&quot;</span>
        <span class="vi">@direction = </span><span class="s">&quot;left&quot;</span>  <span class="k">if</span> <span class="nx">@fullBounds</span><span class="p">().</span><span class="nx">right</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-340">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-340">&#182;</a>               </div>               <p>ColorPaletteMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ColorPaletteMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">targetSetter: </span><span class="s">&quot;color&quot;</span>
  <span class="nv">choice: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, sizePoint) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">sizePoint</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nv">ext = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="vi">@choice = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="nv">x = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">h = </span><span class="mi">360</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span>
      <span class="nv">y = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span>
        <span class="nv">l = </span><span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="nx">y</span> <span class="o">/</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="nv">context.fillStyle = </span><span class="s">&quot;hsl(&quot;</span> <span class="o">+</span> <span class="nx">h</span> <span class="o">+</span> <span class="s">&quot;,100%,&quot;</span> <span class="o">+</span> <span class="nx">l</span> <span class="o">+</span> <span class="s">&quot;%)&quot;</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span>
  
  <span class="nv">mouseMove: </span><span class="nf">(pos) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">@getPixelColor</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="vi">@choice = </span><span class="nx">@getPixelColor</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">@updateTarget</span><span class="p">()</span>
  
  <span class="nv">updateTarget: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@target</span> <span class="k">instanceof</span> <span class="nx">Morph</span> <span class="o">and</span> <span class="nx">@choice</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Function</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="nx">@choice</span>
      <span class="k">else</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">@targetSetter</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@choice</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-341">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-341">&#182;</a>               </div>               <p>ColorPaletteMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-342">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-342">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nx">c</span>
  </pre></div>             </td>           </tr>                               <tr id="section-343">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-343">&#182;</a>               </div>               <p>ColorPaletteMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;set target&quot;</span><span class="p">,</span> <span class="s">&quot;setTarget&quot;</span><span class="p">,</span> <span class="s">&quot;choose another morph\nwhose color property\n will be&quot;</span> <span class="o">+</span> <span class="s">&quot; controlled by this one&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setTarget: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@world</span><span class="p">()</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">=&gt;</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@target = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">@setTargetSetter</span><span class="p">()</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
  
  <span class="nv">setTargetSetter: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">colorSetters</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target property:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@targetSetter = </span><span class="nx">each</span>
    <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="vi">@targetSetter = </span><span class="nx">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-344">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-344">&#182;</a>               </div>               <p>GrayPaletteMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GrayPaletteMorph</span> <span class="k">extends</span> <span class="nx">ColorPaletteMorph</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, sizePoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">@target</span><span class="p">,</span> <span class="nx">sizePoint</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nv">ext = </span><span class="nx">@extent</span><span class="p">()</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="vi">@choice = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
    <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
    <span class="nv">context.fillStyle = </span><span class="nx">gradient</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ext</span><span class="p">.</span><span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-345">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-345">&#182;</a>               </div>               <p>HandleMorph ////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-346">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-346">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-347">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-347">&#182;</a>               </div>               <p>I am a resize / move handle that can be attached to any Morph</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">HandleMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">minExtent: </span><span class="kc">null</span>
  <span class="nv">inset: </span><span class="kc">null</span>
  <span class="nv">type: </span><span class="kc">null</span> <span class="c1"># &quot;resize&quot; or &quot;move&quot;</span>

  <span class="nv">constructor: </span><span class="nf">(@target = null, minX = 0, minY = 0, insetX, insetY, @type = &quot;resize&quot;) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-348">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-348">&#182;</a>               </div>               <p>if insetY is missing, it will be the same as insetX</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@minExtent = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">minX</span><span class="p">,</span> <span class="nx">minY</span><span class="p">)</span>
    <span class="vi">@inset = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">insetX</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">insetY</span> <span class="o">or</span> <span class="nx">insetX</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nv">size = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-349">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-349">&#182;</a>               </div>               <p>HandleMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="vi">@normalImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="vi">@highlightImage = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nx">@drawOnCanvas</span> <span class="nx">@normalImage</span><span class="p">,</span> <span class="nx">@color</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nx">@drawOnCanvas</span> <span class="nx">@highlightImage</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="k">if</span> <span class="nx">@target</span>
      <span class="nx">@setPosition</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">))</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
      <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  <span class="nv">drawOnCanvas: </span><span class="nf">(aCanvas, color, shadowColor) -&gt;</span>
    <span class="nv">context = </span><span class="nx">aCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.lineWidth = </span><span class="mi">1</span>
    <span class="nv">context.lineCap = </span><span class="s">&quot;round&quot;</span>
    <span class="nv">context.strokeStyle = </span><span class="nx">color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;move&quot;</span>
      <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">@height</span><span class="p">()</span>
        <span class="nv">p11.y = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nv">p22.y = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">6</span>
    <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">@width</span><span class="p">()</span>
      <span class="nv">p11.x = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nv">p22.x = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">6</span>
    <span class="nv">context.strokeStyle = </span><span class="nx">shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;move&quot;</span>
      <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
      <span class="nv">i = </span><span class="o">-</span><span class="mi">2</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">@height</span><span class="p">()</span>
        <span class="nv">p11.y = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nv">p22.y = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">i</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">6</span>
    <span class="nv">p1 = </span><span class="nx">@bottomLeft</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p11 = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">p2 = </span><span class="nx">@topRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
    <span class="nv">p22 = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="nv">i = </span><span class="mi">2</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">@width</span><span class="p">()</span>
      <span class="nv">p11.x = </span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nv">p22.x = </span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p11</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p22</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">6</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-350">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-350">&#182;</a>               </div>               <p>HandleMorph stepping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step = </span><span class="kc">null</span>
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="nv">world = </span><span class="nx">@root</span><span class="p">()</span>
    <span class="nv">offset = </span><span class="nx">pos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="nx">unless</span> <span class="nx">@target</span>
    <span class="vi">@step = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">mouseButton</span>
        <span class="nv">newPos = </span><span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">@type</span> <span class="o">is</span> <span class="s">&quot;resize&quot;</span>
          <span class="nv">newExt = </span><span class="nx">newPos</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">)).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
          <span class="nv">newExt = </span><span class="nx">newExt</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@minExtent</span><span class="p">)</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">newExt</span>
          <span class="nx">@setPosition</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">bottomRight</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">@inset</span><span class="p">))</span>
        <span class="k">else</span> <span class="c1"># type === &#39;move&#39;</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">newPos</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">extent</span><span class="p">()).</span><span class="nx">add</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
      <span class="k">else</span>
        <span class="vi">@step = </span><span class="kc">null</span>
    
    <span class="nx">unless</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">step</span>
      <span class="vi">@target.step = </span><span class="nx">noOperation</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-351">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-351">&#182;</a>               </div>               <p>HandleMorph dragging and dropping:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rootForGrab: </span><span class="o">-&gt;</span>
    <span class="nx">@</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-352">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-352">&#182;</a>               </div>               <p>HandleMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseLeave: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-353">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-353">&#182;</a>               </div>               <p>HandleMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-354">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-354">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.target = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">target</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@target</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-355">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-355">&#182;</a>               </div>               <p>HandleMorph menu:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">attach: </span><span class="o">-&gt;</span>
    <span class="nv">choices = </span><span class="nx">@overlappedMorphs</span><span class="p">()</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="s">&quot;choose target:&quot;</span><span class="p">)</span>
    <span class="nx">choices</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">each</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="nx">each</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="o">-&gt;</span>
        <span class="vi">@isDraggable = </span><span class="kc">false</span>
        <span class="vi">@target = </span><span class="nx">each</span>
        <span class="nx">@drawNew</span><span class="p">()</span>
        <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">choices</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-356">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-356">&#182;</a>               </div>               <p>InspectorMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">InspectorMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">currentProperty: </span><span class="kc">null</span>
  <span class="nv">showing: </span><span class="s">&quot;attributes&quot;</span>
  <span class="nv">markOwnershipOfProperties: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-357">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-357">&#182;</a>               </div>               <p>panes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">list: </span><span class="kc">null</span>
  <span class="nv">detail: </span><span class="kc">null</span>
  <span class="nv">work: </span><span class="kc">null</span>
  <span class="nv">buttonInspect: </span><span class="kc">null</span>
  <span class="nv">buttonClose: </span><span class="kc">null</span>
  <span class="nv">buttonSubset: </span><span class="kc">null</span>
  <span class="nv">buttonEdit: </span><span class="kc">null</span>
  <span class="nv">resizer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(@target) -&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-358">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-358">&#182;</a>               </div>               <p>override inherited properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="vi">@isDraggable = </span><span class="kc">true</span>
    <span class="vi">@border = </span><span class="mi">1</span>
    <span class="vi">@edge = </span><span class="mi">5</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@target</span>
  
  <span class="nv">setTarget: </span><span class="nf">(target) -&gt;</span>
    <span class="vi">@target = </span><span class="nx">target</span>
    <span class="vi">@currentProperty = </span><span class="kc">null</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">buildPanes: </span><span class="o">-&gt;</span>
    <span class="nv">attribs = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-359">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-359">&#182;</a>               </div>               <p>remove existing panes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-360">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-360">&#182;</a>               </div>               <p>keep work pane around</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@work</span></pre></div>             </td>           </tr>                               <tr id="section-361">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-361">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-362">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-362">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="vi">@label.fontSize = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span>
    <span class="vi">@label.isBold = </span><span class="kc">true</span>
    <span class="vi">@label.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@label</span>
    </pre></div>             </td>           </tr>                               <tr id="section-363">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-363">&#182;</a>               </div>               <p>properties list. Note that this picks up ALL properties
(enumerable such as strings and un-enumerable such as functions)
of the whole prototype chain.</p>

<p>a) some of these are DECLARED as part of the class that defines the object
  and are proprietary to the object. These are shown RED</p>

<p>b) some of these are proprietary to the object but are initialised by
  code higher in the prototype chain. These are shown GREEN</p>

<p>c) some of these are not proprietary, i.e. they belong to an object up
  the chain of prototypes. These are shown BLUE</p>

<p>todo: show the static methods and variables in yet another color.</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="k">for</span> <span class="nx">property</span> <span class="k">of</span> <span class="nx">@target</span></pre></div>             </td>           </tr>                               <tr id="section-364">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-364">&#182;</a>               </div>               <p>dummy condition, to be refined</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">attribs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">property</span>  <span class="k">if</span> <span class="nx">property</span>
    <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;attributes&quot;</span>
      <span class="nv">attribs = </span><span class="nx">attribs</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="o">not</span> <span class="nx">isFunction</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
      <span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;methods&quot;</span>
      <span class="nv">attribs = </span><span class="nx">attribs</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">isFunction</span> <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-365">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-365">&#182;</a>               </div>               <p>otherwise show all properties
label getter
format list
format element: [color, predicate(element]</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nv">staticProperties = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-366">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-366">&#182;</a>               </div>               <p>get rid of all the standar fuff properties that are in classes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">staticProperties = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">prop</span> <span class="o">not</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;length&quot;</span><span class="p">,</span><span class="s">&quot;prototype&quot;</span><span class="p">,</span><span class="s">&quot;caller&quot;</span><span class="p">,</span><span class="s">&quot;__super__&quot;</span><span class="p">,</span><span class="s">&quot;arguments&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;attributes&quot;</span>
      <span class="nv">staticFunctions = </span><span class="p">[]</span>
      <span class="nv">staticAttributes = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="o">not</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@showing</span> <span class="o">is</span> <span class="s">&quot;methods&quot;</span>
      <span class="nv">staticFunctions = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
      <span class="nv">staticAttributes = </span><span class="p">[]</span>
    <span class="k">else</span>
      <span class="nv">staticFunctions = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">isFunction</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span>
      <span class="p">)</span>
      <span class="nv">staticAttributes = </span><span class="nx">staticProperties</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">prop</span> <span class="o">not</span> <span class="k">in</span> <span class="nx">staticFunctions</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-367">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-367">&#182;</a>               </div>               <p>alert "stat fun " + staticFunctions + " stat attr " + staticAttributes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">attribs = </span><span class="p">(</span><span class="nx">attribs</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">staticFunctions</span><span class="p">).</span><span class="nx">concat</span> <span class="nx">staticAttributes</span></pre></div>             </td>           </tr>                               <tr id="section-368">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-368">&#182;</a>               </div>               <p>alert " all attribs " + attribs</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-369">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-369">&#182;</a>               </div>               <p>caches the own methods of the object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span>
      <span class="nv">targetOwnMethods = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-370">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-370">&#182;</a>               </div>               <p>alert targetOwnMethods</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list = </span><span class="k">new</span> <span class="nx">ListMorph</span><span class="p">((</span><span class="k">if</span> <span class="nx">@target</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="k">then</span> <span class="nx">attribs</span> <span class="k">else</span> <span class="nx">attribs</span><span class="p">.</span><span class="nx">sort</span><span class="p">()),</span> <span class="kc">null</span><span class="p">,(</span>
      <span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span>
        <span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-371">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-371">&#182;</a>               </div>               <p>give color criteria from the most general to the most specific</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
            <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-372">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-372">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="kc">true</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-373">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-373">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">element</span> <span class="k">in</span> <span class="nx">staticProperties</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-374">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-374">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="p">(</span><span class="nx">@target</span><span class="p">.</span><span class="nx">hasOwnProperty</span> <span class="nx">element</span><span class="p">)</span>
          <span class="p">],</span>
          <span class="p">[</span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-375">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-375">&#182;</a>               </div>               <p>if the element is either an enumerable property of the object
or it belongs to the own methods, then it is highlighted.
Note that hasOwnProperty doesn't pick up non-enumerable properties such as
functions.
In theory, getOwnPropertyNames should give ALL the properties but the methods
are still not picked up, maybe because of the coffeescript construction system, I am not sure</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="p">(</span><span class="nx">element</span> <span class="k">in</span> <span class="nx">targetOwnMethods</span><span class="p">)</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="k">else</span> <span class="kc">null</span>
    <span class="p">))</span>
    <span class="vi">@list.action = </span><span class="p">(</span><span class="nx">selected</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">val = </span><span class="nx">@target</span><span class="p">[</span><span class="nx">selected</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-376">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-376">&#182;</a>               </div>               <p>this is for finding the static variables</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">val</span> <span class="o">is</span> <span class="kc">undefined</span>
        <span class="nv">val = </span><span class="nx">@target</span><span class="p">.</span><span class="nx">constructor</span><span class="p">[</span><span class="nx">selected</span><span class="p">]</span>
      <span class="vi">@currentProperty = </span><span class="nx">val</span>
      <span class="k">if</span> <span class="nx">val</span> <span class="o">is</span> <span class="kc">null</span>
        <span class="nv">txt = </span><span class="s">&quot;NULL&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
        <span class="nv">txt = </span><span class="nx">val</span>
      <span class="k">else</span>
        <span class="nv">txt = </span><span class="nx">val</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">cnts = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span>
      <span class="nv">cnts.isEditable = </span><span class="kc">true</span>
      <span class="nx">cnts</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
      <span class="nx">cnts</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
      <span class="nx">@detail</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">cnts</span></pre></div>             </td>           </tr>                               <tr id="section-377">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-377">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@list.vBar.alpha = </span><span class="mf">0.6</span></pre></div>             </td>           </tr>                               <tr id="section-378">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-378">&#182;</a>               </div>               <p>we know that the content of this list in this pane is not going to need the
step function so we disable that form here. We could have disabled that from the
constructor of MenuMorph, but who knows that someone might intend to use a MenuMorph
in some animated way? We know that in this specific case it won't need animation so
we set that here. Note that the ListMorph itself does require animation because of the
scrollbars, but the MenuMorph that contains its contents doesn't.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list.listContents.step = </span><span class="kc">null</span>
    <span class="nx">@add</span> <span class="nx">@list</span></pre></div>             </td>           </tr>                               <tr id="section-379">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-379">&#182;</a>               </div>               <p>details pane</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@detail = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
    <span class="vi">@detail.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@detail.contents.acceptsDrops = </span><span class="kc">false</span>
    <span class="vi">@detail.isTextLineWrapping = </span><span class="kc">true</span>
    <span class="vi">@detail.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@detail.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@detail.vBar.alpha = </span><span class="mf">0.6</span>
    <span class="nv">ctrl = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="nv">ctrl.isEditable = </span><span class="kc">true</span>
    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">ctrl</span>
    <span class="nx">@add</span> <span class="nx">@detail</span></pre></div>             </td>           </tr>                               <tr id="section-380">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-380">&#182;</a>               </div>               <p>work ('evaluation') pane
don't refresh the work pane if it already exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@work</span> <span class="o">is</span> <span class="kc">null</span>
      <span class="vi">@work = </span><span class="k">new</span> <span class="nx">ScrollFrameMorph</span><span class="p">()</span>
      <span class="vi">@work.acceptsDrops = </span><span class="kc">false</span>
      <span class="vi">@work.contents.acceptsDrops = </span><span class="kc">false</span>
      <span class="vi">@work.isTextLineWrapping = </span><span class="kc">true</span>
      <span class="vi">@work.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
      <span class="vi">@work.hBar.alpha = </span><span class="mf">0.6</span>
      <span class="vi">@work.vBar.alpha = </span><span class="mf">0.6</span>
      <span class="nv">ev = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="nv">ev.isEditable = </span><span class="kc">true</span>
      <span class="nx">ev</span><span class="p">.</span><span class="nx">enableSelecting</span><span class="p">()</span>
      <span class="nx">ev</span><span class="p">.</span><span class="nx">setReceiver</span> <span class="nx">@target</span>
      <span class="nx">@work</span><span class="p">.</span><span class="nx">setContents</span> <span class="nx">ev</span>
    <span class="nx">@add</span> <span class="nx">@work</span></pre></div>             </td>           </tr>                               <tr id="section-381">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-381">&#182;</a>               </div>               <p>properties button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonSubset = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonSubset.labelString = </span><span class="s">&quot;show...&quot;</span>
    <span class="vi">@buttonSubset.action = </span><span class="o">=&gt;</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;attributes&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;attributes&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-382">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-382">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;methods&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;methods&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-383">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-383">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@showing = </span><span class="s">&quot;all&quot;</span>
        <span class="nx">@buildPanes</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-384">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-384">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@markOwnershipOfProperties</span> <span class="k">then</span> <span class="s">&quot;un-mark ownership&quot;</span> <span class="k">else</span> <span class="s">&quot;mark ownership&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="o">=&gt;</span>
        <span class="vi">@markOwnershipOfProperties = </span><span class="o">not</span> <span class="nx">@markOwnershipOfProperties</span>
        <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="p">),</span> <span class="s">&quot;highlight\nownership of properties&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-385">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-385">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonSubset</span></pre></div>             </td>           </tr>                               <tr id="section-386">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-386">&#182;</a>               </div>               <p>inspect button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonInspect = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonInspect.labelString = </span><span class="s">&quot;inspect...&quot;</span>
    <span class="vi">@buttonInspect.action = </span><span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">isObject</span><span class="p">(</span><span class="nx">@currentProperty</span><span class="p">)</span>
        <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">()</span>
        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;in new inspector...&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
          <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">@currentProperty</span><span class="p">)</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
          <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
          <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-387">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-387">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;here...&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
          <span class="nx">@setTarget</span> <span class="nx">@currentProperty</span></pre></div>             </td>           </tr>                               <tr id="section-388">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-388">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@inform</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@currentProperty</span> <span class="o">is</span> <span class="kc">null</span> <span class="k">then</span> <span class="s">&quot;null&quot;</span> <span class="k">else</span> <span class="k">typeof</span> <span class="nx">@currentProperty</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;\nis not inspectable&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-389">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-389">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonInspect</span></pre></div>             </td>           </tr>                               <tr id="section-390">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-390">&#182;</a>               </div>               <p>edit button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonEdit = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonEdit.labelString = </span><span class="s">&quot;edit...&quot;</span>
    <span class="vi">@buttonEdit.action = </span><span class="o">=&gt;</span>
      <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;save&quot;</span><span class="p">,</span> <span class="s">&quot;save&quot;</span><span class="p">,</span> <span class="s">&quot;accept changes&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;add property...&quot;</span><span class="p">,</span> <span class="s">&quot;addProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;rename...&quot;</span><span class="p">,</span> <span class="s">&quot;renameProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;remove...&quot;</span><span class="p">,</span> <span class="s">&quot;removeProperty&quot;</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">popUpAtHand</span> <span class="nx">@world</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-391">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-391">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonEdit</span></pre></div>             </td>           </tr>                               <tr id="section-392">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-392">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonClose = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonClose.labelString = </span><span class="s">&quot;close&quot;</span>
    <span class="vi">@buttonClose.action = </span><span class="o">=&gt;</span>
      <span class="nx">@destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-393">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-393">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonClose</span></pre></div>             </td>           </tr>                               <tr id="section-394">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-394">&#182;</a>               </div>               <p>resizer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@resizer = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-395">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-395">&#182;</a>               </div>               <p>update layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  <span class="nv">fixLayout: </span><span class="o">-&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-396">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-396">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">w</span>
    <span class="k">if</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">@silentSetHeight</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">50</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@resizer</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-397">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-397">&#182;</a>               </div>               <p>list</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">listContents</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>
    <span class="nx">w</span> <span class="o">-=</span> <span class="nx">@edge</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">@edge</span><span class="p">)</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">h = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">y</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-398">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-398">&#182;</a>               </div>               <p>detail</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@detail</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-399">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-399">&#182;</a>               </div>               <p>work</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nx">@work</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@work</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-400">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-400">&#182;</a>               </div>               <p>properties button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nx">@buttonSubset</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonSubset</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-401">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-401">&#182;</a>               </div>               <p>inspect button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">w = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">w</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-402">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-402">&#182;</a>               </div>               <p>edit button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@buttonInspect</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-403">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-403">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@buttonEdit</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-404">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-404">&#182;</a>               </div>               <p>InspectorMorph editing ops:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">save: </span><span class="o">-&gt;</span>
    <span class="nv">txt = </span><span class="nx">@detail</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nv">prop = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-405">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-405">&#182;</a>               </div>               <p>this.target[prop] = evaluate(txt);</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@target</span><span class="p">.</span><span class="nx">evaluateString</span> <span class="s">&quot;this.&quot;</span> <span class="o">+</span> <span class="nx">prop</span> <span class="o">+</span> <span class="s">&quot; = &quot;</span> <span class="o">+</span> <span class="nx">txt</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span>
  
  <span class="nv">addProperty: </span><span class="o">-&gt;</span>
    <span class="nx">@prompt</span> <span class="s">&quot;new property name:&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">prop</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="nx">@buildPanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
          <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="p">),</span> <span class="nx">@</span><span class="p">,</span> <span class="s">&quot;property&quot;</span> <span class="c1"># Chrome cannot handle empty strings (others do)</span>
  
  <span class="nv">renameProperty: </span><span class="o">-&gt;</span>
    <span class="nv">propertyName = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="nx">@prompt</span> <span class="s">&quot;property name:&quot;</span><span class="p">,</span> <span class="p">((</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">try</span>
        <span class="k">delete</span> <span class="p">(</span><span class="nx">@target</span><span class="p">[</span><span class="nx">propertyName</span><span class="p">])</span>
        <span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@currentProperty</span>
      <span class="k">catch</span> <span class="nx">err</span>
        <span class="nx">@inform</span> <span class="nx">err</span>
      <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="p">),</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">propertyName</span>
  
  <span class="nv">removeProperty: </span><span class="o">-&gt;</span>
    <span class="nv">prop = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">selected</span>
    <span class="k">try</span>
      <span class="k">delete</span> <span class="p">(</span><span class="nx">@target</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-406">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-406">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@currentProperty = </span><span class="kc">null</span>
      <span class="nx">@buildPanes</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
        <span class="nx">@target</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@inform</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-407">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-407">&#182;</a>               </div>               <p>TextMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-408">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-408">&#182;</a>               </div>               <p>I am a multi-line, word-wrapping String</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">TextMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">text: </span><span class="kc">null</span>
  <span class="nv">words: </span><span class="p">[]</span>
  <span class="nv">lines: </span><span class="p">[]</span>
  <span class="nv">lineSlots: </span><span class="p">[]</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontName: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span>
  <span class="nv">isBold: </span><span class="kc">null</span>
  <span class="nv">isItalic: </span><span class="kc">null</span>
  <span class="nv">alignment: </span><span class="kc">null</span>
  <span class="nv">shadowOffset: </span><span class="kc">null</span>
  <span class="nv">shadowColor: </span><span class="kc">null</span>
  <span class="nv">maxWidth: </span><span class="kc">null</span>
  <span class="nv">maxLineWidth: </span><span class="mi">0</span>
  <span class="nv">backgroundColor: </span><span class="kc">null</span>
  <span class="nv">isEditable: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-409">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-409">&#182;</a>               </div>               <p>additional properties for ad-hoc evaluation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">receiver: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-410">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-410">&#182;</a>               </div>               <p>additional properties for text-editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">currentlySelecting: </span><span class="kc">false</span>
  <span class="nv">startMark: </span><span class="mi">0</span>
  <span class="nv">endMark: </span><span class="mi">0</span>
  <span class="nv">markedTextColor: </span><span class="kc">null</span>
  <span class="nv">markedBackgoundColor: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">    text, @fontSize = 12, @fontStyle = &quot;sans-serif&quot;, @isBold = false,</span>
<span class="nf">    @isItalic = false, @alignment = &quot;left&quot;, @maxWidth = 0, fontName, shadowOffset,</span>
<span class="nf">    @shadowColor = null</span>
<span class="nf">    ) -&gt;</span>    
      <span class="vi">@text = </span><span class="nx">text</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="nx">text</span> <span class="o">is</span> <span class="s">&quot;&quot;</span> <span class="k">then</span> <span class="nx">text</span> <span class="k">else</span> <span class="s">&quot;TextMorph&quot;</span><span class="p">))</span>
      <span class="vi">@fontName = </span><span class="nx">fontName</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">globalFontFamily</span>
      <span class="vi">@shadowOffset = </span><span class="nx">shadowOffset</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="vi">@markedTextColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
      <span class="vi">@markedBackgoundColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-411">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-411">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-412">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-412">&#182;</a>               </div>               <p>override inherited properites:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">toString: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-413">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-413">&#182;</a>               </div>               <p>e.g. 'a TextMorph("Hello World")'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;a TextMorph&quot;</span> <span class="o">+</span> <span class="s">&quot;(\&quot;&quot;</span> <span class="o">+</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;...\&quot;)&quot;</span>
  
  <span class="nv">font: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-414">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-414">&#182;</a>               </div>               <p>answer a font string, e.g. 'bold italic 12px sans-serif'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">font = </span><span class="s">&quot;&quot;</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;bold &quot;</span>  <span class="k">if</span> <span class="nx">@isBold</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;italic &quot;</span>  <span class="k">if</span> <span class="nx">@isItalic</span>
    <span class="nx">font</span> <span class="o">+</span> <span class="nx">@fontSize</span> <span class="o">+</span> <span class="s">&quot;px &quot;</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@fontName</span> <span class="k">then</span> <span class="nx">@fontName</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="nx">@fontStyle</span>
  
  <span class="nv">parse: </span><span class="o">-&gt;</span>
    <span class="nv">paragraphs = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
    <span class="nv">canvas = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">oldline = </span><span class="s">&quot;&quot;</span>
    <span class="nv">slot = </span><span class="mi">0</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="vi">@maxLineWidth = </span><span class="mi">0</span>
    <span class="vi">@lines = </span><span class="p">[]</span>
    <span class="vi">@lineSlots = </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="vi">@words = </span><span class="p">[]</span>
    <span class="nx">paragraphs</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="vi">@words = </span><span class="nx">@words</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
      <span class="nx">@words</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-415">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-415">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@words</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">word</span> <span class="o">is</span> <span class="s">&quot;\n&quot;</span>
        <span class="nx">@lines</span><span class="p">.</span><span class="nx">push</span> <span class="nx">oldline</span>
        <span class="nx">@lineSlots</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slot</span>
        <span class="vi">@maxLineWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@maxLineWidth</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">oldline</span><span class="p">).</span><span class="nx">width</span><span class="p">)</span>
        <span class="nv">oldline = </span><span class="s">&quot;&quot;</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">@maxWidth</span> <span class="o">&gt;</span> <span class="mi">0</span>
          <span class="nv">newline = </span><span class="nx">oldline</span> <span class="o">+</span> <span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
          <span class="nv">w = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">newline</span><span class="p">).</span><span class="nx">width</span>
          <span class="k">if</span> <span class="nx">w</span> <span class="o">&gt;</span> <span class="nx">@maxWidth</span>
            <span class="nx">@lines</span><span class="p">.</span><span class="nx">push</span> <span class="nx">oldline</span>
            <span class="nx">@lineSlots</span><span class="p">.</span><span class="nx">push</span> <span class="nx">slot</span>
            <span class="vi">@maxLineWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@maxLineWidth</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">oldline</span><span class="p">).</span><span class="nx">width</span><span class="p">)</span>
            <span class="nv">oldline = </span><span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
          <span class="k">else</span>
            <span class="nv">oldline = </span><span class="nx">newline</span>
        <span class="k">else</span>
          <span class="nv">oldline = </span><span class="nx">oldline</span> <span class="o">+</span> <span class="nx">word</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        <span class="nx">slot</span> <span class="o">+=</span> <span class="nx">word</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
  
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nx">@parse</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-416">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-416">&#182;</a>               </div>               <p>set my extent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadowWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">height = </span><span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@maxWidth</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@maxLineWidth</span> <span class="o">+</span> <span class="nx">shadowWidth</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">extent</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@maxWidth</span> <span class="o">+</span> <span class="nx">shadowWidth</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
    <span class="vi">@image.width = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="vi">@image.height = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-417">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-417">&#182;</a>               </div>               <p>prepare context for drawing text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nv">context.textAlign = </span><span class="s">&quot;left&quot;</span>
    <span class="nv">context.textBaseline = </span><span class="s">&quot;bottom&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-418">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-418">&#182;</a>               </div>               <p>fill the background, if desired</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@backgroundColor</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@backgroundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-419">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-419">&#182;</a>               </div>               <p>draw the shadow, if any</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shadowColor</span>
      <span class="nv">offx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">offy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span>
        <span class="nv">line = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="nv">width = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">line</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">shadowWidth</span>
        <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
          <span class="nv">x = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;center&quot;</span>
          <span class="nv">x = </span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="c1"># &#39;left&#39;</span>
          <span class="nv">x = </span><span class="mi">0</span>
        <span class="nv">y = </span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">-</span> <span class="nx">shadowHeight</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">offx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">offy</span>
        <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-420">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-420">&#182;</a>               </div>               <p>now draw the actual text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">offy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nv">i = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">line = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nv">width = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">line</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">shadowWidth</span>
      <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;right&quot;</span>
        <span class="nv">x = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">is</span> <span class="s">&quot;center&quot;</span>
        <span class="nv">x = </span><span class="p">(</span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="k">else</span> <span class="c1"># &#39;left&#39;</span>
        <span class="nv">x = </span><span class="mi">0</span>
      <span class="nv">y = </span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">-</span> <span class="nx">shadowHeight</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">offx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">offy</span>
      <span class="nv">i = </span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-421">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-421">&#182;</a>               </div>               <p>draw the selection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">i = </span><span class="nx">start</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">stop</span>
      <span class="nv">p = </span><span class="nx">@slotPosition</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">c = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedBackgoundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedTextColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-422">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-422">&#182;</a>               </div>               <p>notify my parent of layout change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">layoutChanged</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">layoutChanged</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="vi">@maxWidth = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-423">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-423">&#182;</a>               </div>               <p>TextMorph mesuring:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">columnRow: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-424">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-424">&#182;</a>               </div>               <p>answer the logical position point of the given index ("slot")</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="nv">row = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">row</span> <span class="o">&lt;</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">idx = </span><span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">row</span><span class="p">]</span>
      <span class="nv">col = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="nx">@lines</span><span class="p">[</span><span class="nx">row</span><span class="p">].</span><span class="nx">length</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">col</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">idx</span> <span class="o">is</span> <span class="nx">slot</span>
        <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nx">col</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">row</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-425">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-425">&#182;</a>               </div>               <p>return new Point(0, 0);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  
  <span class="nv">slotPosition: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-426">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-426">&#182;</a>               </div>               <p>answer the physical position point of the given index ("slot")
where the cursor should be placed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">xOffset = </span><span class="mi">0</span>
    <span class="nv">yOffset = </span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span>
    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span>
      <span class="nx">xOffset</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span><span class="p">][</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">xOffset</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">yOffset</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">slotAt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-427">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-427">&#182;</a>               </div>               <p>answer the slot (index) closest to the given point
so the cursor can be moved accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">charX = </span><span class="mi">0</span>
    <span class="nv">row = </span><span class="mi">0</span>
    <span class="nv">col = </span><span class="mi">0</span>
    <span class="nv">shadowHeight = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nx">row</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">((</span><span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">shadowHeight</span><span class="p">)</span> <span class="o">*</span> <span class="nx">row</span><span class="p">)</span>
    <span class="nv">row = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">charX</span>
      <span class="nx">charX</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@lines</span><span class="p">[</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">col</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">col</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">+</span> <span class="nx">col</span> <span class="o">-</span> <span class="mi">1</span>
  
  <span class="nv">upFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-428">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-428">&#182;</a>               </div>               <p>answer the slot above the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">slot</span>  <span class="k">if</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">1</span>
    <span class="nv">above = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">above</span><span class="p">.</span><span class="nx">length</span>  <span class="k">if</span> <span class="nx">above</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">downFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-429">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-429">&#182;</a>               </div>               <p>answer the slot below the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">colRow = </span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">slot</span>  <span class="k">if</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">@lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="nv">below = </span><span class="nx">@lines</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">below</span><span class="p">.</span><span class="nx">length</span>  <span class="k">if</span> <span class="nx">below</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">colRow</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">colRow</span><span class="p">.</span><span class="nx">x</span>
  
  <span class="nv">startOfLine: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-430">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-430">&#182;</a>               </div>               <p>answer the first slot (index) of the line for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@lineSlots</span><span class="p">[</span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">).</span><span class="nx">y</span><span class="p">]</span>
  
  <span class="nv">endOfLine: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-431">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-431">&#182;</a>               </div>               <p>answer the slot (index) indicating the EOL for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@startOfLine</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span> <span class="o">+</span> <span class="nx">@lines</span><span class="p">[</span><span class="nx">@columnRow</span><span class="p">(</span><span class="nx">slot</span><span class="p">).</span><span class="nx">y</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-432">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-432">&#182;</a>               </div>               <p>TextMorph editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">edit: </span><span class="o">-&gt;</span>
    <span class="nx">@root</span><span class="p">().</span><span class="nx">edit</span> <span class="nx">@</span>
  
  <span class="nv">selection: </span><span class="o">-&gt;</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">stop</span>
  
  <span class="nv">selectionStartSlot: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span>
  
  <span class="nv">clearSelection: </span><span class="o">-&gt;</span>
    <span class="vi">@currentlySelecting = </span><span class="kc">false</span>
    <span class="vi">@startMark = </span><span class="mi">0</span>
    <span class="vi">@endMark = </span><span class="mi">0</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">deleteSelection: </span><span class="o">-&gt;</span>
    <span class="nv">text = </span><span class="nx">@text</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="vi">@text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@clearSelection</span><span class="p">()</span>
  
  <span class="nv">selectAll: </span><span class="o">-&gt;</span>
    <span class="vi">@startMark = </span><span class="mi">0</span>
    <span class="vi">@endMark = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">selectAllAndEdit: </span><span class="o">-&gt;</span>
    <span class="nx">@edit</span><span class="p">()</span>
    <span class="nx">@selectAll</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">@isEditable</span>
      <span class="nx">@edit</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">@currentlySelecting</span>
      <span class="nx">@root</span><span class="p">().</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
      <span class="vi">@currentlySelecting = </span><span class="kc">false</span>
    <span class="k">else</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseClickLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
  
  <span class="nv">enableSelecting: </span><span class="o">-&gt;</span>
    <span class="vi">@mouseDownLeft = </span><span class="nf">(pos) -&gt;</span>
      <span class="nx">@clearSelection</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nx">@edit</span><span class="p">()</span>
        <span class="nx">@root</span><span class="p">().</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
        <span class="vi">@startMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="vi">@endMark = </span><span class="nx">@startMark</span>
        <span class="vi">@currentlySelecting = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-433">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-433">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@mouseMove = </span><span class="nf">(pos) -&gt;</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="nx">@currentlySelecting</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nv">newMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">newMark</span> <span class="o">isnt</span> <span class="nx">@endMark</span>
          <span class="vi">@endMark = </span><span class="nx">newMark</span>
          <span class="nx">@drawNew</span><span class="p">()</span>
          <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">disableSelecting: </span><span class="o">-&gt;</span>
    <span class="k">delete</span> <span class="nx">@mouseDownLeft</span>
    <span class="k">delete</span> <span class="nx">@mouseMove</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-434">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-434">&#182;</a>               </div>               <p>TextMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;edit&quot;</span><span class="p">,</span> <span class="s">&quot;edit&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;font size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfont\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setFontSize</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this Text&#39;s\nfont point size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align left&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToLeft&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;left&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align right&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToRight&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;right&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;align center&quot;</span><span class="p">,</span> <span class="s">&quot;setAlignmentToCenter&quot;</span>  <span class="k">if</span> <span class="nx">@alignment</span> <span class="o">isnt</span> <span class="s">&quot;center&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;serif&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sans-serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSansSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;sans-serif&quot;</span>
    <span class="k">if</span> <span class="nx">@isBold</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal weight&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">if</span> <span class="nx">@isItalic</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal style&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;italic&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">toggleIsDraggable: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-435">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-435">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isDraggable = </span><span class="o">not</span> <span class="nx">@isDraggable</span>
    <span class="k">if</span> <span class="nx">@isDraggable</span>
      <span class="nx">@disableSelecting</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@enableSelecting</span><span class="p">()</span>
  
  <span class="nv">setAlignmentToLeft: </span><span class="o">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;left&quot;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setAlignmentToRight: </span><span class="o">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;right&quot;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setAlignmentToCenter: </span><span class="o">-&gt;</span>
    <span class="vi">@alignment = </span><span class="s">&quot;center&quot;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleWeight: </span><span class="o">-&gt;</span>
    <span class="vi">@isBold = </span><span class="o">not</span> <span class="nx">@isBold</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleItalic: </span><span class="o">-&gt;</span>
    <span class="vi">@isItalic = </span><span class="o">not</span> <span class="nx">@isItalic</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSerif: </span><span class="o">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSansSerif: </span><span class="o">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;sans-serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setText: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-436">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-436">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">size</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setFontSize: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-437">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-437">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">numericalSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-438">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-438">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;setLeft&quot;</span><span class="p">,</span> <span class="s">&quot;setTop&quot;</span><span class="p">,</span> <span class="s">&quot;setAlphaScaled&quot;</span><span class="p">,</span> <span class="s">&quot;setFontSize&quot;</span><span class="p">,</span> <span class="s">&quot;setText&quot;</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-439">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-439">&#182;</a>               </div>               <p>TextMorph evaluation:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">evaluationMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">new</span> <span class="nx">MenuMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;do it&quot;</span><span class="p">,</span> <span class="s">&quot;doIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show it&quot;</span><span class="p">,</span> <span class="s">&quot;showIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression\nand show the result&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;inspect it&quot;</span><span class="p">,</span> <span class="s">&quot;inspectIt&quot;</span><span class="p">,</span> <span class="s">&quot;evaluate the\nselected expression\nand inspect the result&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;select all&quot;</span><span class="p">,</span> <span class="s">&quot;selectAllAndEdit&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">setReceiver: </span><span class="nf">(obj) -&gt;</span>
    <span class="vi">@receiver = </span><span class="nx">obj</span>
    <span class="vi">@customContextMenu = </span><span class="nx">@evaluationMenu</span><span class="p">()</span>
  
  <span class="nv">doIt: </span><span class="o">-&gt;</span>
    <span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span> <span class="nx">@selection</span><span class="p">()</span>
    <span class="nx">@edit</span><span class="p">()</span>
  
  <span class="nv">showIt: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span><span class="p">(</span><span class="nx">@selection</span><span class="p">())</span>
    <span class="nx">@inform</span> <span class="nx">result</span>  <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
  
  <span class="nv">inspectIt: </span><span class="o">-&gt;</span>
    <span class="nv">result = </span><span class="nx">@receiver</span><span class="p">.</span><span class="nx">evaluateString</span><span class="p">(</span><span class="nx">@selection</span><span class="p">())</span>
    <span class="nv">world = </span><span class="nx">@world</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">result</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nv">inspector = </span><span class="k">new</span> <span class="nx">InspectorMorph</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">world</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">world</span>
      <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">inspector</span>
      <span class="nx">inspector</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-440">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-440">&#182;</a>               </div>               <p>MenuMorph ///////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MenuMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>

  <span class="nv">target: </span><span class="kc">null</span>
  <span class="nv">title: </span><span class="kc">null</span>
  <span class="nv">environment: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">items: </span><span class="kc">null</span>
  <span class="nv">label: </span><span class="kc">null</span>
  <span class="nv">world: </span><span class="kc">null</span>
  <span class="nv">isListContents: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(@target, @title = null, @environment = null, @fontSize = null) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-441">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-441">&#182;</a>               </div>               <p>Note that Morph does a drawNew upon creation (TODO Why?), so we need
to initialise the items before calling super. We can't initialise it
outside the constructor because the array would be shared across instantiated
objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@items = </span><span class="p">[]</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@border = </span><span class="kc">null</span> <span class="c1"># the Box Morph constructor puts this to 2</span></pre></div>             </td>           </tr>                               <tr id="section-442">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-442">&#182;</a>               </div>               <p>important not to traverse all the children for stepping through, because
there could be a lot of entries for example in the inspector the number
of properties of an object - there could be a 100 of those and we don't
want to traverse them all. Setting step to null (as opposed to nop) means
that</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">addItem: </span><span class="nf">(labelString, action, hint, color) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">localize</span><span class="p">(</span><span class="nx">labelString</span> <span class="o">or</span> <span class="s">&quot;close&quot;</span><span class="p">),</span> <span class="nx">action</span> <span class="o">or</span> <span class="nx">nop</span><span class="p">,</span> <span class="nx">hint</span><span class="p">,</span> <span class="nx">color</span><span class="p">]</span>
  
  <span class="nv">addLine: </span><span class="nf">(width) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="o">or</span> <span class="mi">1</span><span class="p">]</span>
  
  <span class="nv">createLabel: </span><span class="o">-&gt;</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@label</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nv">text = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="nx">localize</span><span class="p">(</span><span class="nx">@title</span><span class="p">),</span>
      <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&quot;center&quot;</span><span class="p">)</span>
    <span class="nv">text.alignment = </span><span class="s">&quot;center&quot;</span>
    <span class="nv">text.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nv">text.backgroundColor = </span><span class="nx">@borderColor</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">BoxMorph</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@label.color = </span><span class="nx">@borderColor</span>
    <span class="vi">@label.borderColor = </span><span class="nx">@borderColor</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setExtent</span> <span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">add</span> <span class="nx">text</span>
    <span class="vi">@label.text = </span><span class="nx">text</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nv">isLine = </span><span class="kc">false</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-443">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-443">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span>
    <span class="nx">unless</span> <span class="nx">@isListContents</span>
      <span class="vi">@edge = </span><span class="mi">5</span>
      <span class="vi">@border = </span><span class="mi">2</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">y = </span><span class="mi">2</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="nx">unless</span> <span class="nx">@isListContents</span>
      <span class="k">if</span> <span class="nx">@title</span>
        <span class="nx">@createLabel</span><span class="p">()</span>
        <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="nx">@add</span> <span class="nx">@label</span>
        <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">tuple</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">isLine = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span> <span class="o">or</span>
        <span class="nx">tuple</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span>
          <span class="nv">item = </span><span class="nx">tuple</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">isLine = </span><span class="kc">true</span>
        <span class="nv">item = </span><span class="k">new</span> <span class="nx">Morph</span><span class="p">()</span>
        <span class="nv">item.color = </span><span class="nx">@borderColor</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">setHeight</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-444">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-444">&#182;</a>               </div>               <p>bubble help hint</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">item = </span><span class="k">new</span> <span class="nx">MenuItemMorph</span><span class="p">(</span><span class="nx">@target</span><span class="p">,</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="nx">@fontSize</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span><span class="p">,</span>
          <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontName</span><span class="p">,</span> <span class="nx">@environment</span><span class="p">,</span>
          <span class="nx">tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># color</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nx">@add</span> <span class="nx">item</span>
      <span class="nv">y = </span><span class="nx">y</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
      <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">isLine</span></pre></div>             </td>           </tr>                               <tr id="section-445">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-445">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fb = </span><span class="nx">@fullBounds</span><span class="p">()</span>
    <span class="nx">@silentSetExtent</span> <span class="nx">fb</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nx">@adjustWidths</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  
  <span class="nv">maxWidth: </span><span class="o">-&gt;</span>
    <span class="nv">w = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">FrameMorph</span>
      <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">scrollFrame</span> <span class="k">instanceof</span> <span class="nx">ScrollFrameMorph</span>
        <span class="nv">w = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>    
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">StringFieldMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">ColorPickerMorph</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">SliderMorph</span><span class="p">)</span>
          <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  </pre></div>             </td>           </tr>                               <tr id="section-446">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-446">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">w = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span>  <span class="k">if</span> <span class="nx">@label</span>
    <span class="nx">w</span>
  
  <span class="nv">adjustWidths: </span><span class="o">-&gt;</span>
    <span class="nv">w = </span><span class="nx">@maxWidth</span><span class="p">()</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">silentSetWidth</span> <span class="nx">w</span>
      <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">createBackgrounds</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">item</span> <span class="o">is</span> <span class="nx">@label</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">setPosition</span> <span class="nx">item</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  
  <span class="nv">unselectAllItems: </span><span class="o">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(item) -&gt;</span>
      <span class="nv">item.image = </span><span class="nx">item</span><span class="p">.</span><span class="nx">normalImage</span>  <span class="k">if</span> <span class="nx">item</span> <span class="k">instanceof</span> <span class="nx">MenuItemMorph</span></pre></div>             </td>           </tr>                               <tr id="section-447">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-447">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">popup: </span><span class="nf">(world, pos) -&gt;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@setPosition</span> <span class="nx">pos</span>
    <span class="nx">@addShadow</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">80</span>
    <span class="nx">@keepWithin</span> <span class="nx">world</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">world</span><span class="p">.</span><span class="nx">activeMenu</span>
    <span class="nx">world</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@</span>
    <span class="nv">world.activeMenu = </span><span class="nx">@</span>
    <span class="nx">@fullChanged</span><span class="p">()</span>
  
  <span class="nv">popUpAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">()</span>
  
  <span class="nv">popUpCenteredAtHand: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">hand</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  
  <span class="nv">popUpCenteredInWorld: </span><span class="nf">(world) -&gt;</span>
    <span class="nv">wrrld = </span><span class="nx">world</span> <span class="o">or</span> <span class="nx">@world</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@popup</span> <span class="nx">wrrld</span><span class="p">,</span> <span class="nx">wrrld</span><span class="p">.</span><span class="nx">center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@extent</span><span class="p">().</span><span class="nx">floorDivideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-448">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-448">&#182;</a>               </div>               <p>PenMorph ////////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-449">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-449">&#182;</a>               </div>               <p>I am a simple LOGO-wise turtle.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">PenMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>
  
  <span class="nv">heading: </span><span class="mi">0</span>
  <span class="nv">penSize: </span><span class="kc">null</span>
  <span class="nv">isWarped: </span><span class="kc">false</span> <span class="c1"># internal optimization</span>
  <span class="nv">wantsRedraw: </span><span class="kc">false</span> <span class="c1"># internal optimization</span>
  <span class="nv">isDown: </span><span class="kc">true</span>
  
  <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
    <span class="vi">@penSize = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@penSize</span><span class="p">,</span> <span class="nx">@penSize</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-450">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-450">&#182;</a>               </div>               <p>todo we need to change the size two times, for getting the right size
of the arrow and of the line. Probably should make the two distinct</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@penSize = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-451">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-451">&#182;</a>               </div>               <p>alert @morphMethod() # works
doesn't work cause coffeescript doesn't support static inheritance
alert @morphStaticMethod()</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@staticVariable: </span><span class="mi">1</span>
  <span class="vi">@staticFunction: </span><span class="o">-&gt;</span> <span class="mf">3.14</span>
    </pre></div>             </td>           </tr>                               <tr id="section-452">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-452">&#182;</a>               </div>               <p>PenMorph updating - optimized for warping, i.e atomic recursion</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">changed: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@isWarped</span> <span class="o">is</span> <span class="kc">false</span>
      <span class="nv">w = </span><span class="nx">@root</span><span class="p">()</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@visibleBounds</span><span class="p">().</span><span class="nx">spread</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">w</span> <span class="k">instanceof</span> <span class="nx">WorldMorph</span>
      <span class="nx">@parent</span><span class="p">.</span><span class="nx">childChanged</span> <span class="nx">@</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-453">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-453">&#182;</a>               </div>               <p>PenMorph display:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawNew: </span><span class="nf">(facing) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-454">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-454">&#182;</a>               </div>               <p>my orientation can be overridden with the "facing" parameter to
   implement Scratch-style rotation styles</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">direction = </span><span class="nx">facing</span> <span class="o">or</span> <span class="nx">@heading</span>
    <span class="k">if</span> <span class="nx">@isWarped</span>
      <span class="vi">@wantsRedraw = </span><span class="kc">true</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="nx">@extent</span><span class="p">())</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">len = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nv">start = </span><span class="nx">@center</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">dest = </span><span class="nx">start</span><span class="p">.</span><span class="nx">distanceAngle</span><span class="p">(</span><span class="nx">len</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span> <span class="nx">direction</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span>
    <span class="nv">left = </span><span class="nx">start</span><span class="p">.</span><span class="nx">distanceAngle</span><span class="p">(</span><span class="nx">len</span><span class="p">,</span> <span class="nx">direction</span> <span class="o">+</span> <span class="mi">195</span><span class="p">)</span>
    <span class="nv">right = </span><span class="nx">start</span><span class="p">.</span><span class="nx">distanceAngle</span><span class="p">(</span><span class="nx">len</span><span class="p">,</span> <span class="nx">direction</span> <span class="o">-</span> <span class="mi">195</span><span class="p">)</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">start</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">start</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">left</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">left</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">right</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">right</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nv">context.strokeStyle = </span><span class="s">&quot;white&quot;</span>
    <span class="nv">context.lineWidth = </span><span class="mi">3</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nv">context.strokeStyle = </span><span class="s">&quot;black&quot;</span>
    <span class="nv">context.lineWidth = </span><span class="mi">1</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="vi">@wantsRedraw = </span><span class="kc">false</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-455">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-455">&#182;</a>               </div>               <p>PenMorph access:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setHeading: </span><span class="nf">(degrees) -&gt;</span>
    <span class="vi">@heading = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">degrees</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
    <span class="k">if</span> <span class="nx">@isWarped</span> <span class="o">is</span> <span class="kc">false</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-456">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-456">&#182;</a>               </div>               <p>PenMorph drawing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawLine: </span><span class="nf">(start, dest) -&gt;</span>
    <span class="nv">context = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">penTrails</span><span class="p">().</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">from = </span><span class="nx">start</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="nv">to = </span><span class="nx">dest</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@isDown</span>
      <span class="nv">context.lineWidth = </span><span class="nx">@penSize</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">context.lineCap = </span><span class="s">&quot;round&quot;</span>
      <span class="nv">context.lineJoin = </span><span class="s">&quot;round&quot;</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">from</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">from</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">to</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">to</span><span class="p">.</span><span class="nx">y</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@isWarped</span> <span class="o">is</span> <span class="kc">false</span>
        <span class="nx">@world</span><span class="p">().</span><span class="nx">broken</span><span class="p">.</span><span class="nx">push</span> <span class="nx">start</span><span class="p">.</span><span class="nx">rectangle</span><span class="p">(</span><span class="nx">dest</span><span class="p">).</span><span class="nx">expandBy</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@penSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">visibleBounds</span><span class="p">()).</span><span class="nx">spread</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-457">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-457">&#182;</a>               </div>               <p>PenMorph turtle ops:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">turn: </span><span class="nf">(degrees) -&gt;</span>
    <span class="nx">@setHeading</span> <span class="nx">@heading</span> <span class="o">+</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">degrees</span><span class="p">)</span>
  
  <span class="nv">forward: </span><span class="nf">(steps) -&gt;</span>
    <span class="nv">start = </span><span class="nx">@center</span><span class="p">()</span>
    <span class="nv">dist = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">steps</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">dist</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="nv">dest = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">distanceAngle</span><span class="p">(</span><span class="nx">dist</span><span class="p">,</span> <span class="nx">@heading</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">dest = </span><span class="nx">@position</span><span class="p">().</span><span class="nx">distanceAngle</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dist</span><span class="p">),</span> <span class="p">(</span><span class="nx">@heading</span> <span class="o">-</span> <span class="mi">180</span><span class="p">))</span>
    <span class="nx">@setPosition</span> <span class="nx">dest</span>
    <span class="nx">@drawLine</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">@center</span><span class="p">()</span>
  
  <span class="nv">down: </span><span class="o">-&gt;</span>
    <span class="vi">@isDown = </span><span class="kc">true</span>
  
  <span class="nv">up: </span><span class="o">-&gt;</span>
    <span class="vi">@isDown = </span><span class="kc">false</span>
  
  <span class="nv">clear: </span><span class="o">-&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-458">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-458">&#182;</a>               </div>               <p>PenMorph optimization for atomic recursion:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">startWarp: </span><span class="o">-&gt;</span>
    <span class="vi">@isWarped = </span><span class="kc">true</span>
  
  <span class="nv">endWarp: </span><span class="o">-&gt;</span>
    <span class="nx">@drawNew</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@wantsRedraw</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">changed</span><span class="p">()</span>
    <span class="vi">@isWarped = </span><span class="kc">false</span>
  
  <span class="nv">warp: </span><span class="nf">(fun) -&gt;</span>
    <span class="nx">@startWarp</span><span class="p">()</span>
    <span class="nx">fun</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span>
    <span class="nx">@endWarp</span><span class="p">()</span>
  
  <span class="nv">warpOp: </span><span class="nf">(selector, argsArray) -&gt;</span>
    <span class="nx">@startWarp</span><span class="p">()</span>
    <span class="nx">@</span><span class="p">[</span><span class="nx">selector</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">argsArray</span>
    <span class="nx">@endWarp</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-459">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-459">&#182;</a>               </div>               <p>PenMorph demo ops:
try these with WARP eg.: this.warp(function () {tree(12, 120, 20)})</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">warpSierpinski: </span><span class="nf">(length, min) -&gt;</span>
    <span class="nx">@warpOp</span> <span class="s">&quot;sierpinski&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">length</span><span class="p">,</span> <span class="nx">min</span><span class="p">]</span>
  
  <span class="nv">sierpinski: </span><span class="nf">(length, min) -&gt;</span>
    <span class="k">if</span> <span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">min</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span>
        <span class="nx">@sierpinski</span> <span class="nx">length</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nx">min</span>
        <span class="nx">@turn</span> <span class="mi">120</span>
        <span class="nx">@forward</span> <span class="nx">length</span>
        <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span>
  
  <span class="nv">warpTree: </span><span class="nf">(level, length, angle) -&gt;</span>
    <span class="nx">@warpOp</span> <span class="s">&quot;tree&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">level</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">angle</span><span class="p">]</span>
  
  <span class="nv">tree: </span><span class="nf">(level, length, angle) -&gt;</span>
    <span class="k">if</span> <span class="nx">level</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@penSize = </span><span class="nx">level</span>
      <span class="nx">@forward</span> <span class="nx">length</span>
      <span class="nx">@turn</span> <span class="nx">angle</span>
      <span class="nx">@tree</span> <span class="nx">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">length</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span> <span class="nx">angle</span>
      <span class="nx">@turn</span> <span class="nx">angle</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span>
      <span class="nx">@tree</span> <span class="nx">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">length</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span> <span class="nx">angle</span>
      <span class="nx">@turn</span> <span class="nx">angle</span>
      <span class="nx">@forward</span> <span class="o">-</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-460">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-460">&#182;</a>               </div>               <p>StringMorph /////////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-461">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-461">&#182;</a>               </div>               <p>I am a single line of text</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">StringMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="nv">text: </span><span class="kc">null</span>
  <span class="nv">fontSize: </span><span class="kc">null</span>
  <span class="nv">fontName: </span><span class="kc">null</span>
  <span class="nv">fontStyle: </span><span class="kc">null</span>
  <span class="nv">isBold: </span><span class="kc">null</span>
  <span class="nv">isItalic: </span><span class="kc">null</span>
  <span class="nv">isEditable: </span><span class="kc">false</span>
  <span class="nv">isNumeric: </span><span class="kc">null</span>
  <span class="nv">shadowOffset: </span><span class="kc">null</span>
  <span class="nv">shadowColor: </span><span class="kc">null</span>
  <span class="nv">isShowingBlanks: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-462">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-462">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">blanksColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-463">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-463">&#182;</a>               </div>               <p>Properties for text-editing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">currentlySelecting: </span><span class="kc">false</span>
  <span class="nv">startMark: </span><span class="mi">0</span>
  <span class="nv">endMark: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-464">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-464">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">markedTextColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-465">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-465">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">markedBackgoundColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>

  <span class="nv">constructor: </span><span class="nf">(</span>
<span class="nf">      text,</span>
<span class="nf">      @fontSize = 12,</span>
<span class="nf">      @fontStyle = &quot;sans-serif&quot;,</span>
<span class="nf">      @isBold = false,</span>
<span class="nf">      @isItalic = false,</span>
<span class="nf">      @isNumeric = false,</span>
<span class="nf">      shadowOffset,</span>
<span class="nf">      shadowColor,</span>
<span class="nf">      color,</span>
<span class="nf">      fontName</span>
<span class="nf">      ) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-466">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-466">&#182;</a>               </div>               <p>additional properties:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@text = </span><span class="nx">text</span> <span class="o">or</span> <span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nx">text</span> <span class="o">is</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;&quot;</span> <span class="k">else</span> <span class="s">&quot;StringMorph&quot;</span><span class="p">))</span>
    <span class="vi">@fontName = </span><span class="nx">fontName</span> <span class="o">or</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">globalFontFamily</span>
    <span class="vi">@shadowOffset = </span><span class="nx">shadowOffset</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@shadowColor = </span><span class="nx">shadowColor</span> <span class="o">or</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-467">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-467">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-468">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-468">&#182;</a>               </div>               <p>override inherited properites:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@color = </span><span class="nx">color</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">true</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">toString: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-469">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-469">&#182;</a>               </div>               <p>e.g. 'a StringMorph("Hello World")'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;a &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;(\&quot;&quot;</span> <span class="o">+</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;...\&quot;)&quot;</span>
  
  <span class="nv">font: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-470">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-470">&#182;</a>               </div>               <p>answer a font string, e.g. 'bold italic 12px sans-serif'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">font = </span><span class="s">&quot;&quot;</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;bold &quot;</span>  <span class="k">if</span> <span class="nx">@isBold</span>
    <span class="nv">font = </span><span class="nx">font</span> <span class="o">+</span> <span class="s">&quot;italic &quot;</span>  <span class="k">if</span> <span class="nx">@isItalic</span>
    <span class="nx">font</span> <span class="o">+</span> <span class="nx">@fontSize</span> <span class="o">+</span> <span class="s">&quot;px &quot;</span> <span class="o">+</span> <span class="p">((</span><span class="k">if</span> <span class="nx">@fontName</span> <span class="k">then</span> <span class="nx">@fontName</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="nx">@fontStyle</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-471">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-471">&#182;</a>               </div>               <p>initialize my surface property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@image = </span><span class="nx">newCanvas</span><span class="p">()</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-472">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-472">&#182;</a>               </div>               <p>set my extent</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">width = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@text</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="vi">@bounds.corner = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">width</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">)))</span>
    <span class="vi">@image.width = </span><span class="nx">width</span>
    <span class="vi">@image.height = </span><span class="nx">@height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-473">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-473">&#182;</a>               </div>               <p>prepare context for drawing text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">context.font = </span><span class="nx">@font</span><span class="p">()</span>
    <span class="nv">context.textAlign = </span><span class="s">&quot;left&quot;</span>
    <span class="nv">context.textBaseline = </span><span class="s">&quot;bottom&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-474">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-474">&#182;</a>               </div>               <p>first draw the shadow, if any</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shadowColor</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@shadowColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">@text</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-475">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-475">&#182;</a>               </div>               <p>now draw the actual text</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@shadowOffset</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nv">context.fillStyle = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@isShowingBlanks</span>
      <span class="nx">@renderWithBlanks</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span>
    <span class="k">else</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">@text</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-476">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-476">&#182;</a>               </div>               <p>draw the selection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">i = </span><span class="nx">start</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">stop</span>
      <span class="nv">p = </span><span class="nx">@slotPosition</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">@position</span><span class="p">())</span>
      <span class="nv">c = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedBackgoundColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span><span class="p">,</span>
        <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span>
      <span class="nv">context.fillStyle = </span><span class="nx">@markedTextColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">fontHeight</span><span class="p">(</span><span class="nx">@fontSize</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-477">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-477">&#182;</a>               </div>               <p>notify my parent of layout change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@parent</span><span class="p">.</span><span class="nx">fixLayout</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">fixLayout</span>  <span class="k">if</span> <span class="nx">@parent</span>
  
  <span class="nv">renderWithBlanks: </span><span class="nf">(context, startX, y) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-478">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-478">&#182;</a>               </div>               <p>create the blank form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">drawBlank = </span><span class="o">-&gt;</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">blank</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="mi">0</span>
      <span class="nx">x</span> <span class="o">+=</span> <span class="nx">space</span>
    <span class="nv">space = </span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">width</span>
    <span class="nv">blank = </span><span class="nx">newCanvas</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">space</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()))</span>
    <span class="nv">ctx = </span><span class="nx">blank</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">words = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
    <span class="nv">x = </span><span class="nx">startX</span> <span class="o">or</span> <span class="mi">0</span>
    <span class="nv">isFirst = </span><span class="kc">true</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">@blanksColor</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">space</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">blank</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">space</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-479">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-479">&#182;</a>               </div>               <p>render my text inserting blanks</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">words</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(word) -&gt;</span>
      <span class="nx">drawBlank</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">isFirst</span>
      <span class="nv">isFirst = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">word</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span> <span class="nx">word</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
        <span class="nx">x</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">word</span><span class="p">).</span><span class="nx">width</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-480">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-480">&#182;</a>               </div>               <p>StringMorph mesuring:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">slotPosition: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-481">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-481">&#182;</a>               </div>               <p>answer the position point of the given index ("slot")
where the cursor should be placed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dest = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">slot</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">xOffset = </span><span class="mi">0</span>
    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="k">while</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">dest</span>
      <span class="nx">xOffset</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@text</span><span class="p">[</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="vi">@pos = </span><span class="nx">dest</span>
    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">xOffset</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span>
    <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  
  <span class="nv">slotAt: </span><span class="nf">(aPoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-482">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-482">&#182;</a>               </div>               <p>answer the slot (index) closest to the given point
so the cursor can be moved accordingly</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">idx = </span><span class="mi">0</span>
    <span class="nv">charX = </span><span class="mi">0</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">charX</span>
      <span class="nx">charX</span> <span class="o">+=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@text</span><span class="p">[</span><span class="nx">idx</span><span class="p">]).</span><span class="nx">width</span>
      <span class="nx">idx</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nx">idx</span> <span class="o">is</span> <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@text</span><span class="p">).</span><span class="nx">width</span> <span class="o">-</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@text</span><span class="p">[</span><span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]).</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">aPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">())</span>  
          <span class="k">return</span> <span class="nx">idx</span>
    <span class="nx">idx</span> <span class="o">-</span> <span class="mi">1</span>
  
  <span class="nv">upFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-483">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-483">&#182;</a>               </div>               <p>answer the slot above the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">slot</span>
  
  <span class="nv">downFrom: </span><span class="nf">(slot) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-484">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-484">&#182;</a>               </div>               <p>answer the slot below the given one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">slot</span>
  
  <span class="nv">startOfLine: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-485">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-485">&#182;</a>               </div>               <p>answer the first slot (index) of the line for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="mi">0</span>
  
  <span class="nv">endOfLine: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-486">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-486">&#182;</a>               </div>               <p>answer the slot (index) indicating the EOL for the given slot</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>

  <span class="nv">rawHeight: </span><span class="o">-&gt;</span>  </pre></div>             </td>           </tr>                               <tr id="section-487">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-487">&#182;</a>               </div>               <p>answer my corrected fontSize</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1.2</span>
    </pre></div>             </td>           </tr>                               <tr id="section-488">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-488">&#182;</a>               </div>               <p>StringMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="o">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;edit&quot;</span><span class="p">,</span> <span class="s">&quot;edit&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;font size...&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">@prompt</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s">&quot;\nfont\nsize:&quot;</span><span class="p">,</span>
        <span class="nx">@setFontSize</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@fontSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="kc">true</span>
    <span class="p">),</span> <span class="s">&quot;set this String&#39;s\nfont point size&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;serif&quot;</span>
    <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;sans-serif&quot;</span><span class="p">,</span> <span class="s">&quot;setSansSerif&quot;</span>  <span class="k">if</span> <span class="nx">@fontStyle</span> <span class="o">isnt</span> <span class="s">&quot;sans-serif&quot;</span>
    <span class="k">if</span> <span class="nx">@isBold</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal weight&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;toggleWeight&quot;</span>
    <span class="k">if</span> <span class="nx">@isItalic</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;normal style&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;italic&quot;</span><span class="p">,</span> <span class="s">&quot;toggleItalic&quot;</span>
    <span class="k">if</span> <span class="nx">@isShowingBlanks</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;hide blanks&quot;</span><span class="p">,</span> <span class="s">&quot;toggleShowBlanks&quot;</span>
    <span class="k">else</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;show blanks&quot;</span><span class="p">,</span> <span class="s">&quot;toggleShowBlanks&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">toggleIsDraggable: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-489">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-489">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isDraggable = </span><span class="o">not</span> <span class="nx">@isDraggable</span>
    <span class="k">if</span> <span class="nx">@isDraggable</span>
      <span class="nx">@disableSelecting</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="nx">@enableSelecting</span><span class="p">()</span>
  
  <span class="nv">toggleShowBlanks: </span><span class="o">-&gt;</span>
    <span class="vi">@isShowingBlanks = </span><span class="o">not</span> <span class="nx">@isShowingBlanks</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleWeight: </span><span class="o">-&gt;</span>
    <span class="vi">@isBold = </span><span class="o">not</span> <span class="nx">@isBold</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">toggleItalic: </span><span class="o">-&gt;</span>
    <span class="vi">@isItalic = </span><span class="o">not</span> <span class="nx">@isItalic</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSerif: </span><span class="o">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setSansSerif: </span><span class="o">-&gt;</span>
    <span class="vi">@fontStyle = </span><span class="s">&quot;sans-serif&quot;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setFontSize: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-490">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-490">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">size</span> <span class="o">is</span> <span class="s">&quot;number&quot;</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nv">newSize = </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
      <span class="vi">@fontSize = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newSize</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>  <span class="nx">unless</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">newSize</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setText: </span><span class="nf">(size) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-491">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-491">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@text = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">size</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">numericalSetters: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-492">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-492">&#182;</a>               </div>               <p>for context menu demo purposes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="s">&quot;setLeft&quot;</span><span class="p">,</span> <span class="s">&quot;setTop&quot;</span><span class="p">,</span> <span class="s">&quot;setAlphaScaled&quot;</span><span class="p">,</span> <span class="s">&quot;setFontSize&quot;</span><span class="p">,</span> <span class="s">&quot;setText&quot;</span><span class="p">]</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-493">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-493">&#182;</a>               </div>               <p>StringMorph editing:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">edit: </span><span class="o">-&gt;</span>
    <span class="nx">@root</span><span class="p">().</span><span class="nx">edit</span> <span class="nx">@</span>
  
  <span class="nv">selection: </span><span class="o">-&gt;</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nx">@text</span><span class="p">.</span><span class="nx">slice</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">stop</span>
  
  <span class="nv">selectionStartSlot: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span>
  
  <span class="nv">clearSelection: </span><span class="o">-&gt;</span>
    <span class="vi">@currentlySelecting = </span><span class="kc">false</span>
    <span class="vi">@startMark = </span><span class="mi">0</span>
    <span class="vi">@endMark = </span><span class="mi">0</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">deleteSelection: </span><span class="o">-&gt;</span>
    <span class="nv">text = </span><span class="nx">@text</span>
    <span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="nv">stop = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">@startMark</span><span class="p">,</span> <span class="nx">@endMark</span><span class="p">)</span>
    <span class="vi">@text = </span><span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@clearSelection</span><span class="p">()</span>
  
  <span class="nv">selectAll: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@mouseDownLeft</span> <span class="c1"># make sure selecting is enabled</span>
      <span class="vi">@startMark = </span><span class="mi">0</span>
      <span class="vi">@endMark = </span><span class="nx">@text</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="k">if</span> <span class="nx">@isEditable</span>
      <span class="nx">@edit</span><span class="p">()</span>  <span class="nx">unless</span> <span class="nx">@currentlySelecting</span>
      <span class="nx">@root</span><span class="p">().</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
      <span class="vi">@currentlySelecting = </span><span class="kc">false</span>
    <span class="k">else</span>
      <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseClickLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
  
  <span class="nv">enableSelecting: </span><span class="o">-&gt;</span>
    <span class="vi">@mouseDownLeft = </span><span class="nf">(pos) -&gt;</span>
      <span class="nx">@clearSelection</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nx">@edit</span><span class="p">()</span>
        <span class="nx">@root</span><span class="p">().</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">gotoPos</span> <span class="nx">pos</span>
        <span class="vi">@startMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="vi">@endMark = </span><span class="nx">@startMark</span>
        <span class="vi">@currentlySelecting = </span><span class="kc">true</span>
    
    <span class="vi">@mouseMove = </span><span class="nf">(pos) -&gt;</span>
      <span class="k">if</span> <span class="nx">@isEditable</span> <span class="o">and</span> <span class="nx">@currentlySelecting</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@isDraggable</span><span class="p">)</span>
        <span class="nv">newMark = </span><span class="nx">@slotAt</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">newMark</span> <span class="o">isnt</span> <span class="nx">@endMark</span>
          <span class="vi">@endMark = </span><span class="nx">newMark</span>
          <span class="nx">@drawNew</span><span class="p">()</span>
          <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">disableSelecting: </span><span class="o">-&gt;</span>
    <span class="k">delete</span> <span class="nx">@mouseDownLeft</span>
    <span class="k">delete</span> <span class="nx">@mouseMove</span></pre></div>             </td>           </tr>                               <tr id="section-494">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-494">&#182;</a>               </div>               <p>MorphsListMorph //////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MorphsListMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span></pre></div>             </td>           </tr>                               <tr id="section-495">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-495">&#182;</a>               </div>               <p>panes:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">morphsList: </span><span class="kc">null</span>
  <span class="nv">buttonClose: </span><span class="kc">null</span>
  <span class="nv">resizer: </span><span class="kc">null</span>

  <span class="nv">constructor: </span><span class="nf">(target) -&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-496">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-496">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@silentSetExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
      <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="vi">@isDraggable = </span><span class="kc">true</span>
    <span class="vi">@border = </span><span class="mi">1</span>
    <span class="vi">@edge = </span><span class="mi">5</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">setTarget: </span><span class="nf">(target) -&gt;</span>
    <span class="vi">@target = </span><span class="nx">target</span>
    <span class="vi">@currentProperty = </span><span class="kc">null</span>
    <span class="nx">@buildPanes</span><span class="p">()</span>
  
  <span class="nv">buildPanes: </span><span class="o">-&gt;</span>
    <span class="nv">attribs = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-497">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-497">&#182;</a>               </div>               <p>remove existing panes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-498">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-498">&#182;</a>               </div>               <p>keep work pane around</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">m</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">m</span> <span class="o">isnt</span> <span class="nx">@work</span></pre></div>             </td>           </tr>                               <tr id="section-499">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-499">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@children = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-500">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-500">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@label = </span><span class="k">new</span> <span class="nx">TextMorph</span><span class="p">(</span><span class="s">&quot;Morphs List&quot;</span><span class="p">)</span>
    <span class="vi">@label.fontSize = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">menuFontSize</span>
    <span class="vi">@label.isBold = </span><span class="kc">true</span>
    <span class="vi">@label.color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span>
    <span class="nx">@add</span> <span class="nx">@label</span></pre></div>             </td>           </tr>                               <tr id="section-501">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-501">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ListOfMorphs = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nb">window</span>
      <span class="nv">theWordMorph = </span><span class="s">&quot;Morph&quot;</span>
      <span class="k">if</span> <span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">theWordMorph</span><span class="p">,</span> <span class="nx">i</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">theWordMorph</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
        <span class="nx">ListOfMorphs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">i</span>
    <span class="vi">@morphsList = </span><span class="k">new</span> <span class="nx">ListMorph</span><span class="p">(</span><span class="nx">ListOfMorphs</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-502">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-502">&#182;</a>               </div>               <p>so far nothing happens when items are selected
@morphsList.action = (selected) ->
 val = myself.target[selected]
 myself.currentProperty = val
 if val is null
   txt = "NULL"
 else if isString(val)
   txt = val
 else
   txt = val.toString()
 cnts = new TextMorph(txt)
 cnts.isEditable = true
 cnts.enableSelecting()
 cnts.setReceiver myself.target
 myself.detail.setContents cnts</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@morphsList.hBar.alpha = </span><span class="mf">0.6</span>
    <span class="vi">@morphsList.vBar.alpha = </span><span class="mf">0.6</span>
    <span class="nx">@add</span> <span class="nx">@morphsList</span></pre></div>             </td>           </tr>                               <tr id="section-503">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-503">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@buttonClose = </span><span class="k">new</span> <span class="nx">TriggerMorph</span><span class="p">()</span>
    <span class="vi">@buttonClose.labelString = </span><span class="s">&quot;close&quot;</span>
    <span class="vi">@buttonClose.action = </span><span class="o">=&gt;</span>
      <span class="nx">@destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-504">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-504">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@add</span> <span class="nx">@buttonClose</span></pre></div>             </td>           </tr>                               <tr id="section-505">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-505">&#182;</a>               </div>               <p>resizer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@resizer = </span><span class="k">new</span> <span class="nx">HandleMorph</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">,</span> <span class="nx">@edge</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-506">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-506">&#182;</a>               </div>               <p>update layout</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@fixLayout</span><span class="p">()</span>
  
  <span class="nv">fixLayout: </span><span class="o">-&gt;</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-507">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-507">&#182;</a>               </div>               <p>label</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@left</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">y = </span><span class="nx">@top</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">r = </span><span class="nx">@right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nv">w = </span><span class="nx">r</span> <span class="o">-</span> <span class="nx">x</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@label</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">w</span>
    <span class="k">if</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@height</span><span class="p">()</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span>
      <span class="nx">@silentSetHeight</span> <span class="nx">@label</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">50</span>
      <span class="nx">@drawNew</span><span class="p">()</span>
      <span class="nx">@changed</span><span class="p">()</span>
      <span class="nx">@resizer</span><span class="p">.</span><span class="nx">drawNew</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-508">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-508">&#182;</a>               </div>               <p>morphsList</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">y = </span><span class="nx">@label</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nx">w</span> <span class="o">-=</span> <span class="nx">@edge</span>
    <span class="nv">b = </span><span class="nx">@bottom</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">@edge</span><span class="p">)</span> <span class="o">-</span> <span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">h = </span><span class="nx">b</span> <span class="o">-</span> <span class="nx">y</span>
    <span class="nx">@morphsList</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@morphsList</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-509">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-509">&#182;</a>               </div>               <p>close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@edge</span>
    <span class="nv">h = </span><span class="nx">WorldMorph</span><span class="p">.</span><span class="nx">MorphicPreferences</span><span class="p">.</span><span class="nx">handleSize</span>
    <span class="nv">w = </span><span class="nx">@morphsList</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">@edge</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setPosition</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@buttonClose</span><span class="p">.</span><span class="nx">setExtent</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
    <span class="nv">Morph::trackChanges = </span><span class="kc">true</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">setExtent: </span><span class="nf">(aPoint) -&gt;</span>
    <span class="k">super</span> <span class="nx">aPoint</span>
    <span class="nx">@fixLayout</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-510">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-510">&#182;</a>               </div>               <p>SliderButtonMorph ///////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-511">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-511">&#182;</a>               </div>               <p>this comment below is needed to figure our dependencies between classes
REQUIRES globalFunctions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SliderButtonMorph</span> <span class="k">extends</span> <span class="nx">CircleBoxMorph</span></pre></div>             </td>           </tr>                               <tr id="section-512">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-512">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">highlightColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-513">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-513">&#182;</a>               </div>               <p>careful: this Color object is shared with all the instances of this class.
if you modify it, then all the objects will get the change
but if you replace it with a new Color, then that will only affect the
specific object instance. Same behaviour as with arrays.
see: https://github.com/jashkenas/coffee-script/issues/2501#issuecomment-7865333</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">pressColor: </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">)</span>
  <span class="nv">is3D: </span><span class="kc">true</span>
  <span class="nv">hasMiddleDip: </span><span class="kc">true</span>

  <span class="nv">constructor: </span><span class="nf">(orientation) -&gt;</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="k">super</span> <span class="nx">orientation</span>
  
  <span class="nv">autoOrientation: </span><span class="o">-&gt;</span>
      <span class="nx">noOperation</span>
  
  <span class="nv">drawNew: </span><span class="o">-&gt;</span>
    <span class="nv">colorBak = </span><span class="nx">@color</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@drawEdges</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@is3D</span>
    <span class="vi">@normalImage = </span><span class="nx">@image</span>
    <span class="vi">@color = </span><span class="nx">@highlightColor</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@drawEdges</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@is3D</span>
    <span class="vi">@highlightImage = </span><span class="nx">@image</span>
    <span class="vi">@color = </span><span class="nx">@pressColor</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@drawEdges</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">@is3D</span>
    <span class="vi">@pressImage = </span><span class="nx">@image</span>
    <span class="vi">@color = </span><span class="nx">colorBak</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
  
  <span class="nv">drawEdges: </span><span class="o">-&gt;</span>
    <span class="nv">context = </span><span class="nx">@image</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
    <span class="nv">w = </span><span class="nx">@width</span><span class="p">()</span>
    <span class="nv">h = </span><span class="nx">@height</span><span class="p">()</span>
    <span class="nv">context.lineJoin = </span><span class="s">&quot;round&quot;</span>
    <span class="nv">context.lineCap = </span><span class="s">&quot;round&quot;</span>
    <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;vertical&quot;</span>
      <span class="nv">context.lineWidth = </span><span class="nx">w</span> <span class="o">/</span> <span class="mi">3</span>
      <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">gradient</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="nx">w</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">gradient</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@hasMiddleDip</span>
        <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span>
          <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">radius = </span><span class="nx">w</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mf">0.35</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mf">0.65</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
        <span class="nv">context.fillStyle = </span><span class="nx">gradient</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">),</span> <span class="kc">false</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@orientation</span> <span class="o">is</span> <span class="s">&quot;horizontal&quot;</span>
      <span class="nv">context.lineWidth = </span><span class="nx">h</span> <span class="o">/</span> <span class="mi">3</span>
      <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">)</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">gradient</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
      <span class="nv">context.strokeStyle = </span><span class="nx">gradient</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">*</span> <span class="mf">0.5</span>
      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">@hasMiddleDip</span>
        <span class="nv">gradient = </span><span class="nx">context</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span>
          <span class="mi">0</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">)</span>
        <span class="nv">radius = </span><span class="nx">h</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;black&quot;</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mf">0.35</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mf">0.65</span><span class="p">,</span> <span class="nx">@color</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;white&quot;</span>
        <span class="nv">context.fillStyle = </span><span class="nx">gradient</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">@width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">@height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">radians</span><span class="p">(</span><span class="mi">360</span><span class="p">),</span> <span class="kc">false</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-514">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-514">&#182;</a>               </div>               <p>SliderButtonMorph events:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseEnter: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseLeave: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@normalImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">mouseDownLeft: </span><span class="nf">(pos) -&gt;</span>
    <span class="vi">@image = </span><span class="nx">@pressImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="nx">@escalateEvent</span> <span class="s">&quot;mouseDownLeft&quot;</span><span class="p">,</span> <span class="nx">pos</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="vi">@image = </span><span class="nx">@highlightImage</span>
    <span class="nx">@changed</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-515">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-515">&#182;</a>               </div>               <p>prevent my parent from getting picked up</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">mouseMove: </span><span class="o">-&gt;</span>
      <span class="nx">noOperation</span></pre></div>             </td>           </tr>                               <tr id="section-516">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-516">&#182;</a>               </div>               <p>MouseSensorMorph ////////////////////////////////////////////////////</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-517">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-517">&#182;</a>               </div>               <p>for demo and debuggin purposes only, to be removed later</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MouseSensorMorph</span> <span class="k">extends</span> <span class="nx">BoxMorph</span>
  <span class="nv">constructor: </span><span class="nf">(edge, border, borderColor) -&gt;</span>
    <span class="k">super</span>
    <span class="vi">@edge = </span><span class="nx">edge</span> <span class="o">or</span> <span class="mi">4</span>
    <span class="vi">@border = </span><span class="nx">border</span> <span class="o">or</span> <span class="mi">2</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="vi">@borderColor = </span><span class="nx">borderColor</span> <span class="o">or</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">()</span>
    <span class="vi">@isTouched = </span><span class="kc">false</span>
    <span class="vi">@upStep = </span><span class="mf">0.05</span>
    <span class="vi">@downStep = </span><span class="mf">0.02</span>
    <span class="vi">@noticesTransparentClick = </span><span class="kc">false</span>
    <span class="nx">@drawNew</span><span class="p">()</span>
  
  <span class="nv">touch: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@isTouched</span>
      <span class="vi">@isTouched = </span><span class="kc">true</span>
      <span class="vi">@alpha = </span><span class="mf">0.6</span>
      <span class="vi">@step = </span><span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@isTouched</span>
          <span class="vi">@alpha = </span><span class="nx">@alpha</span> <span class="o">+</span> <span class="nx">@upStep</span>  <span class="k">if</span> <span class="nx">@alpha</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@alpha</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">@downStep</span><span class="p">)</span>
          <span class="vi">@alpha = </span><span class="nx">@alpha</span> <span class="o">-</span> <span class="nx">@downStep</span>
        <span class="k">else</span>
          <span class="vi">@alpha = </span><span class="mi">0</span>
          <span class="vi">@step = </span><span class="kc">null</span>
        <span class="nx">@changed</span><span class="p">()</span>
  
  <span class="nv">unTouch: </span><span class="o">-&gt;</span>
    <span class="vi">@isTouched = </span><span class="kc">false</span>
  
  <span class="nv">mouseEnter: </span><span class="o">-&gt;</span>
    <span class="nx">@touch</span><span class="p">()</span>
  
  <span class="nv">mouseLeave: </span><span class="o">-&gt;</span>
    <span class="nx">@unTouch</span><span class="p">()</span>
  
  <span class="nv">mouseDownLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@touch</span><span class="p">()</span>
  
  <span class="nv">mouseClickLeft: </span><span class="o">-&gt;</span>
    <span class="nx">@unTouch</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 