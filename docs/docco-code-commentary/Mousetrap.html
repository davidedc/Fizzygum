<!DOCTYPE html>  <html> <head>   <title>Mousetrap.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="BlinkerMorph.html">                 BlinkerMorph.coffee               </a>                                           <a class="source" href="BouncerMorph.html">                 BouncerMorph.coffee               </a>                                           <a class="source" href="BoxMorph.html">                 BoxMorph.coffee               </a>                                           <a class="source" href="CaretMorph.html">                 CaretMorph.coffee               </a>                                           <a class="source" href="CircleBoxMorph.html">                 CircleBoxMorph.coffee               </a>                                           <a class="source" href="CloseCircleButtonMorph.html">                 CloseCircleButtonMorph.coffee               </a>                                           <a class="source" href="Color.html">                 Color.coffee               </a>                                           <a class="source" href="ColorPaletteMorph.html">                 ColorPaletteMorph.coffee               </a>                                           <a class="source" href="ColorPickerMorph.html">                 ColorPickerMorph.coffee               </a>                                           <a class="source" href="FrameMorph.html">                 FrameMorph.coffee               </a>                                           <a class="source" href="GrayPaletteMorph.html">                 GrayPaletteMorph.coffee               </a>                                           <a class="source" href="HandMorph.html">                 HandMorph.coffee               </a>                                           <a class="source" href="HandleMorph.html">                 HandleMorph.coffee               </a>                                           <a class="source" href="InspectorMorph.html">                 InspectorMorph.coffee               </a>                                           <a class="source" href="ListMorph.html">                 ListMorph.coffee               </a>                                           <a class="source" href="MenuItemMorph.html">                 MenuItemMorph.coffee               </a>                                           <a class="source" href="MenuMorph.html">                 MenuMorph.coffee               </a>                                           <a class="source" href="Morph.html">                 Morph.coffee               </a>                                           <a class="source" href="MorphicNode.html">                 MorphicNode.coffee               </a>                                           <a class="source" href="MorphsListMorph.html">                 MorphsListMorph.coffee               </a>                                           <a class="source" href="MouseSensorMorph.html">                 MouseSensorMorph.coffee               </a>                                           <a class="source" href="Mousetrap.html">                 Mousetrap.coffee               </a>                                           <a class="source" href="PenMorph.html">                 PenMorph.coffee               </a>                                           <a class="source" href="Point.html">                 Point.coffee               </a>                                           <a class="source" href="Point2.html">                 Point2.coffee               </a>                                           <a class="source" href="Rectangle.html">                 Rectangle.coffee               </a>                                           <a class="source" href="RectangleMorph.html">                 RectangleMorph.coffee               </a>                                           <a class="source" href="ScrollFrameMorph.html">                 ScrollFrameMorph.coffee               </a>                                           <a class="source" href="ShadowMorph.html">                 ShadowMorph.coffee               </a>                                           <a class="source" href="SliderButtonMorph.html">                 SliderButtonMorph.coffee               </a>                                           <a class="source" href="SliderMorph.html">                 SliderMorph.coffee               </a>                                           <a class="source" href="SpeechBubbleMorph.html">                 SpeechBubbleMorph.coffee               </a>                                           <a class="source" href="StringFieldMorph.html">                 StringFieldMorph.coffee               </a>                                           <a class="source" href="StringMorph.html">                 StringMorph.coffee               </a>                                           <a class="source" href="SystemTest_SimpleMenuTest.html">                 SystemTest_SimpleMenuTest.coffee               </a>                                           <a class="source" href="SystemTestsRecorderAndPlayer.html">                 SystemTestsRecorderAndPlayer.coffee               </a>                                           <a class="source" href="TextMorph.html">                 TextMorph.coffee               </a>                                           <a class="source" href="TriggerMorph.html">                 TriggerMorph.coffee               </a>                                           <a class="source" href="WorkspaceMorph.html">                 WorkspaceMorph.coffee               </a>                                           <a class="source" href="WorldMorph.html">                 WorldMorph.coffee               </a>                                           <a class="source" href="globalFunctions.html">                 globalFunctions.coffee               </a>                                           <a class="source" href="globalSettings.html">                 globalSettings.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Mousetrap.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Copyright</span> <span class="mi">2013</span> <span class="nx">Craig</span> <span class="nx">Campbell</span>
<span class="nx">coffeescript</span> <span class="nx">port</span> <span class="k">by</span> <span class="nx">Davide</span> <span class="nx">Della</span> <span class="nx">Casa</span>

<span class="nx">Licensed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">Apache</span> <span class="nx">License</span><span class="p">,</span> <span class="nx">Version</span> <span class="mf">2.0</span> <span class="p">(</span><span class="nx">the</span> <span class="s">&quot;License&quot;</span><span class="p">);</span>
<span class="nx">you</span> <span class="nx">may</span> <span class="o">not</span> <span class="nx">use</span> <span class="k">this</span> <span class="nx">file</span> <span class="nx">except</span> <span class="k">in</span> <span class="nx">compliance</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span>
<span class="nx">You</span> <span class="nx">may</span> <span class="nx">obtain</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">License</span> <span class="nx">at</span>

<span class="nx">http</span><span class="o">://</span><span class="nx">www</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">licenses</span><span class="o">/</span><span class="nx">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>

<span class="nx">Unless</span> <span class="nx">required</span> <span class="k">by</span> <span class="nx">applicable</span> <span class="nx">law</span> <span class="o">or</span> <span class="nx">agreed</span> <span class="nx">to</span> <span class="k">in</span> <span class="nx">writing</span><span class="p">,</span> <span class="nx">software</span>
<span class="nx">distributed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span> <span class="o">is</span> <span class="nx">distributed</span> <span class="kc">on</span> <span class="nx">an</span> <span class="s">&quot;AS IS&quot;</span> <span class="nx">BASIS</span><span class="p">,</span>
<span class="nx">WITHOUT</span> <span class="nx">WARRANTIES</span> <span class="nx">OR</span> <span class="nx">CONDITIONS</span> <span class="nx">OF</span> <span class="nx">ANY</span> <span class="nx">KIND</span><span class="p">,</span> <span class="nx">either</span> <span class="nx">express</span> <span class="o">or</span> <span class="nx">implied</span><span class="p">.</span>
<span class="nx">See</span> <span class="nx">the</span> <span class="nx">License</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specific</span> <span class="nx">language</span> <span class="nx">governing</span> <span class="nx">permissions</span> <span class="o">and</span>
<span class="nx">limitations</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span>

<span class="nx">Mousetrap</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">keyboard</span> <span class="nx">shortcut</span> <span class="nx">library</span> <span class="k">for</span> <span class="nx">Javascript</span> <span class="nx">with</span>
<span class="kc">no</span> <span class="nx">external</span> <span class="nx">dependencies</span>

<span class="nx">@version</span> <span class="mf">1.3</span><span class="p">.</span><span class="mi">1</span>
<span class="nx">@url</span> <span class="nx">craig</span><span class="p">.</span><span class="o">is/</span><span class="nx">killing</span><span class="o">/</span><span class="nx">mice</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">mapping</span> <span class="k">of</span> <span class="nx">special</span> <span class="nx">keycodes</span> <span class="nx">to</span> <span class="nx">their</span> <span class="nx">corresponding</span> <span class="nx">keys</span>

<span class="nx">everything</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">dictionary</span> <span class="nx">cannot</span> <span class="nx">use</span> <span class="nx">keypress</span> <span class="nx">events</span>
<span class="nx">so</span> <span class="nx">it</span> <span class="nx">has</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">here</span> <span class="nx">to</span> <span class="nx">map</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">correct</span> <span class="nx">keycodes</span> <span class="k">for</span>
<span class="nx">keyup</span><span class="o">/</span><span class="nx">keydown</span> <span class="nx">events</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_MAP =</span>
  <span class="mi">8</span><span class="o">:</span> <span class="s">&quot;backspace&quot;</span>
  <span class="mi">9</span><span class="o">:</span> <span class="s">&quot;tab&quot;</span>
  <span class="mi">13</span><span class="o">:</span> <span class="s">&quot;enter&quot;</span>
  <span class="mi">16</span><span class="o">:</span> <span class="s">&quot;shift&quot;</span>
  <span class="mi">17</span><span class="o">:</span> <span class="s">&quot;ctrl&quot;</span>
  <span class="mi">18</span><span class="o">:</span> <span class="s">&quot;alt&quot;</span>
  <span class="mi">20</span><span class="o">:</span> <span class="s">&quot;capslock&quot;</span>
  <span class="mi">27</span><span class="o">:</span> <span class="s">&quot;esc&quot;</span>
  <span class="mi">32</span><span class="o">:</span> <span class="s">&quot;space&quot;</span>
  <span class="mi">33</span><span class="o">:</span> <span class="s">&quot;pageup&quot;</span>
  <span class="mi">34</span><span class="o">:</span> <span class="s">&quot;pagedown&quot;</span>
  <span class="mi">35</span><span class="o">:</span> <span class="s">&quot;end&quot;</span>
  <span class="mi">36</span><span class="o">:</span> <span class="s">&quot;home&quot;</span>
  <span class="mi">37</span><span class="o">:</span> <span class="s">&quot;left&quot;</span>
  <span class="mi">38</span><span class="o">:</span> <span class="s">&quot;up&quot;</span>
  <span class="mi">39</span><span class="o">:</span> <span class="s">&quot;right&quot;</span>
  <span class="mi">40</span><span class="o">:</span> <span class="s">&quot;down&quot;</span>
  <span class="mi">45</span><span class="o">:</span> <span class="s">&quot;ins&quot;</span>
  <span class="mi">46</span><span class="o">:</span> <span class="s">&quot;del&quot;</span>
  <span class="mi">91</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span>
  <span class="mi">93</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span>
  <span class="mi">224</span><span class="o">:</span> <span class="s">&quot;meta&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">mapping</span> <span class="k">for</span> <span class="nx">special</span> <span class="nx">characters</span> <span class="nx">so</span> <span class="nx">they</span> <span class="nx">can</span> <span class="nx">support</span>

<span class="k">this</span> <span class="nx">dictionary</span> <span class="o">is</span> <span class="nx">only</span> <span class="nx">used</span> <span class="nx">incase</span> <span class="nx">you</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">bind</span> <span class="nx">a</span>
<span class="nx">keyup</span> <span class="o">or</span> <span class="nx">keydown</span> <span class="nx">event</span> <span class="nx">to</span> <span class="nx">one</span> <span class="k">of</span> <span class="nx">these</span> <span class="nx">keys</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_KEYCODE_MAP =</span>
  <span class="mi">106</span><span class="o">:</span> <span class="s">&quot;*&quot;</span>
  <span class="mi">107</span><span class="o">:</span> <span class="s">&quot;+&quot;</span>
  <span class="mi">109</span><span class="o">:</span> <span class="s">&quot;-&quot;</span>
  <span class="mi">110</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="mi">111</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="mi">186</span><span class="o">:</span> <span class="s">&quot;;&quot;</span>
  <span class="mi">187</span><span class="o">:</span> <span class="s">&quot;=&quot;</span>
  <span class="mi">188</span><span class="o">:</span> <span class="s">&quot;,&quot;</span>
  <span class="mi">189</span><span class="o">:</span> <span class="s">&quot;-&quot;</span>
  <span class="mi">190</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="mi">191</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="mi">192</span><span class="o">:</span> <span class="s">&quot;`&quot;</span>
  <span class="mi">219</span><span class="o">:</span> <span class="s">&quot;[&quot;</span>
  <span class="mi">220</span><span class="o">:</span> <span class="s">&quot;\\&quot;</span>
  <span class="mi">221</span><span class="o">:</span> <span class="s">&quot;]&quot;</span>
  <span class="mi">222</span><span class="o">:</span> <span class="s">&quot;&#39;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">this</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">mapping</span> <span class="k">of</span> <span class="nx">keys</span> <span class="nx">that</span> <span class="nx">require</span> <span class="nx">shift</span> <span class="kc">on</span> <span class="nx">a</span> <span class="nx">US</span> <span class="nx">keypad</span>
<span class="nx">back</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">non</span> <span class="nx">shift</span> <span class="nx">equivelents</span>

<span class="k">this</span> <span class="o">is</span> <span class="nx">so</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">keyup</span> <span class="nx">events</span> <span class="nx">with</span> <span class="nx">these</span> <span class="nx">keys</span>

<span class="nx">note</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">only</span> <span class="nx">work</span> <span class="nx">reliably</span> <span class="kc">on</span> <span class="nx">US</span> <span class="nx">keyboards</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_SHIFT_MAP =</span>
  <span class="s">&quot;~&quot;</span><span class="o">:</span> <span class="s">&quot;`&quot;</span>
  <span class="s">&quot;!&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span>
  <span class="s">&quot;@&quot;</span><span class="o">:</span> <span class="s">&quot;2&quot;</span>
  <span class="s">&quot;</span><span class="err">#</span><span class="s">&quot;</span><span class="o">:</span> <span class="s">&quot;3&quot;</span>
  <span class="nv">$: </span><span class="s">&quot;4&quot;</span>
  <span class="s">&quot;%&quot;</span><span class="o">:</span> <span class="s">&quot;5&quot;</span>
  <span class="s">&quot;^&quot;</span><span class="o">:</span> <span class="s">&quot;6&quot;</span>
  <span class="s">&quot;&amp;&quot;</span><span class="o">:</span> <span class="s">&quot;7&quot;</span>
  <span class="s">&quot;*&quot;</span><span class="o">:</span> <span class="s">&quot;8&quot;</span>
  <span class="s">&quot;(&quot;</span><span class="o">:</span> <span class="s">&quot;9&quot;</span>
  <span class="s">&quot;)&quot;</span><span class="o">:</span> <span class="s">&quot;0&quot;</span>
  <span class="nv">_: </span><span class="s">&quot;-&quot;</span>
  <span class="s">&quot;+&quot;</span><span class="o">:</span> <span class="s">&quot;=&quot;</span>
  <span class="s">&quot;:&quot;</span><span class="o">:</span> <span class="s">&quot;;&quot;</span>
  <span class="s">&quot;\&quot;&quot;</span><span class="o">:</span> <span class="s">&quot;&#39;&quot;</span>
  <span class="s">&quot;&lt;&quot;</span><span class="o">:</span> <span class="s">&quot;,&quot;</span>
  <span class="s">&quot;&gt;&quot;</span><span class="o">:</span> <span class="s">&quot;.&quot;</span>
  <span class="s">&quot;?&quot;</span><span class="o">:</span> <span class="s">&quot;/&quot;</span>
  <span class="s">&quot;|&quot;</span><span class="o">:</span> <span class="s">&quot;\\&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">this</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">special</span> <span class="nx">strings</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">to</span> <span class="nx">map</span>
<span class="nx">to</span> <span class="nx">modifier</span> <span class="nx">keys</span> <span class="k">when</span> <span class="nx">you</span> <span class="nx">specify</span> <span class="nx">your</span> <span class="nx">keyboard</span> <span class="nx">shortcuts</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_SPECIAL_ALIASES =</span>
  <span class="nv">option: </span><span class="s">&quot;alt&quot;</span>
  <span class="nv">command: </span><span class="s">&quot;meta&quot;</span>
  <span class="k">return</span><span class="o">:</span> <span class="s">&quot;enter&quot;</span>
  <span class="nv">escape: </span><span class="s">&quot;esc&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">variable</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">flipped</span> <span class="nx">version</span> <span class="k">of</span> <span class="nx">_MAP</span> <span class="nx">from</span> <span class="nx">above</span>
<span class="nx">needed</span> <span class="nx">to</span> <span class="nx">check</span> <span class="k">if</span> <span class="nx">we</span> <span class="nx">should</span> <span class="nx">use</span> <span class="nx">keypress</span> <span class="o">or</span> <span class="o">not</span> <span class="k">when</span> <span class="kc">no</span> <span class="nx">action</span>
<span class="o">is</span> <span class="nx">specified</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="o">|</span><span class="kc">undefined</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_REVERSE_MAP = </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">callbacks</span> <span class="nx">setup</span> <span class="nx">via</span> <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">bind</span><span class="p">()</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_callbacks = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">direct</span> <span class="nx">map</span> <span class="k">of</span> <span class="nx">string</span> <span class="nx">combinations</span> <span class="nx">to</span> <span class="nx">callbacks</span> <span class="nx">used</span> <span class="k">for</span> <span class="nx">trigger</span><span class="p">()</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_directMap = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">keeps</span> <span class="nx">track</span> <span class="k">of</span> <span class="nx">what</span> <span class="nx">level</span> <span class="nx">each</span> <span class="nx">sequence</span> <span class="o">is</span> <span class="nx">at</span> <span class="nx">since</span> <span class="nx">multiple</span>
<span class="nx">sequences</span> <span class="nx">can</span> <span class="nx">start</span> <span class="nx">out</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">sequence</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_sequenceLevels = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">variable</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">setTimeout</span> <span class="nx">call</span>

<span class="nx">@type</span> <span class="p">{</span><span class="kc">null</span><span class="o">|</span><span class="nx">number</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetTimer = </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">temporary</span> <span class="nx">state</span> <span class="nx">where</span> <span class="nx">we</span> <span class="nx">will</span> <span class="nx">ignore</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">keyup</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">|</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ignoreNextKeyup = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">are</span> <span class="nx">we</span> <span class="nx">currently</span> <span class="nx">inside</span> <span class="k">of</span> <span class="nx">a</span> <span class="nx">sequence</span><span class="o">?</span>
<span class="nx">type</span> <span class="k">of</span> <span class="nx">action</span> <span class="p">(</span><span class="s">&quot;keyup&quot;</span> <span class="o">or</span> <span class="s">&quot;keydown&quot;</span> <span class="o">or</span> <span class="s">&quot;keypress&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="kc">false</span>

<span class="nx">@type</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">|</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_sequenceType = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">loop</span> <span class="nx">through</span> <span class="nx">the</span> <span class="nx">f</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">f1</span> <span class="nx">to</span> <span class="nx">f19</span> <span class="o">and</span> <span class="nx">add</span> <span class="nx">them</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">map</span>
<span class="nx">programatically</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">i = </span><span class="mi">1</span>
<span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">20</span>
  <span class="nx">_MAP</span><span class="p">[</span><span class="mi">111</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;f&quot;</span> <span class="o">+</span> <span class="nx">i</span>
  <span class="o">++</span><span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">loop</span> <span class="nx">through</span> <span class="nx">to</span> <span class="nx">map</span> <span class="nx">numbers</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">numeric</span> <span class="nx">keypad</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">i = </span><span class="mi">0</span>
<span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">9</span>
  <span class="nx">_MAP</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">96</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span>
  <span class="o">++</span><span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">cross</span> <span class="nx">browser</span> <span class="nx">add</span> <span class="nx">event</span> <span class="nx">method</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Element</span><span class="o">|</span><span class="nx">HTMLDocument</span><span class="p">}</span> <span class="nx">object</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">type</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Function</span><span class="p">}</span> <span class="nx">callback</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_addEvent = </span><span class="nf">(object, type, callback) -&gt;</span>
  <span class="k">if</span> <span class="nx">object</span><span class="p">.</span><span class="nx">addEventListener</span>
    <span class="nx">object</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span>
    <span class="k">return</span>
  <span class="nx">object</span><span class="p">.</span><span class="nx">attachEvent</span> <span class="s">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">takes</span> <span class="nx">the</span> <span class="nx">event</span> <span class="o">and</span> <span class="nx">returns</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">character</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@</span><span class="k">return</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_characterFromEvent = </span><span class="nf">(e) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>for keypress events we should return the character as is</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="s">&quot;keypress&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>for non keypress events the special maps are needed</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">_KEYCODE_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">_KEYCODE_MAP</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>if it is not in the special map</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">checks</span> <span class="k">if</span> <span class="nx">two</span> <span class="nx">arrays</span> <span class="nx">are</span> <span class="nx">equal</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers1</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers2</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nx">boolean</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_modifiersMatch = </span><span class="nf">(modifiers1, modifiers2) -&gt;</span>
  <span class="nx">modifiers1</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="nx">modifiers2</span><span class="p">.</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">resets</span> <span class="nx">all</span> <span class="nx">sequence</span> <span class="nx">counters</span> <span class="nx">except</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">ones</span> <span class="nx">passed</span> <span class="k">in</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Object</span><span class="p">}</span> <span class="nx">doNotReset</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetSequences = </span><span class="nf">(doNotReset, maxLevel) -&gt;</span>
  <span class="nv">doNotReset = </span><span class="nx">doNotReset</span> <span class="o">or</span> <span class="p">{}</span>
  <span class="nv">activeSequences = </span><span class="kc">false</span>
  <span class="nv">key = </span><span class="kc">undefined</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">_sequenceLevels</span>
    <span class="k">if</span> <span class="nx">doNotReset</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">and</span> <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">maxLevel</span>
      <span class="nv">activeSequences = </span><span class="kc">true</span>
      <span class="k">continue</span>
    <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nv">_sequenceType = </span><span class="kc">false</span>  <span class="k">unless</span> <span class="nx">activeSequences</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">finds</span> <span class="nx">all</span> <span class="nx">callbacks</span> <span class="nx">that</span> <span class="nx">match</span> <span class="nx">based</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">keycode</span><span class="p">,</span> <span class="nx">modifiers</span><span class="p">,</span>
<span class="o">and</span> <span class="nx">action</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">character</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span> <span class="nx">modifiers</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="o">|</span><span class="nb">Object</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">boolean</span><span class="o">=</span><span class="p">}</span> <span class="nx">remove</span> <span class="o">-</span> <span class="nx">should</span> <span class="nx">we</span> <span class="nx">remove</span> <span class="nx">any</span> <span class="nx">matches</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="o">=</span><span class="p">}</span> <span class="nx">combination</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_getMatches = </span><span class="nf">(character, modifiers, e, remove, combination) -&gt;</span>
  <span class="nv">i = </span><span class="kc">undefined</span>
  <span class="nv">callback = </span><span class="kc">undefined</span>
  <span class="nv">matches = </span><span class="p">[]</span>
  <span class="nv">action = </span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span>
  </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>if there are no events related to this keycode</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="p">[]</span>  <span class="k">unless</span> <span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>if a modifier key is coming up on its own we should allow it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">modifiers = </span><span class="p">[</span><span class="nx">character</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">action</span> <span class="o">is</span> <span class="s">&quot;keyup&quot;</span> <span class="o">and</span> <span class="nx">_isModifier</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>loop through all callbacks for the key that was pressed
and see if any of them match</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">].</span><span class="nx">length</span><span class="p">]</span>
    <span class="nv">callback = </span><span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span>
    </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>if this is a sequence but it is not at the right level
then move onto the next match</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">continue</span>  <span class="k">if</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">seq</span> <span class="o">and</span> <span class="nx">_sequenceLevels</span><span class="p">[</span><span class="nx">callback</span><span class="p">.</span><span class="nx">seq</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">level</span>
    </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>if the action we are looking for doesn't match the action we got
then we should keep going</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">continue</span>  <span class="k">unless</span> <span class="nx">action</span> <span class="o">is</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">action</span>
    </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>if this is a keypress event and the meta key and control key
are not pressed that means that we need to only look at the
character, otherwise check the modifiers as well</p>

<p>chrome will not fire a keypress if meta or control is down
safari will fire a keypress if meta or meta+shift is down
firefox will fire a keypress if meta or control is down</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">action</span> <span class="o">is</span> <span class="s">&quot;keypress&quot;</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">)</span> <span class="o">or</span> <span class="nx">_modifiersMatch</span><span class="p">(</span><span class="nx">modifiers</span><span class="p">,</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">modifiers</span><span class="p">)</span>
      </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>remove is used so if you change your mind and call bind a
second time with a new function the first one is overwritten</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_callbacks</span><span class="p">[</span><span class="nx">character</span><span class="p">].</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span>  <span class="k">if</span> <span class="nx">remove</span> <span class="o">and</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">combo</span> <span class="o">is</span> <span class="nx">combination</span>
      <span class="nx">matches</span><span class="p">.</span><span class="nx">push</span> <span class="nx">callback</span>
  <span class="nx">matches</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">takes</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">event</span> <span class="o">and</span> <span class="nx">figures</span> <span class="nx">out</span> <span class="nx">what</span> <span class="nx">the</span> <span class="nx">modifiers</span> <span class="nx">are</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nb">Array</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_eventModifiers = </span><span class="nf">(e) -&gt;</span>
  <span class="nv">modifiers = </span><span class="p">[]</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;shift&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">shiftKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;alt&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">altKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;ctrl&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctrlKey</span>
  <span class="nx">modifiers</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;meta&quot;</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">metaKey</span>
  <span class="nx">modifiers</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">actually</span> <span class="nx">calls</span> <span class="nx">the</span> <span class="nx">callback</span> <span class="nx">function</span>

<span class="k">if</span> <span class="nx">your</span> <span class="nx">callback</span> <span class="nx">function</span> <span class="nx">returns</span> <span class="kc">false</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">jquery</span>
<span class="nx">convention</span> <span class="o">-</span> <span class="nx">prevent</span> <span class="nx">default</span> <span class="o">and</span> <span class="nx">stop</span> <span class="nx">propogation</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nb">Function</span><span class="p">}</span> <span class="nx">callback</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_fireCallback = </span><span class="nf">(callback, e, combo) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>if this event should not happen stop here</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span>  <span class="k">if</span> <span class="nx">Mousetrap</span><span class="p">.</span><span class="nx">stopCallback</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">or</span> <span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">,</span> <span class="nx">combo</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">combo</span><span class="p">)</span> <span class="o">is</span> <span class="kc">false</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span>
    <span class="nv">e.returnValue = </span><span class="kc">false</span>
    <span class="nv">e.cancelBubble = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">handles</span> <span class="nx">a</span> <span class="nx">character</span> <span class="nx">key</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">character</span>
<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_handleCharacter = </span><span class="nf">(character, e) -&gt;</span>
  <span class="nv">callbacks = </span><span class="nx">_getMatches</span><span class="p">(</span><span class="nx">character</span><span class="p">,</span> <span class="nx">_eventModifiers</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">e</span><span class="p">)</span>
  <span class="nv">i = </span><span class="kc">undefined</span>
  <span class="nv">doNotReset = </span><span class="p">{}</span>
  <span class="nv">maxLevel = </span><span class="mi">0</span>
  <span class="nv">processedSequenceCallback = </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>loop through matching callbacks for this key event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span>
    </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>fire for all sequence callbacks
this is because if for example you have multiple sequences
bound such as "g i" and "g t" they both need to fire the
callback for matching g cause otherwise you can only ever
match the first one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">seq</span>
      <span class="nv">processedSequenceCallback = </span><span class="kc">true</span>
      </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>as we loop through keep track of the max
any sequence at a lower level will be discarded</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">maxLevel = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">maxLevel</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">level</span><span class="p">)</span>
      </pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>keep a list of which sequences were matches for later</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">doNotReset</span><span class="p">[</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">seq</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nx">_fireCallback</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">combo</span>
      <span class="k">continue</span>
    </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>if there were no sequence matches but we are still here
that means this is a regular match so we should fire that</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_fireCallback</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">combo</span>  <span class="k">if</span> <span class="o">not</span> <span class="nx">processedSequenceCallback</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_sequenceType</span>
    <span class="o">++</span><span class="nx">i</span>
  </pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>if you are inside of a sequence and the key you are pressing
is not a modifier key then we should reset all sequences
that were not matched by this key event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_resetSequences</span> <span class="nx">doNotReset</span><span class="p">,</span> <span class="nx">maxLevel</span>  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="nx">_sequenceType</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">_isModifier</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">handles</span> <span class="nx">a</span> <span class="nx">keydown</span> <span class="nx">event</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">Event</span><span class="p">}</span> <span class="nx">e</span>
<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_handleKey = </span><span class="nf">(e) -&gt;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>normalize e.which for key events
@see http://stackoverflow.com/questions/4285627/javascript-keycode-vs-charcode-utter-confusion</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">e.which = </span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">isnt</span> <span class="s">&quot;number&quot;</span>
  <span class="nv">character = </span><span class="nx">_characterFromEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>no character found then stop</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span>  <span class="k">unless</span> <span class="nx">character</span>
  <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="s">&quot;keyup&quot;</span> <span class="o">and</span> <span class="nx">_ignoreNextKeyup</span> <span class="o">is</span> <span class="nx">character</span>
    <span class="nv">_ignoreNextKeyup = </span><span class="kc">false</span>
    <span class="k">return</span>
  <span class="nx">_handleCharacter</span> <span class="nx">character</span><span class="p">,</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">determines</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">keycode</span> <span class="nx">specified</span> <span class="o">is</span> <span class="nx">a</span> <span class="nx">modifier</span> <span class="nx">key</span> <span class="o">or</span> <span class="o">not</span>

<span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">key</span>
<span class="nx">@returns</span> <span class="p">{</span><span class="nx">boolean</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_isModifier = </span><span class="nf">(key) -&gt;</span>
  <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;shift&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;ctrl&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;alt&quot;</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">is</span> <span class="s">&quot;meta&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">called</span> <span class="nx">to</span> <span class="nx">set</span> <span class="nx">a</span> <span class="mi">1</span> <span class="nx">second</span> <span class="nx">timeout</span> <span class="kc">on</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">sequence</span>

<span class="k">this</span> <span class="o">is</span> <span class="nx">so</span> <span class="nx">after</span> <span class="nx">each</span> <span class="nx">key</span> <span class="nx">press</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">sequence</span> <span class="nx">you</span> <span class="nx">have</span> <span class="mi">1</span> <span class="nx">second</span>
<span class="nx">to</span> <span class="nx">press</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">key</span> <span class="nx">before</span> <span class="nx">you</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">start</span> <span class="nx">over</span>

<span class="nx">@returns</span> <span class="nx">void</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_resetSequenceTimer = </span><span class="nf">-&gt;</span>
  <span class="nx">clearTimeout</span> <span class="nx">_resetTimer</span>
  <span class="nv">_resetTimer = </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">_resetSequences</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">reverses</span> <span class="nx">the</span> <span class="nx">map</span> <span class="nx">lookup</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">we</span> <span class="nx">can</span> <span class="nx">look</span> <span class="k">for</span> <span class="nx">specific</span> <span class="nx">keys</span>
<span class="nx">to</span> <span class="nx">see</span> <span class="nx">what</span> <span class="nx">can</span> <span class="o">and</span> <span class="nx">can</span><span class="s">&#39;t use keypress</span>

<span class="s">@return {Object}</span>

<span class="s">#DIVIDER</span>
<span class="s">_getReverseMap = -&gt;</span>
<span class="s">  unless _REVERSE_MAP</span>
<span class="s">    _REVERSE_MAP = {}</span>
<span class="s">    for key of _MAP</span>
<span class="s">      </span>

<span class="s">#DIVIDER</span>
<span class="s">      continue  if key &gt; 95 and key &lt; 112</span>
<span class="s">      _REVERSE_MAP[_MAP[key]] = key  if _MAP.hasOwnProperty(key)</span>
<span class="s">  _REVERSE_MAP</span>


<span class="s">#DIVIDER</span>
<span class="s">picks the best action based on the key combination</span>

<span class="s">@param {string} key - character for key</span>
<span class="s">@param {Array} modifiers</span>
<span class="s">@param {string=} action passed in</span>

<span class="s">#DIVIDER</span>
<span class="s">_pickBestAction = (key, modifiers, action) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = (if _getReverseMap()[key] then &quot;keydown&quot; else &quot;keypress&quot;)  unless action</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = &quot;keydown&quot;  if action is &quot;keypress&quot; and modifiers.length</span>
<span class="s">  action</span>


<span class="s">#DIVIDER</span>
<span class="s">binds a key sequence to an event</span>

<span class="s">@param {string} combo - combo specified in bind call</span>
<span class="s">@param {Array} keys</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string=} action</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindSequence = (combo, keys, callback, action) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _sequenceLevels[combo] = 0</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = _pickBestAction(keys[0], [])  unless action</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  callback to increase the sequence level for this sequence and reset</span>
<span class="s">  all other sequences that were active</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  _increaseSequence = -&gt;</span>
<span class="s">    _sequenceType = action</span>
<span class="s">    ++_sequenceLevels[combo]</span>
<span class="s">    _resetSequenceTimer()</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  wraps the specified callback inside of another function in order</span>
<span class="s">  to reset all sequence counters as soon as this sequence is done</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbackAndReset = (e) -&gt;</span>
<span class="s">    _fireCallback callback, e, combo</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    _ignoreNextKeyup = _characterFromEvent(e)  if action isnt &quot;keyup&quot;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    setTimeout _resetSequences, 10</span>

<span class="s">  i = undefined</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  i = 0</span>
<span class="s">  while i &lt; keys.length</span>
<span class="s">    _bindSingle keys[i], (if i &lt; keys.length - 1 then _increaseSequence else _callbackAndReset), action, combo, i</span>
<span class="s">    ++i</span>


<span class="s">#DIVIDER</span>
<span class="s">binds a single keyboard combination</span>

<span class="s">@param {string} combination</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string=} action</span>
<span class="s">@param {string=} sequenceName - name of sequence if part of sequence</span>
<span class="s">@param {number=} level - what part of the sequence the command is</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindSingle = (combination, callback, action, sequenceName, level) -&gt;</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _directMap[combination + &quot;:&quot; + action] = callback</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  combination = combination.replace(/\s+/g, &quot; &quot;)</span>
<span class="s">  sequence = combination.split(&quot; &quot;)</span>
<span class="s">  i = undefined</span>
<span class="s">  key = undefined</span>
<span class="s">  keys = undefined</span>
<span class="s">  modifiers = []</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  if sequence.length &gt; 1</span>
<span class="s">    _bindSequence combination, sequence, callback, action</span>
<span class="s">    return</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  keys = (if combination is &quot;+&quot; then [&quot;+&quot;] else combination.split(&quot;+&quot;))</span>
<span class="s">  i = 0</span>
<span class="s">  while i &lt; keys.length</span>
<span class="s">    key = keys[i]</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    key = _SPECIAL_ALIASES[key]  if _SPECIAL_ALIASES[key]</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    if action and action isnt &quot;keypress&quot; and _SHIFT_MAP[key]</span>
<span class="s">      key = _SHIFT_MAP[key]</span>
<span class="s">      modifiers.push &quot;shift&quot;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    modifiers.push key  if _isModifier(key)</span>
<span class="s">    ++i</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  action = _pickBestAction(key, modifiers, action)</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbacks[key] = []  unless _callbacks[key]</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _getMatches key, modifiers,</span>
<span class="s">    type: action</span>
<span class="s">  , not sequenceName, combination</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  _callbacks[key][(if sequenceName then &quot;unshift&quot; else &quot;push&quot;)]</span>
<span class="s">    callback: callback</span>
<span class="s">    modifiers: modifiers</span>
<span class="s">    action: action</span>
<span class="s">    seq: sequenceName</span>
<span class="s">    level: level</span>
<span class="s">    combo: combination</span>



<span class="s">#DIVIDER</span>
<span class="s">binds multiple combinations to the same callback</span>

<span class="s">@param {Array} combinations</span>
<span class="s">@param {Function} callback</span>
<span class="s">@param {string|undefined} action</span>
<span class="s">@returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">_bindMultiple = (combinations, callback, action) -&gt;</span>
<span class="s">  i = 0</span>

<span class="s">  while i &lt; combinations.length</span>
<span class="s">    _bindSingle combinations[i], callback, action</span>
<span class="s">    ++i</span>



<span class="s">#DIVIDER</span>
<span class="s">_addEvent document, &quot;keypress&quot;, _handleKey</span>
<span class="s">_addEvent document, &quot;keydown&quot;, _handleKey</span>
<span class="s">_addEvent document, &quot;keyup&quot;, _handleKey</span>
<span class="s">Mousetrap =</span>
<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  binds an event to mousetrap</span>
<span class="s">  </span>
<span class="s">  can be a single key, a combination of keys separated with +,</span>
<span class="s">  an array of keys, or a sequence of keys separated by spaces</span>
<span class="s">  </span>
<span class="s">  be sure to list the modifier keys first to make sure that the</span>
<span class="s">  correct key ends up getting bound (the last key in the pattern)</span>
<span class="s">  </span>
<span class="s">  @param {string|Array} keys</span>
<span class="s">  @param {Function} callback</span>
<span class="s">  @param {string=} action - &#39;</span><span class="nx">keypress</span><span class="s">&#39;, &#39;</span><span class="nx">keydown</span><span class="s">&#39;, or &#39;</span><span class="nx">keyup</span><span class="s">&#39;</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  bind: (keys, callback, action) -&gt;</span>
<span class="s">    keys = (if keys instanceof Array then keys else [keys])</span>
<span class="s">    _bindMultiple keys, callback, action</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  unbinds an event to mousetrap</span>
<span class="s">  </span>
<span class="s">  the unbinding sets the callback function of the specified key combo</span>
<span class="s">  to an empty function and deletes the corresponding key in the</span>
<span class="s">  _directMap dict.</span>
<span class="s">  </span>
<span class="s">  TODO: actually remove this from the _callbacks dictionary instead</span>
<span class="s">  of binding an empty function</span>
<span class="s">  </span>
<span class="s">  the keycombo+action has to be exactly the same as</span>
<span class="s">  it was defined in the bind method</span>
<span class="s">  </span>
<span class="s">  @param {string|Array} keys</span>
<span class="s">  @param {string} action</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  unbind: (keys, action) -&gt;</span>
<span class="s">    Mousetrap.bind keys, (-&gt;</span>
<span class="s">    ), action</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  triggers an event that has already been bound</span>
<span class="s">  </span>
<span class="s">  @param {string} keys</span>
<span class="s">  @param {string=} action</span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  trigger: (keys, action) -&gt;</span>
<span class="s">    _directMap[keys + &quot;:&quot; + action] {}, keys  if _directMap[keys + &quot;:&quot; + action]</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  resets the library back to its initial state.  this is useful</span>
<span class="s">  if you want to clear out the current keyboard shortcuts and bind</span>
<span class="s">  new ones - for example if you switch to another page</span>
<span class="s">  </span>
<span class="s">  @returns void</span>

<span class="s">#DIVIDER</span>
<span class="s">  reset: -&gt;</span>
<span class="s">    _callbacks = {}</span>
<span class="s">    _directMap = {}</span>
<span class="s">    this</span>

<span class="s">  </span>

<span class="s">#DIVIDER</span>
<span class="s">  should we stop this event before firing off callbacks</span>
<span class="s">  </span>
<span class="s">  @param {Event} e</span>
<span class="s">  @param {Element} element</span>
<span class="s">  @return {boolean}</span>

<span class="s">#DIVIDER</span>
<span class="s">  stopCallback: (e, element) -&gt;</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    return false  if (&quot; &quot; + element.className + &quot; &quot;).indexOf(&quot; mousetrap &quot;) &gt; -1</span>
<span class="s">    </span>

<span class="s">#DIVIDER</span>
<span class="s">    element.tagName is &quot;INPUT&quot; or element.tagName is &quot;SELECT&quot; or element.tagName is &quot;TEXTAREA&quot; or (element.contentEditable and element.contentEditable is &quot;true&quot;)</span>

<span class="s">window.Mousetrap = Mousetrap</span>

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>pull out the numeric keypad from here cause keypress should
be able to detect the keys from the character</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>if no action was picked in we should try to pick the one
that we think would work best for this key</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>modifier keys don't work as expected with keypress,
switch to keydown</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>start off by adding a sequence level record for this combination
and setting the level to 0</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>if there is no action pick the best one for the first key
in the sequence</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>we should ignore the next key up if the action is key down
or keypress.  this is so if you finish a sequence and
release the key the final key will not trigger a keyup</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>weird race condition if a sequence ends with the key
another sequence begins with</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>loop through keys one at a time and bind the appropriate callback
function.  for any key leading up to the final one it should
increase the sequence. after the final, it should reset all sequences</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>store a direct mapped reference for use with Mousetrap.trigger</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>make sure multiple spaces in a row become a single space</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>if this pattern is a sequence of keys then run through this method
to reprocess each pattern one key at a time</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>take the keys from this pattern and figure out what the actual
pattern is all about</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>normalize key names</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>if this is not a keypress event then we should
be smart about using shift keys
this will only work for US keyboards however</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>if this key is a modifier then add it to the list of modifiers</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>depending on what the key combination is
we will try to pick the best event for it</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>make sure to initialize array if this is the first time
a callback is added for this key</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>remove an existing match if there is one</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>add this call back to the array
if it is a sequence put it at the beginning
if not put it at the end</p>

<p>this is important because the way these are processed expects
the sequence ones to come first</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>start!</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>if the element has the class "mousetrap" then no need to stop</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>stop for input, select, and textarea</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 