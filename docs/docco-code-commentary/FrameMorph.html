<!DOCTYPE html>  <html> <head>   <title>FrameMorph.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="BlinkerMorph.html">                 BlinkerMorph.coffee               </a>                                           <a class="source" href="BouncerMorph.html">                 BouncerMorph.coffee               </a>                                           <a class="source" href="BoxMorph.html">                 BoxMorph.coffee               </a>                                           <a class="source" href="CaretMorph.html">                 CaretMorph.coffee               </a>                                           <a class="source" href="CircleBoxMorph.html">                 CircleBoxMorph.coffee               </a>                                           <a class="source" href="CloseCircleButtonMorph.html">                 CloseCircleButtonMorph.coffee               </a>                                           <a class="source" href="Color.html">                 Color.coffee               </a>                                           <a class="source" href="ColorPaletteMorph.html">                 ColorPaletteMorph.coffee               </a>                                           <a class="source" href="ColorPickerMorph.html">                 ColorPickerMorph.coffee               </a>                                           <a class="source" href="FrameMorph.html">                 FrameMorph.coffee               </a>                                           <a class="source" href="GrayPaletteMorph.html">                 GrayPaletteMorph.coffee               </a>                                           <a class="source" href="HandMorph.html">                 HandMorph.coffee               </a>                                           <a class="source" href="HandleMorph.html">                 HandleMorph.coffee               </a>                                           <a class="source" href="InspectorMorph.html">                 InspectorMorph.coffee               </a>                                           <a class="source" href="ListMorph.html">                 ListMorph.coffee               </a>                                           <a class="source" href="MenuItemMorph.html">                 MenuItemMorph.coffee               </a>                                           <a class="source" href="MenuMorph.html">                 MenuMorph.coffee               </a>                                           <a class="source" href="Morph.html">                 Morph.coffee               </a>                                           <a class="source" href="MorphicNode.html">                 MorphicNode.coffee               </a>                                           <a class="source" href="MorphsListMorph.html">                 MorphsListMorph.coffee               </a>                                           <a class="source" href="MouseSensorMorph.html">                 MouseSensorMorph.coffee               </a>                                           <a class="source" href="Mousetrap.html">                 Mousetrap.coffee               </a>                                           <a class="source" href="PenMorph.html">                 PenMorph.coffee               </a>                                           <a class="source" href="Point.html">                 Point.coffee               </a>                                           <a class="source" href="Point2.html">                 Point2.coffee               </a>                                           <a class="source" href="Rectangle.html">                 Rectangle.coffee               </a>                                           <a class="source" href="RectangleMorph.html">                 RectangleMorph.coffee               </a>                                           <a class="source" href="ScrollFrameMorph.html">                 ScrollFrameMorph.coffee               </a>                                           <a class="source" href="ShadowMorph.html">                 ShadowMorph.coffee               </a>                                           <a class="source" href="SliderButtonMorph.html">                 SliderButtonMorph.coffee               </a>                                           <a class="source" href="SliderMorph.html">                 SliderMorph.coffee               </a>                                           <a class="source" href="SpeechBubbleMorph.html">                 SpeechBubbleMorph.coffee               </a>                                           <a class="source" href="StringFieldMorph.html">                 StringFieldMorph.coffee               </a>                                           <a class="source" href="StringMorph.html">                 StringMorph.coffee               </a>                                           <a class="source" href="SystemTest_SimpleMenuTest.html">                 SystemTest_SimpleMenuTest.coffee               </a>                                           <a class="source" href="SystemTestsRecorderAndPlayer.html">                 SystemTestsRecorderAndPlayer.coffee               </a>                                           <a class="source" href="TextMorph.html">                 TextMorph.coffee               </a>                                           <a class="source" href="TriggerMorph.html">                 TriggerMorph.coffee               </a>                                           <a class="source" href="WorkspaceMorph.html">                 WorkspaceMorph.coffee               </a>                                           <a class="source" href="WorldMorph.html">                 WorldMorph.coffee               </a>                                           <a class="source" href="globalFunctions.html">                 globalFunctions.coffee               </a>                                           <a class="source" href="globalSettings.html">                 globalSettings.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               FrameMorph.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>| FrameMorph //////////////////////////////////////////////////////////
| 
| I clip my submorphs at my bounds. Which potentially saves a lot of redrawing
| 
| and event handling.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">FrameMorph</span> <span class="k">extends</span> <span class="nx">Morph</span>

  <span class="vi">@scrollFrame: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>if this frame belongs to a scrollFrame, then
the @scrollFrame points to it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@scrollFrame = null) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@color = </span><span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">245</span><span class="p">)</span>
    <span class="vi">@acceptsDrops = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@isDraggable = </span><span class="kc">false</span>
      <span class="vi">@noticesTransparentClick = </span><span class="kc">false</span>
    <span class="nx">@updateRendering</span><span class="p">()</span>

  <span class="nv">setColor: </span><span class="nf">(aColor) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>keep in synch the value of the container scrollFrame
if there is one. Note that the container srollFrame
is actually not painted.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@scrollFrame.color = </span><span class="nx">aColor</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">aColor</span><span class="p">)</span>

  <span class="nv">setAlphaScaled: </span><span class="nf">(alpha) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>keep in synch the value of the container scrollFrame
if there is one. Note that the container srollFrame
is actually not painted.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@scrollFrame</span>
      <span class="vi">@scrollFrame.alpha = </span><span class="nx">@calculateAlphaScaled</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span>
  
  <span class="nv">boundsIncludingChildren: </span><span class="nf">-&gt;</span>
    <span class="nv">shadow = </span><span class="nx">@getShadow</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">shadow</span> <span class="o">isnt</span> <span class="kc">null</span>
    <span class="nx">@bounds</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This was in the original Morphic.js, but
it would cause the frame (or scrollframe) not to paint its
contents when "pic..." command is invoked.
fullImage: ->
 # use only for shadows
 @image</p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">recursivelyBlit: </span><span class="nf">(aCanvas, clippingRectangle = @bounds) -&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">unless</span> <span class="nx">@isVisible</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>the part to be redrawn could be outside the frame entirely,
in which case we can stop going down the morphs inside the frame
since the whole point of the frame is to clip everything to a specific
rectangle.
So, check which part of the Frame should be redrawn:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dirtyPartOfFrame = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">clippingRectangle</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if there is no dirty part in the frame then do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="nx">dirtyPartOfFrame</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>this draws the background of the frame itself, which could
contain an image or a pentrail</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@blit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">dirtyPartOfFrame</span>
    
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) =&gt;</span>
      <span class="k">if</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">ShadowMorph</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">clippingRectangle</span>
      <span class="k">else</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">recursivelyBlit</span> <span class="nx">aCanvas</span><span class="p">,</span> <span class="nx">dirtyPartOfFrame</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>FrameMorph scrolling optimization:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">moveBy: </span><span class="nf">(delta) -&gt;</span>
    <span class="nx">@changed</span><span class="p">()</span>
    <span class="vi">@bounds = </span><span class="nx">@bounds</span><span class="p">.</span><span class="nx">translateBy</span><span class="p">(</span><span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">silentMoveBy</span> <span class="nx">delta</span>
    <span class="nx">@changed</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>FrameMorph scrolling support:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submorphBounds: </span><span class="nf">-&gt;</span>
    <span class="nv">result = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nv">result = </span><span class="nx">@children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bounds</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(child) -&gt;</span>
        <span class="nv">result = </span><span class="nx">result</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">boundsIncludingChildren</span><span class="p">())</span>
    <span class="nx">result</span>
  
  <span class="nv">keepInScrollFrame: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@left</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@right</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="k">if</span> <span class="nx">@top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">top</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@top</span><span class="p">())</span>  
    <span class="k">if</span> <span class="nx">@bottom</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span>
      <span class="nx">@moveBy</span> <span class="mi">0</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@bottom</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
  
  <span class="nv">adjustBounds: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="kc">null</span>  <span class="k">if</span> <span class="nx">@scrollFrame</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nv">subBounds = </span><span class="nx">@submorphBounds</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">subBounds</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span><span class="p">)</span>
      <span class="nv">newBounds = </span><span class="nx">subBounds</span><span class="p">.</span><span class="nx">expandBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">padding</span><span class="p">).</span><span class="nx">growBy</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">growth</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">newBounds = </span><span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">copy</span><span class="p">()</span>
    <span class="k">unless</span> <span class="nx">@bounds</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">newBounds</span><span class="p">)</span>
      <span class="vi">@bounds = </span><span class="nx">newBounds</span>
      <span class="nx">@updateRendering</span><span class="p">()</span>
      <span class="nx">@keepInScrollFrame</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">isTextLineWrapping</span>
      <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(morph) =&gt;</span>
        <span class="k">if</span> <span class="nx">morph</span> <span class="k">instanceof</span> <span class="nx">TextMorph</span>
          <span class="nx">morph</span><span class="p">.</span><span class="nx">setWidth</span> <span class="nx">@width</span><span class="p">()</span>
          <span class="nx">@setHeight</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">morph</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span> <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">height</span><span class="p">())</span>
    <span class="nx">@scrollFrame</span><span class="p">.</span><span class="nx">adjustScrollBars</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>FrameMorph dragging &amp; dropping of contents:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reactToDropOf: </span><span class="nf">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  <span class="nv">reactToGrabOf: </span><span class="nf">-&gt;</span>
    <span class="nx">@adjustBounds</span><span class="p">()</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>FrameMorph duplicating:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">copyRecordingReferences: </span><span class="nf">(dict) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>inherited, see comment in Morph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">c = </span><span class="k">super</span> <span class="nx">dict</span>
    <span class="nv">c.frame = </span><span class="p">(</span><span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">])</span>  <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">frame</span> <span class="o">and</span> <span class="nx">dict</span><span class="p">[</span><span class="nx">@scrollFrame</span><span class="p">]</span>
    <span class="nx">c</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>FrameMorph menus:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">developersMenu: </span><span class="nf">-&gt;</span>
    <span class="nv">menu = </span><span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@children</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addLine</span><span class="p">()</span>
      <span class="nx">menu</span><span class="p">.</span><span class="nx">addItem</span> <span class="s">&quot;move all inside...&quot;</span><span class="p">,</span> <span class="s">&quot;keepAllSubmorphsWithin&quot;</span><span class="p">,</span> <span class="s">&quot;keep all submorphs\nwithin and visible&quot;</span>
    <span class="nx">menu</span>
  
  <span class="nv">keepAllSubmorphsWithin: </span><span class="nf">-&gt;</span>
    <span class="nx">@children</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(m) =&gt;</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">keepWithin</span> <span class="nx">@</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 